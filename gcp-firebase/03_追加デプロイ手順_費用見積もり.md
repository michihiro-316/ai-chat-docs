# テナント追加手順 & 費用見積もり

| 項目 | 内容 |
|------|------|
| 対象 | 2つ目以降のテナント追加時 |
| 作業時間 | 約30分（＋DNS反映待ち） |

---

## テナント追加手順

基盤（GCP/Firebase）は初回で構築済みなので、以下の作業のみでOK。

### Step 1: サービスアカウント作成（5分）

1. GCPコンソール →「IAMと管理」→「サービスアカウント」
2. 「サービスアカウントを作成」
3. 名前: `sa-tenant-b`（テナントBの場合）
4. ロール:「Secret Manager のシークレット アクセサー」
5. 「完了」

---

### Step 2: APIキー登録（5分）

1. GCPコンソール →「Secret Manager」→「シークレットを作成」
2. 名前: `tenant-b-openai-key`
3. 値: APIキーを入力 →「作成」
4. 作成したシークレット →「権限」→「アクセスを許可」
5. プリンシパル: `sa-tenant-b@[PROJECT_ID].iam.gserviceaccount.com`
6. ロール:「Secret Manager のシークレット アクセサー」

---

### Step 3: Cloud Run作成（10分）

1. GCPコンソール →「Cloud Run」→「サービスを作成」
2. コンテナイメージ: アプリのイメージURL
3. サービス名: `ai-platform-tenant-b`
4. リージョン: `asia-northeast1`
5. 認証:「未認証の呼び出しを許可」
6. セキュリティ → サービスアカウント: `sa-tenant-b`
7. 「作成」
8. 作成後 →「変数とシークレット」でシークレット紐付け

---

### Step 4: ドメイン設定（5分＋待ち時間）

1. Cloud Run → サービス →「ドメイン マッピングを管理」
2. ドメイン: `companyb.anddigital.co.jp`
3. DNS管理画面でCNAMEレコード追加:
   - ホスト: `companyb`
   - 値: `ghs.googlehosted.com`
4. Firebase → Authentication →「承認済みドメイン」に追加

---

### 完了チェック

| チェック | 確認項目 |
|:------:|---------|
| ☐ | https://companyb.anddigital.co.jp にアクセスできる |
| ☐ | SSL証明書が有効（鍵マーク表示） |
| ☐ | Googleログインが動作する |

---

## 費用見積もり

### 月額費用まとめ

| 規模 | 月額 | 内訳 |
|------|------|------|
| 1テナント | **約$5〜15** | Cloud Run $5〜15 |
| 3テナント | **約$15〜45** | Cloud Run × 3 |
| 5テナント | **約$25〜75** | Cloud Run × 5 |

**注意:** AI API（OpenAI、Anthropic等）の利用料金は別途発生します。

---

### 1テナント追加時の追加コスト

| 項目 | 月額 |
|------|------|
| Cloud Run | $5〜20 |
| Secret Manager | 〜$0.1 |
| **合計** | **約$5〜20** |

---

### 無料枠

| サービス | 無料枠 |
|---------|--------|
| Cloud Run | 月200万リクエスト |
| Firebase Auth | 月5万認証 |
| Secret Manager | 6シークレット |

---

## よくある質問

### Q: 想定より費用が高くなった場合は？

以下を確認:
1. Cloud Runの最小インスタンス数が0か確認（1以上だと常時課金）
2. 使っていないサービスを削除
3. GCPコンソール →「お支払い」→「予算とアラート」で予算設定

### Q: AI APIの料金は含まれていますか？

含まれていません。OpenAI、Anthropic等の料金は各プロバイダーに直接支払いです。

---

## 予算アラートの設定（推奨）

1. GCPコンソール →「お支払い」→「予算とアラート」
2. 「予算を作成」
3. 予算額: $50（例）
4. アラート: 50%、80%、100%到達時に通知
5. 通知先メールを設定 →「保存」
