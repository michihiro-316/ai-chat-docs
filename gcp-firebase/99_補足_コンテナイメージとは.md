# コンテナイメージとは（補足資料）

> この資料は「Cloud Run（サービス）版」で使用するコンテナイメージの解説です。
> Cloud Run functions版（02_構築手順書.md）では、コンテナイメージは不要です（コードを直接入力するだけ）。

---

## コンテナイメージを一言で

**アプリを動かすための「完成品パッケージ」** です。

---

## イメージ図

```
┌─────────────────────────────────┐
│       コンテナイメージ            │
├─────────────────────────────────┤
│  OS（Linux等）                   │
│  実行環境（Python / Node.js 等） │
│  ライブラリ（Flask, React等）    │
│  あなたのコード（main.py等）      │
│  設定ファイル                    │
└─────────────────────────────────┘
```

アプリを動かすのに必要なものが**全部入ったZIPファイル**のようなものです。

---

## 身近な例えで理解する

| 例え | コンテナイメージ |
|------|-----------------|
| お弁当 | ご飯、おかず、箸、容器が全部セット。開けたらすぐ食べられる |
| インスタント食品 | お湯を入れるだけで完成。環境を選ばない |
| ゲームソフト | 本体に入れたらすぐ遊べる。インストール済みの状態 |

---

## なぜコンテナイメージを使うのか

### 従来の問題

```
開発者A: 「私のPCでは動くんですけど...」
開発者B: 「こっちでは動かない」
サーバー: 「本番環境でエラーが出ました」

原因:
- Pythonのバージョンが違う
- ライブラリのバージョンが違う
- OSの設定が違う
```

### コンテナイメージで解決

```
開発者A: 「このイメージを使って」
開発者B: 「OK、動いた」
サーバー: 「同じイメージなので同じ動作です」

理由:
- 全員が同じ「パッケージ」を使う
- 環境の差異がなくなる
```

---

## 手順書で使っている `gcr.io/cloudrun/hello`

これは**Googleが用意したテスト用のサンプルイメージ**です。

| 項目 | 内容 |
|------|------|
| 提供元 | Google公式 |
| 中身 | 「Hello World」を表示するだけのシンプルなアプリ |
| 目的 | Cloud Runの動作確認用 |
| Dockerの準備 | **不要**（Googleが作成済み） |

URLを指定するだけで、すぐにCloud Runにデプロイできます。

---

## 本番で自分のアプリを動かす場合（参考）

本プロジェクトでは行いませんが、参考として記載します。

### 方法1: ローカルPCでDockerを使う

```
1. Dockerをインストール
2. Dockerfile を書く
3. docker build でイメージを作成
4. Google Container Registry にアップロード
5. Cloud Run でそのイメージを指定
```

### 方法2: Cloud Build（GCPサービス）を使う

```
1. ソースコードとDockerfileをアップロード
2. GCPがクラウド上でビルドしてくれる
3. 自動的にContainer Registryに保存される
4. Cloud Run でそのイメージを指定

※ ローカルPCにDockerは不要
```

---

## Dockerとコンテナイメージの関係

| 用語 | 説明 | 例え |
|------|------|------|
| Docker | コンテナを作る・動かすためのツール | 工場の機械 |
| Dockerfile | イメージの設計図 | 製品の設計書 |
| コンテナイメージ | 完成したパッケージ | 完成した製品 |
| コンテナ | イメージを実行している状態 | 製品を使っている状態 |

---

## まとめ

| 方式 | Dockerの準備 | 用途 |
|------|-------------|------|
| Cloud Run functions | **不要** | シンプルなAPI（推奨） |
| Cloud Run（サービス）テスト用 | 不要（Google提供イメージ使用） | 動作確認用 |
| Cloud Run（サービス）本番用 | 必要（または Cloud Build） | 複雑なアプリ |

**本プロジェクトではCloud Run functions版を採用しているため、Docker/コンテナイメージは不要です。**
