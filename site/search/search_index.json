{"config":{"lang":["ja"],"separator":"[\\s\\-\u3000\u3001\u3002\uff0c\uff0e]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"AI\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\u69cb\u7bc9\u30ac\u30a4\u30c9","text":"<p>\u975e\u30a8\u30f3\u30b8\u30cb\u30a2\u5411\u3051\u306eAI\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\u69cb\u7bc9\u624b\u9806\u66f8\u3067\u3059\u3002 2\u3064\u306e\u69cb\u6210\u65b9\u6cd5\u3092\u6bd4\u8f03\u3057\u3001\u76ee\u7684\u306b\u5fdc\u3058\u3066\u9078\u629e\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"#_1","title":"\u69cb\u6210\u6bd4\u8f03\u8868","text":"\u9805\u76ee GCP + Firebase Bolt + Supabase \u69cb\u7bc9\u6642\u9593 1\u301c2\u6642\u9593 30\u5206\u301c1\u6642\u9593 \u96e3\u6613\u5ea6 \u2605\u2605\u2605\u2606\u2606 \u2605\u2605\u2606\u2606\u2606 \u7ba1\u7406\u753b\u9762 2\u3064\uff08GCP + Firebase\uff09 1\u3064\uff08Supabase\uff09 \u6708\u984d\u8cbb\u7528\uff08\u5c0f\u898f\u6a21\uff09 $5\u301c30 $0\uff08\u7121\u6599\u67a0\u5185\uff09 \u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3 \u25ce \u5927\u898f\u6a21\u5bfe\u5fdc \u25cb \u4e2d\u898f\u6a21\u307e\u3067 \u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba \u25ce \u25b3 Google Workspace\u9023\u643a \u25ce \u25b3"},{"location":"#_2","title":"\u3069\u3061\u3089\u3092\u9078\u3076\u3079\u304d\u304b\uff1f","text":""},{"location":"#bolt-supabase","title":"Bolt + Supabase \u3092\u63a8\u5968\u3059\u308b\u30b1\u30fc\u30b9","text":"<ul> <li>\u521d\u3081\u3066\u30af\u30e9\u30a6\u30c9\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u3046</li> <li>\u3068\u306b\u304b\u304f\u65e9\u304f\u52d5\u304f\u3082\u306e\u3092\u4f5c\u308a\u305f\u3044</li> <li>\u30b3\u30b9\u30c8\u3092\u6700\u5c0f\u9650\u306b\u6291\u3048\u305f\u3044\uff08$0\u301c\uff09</li> <li>\u5c0f\u301c\u4e2d\u898f\u6a21\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\uff08\u301c1000\u4eba\uff09</li> </ul>"},{"location":"#gcp-firebase","title":"GCP + Firebase \u3092\u63a8\u5968\u3059\u308b\u30b1\u30fc\u30b9","text":"<ul> <li>\u5927\u898f\u6a21\u306a\u30e6\u30fc\u30b6\u30fc\u6570\u3092\u60f3\u5b9a\uff081000\u4eba\u4ee5\u4e0a\uff09</li> <li>\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba\u30ec\u30d9\u30eb\u306eSLA\u304c\u5fc5\u8981</li> <li>Google Workspace\u3068\u306e\u9023\u643a\u304c\u5fc5\u9808</li> <li>\u5c06\u6765\u7684\u306a\u62e1\u5f35\u6027\u3092\u91cd\u8996</li> </ul>"},{"location":"#_3","title":"\u30d5\u30a9\u30eb\u30c0\u69cb\u6210","text":"<pre><code>docs/\n\u251c\u2500\u2500 README.md                 # \u3053\u306e\u6bd4\u8f03\u8868\n\u251c\u2500\u2500 gcp-firebase/             # GCP + Firebase\u7248\n\u2502   \u251c\u2500\u2500 01_\u69cb\u7bc9\u8a2d\u8a08\u66f8.md\n\u2502   \u251c\u2500\u2500 02_\u69cb\u7bc9\u624b\u9806\u66f8.md\n\u2502   \u251c\u2500\u2500 03_\u8ffd\u52a0\u30c7\u30d7\u30ed\u30a4\u624b\u9806_\u8cbb\u7528\u898b\u7a4d\u3082\u308a.md\n\u2502   \u251c\u2500\u2500 99_\u88dc\u8db3_CloudRun\u7248\u69cb\u7bc9\u624b\u9806.md\n\u2502   \u251c\u2500\u2500 99_\u88dc\u8db3_\u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\u8a2d\u5b9a.md\n\u2502   \u251c\u2500\u2500 99_\u88dc\u8db3_\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3068\u306f.md\n\u2502   \u2514\u2500\u2500 99_\u88dc\u8db3_\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3068\u306f.md\n\u2502\n\u2514\u2500\u2500 bolt-supabase/            # Bolt + Supabase\u7248\n    \u251c\u2500\u2500 01_\u69cb\u7bc9\u8a2d\u8a08\u66f8.md\n    \u2514\u2500\u2500 02_\u69cb\u7bc9\u624b\u9806\u66f8.md\n</code></pre>"},{"location":"#_4","title":"\u8cbb\u7528\u6bd4\u8f03\uff08\u8a73\u7d30\uff09","text":""},{"location":"#_5","title":"\u6708\u984d\u8cbb\u7528\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":"\u898f\u6a21 GCP + Firebase Bolt + Supabase 1\u30c6\u30ca\u30f3\u30c8\uff08\u301c100\u4eba\uff09 $5\u301c15 $0 1\u30c6\u30ca\u30f3\u30c8\uff08\u301c500\u4eba\uff09 $10\u301c30 $0 3\u30c6\u30ca\u30f3\u30c8 $15\u301c90 $0\u301c25 5\u30c6\u30ca\u30f3\u30c8 $25\u301c150 $25\u301c50 <p>\u6ce8\u610f: AI API\uff08OpenAI\u7b49\uff09\u306e\u5229\u7528\u6599\u91d1\u306f\u5225\u9014\u767a\u751f\u3057\u307e\u3059\u3002</p>"},{"location":"#_6","title":"\u7121\u6599\u67a0\u6bd4\u8f03","text":"\u9805\u76ee GCP + Firebase Supabase + Vercel \u8a8d\u8a3c \u67085\u4e07\u4eba \u67085\u4e07\u4eba \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u5b9f\u884c \u6708200\u4e07\u30ea\u30af\u30a8\u30b9\u30c8 \u670850\u4e07\u56de \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9 - 500MB \u30b9\u30c8\u30ec\u30fc\u30b8 - 1GB \u5e2f\u57df\u5e45 - 100GB/\u6708"},{"location":"#_7","title":"\u6280\u8853\u30b9\u30bf\u30c3\u30af\u6bd4\u8f03","text":""},{"location":"#gcp-firebase_1","title":"GCP + Firebase","text":"<pre><code>\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9: Cloud Run functions\u5185\u3067\u914d\u4fe1\n\u30d0\u30c3\u30af\u30a8\u30f3\u30c9:   Cloud Run functions\n\u8a8d\u8a3c:          Firebase Authentication\n\u30b7\u30fc\u30af\u30ec\u30c3\u30c8:   Secret Manager\n\u30db\u30b9\u30c6\u30a3\u30f3\u30b0:   Cloud Run\n</code></pre>"},{"location":"#bolt-supabase_1","title":"Bolt + Supabase","text":"<pre><code>\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9: Vercel\uff08\u81ea\u52d5\u30c7\u30d7\u30ed\u30a4\uff09\n\u30d0\u30c3\u30af\u30a8\u30f3\u30c9:   Supabase Edge Functions\n\u8a8d\u8a3c:          Supabase Auth\n\u30b7\u30fc\u30af\u30ec\u30c3\u30c8:   Supabase Vault\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9:   PostgreSQL\uff08Supabase\uff09\n</code></pre>"},{"location":"#_8","title":"\u5b66\u7fd2\u30ea\u30bd\u30fc\u30b9","text":""},{"location":"#gcp-firebase_2","title":"GCP + Firebase","text":"<ul> <li>Firebase\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8</li> <li>Cloud Run\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8</li> </ul>"},{"location":"#bolt-supabase_2","title":"Bolt + Supabase","text":"<ul> <li>Supabase\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8</li> <li>Bolt.new\u516c\u5f0f\u30b5\u30a4\u30c8</li> <li>Vercel\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8</li> </ul>"},{"location":"#_9","title":"\u4f5c\u6210\u65e5","text":"<p>2025\u5e7412\u6708</p>"},{"location":"bolt-supabase/01_design/","title":"01. \u69cb\u7bc9\u8a2d\u8a08\u66f8\uff08Bolt + Supabase\u7248\uff09","text":"\u9805\u76ee \u5185\u5bb9 \u4f5c\u6210\u65e5 2025\u5e7412\u6708 \u30d0\u30fc\u30b8\u30e7\u30f3 1.0 \u5bfe\u8c61 AI\u30c1\u30fc\u30e0"},{"location":"bolt-supabase/01_design/#1","title":"1. \u30b7\u30b9\u30c6\u30e0\u6982\u8981","text":""},{"location":"bolt-supabase/01_design/#11","title":"1.1 \u76ee\u7684","text":"<p>\u975e\u30a8\u30f3\u30b8\u30cb\u30a2\u30c1\u30fc\u30e0\u304cDify\u3001Vertex AI\u7b49\u306eAI\u30c4\u30fc\u30eb\u3092\u5b89\u5168\u306b\u904b\u7528\u3057\u3001\u5916\u90e8\u9867\u5ba2\u306b\u3082\u30b5\u30fc\u30d3\u30b9\u3092\u63d0\u4f9b\u3067\u304d\u308b\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u3002</p>"},{"location":"bolt-supabase/01_design/#12","title":"1.2 \u8981\u4ef6","text":"\u8981\u4ef6 \u5185\u5bb9 \u904b\u7528\u30a2\u30d7\u30ea Dify\u3001Vertex AI + \u5c06\u6765\u7684\u306b\u4ed6AI\u30c4\u30fc\u30eb\u8ffd\u52a0 \u5229\u7528\u8005 \u793e\u5185\u30e1\u30f3\u30d0\u30fc + \u5916\u90e8\u9867\u5ba2\uff08500\u4eba\u898f\u6a21\u60f3\u5b9a\uff09 \u8a8d\u8a3c\u65b9\u5f0f Google\u30ed\u30b0\u30a4\u30f3\uff08OAuth 2.0\uff09 \u500b\u4eba\u60c5\u5831 \u6271\u308f\u306a\u3044 \u69cb\u7bc9\u65b9\u6cd5 Bolt.new + Supabase\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u8a2d\u5b9a \u62c5\u5f53\u8005\u30b9\u30ad\u30eb \u975e\u30a8\u30f3\u30b8\u30cb\u30a2 \u30b3\u30fc\u30c9\u7ba1\u7406 GitHub\u3067\u7ba1\u7406\uff08Bolt\u9023\u643a\uff09"},{"location":"bolt-supabase/01_design/#13","title":"1.3 \u63a1\u7528\u69cb\u6210","text":"<p>Bolt + Supabase \u30b5\u30fc\u30d0\u30fc\u30ec\u30b9\u69cb\u6210</p> <p>Bolt.new \u3068\u306f</p> <p>AI\u304c\u30b3\u30fc\u30c9\u3092\u81ea\u52d5\u751f\u6210\u3057\u3066\u304f\u308c\u308b\u30ce\u30fc\u30b3\u30fc\u30c9/\u30ed\u30fc\u30b3\u30fc\u30c9\u958b\u767a\u30c4\u30fc\u30eb\u3067\u3059\u3002 \u300c\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\u3092\u4f5c\u3063\u3066\u300d\u3068\u6307\u793a\u3059\u308b\u3060\u3051\u3067\u3001\u52d5\u304f\u30a2\u30d7\u30ea\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002</p> <p>Supabase \u3068\u306f</p> <p>\u300cFirebase\u306e\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u4ee3\u66ff\u300d\u3068\u547c\u3070\u308c\u308bBaaS\uff08Backend as a Service\uff09\u3067\u3059\u3002 \u8a8d\u8a3c\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3001Edge Functions\u304c1\u3064\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u7ba1\u7406\u3067\u304d\u307e\u3059\u3002</p> <p>\u203b \u975e\u30a8\u30f3\u30b8\u30cb\u30a2\u3067\u3082\u69cb\u7bc9\u53ef\u80fd\u306a\u6700\u3082\u30b7\u30f3\u30d7\u30eb\u306a\u69cb\u6210\u3092\u63a1\u7528</p>"},{"location":"bolt-supabase/01_design/#2","title":"2. \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3","text":""},{"location":"bolt-supabase/01_design/#21","title":"2.1 \u5168\u4f53\u69cb\u6210\u56f3","text":"<pre><code>                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                              \u2502     \u30e6\u30fc\u30b6\u30fc      \u2502\n                              \u2502   \uff08\u30d6\u30e9\u30a6\u30b6\uff09     \u2502\n                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                       \u2502\n                                       \u2502 HTTPS\n                                       \u2502\n              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n              \u2502                        \u2502                        \u2502\n              \u25bc                        \u25bc                        \u25bc\n    companya.example     companyb.example     companyc.example\n         .co.jp                  .co.jp                  .co.jp\n              \u2502                        \u2502                        \u2502\n              \u25bc                        \u25bc                        \u25bc\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502     Vercel      \u2502    \u2502     Vercel      \u2502    \u2502     Vercel      \u2502\n   \u2502  (\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9) \u2502    \u2502  (\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9) \u2502    \u2502  (\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9) \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n            \u2502                      \u2502                      \u2502\n            \u25bc                      \u25bc                      \u25bc\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502                     Supabase                                \u2502\n   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n   \u2502  \u2502    Auth     \u2502  \u2502  Database   \u2502  \u2502Edge Functions\u2502         \u2502\n   \u2502  \u2502  (\u8a8d\u8a3c)     \u2502  \u2502 (PostgreSQL)\u2502  \u2502 (\u30d0\u30c3\u30af\u30a8\u30f3\u30c9)\u2502         \u2502\n   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n   \u2502                                           \u2502                 \u2502\n   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                          \u2502                 \u2502\n   \u2502  \u2502   Vault     \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                 \u2502\n   \u2502  \u2502 (\u30b7\u30fc\u30af\u30ec\u30c3\u30c8)\u2502                                           \u2502\n   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                            \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"bolt-supabase/01_design/#22","title":"2.2 \u69cb\u6210\u306e\u30dd\u30a4\u30f3\u30c8","text":"\u30dd\u30a4\u30f3\u30c8 \u8aac\u660e \u30ef\u30f3\u30b9\u30c8\u30c3\u30d7 \u8a8d\u8a3c\u30fbDB\u30fb\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30fb\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u304c1\u3064\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9 Bolt\u9023\u643a AI\u304c\u81ea\u52d5\u3067\u30b3\u30fc\u30c9\u751f\u6210\u3001Supabase\u9023\u643a\u3082\u81ea\u52d5\u8a2d\u5b9a \u81ea\u52d5\u30c7\u30d7\u30ed\u30a4 GitHub\u306b\u30d7\u30c3\u30b7\u30e5 \u2192 Vercel\u304c\u81ea\u52d5\u30c7\u30d7\u30ed\u30a4 \u81ea\u52d5SSL Vercel\u304c\u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\u306b\u81ea\u52d5\u3067SSL\u767a\u884c \u4f4e\u30b3\u30b9\u30c8 \u7121\u6599\u67a0\u304c\u5145\u5b9f\u3001\u5c0f\u898f\u6a21\u306a\u3089$0\u3067\u904b\u7528\u53ef\u80fd"},{"location":"bolt-supabase/01_design/#3","title":"3. \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u8a2d\u8a08","text":""},{"location":"bolt-supabase/01_design/#31-supabase-auth","title":"3.1 Supabase Auth","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u5f79\u5272 \u5168\u30c6\u30ca\u30f3\u30c8\u5171\u901a\u306e\u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c \u8a8d\u8a3c\u65b9\u5f0f Google\u30ed\u30b0\u30a4\u30f3\uff08OAuth 2.0\uff09 \u30e6\u30fc\u30b6\u30fc\u7ba1\u7406 Supabase\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u4e00\u5143\u7ba1\u7406 \u30bb\u30c3\u30b7\u30e7\u30f3 \u81ea\u52d5\u7ba1\u7406\uff08JWT\u30c8\u30fc\u30af\u30f3\uff09"},{"location":"bolt-supabase/01_design/#32-supabase-edge-functions","title":"3.2 Supabase Edge Functions","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u5f79\u5272 \u30d0\u30c3\u30af\u30a8\u30f3\u30c9API\uff08AI\u547c\u3073\u51fa\u3057\u7b49\uff09 \u30e9\u30f3\u30bf\u30a4\u30e0 Deno\uff08TypeScript\uff09 \u30c7\u30d7\u30ed\u30a4 CLI\u307e\u305f\u306f\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u304b\u3089 \u30bf\u30a4\u30e0\u30a2\u30a6\u30c8 150\u79d2\uff08\u7121\u6599\u30d7\u30e9\u30f3\uff09 \u8a8d\u8a3c Supabase Auth\u3068\u81ea\u52d5\u9023\u643a"},{"location":"bolt-supabase/01_design/#33-supabase-vault","title":"3.3 Supabase Vault","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u5f79\u5272 API\u30ad\u30fc\u30fb\u6a5f\u5bc6\u60c5\u5831\u306e\u4fdd\u7ba1 \u6697\u53f7\u5316 AES-256-GCM \u30a2\u30af\u30bb\u30b9 Edge Functions\u304b\u3089\u53c2\u7167"},{"location":"bolt-supabase/01_design/#34-vercel","title":"3.4 Vercel\uff08\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\uff09","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u5f79\u5272 \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u914d\u4fe1 \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af React / Next.js\uff08Bolt\u304c\u81ea\u52d5\u9078\u629e\uff09 \u30c7\u30d7\u30ed\u30a4 GitHub\u9023\u643a\u3067\u81ea\u52d5 CDN \u30b0\u30ed\u30fc\u30d0\u30eb\u30a8\u30c3\u30b8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af"},{"location":"bolt-supabase/01_design/#4","title":"4. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u8a08","text":""},{"location":"bolt-supabase/01_design/#41","title":"4.1 \u591a\u5c64\u9632\u5fa1\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    \u7b2c1\u5c64: HTTPS\u901a\u4fe1                          \u2502\n\u2502                   \uff08\u5168\u901a\u4fe1\u306e\u6697\u53f7\u5316\uff09                          \u2502\n\u2502  - TLS 1.3                                                  \u2502\n\u2502  - Vercel / Supabase \u81ea\u52d5SSL                                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                \u7b2c2\u5c64: Supabase Auth                         \u2502\n\u2502                   \uff08\u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c\uff09                            \u2502\n\u2502  - Google\u30ed\u30b0\u30a4\u30f3\u5fc5\u9808                                        \u2502\n\u2502  - Row Level Security\uff08RLS\uff09\u3067\u30c7\u30fc\u30bf\u30a2\u30af\u30bb\u30b9\u5236\u5fa1              \u2502\n\u2502  - JWT\u30c8\u30fc\u30af\u30f3\u3067\u8a8d\u8a3c\u72b6\u614b\u7ba1\u7406                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502               \u7b2c3\u5c64: Supabase Vault                         \u2502\n\u2502                \uff08\u6a5f\u5bc6\u60c5\u5831\u306e\u4fdd\u8b77\uff09                              \u2502\n\u2502  - API\u30ad\u30fc\u306f\u30b3\u30fc\u30c9\u306b\u542b\u3081\u306a\u3044                                  \u2502\n\u2502  - AES-256-GCM\u6697\u53f7\u5316\u4fdd\u5b58                                     \u2502\n\u2502  - Edge Functions\u304b\u3089\u306e\u307f\u30a2\u30af\u30bb\u30b9\u53ef\u80fd                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"bolt-supabase/01_design/#42-row-level-securityrls","title":"4.2 Row Level Security\uff08RLS\uff09","text":"<p>Supabase\u306e\u5f37\u529b\u306a\u6a5f\u80fd\u3002\u30e6\u30fc\u30b6\u30fc\u3054\u3068\u306b\u30c7\u30fc\u30bf\u30a2\u30af\u30bb\u30b9\u3092\u81ea\u52d5\u5236\u9650\u3002</p> <pre><code>-- \u4f8b: \u30e6\u30fc\u30b6\u30fc\u306f\u81ea\u5206\u306e\u30c7\u30fc\u30bf\u306e\u307f\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\nCREATE POLICY \"Users can only see their own data\"\nON chat_history\nFOR SELECT\nUSING (auth.uid() = user_id);\n</code></pre>"},{"location":"bolt-supabase/01_design/#5","title":"5. \u30b3\u30b9\u30c8\u8a2d\u8a08","text":""},{"location":"bolt-supabase/01_design/#51","title":"5.1 \u6708\u984d\u8cbb\u7528\u898b\u7a4d\u3082\u308a","text":""},{"location":"bolt-supabase/01_design/#supabase","title":"Supabase\uff08\u7121\u6599\u30d7\u30e9\u30f3\uff09","text":"\u30ea\u30bd\u30fc\u30b9 \u7121\u6599\u67a0 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9 500MB \u30b9\u30c8\u30ec\u30fc\u30b8 1GB Edge Functions 500,000\u56de/\u6708 \u8a8d\u8a3c\u30e6\u30fc\u30b6\u30fc 50,000 MAU Vault \u7121\u5236\u9650"},{"location":"bolt-supabase/01_design/#vercel","title":"Vercel\uff08\u7121\u6599\u30d7\u30e9\u30f3\uff09","text":"\u30ea\u30bd\u30fc\u30b9 \u7121\u6599\u67a0 \u5e2f\u57df\u5e45 100GB/\u6708 \u30d3\u30eb\u30c9\u6642\u9593 6,000\u5206/\u6708 \u30b5\u30fc\u30d0\u30fc\u30ec\u30b9\u95a2\u6570 100GB-\u6642\u9593/\u6708"},{"location":"bolt-supabase/01_design/#_1","title":"\u7dcf\u30b3\u30b9\u30c8\u898b\u7a4d\u3082\u308a","text":"\u30c6\u30ca\u30f3\u30c8\u6570 \u6708\u984d\u76ee\u5b89 \u5099\u8003 1\u30c6\u30ca\u30f3\u30c8 $0 \u7121\u6599\u67a0\u5185\u3067\u904b\u7528\u53ef\u80fd 3\u30c6\u30ca\u30f3\u30c8 $0\u301c25 Supabase Pro\u691c\u8a0e 5\u30c6\u30ca\u30f3\u30c8 $25\u301c50 Supabase Pro <p>\u91cd\u8981: AI API\u5229\u7528\u6599\u91d1\u306f\u5225\u9014\u767a\u751f</p> <p>\u4e0a\u8a18\u306f\u30a4\u30f3\u30d5\u30e9\u8cbb\u7528\u306e\u307f\u3067\u3059\u3002OpenAI\u3001Anthropic\u7b49\u306eAI API\u5229\u7528\u6599\u91d1\u306f\u5225\u9014\u767a\u751f\u3057\u307e\u3059\u3002</p>"},{"location":"bolt-supabase/01_design/#6-gcp","title":"6. GCP\u7248\u3068\u306e\u6bd4\u8f03","text":"\u9805\u76ee Bolt + Supabase GCP + Firebase \u69cb\u7bc9\u6642\u9593 30\u5206\u301c1\u6642\u9593 1\u301c2\u6642\u9593 \u7ba1\u7406\u753b\u9762 1\u3064\uff08Supabase\uff09 2\u3064\uff08GCP + Firebase\uff09 \u5b66\u7fd2\u30b3\u30b9\u30c8 \u4f4e\u3044 \u3084\u3084\u9ad8\u3044 \u6708\u984d\u8cbb\u7528\uff08\u5c0f\u898f\u6a21\uff09 $0 $5\u301c30 \u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3 \u4e2d\u898f\u6a21\u307e\u3067 \u5927\u898f\u6a21\u5bfe\u5fdc \u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba \u25b3 \u25ce Google Workspace\u9023\u643a \u25b3 \u25ce"},{"location":"bolt-supabase/01_design/#_2","title":"\u63a8\u5968\u9078\u629e","text":"\u30b1\u30fc\u30b9 \u63a8\u5968 \u975e\u30a8\u30f3\u30b8\u30cb\u30a2\u304c\u69cb\u7bc9 Bolt + Supabase \u5c0f\u301c\u4e2d\u898f\u6a21\uff08\u301c1000\u4eba\uff09 Bolt + Supabase \u5927\u898f\u6a21\u30fb\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba GCP + Firebase Google Workspace\u9023\u643a\u5fc5\u9808 GCP + Firebase"},{"location":"bolt-supabase/01_design/#7","title":"7. \u53ef\u7528\u6027\u30fb\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3","text":""},{"location":"bolt-supabase/01_design/#71","title":"7.1 \u53ef\u7528\u6027","text":"\u30b5\u30fc\u30d3\u30b9 SLA Supabase 99.9%\uff08Pro\u4ee5\u4e0a\uff09 Vercel 99.99%"},{"location":"bolt-supabase/01_design/#72","title":"7.2 \u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3","text":"\u9805\u76ee \u5236\u9650 \u540c\u6642\u63a5\u7d9a \u7121\u6599: 200 / Pro: 500 Edge Functions \u81ea\u52d5\u30b9\u30b1\u30fc\u30eb \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9 \u7121\u6599: 500MB / Pro: 8GB\u301c"},{"location":"bolt-supabase/01_design/#8","title":"8. \u4eca\u5f8c\u306e\u62e1\u5f35","text":""},{"location":"bolt-supabase/01_design/#81","title":"8.1 \u6709\u6599\u30d7\u30e9\u30f3\u3078\u306e\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9","text":"\u30d7\u30e9\u30f3 \u6708\u984d \u4e3b\u306a\u8ffd\u52a0\u6a5f\u80fd Supabase Pro $25 8GB DB\u3001\u6bce\u65e5\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3001SLA Vercel Pro $20 1TB\u5e2f\u57df\u3001\u30c1\u30fc\u30e0\u6a5f\u80fd"},{"location":"bolt-supabase/01_design/#82","title":"8.2 \u8ffd\u52a0\u53ef\u80fd\u306a\u6a5f\u80fd","text":"\u6a5f\u80fd \u65b9\u6cd5 \u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u6a5f\u80fd Supabase Realtime\uff08\u6a19\u6e96\u642d\u8f09\uff09 \u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9 Supabase Storage\uff08\u6a19\u6e96\u642d\u8f09\uff09 \u5b9a\u671f\u5b9f\u884c Supabase Cron\uff08Pro\u4ee5\u4e0a\uff09"},{"location":"bolt-supabase/02_setup/","title":"02. \u69cb\u7bc9\u624b\u9806\u66f8\uff08Bolt + Supabase\u7248\uff09","text":"\u9805\u76ee \u5185\u5bb9 \u5bfe\u8c61\u8005 \u975e\u30a8\u30f3\u30b8\u30cb\u30a2 \u4f5c\u696d\u6642\u9593 \u7d0430\u5206\u301c1\u6642\u9593"},{"location":"bolt-supabase/02_setup/#_1","title":"\u4e8b\u524d\u6e96\u5099\u30c1\u30a7\u30c3\u30af","text":"<ul> <li>[ ] Google\u30a2\u30ab\u30a6\u30f3\u30c8</li> <li>[ ] GitHub\u30a2\u30ab\u30a6\u30f3\u30c8\uff08\u7121\u6599\u3067\u4f5c\u6210\u53ef\u80fd\uff09</li> <li>[ ] AI\u306eAPI\u30ad\u30fc\uff08OpenAI\u7b49\uff09</li> </ul>"},{"location":"bolt-supabase/02_setup/#_2","title":"\u5168\u4f53\u69cb\u6210","text":""},{"location":"bolt-supabase/02_setup/#_3","title":"\u4ed5\u7d44\u307f\u306e\u6982\u8981","text":"<pre><code>\u3042\u306a\u305f\uff08\u30d6\u30e9\u30a6\u30b6\uff09\n    |\n    | (1) Bolt.new\u3067\u30a2\u30d7\u30ea\u3092\u4f5c\u6210\n    v\nBolt.new\uff08AI\u958b\u767a\u30c4\u30fc\u30eb\uff09\n    |\n    | (2) \u81ea\u52d5\u3067\u30b3\u30fc\u30c9\u751f\u6210 &amp; GitHub\u9023\u643a\n    v\nGitHub\uff08\u30b3\u30fc\u30c9\u7ba1\u7406\uff09\n    |\n    | (3) \u81ea\u52d5\u30c7\u30d7\u30ed\u30a4\n    v\nVercel\uff08\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u914d\u4fe1\uff09\n    |\n    | (4) API\u547c\u3073\u51fa\u3057\n    v\nSupabase Edge Functions\n    |\n    | (5) API\u30ad\u30fc\u53d6\u5f97 &amp; AI\u547c\u3073\u51fa\u3057\n    v\nOpenAI API\uff08ChatGPT\uff09\n</code></pre>"},{"location":"bolt-supabase/02_setup/#_4","title":"\u4f55\u3092\u4f5c\u308b\u304b","text":"\u4f5c\u308b\u3082\u306e \u5f79\u5272 \u4f5c\u696d Supabase\u30d7\u30ed\u30b8\u30a7\u30af\u30c8 \u8a8d\u8a3c + \u30d0\u30c3\u30af\u30a8\u30f3\u30c9 \u8a2d\u5b9a\u306e\u307f Bolt.new\u30d7\u30ed\u30b8\u30a7\u30af\u30c8 \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u751f\u6210 AI\u306b\u6307\u793a\u3059\u308b\u3060\u3051 Vercel\u30c7\u30d7\u30ed\u30a4 \u30db\u30b9\u30c6\u30a3\u30f3\u30b0 \u81ea\u52d5 <p>\u30b3\u30b9\u30c8\u306b\u3064\u3044\u3066</p> \u30b5\u30fc\u30d3\u30b9 \u7121\u6599\u67a0 Supabase 500MB DB\u300150,000\u30e6\u30fc\u30b6\u30fc\u3001500,000 Edge Functions Vercel 100GB\u5e2f\u57df/\u6708 Bolt.new \u6708\u9593\u30c8\u30fc\u30af\u30f3\u5236\u9650\u3042\u308a\uff08\u7121\u6599\u30d7\u30e9\u30f3\uff09 OpenAI API \u7121\u6599\u67a0\u306a\u3057\uff08\u5f93\u91cf\u8ab2\u91d1\uff09"},{"location":"bolt-supabase/02_setup/#step-1-supabase10","title":"Step 1: Supabase\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\uff0810\u5206\uff09","text":""},{"location":"bolt-supabase/02_setup/#1-1-supabase","title":"1-1. Supabase\u30a2\u30ab\u30a6\u30f3\u30c8\u4f5c\u6210","text":"<ol> <li> <p><code>https://supabase.com</code> \u306b\u30a2\u30af\u30bb\u30b9</p> </li> <li> <p>\u300cStart your project\u300d\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li> <p>\u300cContinue with GitHub\u300d\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li>GitHub\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ed\u30b0\u30a4\u30f3\uff08\u63a8\u5968\uff09</li> <li> <p>\u307e\u305f\u306f\u300cContinue with email\u300d\u3067\u30e1\u30fc\u30eb\u767b\u9332</p> </li> <li> <p>GitHub\u3068\u306e\u9023\u643a\u3092\u8a31\u53ef</p> </li> </ol>"},{"location":"bolt-supabase/02_setup/#1-2","title":"1-2. \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210","text":"<ol> <li> <p>\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u300cNew project\u300d\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li> <p>\u8a2d\u5b9a\u3092\u5165\u529b:</p> </li> </ol> \u9805\u76ee \u5165\u529b\u5024 Organization \u81ea\u5206\u306eOrg\uff08\u81ea\u52d5\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\uff09 Name <code>ai-chat-app</code>\uff08\u4efb\u610f\uff09 Database Password \u5f37\u529b\u306a\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\uff08\u30e1\u30e2\u5fc5\u9808\uff09 Region <code>Northeast Asia (Tokyo)</code> Pricing Plan Free <ol> <li> <p>\u300cCreate new project\u300d\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li> <p>\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\u5b8c\u4e86\u307e\u3067\u5f85\u6a5f\uff081\u301c2\u5206\uff09</p> </li> </ol>"},{"location":"bolt-supabase/02_setup/#step-2-supabase5","title":"Step 2: Supabase\u8a8d\u8a3c\u8a2d\u5b9a\uff085\u5206\uff09","text":""},{"location":"bolt-supabase/02_setup/#2-1-google","title":"2-1. Google\u8a8d\u8a3c\u3092\u6709\u52b9\u5316","text":"<ol> <li> <p>\u5de6\u30e1\u30cb\u30e5\u30fc\u300cAuthentication\u300d\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li> <p>\u300cProviders\u300d\u30bf\u30d6\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li> <p>\u300cGoogle\u300d\u3092\u63a2\u3057\u3066\u30af\u30ea\u30c3\u30af</p> </li> <li> <p>\u300cEnable Google provider\u300d\u3092\u30aa\u30f3</p> </li> <li> <p>Google Cloud Console\u3067OAuth\u8a2d\u5b9a:</p> </li> <li><code>https://console.cloud.google.com</code> \u306b\u30a2\u30af\u30bb\u30b9</li> <li>\u300cAPI\u3068\u30b5\u30fc\u30d3\u30b9\u300d\u2192\u300c\u8a8d\u8a3c\u60c5\u5831\u300d</li> <li>\u300c\u8a8d\u8a3c\u60c5\u5831\u3092\u4f5c\u6210\u300d\u2192\u300cOAuth\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u300d</li> <li>\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u7a2e\u985e\uff1a\u300c\u30a6\u30a7\u30d6\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u300d</li> <li> <p>\u627f\u8a8d\u6e08\u307f\u30ea\u30c0\u30a4\u30ec\u30af\u30c8URI\uff1aSupabase\u306b\u8868\u793a\u3055\u308c\u308bURL\u3092\u5165\u529b</p> </li> <li> <p>\u53d6\u5f97\u3057\u305fClient ID\u3068Client Secret\u3092Supabase\u306b\u5165\u529b</p> </li> <li> <p>\u300cSave\u300d\u3092\u30af\u30ea\u30c3\u30af</p> </li> </ol> <p>\u7c21\u5358\u306a\u65b9\u6cd5</p> <p>Supabase\u306e\u300cMagic Link\u300d\uff08\u30e1\u30fc\u30eb\u8a8d\u8a3c\uff09\u3092\u4f7f\u3048\u3070\u3001Google\u8a2d\u5b9a\u306a\u3057\u3067\u8a8d\u8a3c\u3067\u304d\u307e\u3059\u3002 \u521d\u3081\u3066\u306e\u5834\u5408\u306f\u3053\u3061\u3089\u304c\u304a\u3059\u3059\u3081\u3067\u3059\u3002</p>"},{"location":"bolt-supabase/02_setup/#step-3-vaultapi5","title":"Step 3: Vault\u8a2d\u5b9a\uff08API\u30ad\u30fc\u4fdd\u5b58\uff09\uff085\u5206\uff09","text":""},{"location":"bolt-supabase/02_setup/#3-1","title":"3-1. \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u4f5c\u6210","text":"<ol> <li> <p>\u5de6\u30e1\u30cb\u30e5\u30fc\u300cProject Settings\u300d\uff08\u6b6f\u8eca\u30a2\u30a4\u30b3\u30f3\uff09</p> </li> <li> <p>\u300cVault\u300d\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li> <p>\u300cAdd new secret\u300d\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li> <p>\u8a2d\u5b9a\u3092\u5165\u529b:</p> </li> </ol> \u9805\u76ee \u5165\u529b\u5024 Name <code>openai_api_key</code> Secret OpenAI\u306eAPI\u30ad\u30fc\u3092\u8cbc\u308a\u4ed8\u3051 <ol> <li>\u300cSave\u300d\u3092\u30af\u30ea\u30c3\u30af</li> </ol>"},{"location":"bolt-supabase/02_setup/#step-4-edge-function10","title":"Step 4: Edge Function\u4f5c\u6210\uff0810\u5206\uff09","text":""},{"location":"bolt-supabase/02_setup/#4-1-supabase-cli","title":"4-1. Supabase CLI\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff08\u30aa\u30d7\u30b7\u30e7\u30f3\uff09","text":"<p>CLI\u3092\u4f7f\u308f\u306a\u3044\u5834\u5408\u306f\u3001\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u304b\u3089\u76f4\u63a5\u4f5c\u6210\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"bolt-supabase/02_setup/#4-2","title":"4-2. \u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u304b\u3089\u4f5c\u6210","text":"<ol> <li> <p>\u5de6\u30e1\u30cb\u30e5\u30fc\u300cEdge Functions\u300d\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li> <p>\u300cCreate a new function\u300d\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li> <p>\u95a2\u6570\u540d: <code>chat</code></p> </li> <li> <p>\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092\u8cbc\u308a\u4ed8\u3051:</p> </li> </ol> <pre><code>import { serve } from \"https://deno.land/std@0.168.0/http/server.ts\"\nimport { createClient } from 'https://esm.sh/@supabase/supabase-js@2'\n\nconst corsHeaders = {\n  'Access-Control-Allow-Origin': '*',\n  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',\n}\n\nserve(async (req) =&gt; {\n  // CORS\u5bfe\u5fdc\n  if (req.method === 'OPTIONS') {\n    return new Response('ok', { headers: corsHeaders })\n  }\n\n  try {\n    // \u8a8d\u8a3c\u30c1\u30a7\u30c3\u30af\n    const supabaseClient = createClient(\n      Deno.env.get('SUPABASE_URL') ?? '',\n      Deno.env.get('SUPABASE_ANON_KEY') ?? '',\n      { global: { headers: { Authorization: req.headers.get('Authorization')! } } }\n    )\n\n    const { data: { user } } = await supabaseClient.auth.getUser()\n    if (!user) {\n      return new Response(JSON.stringify({ error: 'Unauthorized' }), {\n        status: 401,\n        headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n      })\n    }\n\n    // \u30ea\u30af\u30a8\u30b9\u30c8\u53d6\u5f97\n    const { message } = await req.json()\n\n    // OpenAI API\u547c\u3073\u51fa\u3057\n    const openaiKey = Deno.env.get('OPENAI_API_KEY')\n    const response = await fetch('https://api.openai.com/v1/chat/completions', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${openaiKey}`,\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        model: 'gpt-3.5-turbo',\n        messages: [{ role: 'user', content: message }],\n      }),\n    })\n\n    const data = await response.json()\n\n    return new Response(JSON.stringify({\n      reply: data.choices[0].message.content\n    }), {\n      headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n    })\n\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n    })\n  }\n})\n</code></pre> <ol> <li>\u300cDeploy\u300d\u3092\u30af\u30ea\u30c3\u30af</li> </ol>"},{"location":"bolt-supabase/02_setup/#4-3","title":"4-3. \u74b0\u5883\u5909\u6570\u8a2d\u5b9a","text":"<ol> <li> <p>Edge Functions\u30da\u30fc\u30b8\u3067\u4f5c\u6210\u3057\u305f\u95a2\u6570\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li> <p>\u300cManage secrets\u300d\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li> <p><code>OPENAI_API_KEY</code> \u3092\u8ffd\u52a0\uff08Vault\u304b\u3089\u53c2\u7167\uff09</p> </li> </ol>"},{"location":"bolt-supabase/02_setup/#step-5-boltnew10","title":"Step 5: Bolt.new\u3067\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u4f5c\u6210\uff0810\u5206\uff09","text":""},{"location":"bolt-supabase/02_setup/#5-1-boltnew","title":"5-1. Bolt.new\u306b\u30a2\u30af\u30bb\u30b9","text":"<ol> <li> <p><code>https://bolt.new</code> \u306b\u30a2\u30af\u30bb\u30b9</p> </li> <li> <p>GitHub\u3067\u30ed\u30b0\u30a4\u30f3</p> </li> </ol>"},{"location":"bolt-supabase/02_setup/#5-2-ai","title":"5-2. AI\u306b\u30a2\u30d7\u30ea\u751f\u6210\u3092\u6307\u793a","text":"<p>\u30d7\u30ed\u30f3\u30d7\u30c8\u4f8b:</p> <pre><code>Supabase\u3068\u9023\u643a\u3057\u305fAI\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\u3092\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u8981\u4ef6:\n- Supabase Auth\u3067\u30ed\u30b0\u30a4\u30f3\u6a5f\u80fd\uff08Google\u30ed\u30b0\u30a4\u30f3\uff09\n- \u30ed\u30b0\u30a4\u30f3\u5f8c\u306b\u30c1\u30e3\u30c3\u30c8\u753b\u9762\u3092\u8868\u793a\n- \u30c1\u30e3\u30c3\u30c8\u306fSupabase Edge Functions\u7d4c\u7531\u3067OpenAI API\u3092\u547c\u3073\u51fa\u3057\n- \u30b7\u30f3\u30d7\u30eb\u3067\u30e2\u30c0\u30f3\u306aUI\uff08Tailwind CSS\u4f7f\u7528\uff09\n- \u30ec\u30b9\u30dd\u30f3\u30b7\u30d6\u30c7\u30b6\u30a4\u30f3\n\nSupabase\u8a2d\u5b9a:\n- URL: [Supabase\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306eProject URL]\n- Anon Key: [Supabase\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306eAnon Key]\n</code></pre> <ol> <li> <p>AI\u304c\u30b3\u30fc\u30c9\u3092\u751f\u6210\u3059\u308b\u306e\u3092\u5f85\u3064</p> </li> <li> <p>\u751f\u6210\u3055\u308c\u305f\u30a2\u30d7\u30ea\u3092\u30d7\u30ec\u30d3\u30e5\u30fc\u3067\u78ba\u8a8d</p> </li> </ol>"},{"location":"bolt-supabase/02_setup/#5-3-supabase","title":"5-3. Supabase\u63a5\u7d9a\u60c5\u5831\u306e\u78ba\u8a8d","text":"<p>Supabase\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9 \u2192 Project Settings \u2192 API \u3067\u78ba\u8a8d:</p> \u9805\u76ee \u5834\u6240 Project URL <code>https://xxxxx.supabase.co</code> Anon Key <code>eyJhbGci...</code>"},{"location":"bolt-supabase/02_setup/#step-6-5","title":"Step 6: \u30c7\u30d7\u30ed\u30a4\uff085\u5206\uff09","text":""},{"location":"bolt-supabase/02_setup/#6-1-github","title":"6-1. GitHub\u306b\u30d7\u30c3\u30b7\u30e5","text":"<ol> <li> <p>Bolt.new\u306e\u300cDeploy\u300d\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li> <p>GitHub\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\uff08\u307e\u305f\u306f\u65e2\u5b58\u3092\u9078\u629e\uff09</p> </li> <li> <p>\u30d7\u30c3\u30b7\u30e5\u5b8c\u4e86\u3092\u5f85\u3064</p> </li> </ol>"},{"location":"bolt-supabase/02_setup/#6-2-vercel","title":"6-2. Vercel\u306b\u30c7\u30d7\u30ed\u30a4","text":"<ol> <li> <p><code>https://vercel.com</code> \u306b\u30a2\u30af\u30bb\u30b9</p> </li> <li> <p>\u300cAdd New Project\u300d\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li> <p>\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fGitHub\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u9078\u629e</p> </li> <li> <p>\u300cDeploy\u300d\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li> <p>\u30c7\u30d7\u30ed\u30a4\u5b8c\u4e86\u3092\u5f85\u3064\uff081\u301c2\u5206\uff09</p> </li> <li> <p>\u767a\u884c\u3055\u308c\u305fURL\u3092\u30e1\u30e2</p> </li> <li>\u4f8b: <code>https://ai-chat-app.vercel.app</code></li> </ol>"},{"location":"bolt-supabase/02_setup/#step-7-url","title":"Step 7: \u8a8d\u8a3c\u30ea\u30c0\u30a4\u30ec\u30af\u30c8URL\u8a2d\u5b9a","text":""},{"location":"bolt-supabase/02_setup/#7-1-supabase","title":"7-1. Supabase\u5074\u306e\u8a2d\u5b9a","text":"<ol> <li> <p>Supabase\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9 \u2192 Authentication \u2192 URL Configuration</p> </li> <li> <p>\u300cSite URL\u300d\u306bVercel\u306eURL\u3092\u8a2d\u5b9a</p> </li> <li> <p>\u4f8b: <code>https://ai-chat-app.vercel.app</code></p> </li> <li> <p>\u300cRedirect URLs\u300d\u306b\u8ffd\u52a0:</p> </li> <li><code>https://ai-chat-app.vercel.app/**</code></li> </ol>"},{"location":"bolt-supabase/02_setup/#step-8","title":"Step 8: \u52d5\u4f5c\u78ba\u8a8d","text":""},{"location":"bolt-supabase/02_setup/#8-1","title":"8-1. \u30a2\u30af\u30bb\u30b9\u78ba\u8a8d","text":"URL \u671f\u5f85\u3059\u308b\u7d50\u679c <code>https://[Vercel URL]/</code> \u30ed\u30b0\u30a4\u30f3\u753b\u9762\u304c\u8868\u793a"},{"location":"bolt-supabase/02_setup/#8-2","title":"8-2. \u30ed\u30b0\u30a4\u30f3\u30c6\u30b9\u30c8","text":"<ol> <li> <p>\u300cGoogle\u3067\u30ed\u30b0\u30a4\u30f3\u300d\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li> <p>Google\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u9078\u629e</p> </li> <li> <p>\u30ed\u30b0\u30a4\u30f3\u6210\u529f\u5f8c\u3001\u30c1\u30e3\u30c3\u30c8\u753b\u9762\u304c\u8868\u793a</p> </li> </ol>"},{"location":"bolt-supabase/02_setup/#8-3","title":"8-3. \u30c1\u30e3\u30c3\u30c8\u30c6\u30b9\u30c8","text":"<ol> <li> <p>\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5165\u529b</p> </li> <li> <p>\u9001\u4fe1\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li> <p>AI\u304b\u3089\u306e\u56de\u7b54\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u6210\u529f</p> </li> </ol>"},{"location":"bolt-supabase/02_setup/#_5","title":"\u5b8c\u4e86\u30c1\u30a7\u30c3\u30af","text":"<ul> <li>[ ] Vercel\u306eURL\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b</li> <li>[ ] \u30ed\u30b0\u30a4\u30f3\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b</li> <li>[ ] Google\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b</li> <li>[ ] \u30c1\u30e3\u30c3\u30c8\u3067AI\u3068\u4f1a\u8a71\u3067\u304d\u308b</li> <li>[ ] HTTPS\u3067\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\uff08\u9375\u30de\u30fc\u30af\uff09</li> </ul>"},{"location":"bolt-supabase/02_setup/#_6","title":"\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0","text":""},{"location":"bolt-supabase/02_setup/#_7","title":"\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u3044","text":"<ul> <li>Supabase\u306e\u300cRedirect URLs\u300d\u306bVercel\u306eURL\u3092\u8ffd\u52a0\u3057\u305f\u304b\u78ba\u8a8d</li> <li>Google OAuth\u8a2d\u5b9a\u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8URI\u3092\u78ba\u8a8d</li> </ul>"},{"location":"bolt-supabase/02_setup/#_8","title":"\u30c1\u30e3\u30c3\u30c8\u3067\u30a8\u30e9\u30fc\u304c\u51fa\u308b","text":"<ul> <li>Edge Functions\u306bOPENAI_API_KEY\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d</li> <li>Supabase Edge Functions\u306e\u30ed\u30b0\u3092\u78ba\u8a8d</li> </ul>"},{"location":"bolt-supabase/02_setup/#unauthorized","title":"\u300cUnauthorized\u300d\u30a8\u30e9\u30fc","text":"<ul> <li>\u30ed\u30b0\u30a4\u30f3\u72b6\u614b\u304c\u6b63\u3057\u304f\u4fdd\u6301\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d</li> <li>\u30d6\u30e9\u30a6\u30b6\u306eCookie\u3092\u30af\u30ea\u30a2\u3057\u3066\u518d\u8a66\u884c</li> </ul>"},{"location":"bolt-supabase/02_setup/#url","title":"\u91cd\u8981\u306aURL","text":"\u30b5\u30fc\u30d3\u30b9 URL Supabase\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9 <code>https://supabase.com/dashboard</code> Vercel\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9 <code>https://vercel.com/dashboard</code> Bolt.new <code>https://bolt.new</code> OpenAI API\u30ad\u30fc\u53d6\u5f97 <code>https://platform.openai.com/api-keys</code>"},{"location":"claude-code/","title":"Claude Code \u8a2d\u5b9a","text":"<p>\u3053\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u306f\u3001Claude Code\uff08Anthropic\u516c\u5f0fCLI\uff09\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002</p> <p>\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9</p> <p>\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b\u305d\u306e\u307e\u307e\u4f7f\u3048\u308b .claude \u30d5\u30a9\u30eb\u30c0\u4e00\u5f0f</p> \ud83d\udce6 claude-template.zip"},{"location":"claude-code/#_1","title":"\u6982\u8981","text":"<p>Claude Code\u306f <code>.claude</code> \u30d5\u30a9\u30eb\u30c0\u3092\u4f7f\u3063\u3066\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u56fa\u6709\u306e\u30eb\u30fc\u30eb\u3084\u6a29\u9650\u3092\u8a2d\u5b9a\u3067\u304d\u307e\u3059\u3002 \u3053\u308c\u306b\u3088\u308a\u3001AI\u304c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u6587\u8108\u3092\u7406\u89e3\u3057\u3001\u4e00\u8cab\u3057\u305f\u30b3\u30fc\u30c9\u751f\u6210\u3092\u884c\u3044\u307e\u3059\u3002</p>"},{"location":"claude-code/#_2","title":"\u30d5\u30a9\u30eb\u30c0\u69cb\u6210","text":"<pre><code>.claude/\n\u251c\u2500\u2500 CLAUDE.md           # \u30eb\u30fc\u30eb\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\uff08\u30a8\u30f3\u30c8\u30ea\u30dd\u30a4\u30f3\u30c8\uff09\n\u251c\u2500\u2500 settings.json       # \u6a29\u9650\u8a2d\u5b9a\uff08\u30c1\u30fc\u30e0\u5171\u6709\u7528\uff09\n\u251c\u2500\u2500 settings.local.json # \u6a29\u9650\u8a2d\u5b9a\uff08\u500b\u4eba\u7528\u30fbGit\u5bfe\u8c61\u5916\uff09\n\u2514\u2500\u2500 rules/              # \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30eb\u30fc\u30eb\n    \u251c\u2500\u2500 00_project_context.md\n    \u251c\u2500\u2500 01_comment_policy.md\n    \u251c\u2500\u2500 02_system_architecture.md\n    \u251c\u2500\u2500 03_directory_structure.md\n    \u251c\u2500\u2500 04_boundary_policy.md\n    \u251c\u2500\u2500 05_security_notes.md\n    \u251c\u2500\u2500 06_cloudrun_ops.md\n    \u2514\u2500\u2500 99_for_non_engineers.md\n</code></pre>"},{"location":"claude-code/#_3","title":"\u5404\u30d5\u30a1\u30a4\u30eb\u306e\u5f79\u5272","text":"\u30d5\u30a1\u30a4\u30eb \u5f79\u5272 <code>CLAUDE.md</code> \u30eb\u30fc\u30eb\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\u9806\u5e8f\u3092\u5b9a\u7fa9 <code>settings.json</code> \u7981\u6b62\u64cd\u4f5c\u306e\u5b9a\u7fa9\uff08\u79d8\u5bc6\u60c5\u5831\u306e\u8aad\u307f\u53d6\u308a\u7981\u6b62\u7b49\uff09 <code>rules/*.md</code> \u30b3\u30fc\u30c9\u751f\u6210\u6642\u306b\u5f93\u3046\u3079\u304d\u30eb\u30fc\u30eb"},{"location":"claude-code/#_4","title":"\u30eb\u30fc\u30eb\u4e00\u89a7","text":"\u756a\u53f7 \u30d5\u30a1\u30a4\u30eb \u5185\u5bb9 00 project_context \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u524d\u63d0\u6761\u4ef6 01 comment_policy \u30b3\u30e1\u30f3\u30c8\u65b9\u91dd 02 system_architecture \u30b7\u30b9\u30c6\u30e0\u69cb\u6210 03 directory_structure \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210 04 boundary_policy \u5883\u754c\u3068\u578b\u7ba1\u7406 05 security_notes \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u65b9\u91dd 06 cloudrun_ops Cloud Run\u904b\u7528 99 for_non_engineers \u975e\u30a8\u30f3\u30b8\u30cb\u30a2\u5411\u3051\u8aac\u660e"},{"location":"claude-code/#_5","title":"\u4f7f\u3044\u65b9","text":"<ol> <li><code>.claude</code> \u30d5\u30a9\u30eb\u30c0\u3092\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30eb\u30fc\u30c8\u306b\u914d\u7f6e</li> <li><code>CLAUDE.md</code> \u3067\u30eb\u30fc\u30eb\u306e\u8aad\u307f\u8fbc\u307f\u9806\u5e8f\u3092\u5b9a\u7fa9</li> <li><code>rules/</code> \u914d\u4e0b\u306b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u56fa\u6709\u306e\u30eb\u30fc\u30eb\u3092\u8a18\u8ff0</li> <li><code>settings.json</code> \u3067\u6a29\u9650\u3092\u5236\u5fa1</li> </ol> <p>Claude Code\u306f\u4f1a\u8a71\u958b\u59cb\u6642\u306b\u3053\u308c\u3089\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u81ea\u52d5\u7684\u306b\u8aad\u307f\u8fbc\u307f\u3001\u30eb\u30fc\u30eb\u306b\u5f93\u3063\u3066\u30b3\u30fc\u30c9\u751f\u6210\u3092\u884c\u3044\u307e\u3059\u3002</p>"},{"location":"claude-code/00_project_context/","title":"00_project_context.md","text":"<p>\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u524d\u63d0\u6761\u4ef6\u3092\u5b9a\u7fa9\u3059\u308b\u6700\u91cd\u8981\u30eb\u30fc\u30eb\u3067\u3059\u3002</p>"},{"location":"claude-code/00_project_context/#_1","title":"\u5185\u5bb9","text":"<pre><code># Project Context\uff08\u6700\u91cd\u8981\uff09\n\n\u3053\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306f\u9867\u5ba2\u6848\u4ef6\uff08\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30ef\u30fc\u30af\uff09\u3067\u3042\u308b\u3002\n\u521d\u671f\u30d5\u30a7\u30fc\u30ba\u306f PoC / \u793e\u5185\u691c\u8a3c\u7528\u9014\u3002\n\n\u6700\u512a\u5148\u4e8b\u9805\uff1a\n- \u672c\u756a\u5f71\u97ff\u30bc\u30ed\n- \u518d\u73fe\u6027\n- \u8aac\u660e\u8cac\u4efb\n- \u5c06\u6765\u306e\u6b63\u5f0f\u8a2d\u8a08\u3092\u59a8\u3052\u306a\u3044\u3053\u3068\n\nClaude \u306f\u696d\u52d9\u59d4\u8a17\u30a8\u30f3\u30b8\u30cb\u30a2\u3068\u3057\u3066\u632f\u308b\u821e\u3044\u3001\n\u63a8\u6e2c\u3067\u306e\u5b9f\u88c5\u306f\u7981\u6b62\u3059\u308b\u3002\n</code></pre>"},{"location":"claude-code/00_project_context/#_2","title":"\u89e3\u8aac","text":"<p>\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306f Claude Code \u306b\u5bfe\u3057\u3066\u300c\u3069\u306e\u3088\u3046\u306a\u7acb\u5834\u3067\u632f\u308b\u821e\u3046\u3079\u304d\u304b\u300d\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"claude-code/00_project_context/#_3","title":"\u6700\u512a\u5148\u4e8b\u9805","text":"\u9805\u76ee \u610f\u5473 \u672c\u756a\u5f71\u97ff\u30bc\u30ed \u65e2\u5b58\u74b0\u5883\u3092\u58ca\u3055\u306a\u3044 \u518d\u73fe\u6027 \u8ab0\u304c\u3084\u3063\u3066\u3082\u540c\u3058\u7d50\u679c\u306b\u306a\u308b \u8aac\u660e\u8cac\u4efb \u306a\u305c\u305d\u3046\u3057\u305f\u304b\u8aac\u660e\u3067\u304d\u308b \u5c06\u6765\u306e\u6b63\u5f0f\u8a2d\u8a08\u3092\u59a8\u3052\u306a\u3044 \u4e00\u6642\u7684\u306a\u56de\u907f\u7b56\u3067\u5c06\u6765\u3092\u7e1b\u3089\u306a\u3044"},{"location":"claude-code/00_project_context/#_4","title":"\u884c\u52d5\u6307\u91dd","text":"<ul> <li>\u63a8\u6e2c\u3067\u306e\u5b9f\u88c5\u306f\u7981\u6b62</li> <li>\u4e0d\u660e\u70b9\u306f\u78ba\u8a8d\u3057\u3066\u304b\u3089\u5b9f\u88c5</li> <li>\u696d\u52d9\u59d4\u8a17\u30a8\u30f3\u30b8\u30cb\u30a2\u3068\u3057\u3066\u306e\u8cac\u4efb\u3042\u308b\u884c\u52d5</li> </ul>"},{"location":"claude-code/01_comment_policy/","title":"01_comment_policy.md","text":"<p>\u30b3\u30fc\u30c9\u30b3\u30e1\u30f3\u30c8\u306e\u65b9\u91dd\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002</p>"},{"location":"claude-code/01_comment_policy/#_1","title":"\u5185\u5bb9","text":"<pre><code># \u30b3\u30e1\u30f3\u30c8\u65b9\u91dd\n\n\u30b3\u30e1\u30f3\u30c8\u306f\u300c\u8a2d\u8a08\u5224\u65ad\u306e\u30e1\u30e2\u300d\u3068\u3057\u3066\u6271\u3046\u3002\n\n- \u306a\u305c\u5fc5\u8981\u304b\u3092\u66f8\u304f\n- \u5224\u65ad\u3092\u4f34\u3046\u7b87\u6240\u306b\u9650\u5b9a\n- \u66f8\u304d\u3059\u304e\u306a\u3044\n\n\u81ea\u660e\u306a\u51e6\u7406\u3078\u306e\u5197\u9577\u306a\u30b3\u30e1\u30f3\u30c8\u306f\u7981\u6b62\u3002\n</code></pre>"},{"location":"claude-code/01_comment_policy/#_2","title":"\u89e3\u8aac","text":""},{"location":"claude-code/01_comment_policy/#_3","title":"\u826f\u3044\u30b3\u30e1\u30f3\u30c8","text":"<pre><code># Firebase Admin SDK\u3067\u306f\u306a\u304f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u691c\u8a3c\u3092\u4f7f\u7528\n# \u7406\u7531\uff1aPoC\u30d5\u30a7\u30fc\u30ba\u3067\u306f\u904b\u7528\u8ca0\u8377\u3092\u4e0b\u3052\u308b\u305f\u3081\ndef verify_token(token):\n    ...\n</code></pre>"},{"location":"claude-code/01_comment_policy/#_4","title":"\u60aa\u3044\u30b3\u30e1\u30f3\u30c8","text":"<pre><code># \u30e6\u30fc\u30b6\u30fc\u3092\u53d6\u5f97\u3059\u308b\nuser = get_user(id)  # \u81ea\u660e\u306a\u306e\u3067\u4e0d\u8981\n\n# i\u30921\u5897\u3084\u3059\ni += 1  # \u81ea\u660e\u3059\u304e\u308b\n</code></pre>"},{"location":"claude-code/01_comment_policy/#_5","title":"\u65b9\u91dd\u306e\u30dd\u30a4\u30f3\u30c8","text":"DO DON'T \u306a\u305c\u305d\u306e\u5224\u65ad\u3092\u3057\u305f\u304b\u66f8\u304f \u4f55\u3092\u3057\u3066\u3044\u308b\u304b\u66f8\u304f\uff08\u30b3\u30fc\u30c9\u3092\u8aad\u3081\u3070\u308f\u304b\u308b\uff09 \u4f8b\u5916\u7684\u306a\u51e6\u7406\u306b\u6ce8\u91c8\u3092\u4ed8\u3051\u308b \u3059\u3079\u3066\u306e\u95a2\u6570\u306b\u30b3\u30e1\u30f3\u30c8\u3092\u4ed8\u3051\u308b \u5c06\u6765\u306e\u6ce8\u610f\u70b9\u3092\u6b8b\u3059 \u81ea\u660e\u306a\u3053\u3068\u3092\u8aac\u660e\u3059\u308b"},{"location":"claude-code/02_system_architecture/","title":"02_system_architecture.md","text":"<p>\u30b7\u30b9\u30c6\u30e0\u5168\u4f53\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002</p>"},{"location":"claude-code/02_system_architecture/#_1","title":"\u5185\u5bb9","text":"<pre><code># \u30b7\u30b9\u30c6\u30e0\u69cb\u6210\uff08\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\uff09\u2014 \u30d5\u30ed\u30f3\u30c8\u3082\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3082 Cloud Run\n\n\u672c\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f\u3001\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\uff08\u753b\u9762\u914d\u4fe1\uff09\u3082\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\uff08API\uff09\u3082\n\u540c\u3058\u304f Cloud Run \u4e0a\u3067\u63d0\u4f9b\u3059\u308b\u524d\u63d0\u3067\u3001\u30b7\u30b9\u30c6\u30e0\u5168\u4f53\u306e\u6700\u5c0f\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3092\u5b9a\u7fa9\u3059\u308b\u3002\n</code></pre>"},{"location":"claude-code/02_system_architecture/#_2","title":"\u69cb\u6210\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"claude-code/02_system_architecture/#cloud-run-poc","title":"\u63a8\u5968\uff1a\u5358\u4e00 Cloud Run \u30b5\u30fc\u30d3\u30b9\uff08PoC\u5411\u3051\uff09","text":"<pre><code>[Cloud Run (single service)]\n  GET  /            -&gt; front.html\n  GET  /static/*    -&gt; script.js, css, etc\n  POST /api/chat    -&gt; server-side logic\n  GET  /api/health  -&gt; health check\n</code></pre> <p>\u30e1\u30ea\u30c3\u30c8</p> <ul> <li>\u69cb\u6210\u304c\u5358\u7d14</li> <li>CORS\u304c\u4e0d\u8981</li> <li>\u904b\u7528\u304c\u8efd\u3044</li> </ul>"},{"location":"claude-code/02_system_architecture/#_3","title":"\u30c7\u30fc\u30bf\u30d5\u30ed\u30fc","text":"<pre><code>[Browser]\n  front.html  (UI)\n    \u2193\n  script.js   (state / auth / fetch)\n    \u2193 HTTPS (same origin, JSON)\n[Cloud Run]\n  /api/*      (server-side logic)\n    \u2193\n[External Services]\n  AI API / DB\n</code></pre>"},{"location":"claude-code/02_system_architecture/#_4","title":"\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u898f\u7d04","text":"\u30d1\u30b9 \u7528\u9014 <code>/</code> HTML\uff08UI\uff09 <code>/static/*</code> JS/CSS/\u753b\u50cf <code>/api/*</code> API"},{"location":"claude-code/02_system_architecture/#_5","title":"\u7981\u6b62\u4e8b\u9805","text":"<ul> <li><code>/api</code> \u4ee5\u5916\u306e\u30d1\u30b9\u3067API\u3092\u751f\u3084\u3059</li> <li>HTML\u3068JS\u306e\u8cac\u52d9\u5206\u96e2\u3092\u5d29\u3059</li> <li><code>front.html</code> \u306bJS\u30ed\u30b8\u30c3\u30af\u3092\u623b\u3059</li> </ul>"},{"location":"claude-code/03_directory_structure/","title":"03_directory_structure.md","text":"<p>\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\u3092\u56fa\u5b9a\u3067\u5b9a\u7fa9\u3057\u307e\u3059\u3002</p>"},{"location":"claude-code/03_directory_structure/#_1","title":"\u5185\u5bb9","text":"<pre><code># \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\uff08\u56fa\u5b9a\uff09\n\n\u672c\u30d5\u30a7\u30fc\u30ba\u3067\u306f\u4ee5\u4e0b\u3092\u6b63\u5f0f\u69cb\u6210\u3068\u3059\u308b\u3002\n\npython/\n\u251c\u2500 backend.py\n\u251c\u2500 front.html\n\u251c\u2500 script.js\n\u2514\u2500 requirements.txt\n\n\u80a5\u5927\u5316\u3057\u305f\u5834\u5408\u306e\u307f\u3001\u5408\u610f\u306e\u4e0a\u3067\u5206\u5272\u3059\u308b\u3002\n</code></pre>"},{"location":"claude-code/03_directory_structure/#_2","title":"\u89e3\u8aac","text":""},{"location":"claude-code/03_directory_structure/#_3","title":"\u306a\u305c\u56fa\u5b9a\u3059\u308b\u306e\u304b","text":"\u7406\u7531 \u8aac\u660e \u518d\u73fe\u6027 \u8ab0\u304c\u898b\u3066\u3082\u540c\u3058\u69cb\u6210 \u8aac\u660e\u8cac\u4efb \u300c\u3053\u3053\u306b\u3042\u308b\u300d\u3068\u65ad\u8a00\u3067\u304d\u308b \u30b7\u30f3\u30d7\u30eb\u3055 PoC\u30d5\u30a7\u30fc\u30ba\u3067\u306f\u904e\u5270\u306a\u5206\u5272\u3092\u907f\u3051\u308b"},{"location":"claude-code/03_directory_structure/#_4","title":"\u5404\u30d5\u30a1\u30a4\u30eb\u306e\u5f79\u5272","text":"\u30d5\u30a1\u30a4\u30eb \u5f79\u5272 <code>backend.py</code> \u30b5\u30fc\u30d0\u30fc\u51e6\u7406\uff08API\u3001\u8a8d\u8a3c\u691c\u8a3c\uff09 <code>front.html</code> \u753b\u9762\uff08DOM\u69cb\u9020\u306e\u307f\uff09 <code>script.js</code> \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30ed\u30b8\u30c3\u30af <code>requirements.txt</code> Python\u4f9d\u5b58\u30d1\u30c3\u30b1\u30fc\u30b8"},{"location":"claude-code/03_directory_structure/#_5","title":"\u5206\u5272\u306e\u5224\u65ad\u57fa\u6e96","text":"<ul> <li>\u30d5\u30a1\u30a4\u30eb\u304c\u80a5\u5927\u5316\u3057\u305f\u5834\u5408</li> <li>\u8cac\u52d9\u304c\u660e\u78ba\u306b\u5206\u96e2\u3067\u304d\u308b\u5834\u5408</li> <li>\u30c1\u30fc\u30e0\u3067\u5408\u610f\u304c\u53d6\u308c\u305f\u5834\u5408</li> </ul> <p>\u30dd\u30a4\u30f3\u30c8</p> <p>\u300c\u5408\u610f\u306e\u4e0a\u3067\u300d\u304c\u91cd\u8981\u3067\u3059\u3002\u52dd\u624b\u306b\u69cb\u6210\u3092\u5909\u3048\u307e\u305b\u3093\u3002</p>"},{"location":"claude-code/04_boundary_policy/","title":"04_boundary_policy.md","text":"<p>\u5883\u754c\uff08API\u3001\u8a8d\u8a3c\u3001\u30d5\u30ed\u30f3\u30c8\u2194\u30d0\u30c3\u30af\uff09\u306e\u578b\u7ba1\u7406\u65b9\u91dd\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002</p>"},{"location":"claude-code/04_boundary_policy/#_1","title":"\u5185\u5bb9","text":"<pre><code># \u5883\u754c\u3068\u578b\u7ba1\u7406\u65b9\u91dd\n\n\u5185\u90e8\u51e6\u7406\u306f\u67d4\u8edf\u306b\u66f8\u304f\u3002\n\u5883\u754c\u306e\u307f\u69cb\u9020\u3092\u660e\u793a\u3059\u308b\u3002\n\n\u5883\u754c\uff1a\n- API Request / Response\n- \u8a8d\u8a3c\u30fb\u8a8d\u53ef\n- \u30d5\u30ed\u30f3\u30c8 \u2194 \u30d0\u30c3\u30af\n\nTypedDict \u7b49\u3092\u4f7f\u7528\u3057\u3001\n\u76ee\u7684\u306f\u53ef\u8aad\u6027\u3068\u8aac\u660e\u8cac\u4efb\u3002\n</code></pre>"},{"location":"claude-code/04_boundary_policy/#_2","title":"\u89e3\u8aac","text":""},{"location":"claude-code/04_boundary_policy/#_3","title":"\u5883\u754c\u3068\u306f","text":"<p>\u30b7\u30b9\u30c6\u30e0\u306e\u300c\u3064\u306a\u304e\u76ee\u300d\u3092\u6307\u3057\u307e\u3059\u3002</p> <pre><code>[\u30d5\u30ed\u30f3\u30c8] \u2190\u5883\u754c\u2192 [\u30d0\u30c3\u30af\u30a8\u30f3\u30c9] \u2190\u5883\u754c\u2192 [\u5916\u90e8API]\n</code></pre>"},{"location":"claude-code/04_boundary_policy/#_4","title":"\u306a\u305c\u5883\u754c\u3060\u3051\u53b3\u5bc6\u306b\u3059\u308b\u306e\u304b","text":"\u5185\u90e8\u51e6\u7406 \u5883\u754c \u67d4\u8edf\u306b\u66f8\u3044\u3066\u3088\u3044 \u578b\u3092\u660e\u793a\u3059\u308b \u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u81ea\u7531 \u5909\u66f4\u6642\u306f\u5408\u610f\u304c\u5fc5\u8981 \u5b9f\u88c5\u8005\u306e\u88c1\u91cf \u5951\u7d04\u3068\u3057\u3066\u6271\u3046"},{"location":"claude-code/04_boundary_policy/#_5","title":"\u5b9f\u88c5\u4f8b","text":"<pre><code>from typing import TypedDict\n\nclass ChatRequest(TypedDict):\n    message: str\n    user_id: str\n\nclass ChatResponse(TypedDict):\n    reply: str\n    timestamp: str\n</code></pre>"},{"location":"claude-code/04_boundary_policy/#_6","title":"\u76ee\u7684","text":"<ul> <li>\u53ef\u8aad\u6027\uff1a\u4f55\u3092\u9001\u3063\u3066\u4f55\u304c\u8fd4\u308b\u304b\u4e00\u76ee\u3067\u308f\u304b\u308b</li> <li>\u8aac\u660e\u8cac\u4efb\uff1a\u300c\u3053\u306e\u5f62\u5f0f\u3067\u901a\u4fe1\u3059\u308b\u300d\u3068\u65ad\u8a00\u3067\u304d\u308b</li> <li>\u4fdd\u5b88\u6027\uff1a\u5883\u754c\u306e\u5909\u66f4\u3092\u691c\u77e5\u3057\u3084\u3059\u3044</li> </ul>"},{"location":"claude-code/05_security_notes/","title":"05_security_notes.md","text":"<p>PoC / \u9867\u5ba2\u63d0\u4f9b\u5411\u3051\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u65b9\u91dd\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002</p>"},{"location":"claude-code/05_security_notes/#_1","title":"\u5185\u5bb9","text":"<pre><code># \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u65b9\u91dd\uff08PoC / \u9867\u5ba2\u63d0\u4f9b\u5411\u3051\uff09\n\n## \u57fa\u672c\u30b9\u30bf\u30f3\u30b9\n\n\u672c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306f\u9867\u5ba2\u306b\u63d0\u4f9b\u3055\u308c\u308b\u305f\u3081\u3001\n\u6700\u4f4e\u9650\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306f\u5fc5\u9808\u3068\u3059\u308b\u3002\n\n\u305f\u3060\u3057\u3001\u4ee5\u4e0b\u3092\u540c\u6642\u306b\u6e80\u305f\u3059\u3053\u3068\u3092\u91cd\u8996\u3059\u308b\uff1a\n\n- \u904b\u7528\u8005\u672c\u4eba\u304c\u7406\u89e3\u30fb\u8aac\u660e\u3067\u304d\u308b\n- \u904e\u5ea6\u306b\u8907\u96d1\u5316\u3057\u306a\u3044\n- \u5c06\u6765\u306e\u5f37\u5316\u3092\u59a8\u3052\u306a\u3044\n</code></pre>"},{"location":"claude-code/05_security_notes/#_2","title":"\u3053\u306e\u30d5\u30a7\u30fc\u30ba\u3067\u5fc5\u305a\u5b88\u308b\u3053\u3068","text":""},{"location":"claude-code/05_security_notes/#_3","title":"\u8a8d\u8a3c\u30fb\u8a8d\u53ef","text":"\u9805\u76ee \u5b9f\u88c5 \u8a8d\u8a3c\u57fa\u76e4 Firebase Authentication JWT\u53d6\u5f97 \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3067\u5b9f\u65bd JWT\u691c\u8a3c \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3067\u5b9f\u65bd \u30a2\u30af\u30bb\u30b9\u5236\u5fa1 \u30e1\u30fc\u30eb/\u30c9\u30e1\u30a4\u30f3\u5236\u5fa1"},{"location":"claude-code/05_security_notes/#_4","title":"\u79d8\u5bc6\u60c5\u5831\u306e\u7ba1\u7406","text":"DO DON'T \u74b0\u5883\u5909\u6570\u3067\u7ba1\u7406 \u30b3\u30fc\u30c9\u306b\u76f4\u66f8\u304d \u30b5\u30fc\u30d0\u30fc\u5074\u3067\u4fdd\u6301 \u30d5\u30ed\u30f3\u30c8\u306b\u6e21\u3059 \u30ed\u30b0\u304b\u3089\u9664\u5916 \u30ed\u30b0\u306b\u51fa\u529b"},{"location":"claude-code/05_security_notes/#_5","title":"\u3053\u306e\u30d5\u30a7\u30fc\u30ba\u3067\u3084\u3089\u306a\u3044\u3053\u3068","text":"<ul> <li>JWT\u7f72\u540d\u306e\u5b8c\u5168\u691c\u8a3c\uff08Admin SDK\uff09</li> <li>WAF / IAM \u306e\u9ad8\u5ea6\u8a2d\u5b9a</li> <li>IP\u5236\u9650\u30fb\u591a\u8981\u7d20\u8a8d\u8a3c</li> <li>\u76e3\u67fb\u30ed\u30b0\u306e\u5b8c\u5168\u5b9f\u88c5</li> </ul>"},{"location":"claude-code/05_security_notes/#_6","title":"\u5224\u65ad\u57fa\u6e96","text":"<p>\u4ee5\u4e0b\u3059\u3079\u3066\u306b YES \u3068\u7b54\u3048\u3089\u308c\u308b\u3053\u3068\uff1a</p> <ul> <li>[x] \u81ea\u5206\u3067\u8aac\u660e\u3067\u304d\u308b\u304b\uff1f</li> <li>[x] \u969c\u5bb3\u6642\u306b\u81ea\u5206\u3067\u76f4\u305b\u308b\u304b\uff1f</li> <li>[x] \u9867\u5ba2\u306b\u300c\u4eca\u306f\u3053\u3053\u307e\u3067\u300d\u3068\u8aac\u660e\u3067\u304d\u308b\u304b\uff1f</li> </ul>"},{"location":"claude-code/06_cloudrun_ops/","title":"06_cloudrun_ops.md","text":"<p>Cloud Run\u306e\u904b\u7528\u65b9\u91dd\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002</p>"},{"location":"claude-code/06_cloudrun_ops/#_1","title":"\u5185\u5bb9","text":"<pre><code># Cloud Run \u904b\u7528\u65b9\u91dd\uff08\u30b7\u30f3\u30d7\u30eb\u91cd\u8996\uff09\n\n## \u57fa\u672c\u65b9\u91dd\n\nCloud Run \u306f\u4ee5\u4e0b\u3092\u76ee\u7684\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u3002\n\n- \u7ba1\u7406\u8ca0\u8377\u3092\u6700\u5c0f\u5316\u3059\u308b\n- \u904b\u7528\u3092\u5358\u7d14\u306b\u4fdd\u3064\n- \u672c\u4eba\u304c\u628a\u63e1\u3067\u304d\u308b\u7bc4\u56f2\u306b\u7559\u3081\u308b\n</code></pre>"},{"location":"claude-code/06_cloudrun_ops/#_2","title":"\u5fc5\u9808\u30eb\u30fc\u30eb","text":"\u30eb\u30fc\u30eb \u8aac\u660e \u5358\u4e00\u30b5\u30fc\u30d3\u30b9\u69cb\u6210 \u5206\u5272\u3057\u306a\u3044 \u30d5\u30ed\u30f3\u30c8\u30fb\u30d0\u30c3\u30af\u540c\u5c45 \u540c\u4e00Cloud Run\u306b\u914d\u7f6e \u74b0\u5883\u5909\u6570\u3067\u8a2d\u5b9a\u7ba1\u7406 Secret Manager\u306f\u4f7f\u308f\u306a\u3044 PORT\u74b0\u5883\u5909\u6570\u3092\u4f7f\u7528 Cloud Run\u304c\u81ea\u52d5\u8a2d\u5b9a"},{"location":"claude-code/06_cloudrun_ops/#_3","title":"\u30ed\u30b0\u30fb\u76e3\u8996","text":"DO DON'T print/logging\u306f\u6700\u5c0f\u9650 \u904e\u5270\u306a\u30ed\u30b0\u51fa\u529b Cloud Logging\u3067\u78ba\u8a8d \u72ec\u81ea\u306e\u76e3\u8996\u30b7\u30b9\u30c6\u30e0\u69cb\u7bc9 \u30a8\u30e9\u30fc\u6642\u306e\u307f\u8a73\u7d30\u30ed\u30b0 \u3059\u3079\u3066\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30ed\u30b0"},{"location":"claude-code/06_cloudrun_ops/#_4","title":"\u3053\u306e\u30d5\u30a7\u30fc\u30ba\u3067\u3084\u3089\u306a\u3044\u3053\u3068","text":"<ul> <li>\u8907\u6570\u30b5\u30fc\u30d3\u30b9\u5206\u5272</li> <li>\u8907\u96d1\u306a IAM \u8a2d\u8a08</li> <li>\u9ad8\u5ea6\u306a\u30aa\u30fc\u30c8\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u8abf\u6574</li> <li>\u30de\u30eb\u30c1\u30ea\u30fc\u30b8\u30e7\u30f3\u69cb\u6210</li> </ul>"},{"location":"claude-code/06_cloudrun_ops/#_5","title":"\u5224\u65ad\u57fa\u6e96","text":"<ul> <li>[x] \u672c\u4eba\u304cCloud Run\u306e\u72b6\u614b\u3092\u8aac\u660e\u3067\u304d\u308b\u304b</li> <li>[x] \u969c\u5bb3\u6642\u306b\u4e00\u4eba\u3067\u5207\u308a\u5206\u3051\u3067\u304d\u308b\u304b</li> </ul> <p>YES \u3067\u3042\u308c\u3070\u63a1\u7528\u3059\u308b\u3002</p>"},{"location":"claude-code/99_for_non_engineers/","title":"99_for_non_engineers.md","text":"<p>\u975e\u30a8\u30f3\u30b8\u30cb\u30a2\u5411\u3051\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u8aac\u660e\u3067\u3059\u3002</p>"},{"location":"claude-code/99_for_non_engineers/#_1","title":"\u76ee\u7684","text":"<p>\u30a8\u30f3\u30b8\u30cb\u30a2\u3067\u306f\u306a\u3044\u65b9\u304c\u4ee5\u4e0b\u3092\u7406\u89e3\u3067\u304d\u308b\u3053\u3068\u3092\u76ee\u7684\u3068\u3057\u3066\u3044\u307e\u3059\uff1a</p> <ul> <li>\u3053\u306e\u30b7\u30b9\u30c6\u30e0\u306f\u300c\u4f55\u3092\u3059\u308b\u3082\u306e\u304b\u300d</li> <li>\u3069\u306e\u3088\u3046\u306a\u69cb\u6210\u3067\u52d5\u3044\u3066\u3044\u308b\u304b</li> <li>\u306a\u305c\u3053\u306e\u4f5c\u308a\u65b9\u3092\u9078\u3093\u3067\u3044\u308b\u304b</li> </ul>"},{"location":"claude-code/99_for_non_engineers/#_2","title":"\u3053\u306e\u30b7\u30b9\u30c6\u30e0\u306f\u4f55\u304b","text":"<p>\u9867\u5ba2\u5411\u3051\u306b\u63d0\u4f9b\u3059\u308b AI \u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea \u3067\u3059\u3002</p> <ul> <li>\u30d6\u30e9\u30a6\u30b6\uff08Web\u753b\u9762\uff09\u304b\u3089\u5229\u7528</li> <li>Google\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ed\u30b0\u30a4\u30f3</li> <li>\u8a31\u53ef\u3055\u308c\u305f\u30e6\u30fc\u30b6\u30fc\u306e\u307f\u5229\u7528\u53ef\u80fd</li> <li>AI\u3068\u30c1\u30e3\u30c3\u30c8\u5f62\u5f0f\u3067\u4f1a\u8a71</li> </ul>"},{"location":"claude-code/99_for_non_engineers/#_3","title":"\u5168\u4f53\u69cb\u6210","text":"<pre><code>\u753b\u9762\uff08HTML\uff09\n   \u2193\n\u52d5\u304d\u3092\u5236\u5fa1\u3059\u308b\u4ed5\u7d44\u307f\uff08JavaScript\uff09\n   \u2193\n\u5224\u65ad\u3068\u51e6\u7406\u3092\u884c\u3046\u30b5\u30fc\u30d0\u30fc\uff08Python\uff09\n</code></pre>"},{"location":"claude-code/99_for_non_engineers/#_4","title":"\u30d5\u30a1\u30a4\u30eb\u69cb\u6210","text":"<pre><code>python/\n\u251c\u2500 backend.py      \u2190 \u30b5\u30fc\u30d0\u30fc\n\u251c\u2500 front.html      \u2190 \u753b\u9762\n\u251c\u2500 script.js       \u2190 \u52d5\u304d\u306e\u5236\u5fa1\n\u2514\u2500 requirements.txt \u2190 \u5fc5\u8981\u306a\u90e8\u54c1\u4e00\u89a7\n</code></pre>"},{"location":"claude-code/99_for_non_engineers/#_5","title":"\u5404\u30d5\u30a1\u30a4\u30eb\u306e\u5f79\u5272\uff08\u7c21\u6613\u7248\uff09","text":"\u30d5\u30a1\u30a4\u30eb \u5f79\u5272 \u4f8b\u3048 front.html \u898b\u305f\u76ee \u5efa\u7269\u306e\u5916\u89b3 script.js \u52d5\u304d \u30a8\u30ec\u30d9\u30fc\u30bf\u30fc\u306e\u64cd\u4f5c\u76e4 backend.py \u5224\u65ad \u7ba1\u7406\u4eba\u5ba4"},{"location":"claude-code/99_for_non_engineers/#_6","title":"\u306a\u305c\u3053\u3046\u4f5c\u3063\u3066\u3044\u308b\u306e\u304b","text":"<ol> <li>\u8ab0\u304c\u898b\u3066\u3082\u5f79\u5272\u304c\u308f\u304b\u308b</li> <li>\u9593\u9055\u3063\u305f\u5909\u66f4\u3092\u9632\u3052\u308b</li> <li>\u540c\u3058\u3082\u306e\u3092\u4f55\u5ea6\u3067\u3082\u4f5c\u308a\u76f4\u305b\u308b</li> </ol>"},{"location":"claude-code/99_for_non_engineers/#_7","title":"\u6700\u5f8c\u306b","text":"<p>\u300c\u52d5\u3051\u3070\u3088\u3044\u300d\u3067\u306f\u306a\u304f\u300c\u8ab0\u304c\u898b\u3066\u3082\u7406\u89e3\u3067\u304d\u3001\u518d\u73fe\u3067\u304d\u308b\u300d</p> <p>\u3053\u308c\u304c\u6700\u512a\u5148\u4e8b\u9805\u3067\u3059\u3002</p>"},{"location":"claude-code/claude_md/","title":"CLAUDE.md","text":"<p><code>.claude/CLAUDE.md</code> \u306fClaude Code\u304c\u6700\u521d\u306b\u8aad\u307f\u8fbc\u3080\u30a8\u30f3\u30c8\u30ea\u30dd\u30a4\u30f3\u30c8\u3067\u3059\u3002</p>"},{"location":"claude-code/claude_md/#_1","title":"\u5f79\u5272","text":"<ul> <li>\u30eb\u30fc\u30eb\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\u9806\u5e8f\u3092\u6307\u5b9a</li> <li>\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u5168\u4f53\u306e\u6982\u8981\u3092\u8a18\u8ff0</li> <li>\u4ed6\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3078\u306e\u53c2\u7167\u3092\u63d0\u4f9b</li> </ul>"},{"location":"claude-code/claude_md/#_2","title":"\u5185\u5bb9","text":"<pre><code># Project Memory (Claude Code)\n\nThis repository uses modular project rules under `.claude/rules/`.\n\n## Rules index (load order)\n- 00_project_context.md\n- 01_comment_policy.md\n- 02_system_architecture.md\n- 03_directory_structure.md\n- 04_boundary_policy.md\n- 05_security_notes.md\n- 06_cloudrun_ops.md\n- 99_for_non_engineers.md\n\n## Notes\n- Architecture assumes **frontend and backend are served from Cloud Run**.\n- `02_architecture.md` is kept as a short compatibility stub; refer to `02_system_architecture.md`.\n- Verify loaded memory via `/memory`.\n</code></pre>"},{"location":"claude-code/claude_md/#_3","title":"\u30dd\u30a4\u30f3\u30c8","text":"<ul> <li>\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u756a\u53f7\u3092\u4ed8\u3051\u308b\u3053\u3068\u3067\u8aad\u307f\u8fbc\u307f\u9806\u5e8f\u3092\u660e\u793a</li> <li><code>00_</code> \u306f\u6700\u91cd\u8981\u30eb\u30fc\u30eb\u3001<code>99_</code> \u306f\u88dc\u8db3\u60c5\u5831\u3068\u3044\u3046\u6163\u4f8b</li> <li><code>/memory</code> \u30b3\u30de\u30f3\u30c9\u3067\u8aad\u307f\u8fbc\u307f\u72b6\u614b\u3092\u78ba\u8a8d\u53ef\u80fd</li> </ul>"},{"location":"claude-code/settings/","title":"settings.json","text":"<p><code>.claude/settings.json</code> \u306fClaude Code\u306e\u6a29\u9650\u3092\u5236\u5fa1\u3059\u308b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002</p>"},{"location":"claude-code/settings/#_1","title":"\u5f79\u5272","text":"<ul> <li>\u7981\u6b62\u64cd\u4f5c\u306e\u5b9a\u7fa9</li> <li>\u30c1\u30fc\u30e0\u5168\u4f53\u3067\u5171\u6709\u3059\u308b\u6a29\u9650\u30eb\u30fc\u30eb</li> <li>Git\u7ba1\u7406\u5bfe\u8c61</li> </ul>"},{"location":"claude-code/settings/#_2","title":"\u5185\u5bb9","text":"<pre><code>{\n  \"permissions\": {\n    \"deny\": [\n      \"Read(./.env)\",\n      \"Read(./.env.*)\",\n      \"Read(./secrets/**)\",\n      \"Read(./**/*.key)\",\n      \"Read(./**/*.pem)\",\n      \"Read(./**/*credential*)\",\n      \"Read(./**/*secret*)\"\n    ]\n  }\n}\n</code></pre>"},{"location":"claude-code/settings/#_3","title":"\u8a2d\u5b9a\u9805\u76ee","text":""},{"location":"claude-code/settings/#deny","title":"deny\uff08\u7981\u6b62\uff09","text":"\u30d1\u30bf\u30fc\u30f3 \u8aac\u660e <code>.env</code>, <code>.env.*</code> \u74b0\u5883\u5909\u6570\u30d5\u30a1\u30a4\u30eb <code>secrets/**</code> \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30d5\u30a9\u30eb\u30c0 <code>*.key</code>, <code>*.pem</code> \u79d8\u5bc6\u9375\u30fb\u8a3c\u660e\u66f8 <code>*credential*</code> \u8a8d\u8a3c\u60c5\u5831\u30d5\u30a1\u30a4\u30eb <code>*secret*</code> \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u95a2\u9023\u30d5\u30a1\u30a4\u30eb"},{"location":"claude-code/settings/#settingslocaljson","title":"settings.local.json \u3068\u306e\u9055\u3044","text":"\u30d5\u30a1\u30a4\u30eb \u7528\u9014 Git\u7ba1\u7406 <code>settings.json</code> \u30c1\u30fc\u30e0\u5171\u6709\u306e\u30eb\u30fc\u30eb \u25cb <code>settings.local.json</code> \u500b\u4eba\u306e\u8a31\u53ef\u8a2d\u5b9a \u00d7 <p>\u6ce8\u610f</p> <p><code>settings.local.json</code> \u306f\u500b\u4eba\u306e\u4f5c\u696d\u74b0\u5883\u306b\u4f9d\u5b58\u3059\u308b\u305f\u3081\u3001<code>.gitignore</code> \u306b\u8ffd\u52a0\u3059\u308b\u3053\u3068\u3092\u63a8\u5968\u3057\u307e\u3059\u3002</p>"},{"location":"code/nodejs/","title":"Node.js\u7248 \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9","text":"<p>GCP Cloud Run functions \u3067\u52d5\u4f5c\u3059\u308bAI\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\u306eNode.js\u7248\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3067\u3059\u3002</p>"},{"location":"code/nodejs/#_1","title":"\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7","text":"\u30d5\u30a1\u30a4\u30eb \u5f79\u5272 GCP\u3067\u306e\u64cd\u4f5c backend.js \u30b5\u30fc\u30d0\u30fc\u5074\u306e\u51e6\u7406\uff08\u30e1\u30a4\u30f3\uff09 index.js \u306b\u8cbc\u308a\u4ed8\u3051 front.html \u753b\u9762\u306e\u30c7\u30b6\u30a4\u30f3\uff08HTML/CSS\uff09 \u65b0\u898f\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u8ffd\u52a0 script.js \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u306e\u51e6\u7406\uff08JavaScript\uff09 \u65b0\u898f\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u8ffd\u52a0 package.json \u4f7f\u7528\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u4e00\u89a7 package.json \u306b\u8cbc\u308a\u4ed8\u3051"},{"location":"code/nodejs/#_2","title":"\u4f7f\u3044\u65b9","text":"<ol> <li>\u5404\u30d5\u30a1\u30a4\u30eb\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u30b3\u30fc\u30c9\u3092\u8868\u793a</li> <li>\u30b3\u30fc\u30c9\u30d6\u30ed\u30c3\u30af\u53f3\u4e0a\u306e\u30b3\u30d4\u30fc\u30dc\u30bf\u30f3\u3067\u30b3\u30d4\u30fc</li> <li>GCP\u306eCloud Run functions\u306b\u8cbc\u308a\u4ed8\u3051</li> </ol> <p>\u8a73\u3057\u3044\u624b\u9806\u306f \u69cb\u7bc9\u624b\u9806\u66f8 \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"code/nodejs/backend/","title":"backend.js","text":"<p>\u30b5\u30fc\u30d0\u30fc\u5074\u306e\u51e6\u7406\uff08\u30e1\u30a4\u30f3\uff09</p> <pre><code>/**\n * AI \u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea - \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\uff08\u30b5\u30fc\u30d0\u30fc\u5074\u51e6\u7406\uff09\n *\n * \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n * \u3010HTTP\u901a\u4fe1\u3068\u306f\uff1f - \u624b\u7d19\u306e\u3084\u308a\u53d6\u308a\u306b\u4f8b\u3048\u308b\u3068\u3011\n * \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n *\n * \u30d6\u30e9\u30a6\u30b6\uff08\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\uff09\u3068\u30b5\u30fc\u30d0\u30fc\uff08\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\uff09\u306f\u300c\u624b\u7d19\u300d\u3067\u3084\u308a\u53d6\u308a\u3057\u307e\u3059\u3002\n *\n * \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n * \u2502  fetch('/api/chat', {                                       \u2502\n * \u2502      method: 'POST',                    \u2190 \u624b\u7d19\u306e\u7a2e\u985e        \u2502\n * \u2502      headers: { Authorization: '...' }, \u2190 \u5c01\u7b52\u306e\u60c5\u5831        \u2502\n * \u2502      body: JSON.stringify({ message })  \u2190 \u624b\u7d19\u306e\u4e2d\u8eab        \u2502\n * \u2502  })                                                         \u2502\n * \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n *\n * \u25a0 method = \u624b\u7d19\u306e\u7a2e\u985e\uff08GET=\u60c5\u5831\u304f\u3060\u3055\u3044 / POST=\u3053\u308c\u51e6\u7406\u3057\u3066\uff09\n * \u25a0 headers = \u5c01\u7b52\u306e\u60c5\u5831\uff08\u8a8d\u8a3c\u30c8\u30fc\u30af\u30f3\u7b49\uff09\n * \u25a0 body = \u624b\u7d19\u306e\u4e2d\u8eab\uff08\u9001\u308a\u305f\u3044\u30c7\u30fc\u30bf\uff09\n *\n * \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n * \u3010JWT\u30c8\u30fc\u30af\u30f3\u3068\u306f\uff1f - \u4f1a\u54e1\u8a3c\u306b\u4f8b\u3048\u308b\u3068\u3011\n * \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n *\n * JWT\u30c8\u30fc\u30af\u30f3 = \u300c\u30c7\u30b8\u30bf\u30eb\u4f1a\u54e1\u8a3c\u300d\u306e\u3088\u3046\u306a\u3082\u306e\u3002\n *\n * \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n * \u2502  Google\u3067\u30ed\u30b0\u30a4\u30f3                                            \u2502\n * \u2502       \u2193                                                     \u2502\n * \u2502  Firebase\u304c\u300c\u3053\u306e\u4eba\u306f\u25cb\u25cb\u3055\u3093\u3067\u3059\u300d\u3068\u3044\u3046\u4f1a\u54e1\u8a3c\u3092\u767a\u884c         \u2502\n * \u2502       \u2193                                                     \u2502\n * \u2502  \u305d\u306e\u4f1a\u54e1\u8a3c\uff08JWT\u30c8\u30fc\u30af\u30f3\uff09\u3092\u30b5\u30fc\u30d0\u30fc\u306b\u898b\u305b\u3066\u30a2\u30af\u30bb\u30b9         \u2502\n * \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n *\n * \u25a0 \u306a\u305c\u5fc5\u8981\uff1f\n *   \u2192 \u30b5\u30fc\u30d0\u30fc\u306f\u300c\u8ab0\u304b\u3089\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u304b\u300d\u3092\u78ba\u8a8d\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\n *   \u2192 JWT\u30c8\u30fc\u30af\u30f3\u306e\u4e2d\u306b\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u7b49\u306e\u60c5\u5831\u304c\u5165\u3063\u3066\u3044\u308b\n *\n * \u25a0 \u3053\u306e\u30b3\u30fc\u30c9\u3067\u306e\u4f7f\u308f\u308c\u65b9\n *   1. \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9: \u30ed\u30b0\u30a4\u30f3\u5f8c\u3001\u30c8\u30fc\u30af\u30f3\u3092headers\u306b\u5165\u308c\u3066\u9001\u4fe1\n *   2. \u30d0\u30c3\u30af\u30a8\u30f3\u30c9: \u30c8\u30fc\u30af\u30f3\u304b\u3089\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u53d6\u308a\u51fa\u3057\u3066\u8a8d\u8a3c\n */\n\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// \u30e9\u30a4\u30d6\u30e9\u30ea\u8aad\u307f\u8fbc\u307f\u3010\u524a\u9664\u7981\u6b62\u3011\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n\n// Cloud Run functions \u3067HTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u53d6\u308b\u305f\u3081\u306b\u5fc5\u8981\uff08Google\u63d0\u4f9b\uff09\nconst functions = require('@google-cloud/functions-framework');\n\n// ChatGPT API\u3092\u547c\u3073\u51fa\u3059\u305f\u3081\u306b\u5fc5\u8981\uff08OpenAI\u63d0\u4f9b\uff09\nconst OpenAI = require('openai');\n\n// \u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3080\u305f\u3081\u306b\u5fc5\u8981\uff08Node.js\u6a19\u6e96\u6a5f\u80fd\uff09\nconst fs = require('fs');\n\n// \u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u3092\u6271\u3046\u305f\u3081\u306b\u5fc5\u8981\uff08Node.js\u6a19\u6e96\u6a5f\u80fd\uff09\nconst path = require('path');\n\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// \u2605\u2605\u2605 \u8a2d\u5b9a\uff08\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3054\u3068\u306b\u5909\u66f4\u304c\u5fc5\u8981\uff09\u2605\u2605\u2605\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n\n/**\n * \u3010CORS\u8a2d\u5b9a - \u672c\u756a\u74b0\u5883\u3067\u306f\u5909\u66f4\u63a8\u5968\u3011\n *\n * \u25a0 \u3053\u308c\u306f\u4f55\uff1f\n *   \u300c\u3069\u306eWeb\u30b5\u30a4\u30c8\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3059\u308b\u304b\u300d\u306e\u8a2d\u5b9a\u3067\u3059\u3002\n *   '*' \u306f\u300c\u3069\u3053\u304b\u3089\u3067\u3082OK\u300d\u3068\u3044\u3046\u610f\u5473\uff08\u958b\u767a\u7528\uff09\u3002\n *\n * \u25a0 \u672c\u756a\u3067\u306f\u3069\u3046\u3059\u308b\uff1f\n *   Cloud Run\u306e\u95a2\u6570URL\uff08\u30c7\u30d7\u30ed\u30a4\u5f8c\u306b\u8868\u793a\u3055\u308c\u308b\uff09\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n *\n *   \u3010\u78ba\u8a8d\u65b9\u6cd5\u3011\n *   GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u2192 Cloud Run \u2192 \u95a2\u6570\u3092\u30af\u30ea\u30c3\u30af \u2192 \u4e0a\u90e8\u306b\u8868\u793a\u3055\u308c\u308bURL\n *   \u4f8b: https://ai-chat-app-xxxxx-an.a.run.app\n *\n *   \u3010\u8a2d\u5b9a\u4f8b\u3011\n *   const ALLOWED_ORIGINS = [\n *       'https://ai-chat-app-xxxxx-an.a.run.app'\n *   ];\n *\n * \u25a0 \u4eca\u306f\u5909\u66f4\u3057\u306a\u304f\u3066OK\n *   \u3053\u306e\u30a2\u30d7\u30ea\u306f\u30d5\u30ed\u30f3\u30c8\u3068\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u304c\u540c\u3058URL\u306a\u306e\u3067\u3001\n *   '*' \u306e\u307e\u307e\u3067\u3082\u52d5\u4f5c\u3057\u307e\u3059\u3002\n */\nconst ALLOWED_ORIGINS = ['*'];\n\n// HTML\u30d5\u30a1\u30a4\u30eb\u8aad\u307f\u8fbc\u307f\u3010\u524a\u9664\u7981\u6b62\u3011\nconst HTML_CONTENT = fs.readFileSync(path.join(__dirname, 'front.html'), 'utf8');\n\n// JavaScript\u30d5\u30a1\u30a4\u30eb\u8aad\u307f\u8fbc\u307f\u3010\u524a\u9664\u7981\u6b62\u3011\nconst SCRIPT_CONTENT = fs.readFileSync(path.join(__dirname, 'script.js'), 'utf8');\n\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// \u30d8\u30eb\u30d1\u30fc\u95a2\u6570\u3010\u524a\u9664\u7981\u6b62\u3011\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n\n// CORS\u30d8\u30c3\u30c0\u30fc\u8a2d\u5b9a\nfunction setCorsHeaders(res, origin) {\n    if (ALLOWED_ORIGINS.includes('*') || ALLOWED_ORIGINS.includes(origin)) {\n        res.set('Access-Control-Allow-Origin', origin || '*');\n    }\n    res.set('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');\n    res.set('Access-Control-Allow-Headers', 'Content-Type, Authorization');\n    res.set('Access-Control-Max-Age', '3600');\n}\n\n// \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30d8\u30c3\u30c0\u30fc\u8a2d\u5b9a\nfunction setSecurityHeaders(res) {\n    res.set('X-Content-Type-Options', 'nosniff');\n    res.set('X-Frame-Options', 'DENY');\n    res.set('X-XSS-Protection', '1; mode=block');\n    res.set('Referrer-Policy', 'strict-origin-when-cross-origin');\n}\n\n/**\n * \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n * \u2605\u2605\u2605 \u30a2\u30af\u30bb\u30b9\u5236\u5fa1\uff08\u91cd\u8981\uff01\u524a\u9664\u7981\u6b62\uff09\u2605\u2605\u2605\n * \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n *\n * \u3053\u306e\u95a2\u6570\u304c\u306a\u3044\u3068\u3001\u8ab0\u3067\u3082\u30a2\u30d7\u30ea\u3092\u4f7f\u3048\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n *\n * \u3010\u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\u65b9\u6cd5\u3011GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u2192 Cloud Run \u2192 \u74b0\u5883\u5909\u6570\n *   ALLOWED_EMAILS: \"admin@example.com,user1@example.com\"\n *   ALLOWED_DOMAINS: \"@yourcompany.co.jp\"\n *\n * \u3010\u6ce8\u610f\u3011\u4e21\u65b9\u672a\u8a2d\u5b9a\u3060\u3068\u5168\u54e1\u8a31\u53ef\u306b\u306a\u308a\u307e\u3059\uff08\u958b\u767a\u7528\uff09\n */\nfunction isEmailAllowed(email) {\n    if (!email) return false;\n    const lowerEmail = email.toLowerCase();\n\n    const allowedEmails = process.env.ALLOWED_EMAILS\n        ? process.env.ALLOWED_EMAILS.split(',').map(e =&gt; e.trim().toLowerCase())\n        : [];\n    const allowedDomains = process.env.ALLOWED_DOMAINS\n        ? process.env.ALLOWED_DOMAINS.split(',').map(d =&gt; d.trim().toLowerCase())\n        : [];\n\n    if (allowedEmails.includes(lowerEmail)) return true;\n    for (const domain of allowedDomains) {\n        if (lowerEmail.endsWith(domain)) return true;\n    }\n\n    // \u8a2d\u5b9a\u306a\u3057 = \u5168\u54e1\u8a31\u53ef\uff08\u958b\u767a\u7528\uff09\n    if (allowedEmails.length === 0 &amp;&amp; allowedDomains.length === 0) {\n        console.warn('\u26a0\ufe0f ALLOWED_EMAILS/ALLOWED_DOMAINS \u672a\u8a2d\u5b9a');\n        return true;\n    }\n    return false;\n}\n\n// JWT\u30c8\u30fc\u30af\u30f3\u304b\u3089\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u53d6\u5f97\u3010\u524a\u9664\u7981\u6b62\u3011\nfunction getEmailFromToken(idToken) {\n    try {\n        const payload = idToken.split('.')[1];\n        const decoded = Buffer.from(payload, 'base64').toString('utf8');\n        return JSON.parse(decoded).email || null;\n    } catch (e) {\n        return null;\n    }\n}\n\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// \u30e1\u30a4\u30f3\u30cf\u30f3\u30c9\u30e9\u3010\u524a\u9664\u7981\u6b62\u3011\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n//\n// \u25a0 \u30e1\u30a4\u30f3\u30cf\u30f3\u30c9\u30e9\u3068\u306f\uff1f\n//   \u300c\u53d7\u4ed8\u4fc2\u300d\u306e\u3088\u3046\u306a\u3082\u306e\u3002\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u6700\u521d\u306b\u53d7\u3051\u53d6\u308a\u3001\n//   URL\u306b\u5fdc\u3058\u3066\u9069\u5207\u306a\u51e6\u7406\u306b\u632f\u308a\u5206\u3051\u307e\u3059\u3002\n//\n// \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n// \u2502  \u30d6\u30e9\u30a6\u30b6: \u300c/api/chat \u306b POST \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u308a\u307e\u3059\u300d         \u2502\n// \u2502       \u2193                                                     \u2502\n// \u2502  \u30e1\u30a4\u30f3\u30cf\u30f3\u30c9\u30e9: \u300c/api/chat \u3067\u3059\u306d\u3001\u30c1\u30e3\u30c3\u30c8\u51e6\u7406\u306b\u56de\u3057\u307e\u3059\u300d  \u2502\n// \u2502       \u2193                                                     \u2502\n// \u2502  \u30c1\u30e3\u30c3\u30c8API: \u300cAI\u306b\u554f\u3044\u5408\u308f\u305b\u3066\u8fd4\u7b54\u3057\u307e\u3059\u300d                  \u2502\n// \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n//\n// \u25a0 functions.http('app', ...) \u3068\u306f\uff1f\n//   \u300capp\u3068\u3044\u3046\u540d\u524d\u3067HTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u53d6\u308b\u5165\u53e3\u3092\u4f5c\u308b\u300d\u3068\u3044\u3046\u610f\u5473\u3002\n//   GCP\u306f\u3053\u306e\u540d\u524d\u3092\u898b\u3066\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u3053\u306e\u95a2\u6570\u306b\u6e21\u3057\u307e\u3059\u3002\n//\n\nfunctions.http('app', async (req, res) =&gt; {\n    // \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    // \u2502 req\uff08\u30ea\u30af\u30a8\u30b9\u30c8\uff09= \u30d6\u30e9\u30a6\u30b6\u304b\u3089\u5c4a\u3044\u305f\u300c\u624b\u7d19\u300d               \u2502\n    // \u2502   - req.method  \u2192 \u624b\u7d19\u306e\u7a2e\u985e\uff08GET/POST\uff09                   \u2502\n    // \u2502   - req.path    \u2192 \u3069\u3053\u5b9b\u3066\uff1f\uff08/api/chat \u306a\u3069\uff09             \u2502\n    // \u2502   - req.headers \u2192 \u5c01\u7b52\u306e\u60c5\u5831\uff08\u8a8d\u8a3c\u30c8\u30fc\u30af\u30f3\u306a\u3069\uff09           \u2502\n    // \u2502   - req.body    \u2192 \u624b\u7d19\u306e\u4e2d\u8eab\uff08\u9001\u3089\u308c\u3066\u304d\u305f\u30c7\u30fc\u30bf\uff09         \u2502\n    // \u2502                                                             \u2502\n    // \u2502 res\uff08\u30ec\u30b9\u30dd\u30f3\u30b9\uff09= \u30d6\u30e9\u30a6\u30b6\u306b\u8fd4\u3059\u300c\u8fd4\u4e8b\u300d\u3092\u4f5c\u308b\u9053\u5177         \u2502\n    // \u2502   - res.json()  \u2192 JSON\u5f62\u5f0f\u3067\u8fd4\u4e8b\u3092\u8fd4\u3059                     \u2502\n    // \u2502   - res.send()  \u2192 \u30c6\u30ad\u30b9\u30c8\u3084HTML\u3067\u8fd4\u4e8b\u3092\u8fd4\u3059               \u2502\n    // \u2502   - res.status()\u2192 \u8fd4\u4e8b\u306e\u72b6\u614b\uff08200=\u6210\u529f\u3001404=\u898b\u3064\u304b\u3089\u306a\u3044\uff09 \u2502\n    // \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n    const origin = req.headers.origin;\n\n    // \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\u3092\u8fd4\u4e8b\u306b\u8ffd\u52a0\u3010\u524a\u9664\u7981\u6b62\u3011\n    setCorsHeaders(res, origin);\n    setSecurityHeaders(res);\n\n    // \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    // \u2502 \u30d7\u30ea\u30d5\u30e9\u30a4\u30c8\u30ea\u30af\u30a8\u30b9\u30c8\u3068\u306f\uff1f\u3010\u524a\u9664\u7981\u6b62\u3011                     \u2502\n    // \u2502                                                             \u2502\n    // \u2502 \u30d6\u30e9\u30a6\u30b6\u304c\u672c\u756a\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308b\u524d\u306b                        \u2502\n    // \u2502 \u300c\u3053\u306e\u30b5\u30fc\u30d0\u30fc\u3001\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3044\u3044\uff1f\u300d\u3068\u78ba\u8a8d\u3059\u308b\u4ed5\u7d44\u307f        \u2502\n    // \u2502                                                             \u2502\n    // \u2502 \u30d6\u30e9\u30a6\u30b6: \u300cOPTIONS\u3067\u78ba\u8a8d\u3057\u307e\u3059\u300d                           \u2502\n    // \u2502 \u30b5\u30fc\u30d0\u30fc: \u300c204\uff08OK\u3001\u4e2d\u8eab\u306a\u3057\uff09\u3067\u8fd4\u4e8b\u300d                     \u2502\n    // \u2502 \u30d6\u30e9\u30a6\u30b6: \u300c\u3058\u3083\u3042\u672c\u756a\u306ePOST\u3092\u9001\u308a\u307e\u3059\u300d                    \u2502\n    // \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    if (req.method === 'OPTIONS') {\n        return res.status(204).send('');\n    }\n\n    const reqPath = req.path;\n\n    // \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n    // \u2551 \u3010\u51e6\u7406\u306e\u6d41\u308c\u3011\u30e6\u30fc\u30b6\u30fc\u306e\u64cd\u4f5c\u9806\u306b\u4e26\u3093\u3067\u3044\u307e\u3059                 \u2551\n    // \u2551                                                             \u2551\n    // \u2551  1. / (\u30c8\u30c3\u30d7\u30da\u30fc\u30b8)     \u2192 \u30e6\u30fc\u30b6\u30fc\u304c\u6700\u521d\u306b\u30a2\u30af\u30bb\u30b9         \u2551\n    // \u2551  1b. /script.js          \u2192 \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u306eJavaScript       \u2551\n    // \u2551  2. /api/check-access    \u2192 \u30ed\u30b0\u30a4\u30f3\u5f8c\u3001\u6a29\u9650\u3092\u78ba\u8a8d           \u2551\n    // \u2551  3. /api/chat            \u2192 \u30e1\u30a4\u30f3\u306e\u30c1\u30e3\u30c3\u30c8\u6a5f\u80fd             \u2551\n    // \u2551  4. \u3010\u65b0\u3057\u3044API\u3092\u8ffd\u52a0\u3011  \u2192 \u6a5f\u80fd\u62e1\u5f35\u306f\u3053\u3053\u306b                 \u2551\n    // \u2551  5. /api/health          \u2192 \u904b\u7528\u76e3\u8996\u7528\uff08\u30e6\u30fc\u30b6\u30fc\u306f\u4f7f\u308f\u306a\u3044\uff09 \u2551\n    // \u2551  6. 404\u30a8\u30e9\u30fc            \u2192 \u3069\u308c\u306b\u3082\u8a72\u5f53\u3057\u306a\u3044\u5834\u5408           \u2551\n    // \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n\n    // ---------------------------------------------------------------\n    // 1. \u30c8\u30c3\u30d7\u30da\u30fc\u30b8\u8868\u793a\u3010\u524a\u9664\u7981\u6b62\u3011\n    // \u2192 \u30e6\u30fc\u30b6\u30fc\u304c\u6700\u521d\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u753b\u9762\uff08\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\uff09\n    // ---------------------------------------------------------------\n    if (reqPath === '/' &amp;&amp; req.method === 'GET') {\n        res.set('Content-Type', 'text/html; charset=utf-8');\n        return res.send(HTML_CONTENT);\n    }\n\n    // ---------------------------------------------------------------\n    // 1b. JavaScript\u914d\u4fe1\u3010\u524a\u9664\u7981\u6b62\u3011\n    // \u2192 \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3067\u4f7f\u3046JavaScript\uff08front.html\u304b\u3089\u8aad\u307f\u8fbc\u307e\u308c\u308b\uff09\n    // ---------------------------------------------------------------\n    if (reqPath === '/script.js' &amp;&amp; req.method === 'GET') {\n        res.set('Content-Type', 'application/javascript; charset=utf-8');\n        return res.send(SCRIPT_CONTENT);\n    }\n\n    // ---------------------------------------------------------------\n    // 2. \u30a2\u30af\u30bb\u30b9\u6a29\u9650\u30c1\u30a7\u30c3\u30af\u3010\u524a\u9664\u7981\u6b62\u3011\n    // \u2192 \u30ed\u30b0\u30a4\u30f3\u5f8c\u3001\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u304c\u30a2\u30d7\u30ea\u3092\u4f7f\u3048\u308b\u304b\u78ba\u8a8d\n    // \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u304b\u3089: fetch('/api/check-access', { method: 'POST', headers: {...} })\n    // ---------------------------------------------------------------\n    if (reqPath === '/api/check-access' &amp;&amp; req.method === 'POST') {\n        try {\n            const authHeader = req.headers.authorization;\n            if (!authHeader?.startsWith('Bearer ')) {\n                return res.status(401).json({ allowed: false, error: '\u8a8d\u8a3c\u30c8\u30fc\u30af\u30f3\u304c\u3042\u308a\u307e\u305b\u3093' });\n            }\n            const email = getEmailFromToken(authHeader.split('Bearer ')[1]);\n            if (!email) {\n                return res.status(401).json({ allowed: false, error: '\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u53d6\u5f97\u5931\u6557' });\n            }\n            const allowed = isEmailAllowed(email);\n            console.log(`\u30a2\u30af\u30bb\u30b9: ${email} \u2192 ${allowed ? '\u8a31\u53ef' : '\u62d2\u5426'}`);\n            return res.json({ allowed });\n        } catch (e) {\n            return res.status(500).json({ allowed: false, error: '\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f' });\n        }\n    }\n\n    // ---------------------------------------------------------------\n    // 3. \u2605\u2605\u2605 \u30c1\u30e3\u30c3\u30c8API\uff08\u3053\u3053\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\uff09\u2605\u2605\u2605\n    // \u2192 \u30e1\u30a4\u30f3\u306e\u6a5f\u80fd\u3002AI\u3068\u30c1\u30e3\u30c3\u30c8\u3059\u308b\n    // \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u304b\u3089: fetch('/api/chat', { method: 'POST', body: JSON.stringify({ message }) })\n    // ---------------------------------------------------------------\n    if (reqPath === '/api/chat' &amp;&amp; req.method === 'POST') {\n        try {\n            // --- \u8a8d\u8a3c\u30c1\u30a7\u30c3\u30af\u3010\u524a\u9664\u7981\u6b62\u3011---\n            const authHeader = req.headers.authorization;\n            if (!authHeader?.startsWith('Bearer ')) {\n                return res.status(401).json({ error: '\u30ed\u30b0\u30a4\u30f3\u304c\u5fc5\u8981\u3067\u3059' });\n            }\n            const email = getEmailFromToken(authHeader.split('Bearer ')[1]);\n            if (!isEmailAllowed(email)) {\n                return res.status(403).json({ error: '\u6a29\u9650\u304c\u3042\u308a\u307e\u305b\u3093' });\n            }\n\n            // --- \u5165\u529b\u30c1\u30a7\u30c3\u30af\u3010\u524a\u9664\u7981\u6b62\u3011---\n            const { message } = req.body;\n            if (!message || typeof message !== 'string') {\n                return res.status(400).json({ error: '\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044' });\n            }\n            if (message.length &gt; 10000) {\n                return res.status(400).json({ error: '\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9577\u3059\u304e\u307e\u3059' });\n            }\n\n            // --- AI\u547c\u3073\u51fa\u3057\u3010\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u53ef\u80fd\u3011---\n            const openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });\n            const completion = await openai.chat.completions.create({\n                model: 'gpt-3.5-turbo',  // \u2190 gpt-4 \u306b\u5909\u66f4\u53ef\u80fd\n                messages: [{ role: 'user', content: message }],\n                max_tokens: 1000,        // \u2190 \u56de\u7b54\u306e\u9577\u3055\n                temperature: 0.7         // \u2190 0=\u56fa\u5b9a\u7684\u30011=\u5275\u9020\u7684\n            });\n\n            return res.json({ response: completion.choices[0].message.content });\n\n        } catch (e) {\n            console.error('\u30c1\u30e3\u30c3\u30c8\u30a8\u30e9\u30fc:', e.message);\n            return res.status(500).json({ error: 'AI\u306e\u51e6\u7406\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f' });\n        }\n    }\n\n    // ---------------------------------------------------------------\n    // 4. \u3010\u65b0\u3057\u3044API\u3092\u8ffd\u52a0\u3059\u308b\u5834\u6240\u3011\n    // \u2192 \u6a5f\u80fd\u3092\u8ffd\u52a0\u3057\u305f\u3044\u5834\u5408\u306f\u3053\u3053\u306b\u66f8\u304f\n    //\n    // \u4f8b: \u30c1\u30e3\u30c3\u30c8\u5c65\u6b74\u3092\u53d6\u5f97\u3059\u308bAPI\n    // if (reqPath === '/api/history' &amp;&amp; req.method === 'GET') {\n    //     // \u8a8d\u8a3c\u30c1\u30a7\u30c3\u30af\uff08\u4e0a\u306e\u30c1\u30e3\u30c3\u30c8API\u304b\u3089\u30b3\u30d4\u30fc\uff09\n    //     // \u5c65\u6b74\u3092\u53d6\u5f97\u3057\u3066\u8fd4\u3059\u51e6\u7406\n    //     return res.json({ history: [...] });\n    // }\n    // ---------------------------------------------------------------\n\n    // ---------------------------------------------------------------\n    // 5. \u30d8\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u3010\u524a\u9664\u7981\u6b62\u3011\n    // \u2192 \u30b5\u30fc\u30d0\u30fc\u304c\u52d5\u3044\u3066\u3044\u308b\u304b\u78ba\u8a8d\u7528\uff08\u904b\u7528\u76e3\u8996\u7528\u3001\u30e6\u30fc\u30b6\u30fc\u306f\u4f7f\u308f\u306a\u3044\uff09\n    // ---------------------------------------------------------------\n    if (reqPath === '/api/health' &amp;&amp; req.method === 'GET') {\n        return res.json({ status: 'ok', timestamp: new Date().toISOString() });\n    }\n\n    // ---------------------------------------------------------------\n    // 6. 404\u30a8\u30e9\u30fc\u3010\u524a\u9664\u7981\u6b62\u3011\n    // \u2192 \u4e0a\u306e\u3069\u308c\u306b\u3082\u8a72\u5f53\u3057\u306a\u3044URL\u306b\u30a2\u30af\u30bb\u30b9\u3055\u308c\u305f\u5834\u5408\n    // ---------------------------------------------------------------\n    return res.status(404).json({ error: '\u30da\u30fc\u30b8\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093' });\n});\n</code></pre>"},{"location":"code/nodejs/front/","title":"front.html","text":"<p>\u753b\u9762\u306e\u30c7\u30b6\u30a4\u30f3\uff08HTML/CSS\uff09</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"ja\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;title&gt;AI \u30c1\u30e3\u30c3\u30c8&lt;/title&gt;\n    &lt;!-- Firebase SDK\u3010\u524a\u9664\u7981\u6b62\u3011 --&gt;\n    &lt;script src=\"https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js\"&gt;&lt;/script&gt;\n    &lt;style&gt;\n        /* \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n           CSS\u3010\u524a\u9664\u7981\u6b62\u3011\u30c7\u30b6\u30a4\u30f3\u3092\u5909\u3048\u305f\u3044\u5834\u5408\u306f\u3053\u3053\u3092\u7de8\u96c6\n           \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 */\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            background: #f5f5f5;\n            min-height: 100vh;\n            display: flex;\n            flex-direction: column;\n        }\n        header {\n            background: #1a73e8;\n            color: white;\n            padding: 16px;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        main {\n            flex: 1;\n            max-width: 800px;\n            margin: 0 auto;\n            padding: 20px;\n            width: 100%;\n        }\n        .chat-container {\n            background: white;\n            border-radius: 8px;\n            padding: 20px;\n            min-height: 400px;\n            max-height: 60vh;\n            overflow-y: auto;\n            margin-bottom: 20px;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n        }\n        .message {\n            margin-bottom: 16px;\n            padding: 12px 16px;\n            border-radius: 8px;\n            max-width: 80%;\n        }\n        .user { background: #e3f2fd; margin-left: auto; text-align: right; }\n        .assistant { background: #f5f5f5; margin-right: auto; }\n        .error { background: #ffebee; color: #c62828; }\n        .input-area { display: flex; gap: 10px; }\n        #message-input {\n            flex: 1;\n            padding: 12px 16px;\n            border: 1px solid #ddd;\n            border-radius: 24px;\n            font-size: 16px;\n            outline: none;\n        }\n        #message-input:focus { border-color: #1a73e8; }\n        .btn {\n            padding: 12px 24px;\n            background: #1a73e8;\n            color: white;\n            border: none;\n            border-radius: 24px;\n            font-size: 16px;\n            cursor: pointer;\n        }\n        .btn:hover { background: #1557b0; }\n        .btn:disabled { background: #ccc; cursor: not-allowed; }\n        .btn-outline { background: transparent; border: 1px solid white; padding: 8px 16px; }\n        .loading {\n            display: inline-block;\n            width: 20px;\n            height: 20px;\n            border: 2px solid #f3f3f3;\n            border-top: 2px solid #1a73e8;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n        }\n        @keyframes spin { to { transform: rotate(360deg); } }\n        .center-screen {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            min-height: 60vh;\n            text-align: center;\n        }\n        .user-info { display: flex; align-items: center; gap: 12px; }\n        .user-info img { width: 32px; height: 32px; border-radius: 50%; }\n        .hidden { display: none !important; }\n        .google-btn {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            padding: 12px 24px;\n            background: white;\n            border: 1px solid #ddd;\n            border-radius: 4px;\n            font-size: 16px;\n            cursor: pointer;\n        }\n        .google-btn:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.15); }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;!-- \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n         HTML\u69cb\u9020\u3010\u524a\u9664\u7981\u6b62\u3011\u753b\u9762\u3092\u8ffd\u52a0\u3057\u305f\u3044\u5834\u5408\u306f&lt;main&gt;\u5185\u306b\u65b0\u3057\u3044div\u3092\u8ffd\u52a0\n         \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 --&gt;\n    &lt;header&gt;\n        &lt;h1&gt;AI \u30c1\u30e3\u30c3\u30c8&lt;/h1&gt;\n        &lt;div id=\"user-info\" class=\"user-info hidden\"&gt;\n            &lt;img id=\"user-photo\" src=\"\" alt=\"\"&gt;\n            &lt;span id=\"user-name\"&gt;&lt;/span&gt;\n            &lt;button class=\"btn btn-outline\" onclick=\"logout()\"&gt;\u30ed\u30b0\u30a2\u30a6\u30c8&lt;/button&gt;\n        &lt;/div&gt;\n    &lt;/header&gt;\n\n    &lt;main&gt;\n        &lt;!-- \u30ed\u30b0\u30a4\u30f3\u753b\u9762 --&gt;\n        &lt;div id=\"login-screen\" class=\"center-screen\"&gt;\n            &lt;h2&gt;\u3088\u3046\u3053\u305d&lt;/h2&gt;\n            &lt;p style=\"margin: 20px 0; color: #666;\"&gt;Google\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044&lt;/p&gt;\n            &lt;button class=\"google-btn\" onclick=\"login()\"&gt;\n                &lt;svg width=\"18\" height=\"18\" viewBox=\"0 0 18 18\"&gt;\n                    &lt;path fill=\"#4285F4\" d=\"M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z\"/&gt;\n                    &lt;path fill=\"#34A853\" d=\"M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 0 0 9 18z\"/&gt;\n                    &lt;path fill=\"#FBBC05\" d=\"M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z\"/&gt;\n                    &lt;path fill=\"#EA4335\" d=\"M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z\"/&gt;\n                &lt;/svg&gt;\n                Google\u3067\u30ed\u30b0\u30a4\u30f3\n            &lt;/button&gt;\n        &lt;/div&gt;\n\n        &lt;!-- \u30a2\u30af\u30bb\u30b9\u62d2\u5426\u753b\u9762 --&gt;\n        &lt;div id=\"access-denied\" class=\"center-screen hidden\"&gt;\n            &lt;h2 style=\"color: #c62828;\"&gt;\u30a2\u30af\u30bb\u30b9\u304c\u8a31\u53ef\u3055\u308c\u3066\u3044\u307e\u305b\u3093&lt;/h2&gt;\n            &lt;p style=\"margin: 20px 0; color: #666;\"&gt;\u7ba1\u7406\u8005\u306b\u304a\u554f\u3044\u5408\u308f\u305b\u304f\u3060\u3055\u3044\u3002&lt;/p&gt;\n            &lt;p style=\"color: #999; font-size: 14px;\"&gt;\u30ed\u30b0\u30a4\u30f3\u4e2d: &lt;span id=\"denied-email\"&gt;&lt;/span&gt;&lt;/p&gt;\n            &lt;button class=\"btn\" style=\"margin-top: 20px;\" onclick=\"logout()\"&gt;\u5225\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ed\u30b0\u30a4\u30f3&lt;/button&gt;\n        &lt;/div&gt;\n\n        &lt;!-- \u30c1\u30e3\u30c3\u30c8\u753b\u9762 --&gt;\n        &lt;div id=\"chat-screen\" class=\"hidden\"&gt;\n            &lt;div id=\"chat-container\" class=\"chat-container\"&gt;\n                &lt;div class=\"message assistant\"&gt;\u3053\u3093\u306b\u3061\u306f\uff01\u4f55\u3067\u3082\u805e\u3044\u3066\u304f\u3060\u3055\u3044\u3002&lt;/div&gt;\n            &lt;/div&gt;\n            &lt;div class=\"input-area\"&gt;\n                &lt;input type=\"text\" id=\"message-input\" placeholder=\"\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5165\u529b...\" autocomplete=\"off\"&gt;\n                &lt;button id=\"send-btn\" class=\"btn\" onclick=\"sendMessage()\"&gt;\u9001\u4fe1&lt;/button&gt;\n            &lt;/div&gt;\n        &lt;/div&gt;\n    &lt;/main&gt;\n\n    &lt;!-- \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n         JavaScript\u3010\u524a\u9664\u7981\u6b62\u3011\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3068\u306e\u901a\u4fe1\u51e6\u7406\n         \u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u5834\u5408\u306f script.js \u3092\u7de8\u96c6\n         \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 --&gt;\n    &lt;script src=\"script.js\"&gt;&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"code/nodejs/package/","title":"package.json","text":"<p>\u4f7f\u7528\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u4e00\u89a7</p> <pre><code>{\n  \"name\": \"ai-chat-app\",\n  \"version\": \"1.0.0\",\n  \"description\": \"AI \u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\uff08Firebase Auth\u8a8d\u8a3c + \u30e1\u30fc\u30eb\u5236\u9650\u6a5f\u80fd\u4ed8\u304d\uff09\",\n  \"main\": \"index.js\",\n  \"dependencies\": {\n    \"@google-cloud/functions-framework\": \"^3.0.0\",\n    \"openai\": \"^4.0.0\"\n  },\n  \"comment\": [\n    \"\u3010\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u3064\u3044\u3066\u3011\",\n    \"Node.js \u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002\",\n    \"\u4f7f\u7528\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u305d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002\",\n    \"\",\n    \"\u3010GCP\u3067\u306e\u4f7f\u3044\u65b9\u3011\",\n    \"1. Cloud Run functions \u306e\u4f5c\u6210\u753b\u9762\u3092\u958b\u304f\",\n    \"2. \u300c\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u300d\u2192\u300c\u30a4\u30f3\u30e9\u30a4\u30f3\u30a8\u30c7\u30a3\u30bf\u300d\u3092\u9078\u629e\",\n    \"3. index.js \u306b backend.js \u306e\u5185\u5bb9\u3092\u8cbc\u308a\u4ed8\u3051\",\n    \"4. package.json \u306b\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u5bb9\u3092\u8cbc\u308a\u4ed8\u3051\",\n    \"5. front.html \u3068 script.js \u3092\u65b0\u898f\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u8ffd\u52a0\",\n    \"6. \u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3068\u3001GCP\u304c\u81ea\u52d5\u7684\u306b\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u308c\u307e\u3059\"\n  ]\n}\n</code></pre>"},{"location":"code/nodejs/script/","title":"script.js","text":"<p>\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u306e\u51e6\u7406\uff08JavaScript\uff09</p> <pre><code>/**\n * AI \u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea - \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\uff08\u30d6\u30e9\u30a6\u30b6\u5074\u51e6\u7406\uff09\n *\n * \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n * \u2551 \u3010\u51e6\u7406\u306e\u6d41\u308c\u3011                                               \u2551\n * \u2551  1. Firebase\u8a2d\u5b9a     \u2192 \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3054\u3068\u306b\u66f8\u304d\u63db\u3048           \u2551\n * \u2551  2. \u8a8d\u8a3c\u72b6\u614b\u76e3\u8996     \u2192 \u30ed\u30b0\u30a4\u30f3/\u30ed\u30b0\u30a2\u30a6\u30c8\u3092\u691c\u77e5            \u2551\n * \u2551  3. \u753b\u9762\u5207\u308a\u66ff\u3048     \u2192 \u30ed\u30b0\u30a4\u30f3/\u62d2\u5426/\u30c1\u30e3\u30c3\u30c8\u753b\u9762\u3092\u5207\u66ff     \u2551\n * \u2551  4. \u8a8d\u8a3c\u95a2\u6570         \u2192 \u30ed\u30b0\u30a4\u30f3/\u30ed\u30b0\u30a2\u30a6\u30c8\u51e6\u7406              \u2551\n * \u2551  5. \u30a2\u30af\u30bb\u30b9\u6a29\u9650\u78ba\u8a8d \u2192 \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306b\u554f\u3044\u5408\u308f\u305b             \u2551\n * \u2551  6. \u30c1\u30e3\u30c3\u30c8\u6a5f\u80fd     \u2192 AI\u3068\u306e\u4f1a\u8a71\u51e6\u7406                       \u2551\n * \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n */\n\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// 1. \u2605\u2605\u2605 Firebase\u8a2d\u5b9a\uff08\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3054\u3068\u306b\u5909\u66f4\u304c\u5fc5\u8981\uff09\u2605\u2605\u2605\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// Firebase\u30b3\u30f3\u30bd\u30fc\u30eb \u2192 \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u8a2d\u5b9a \u2192 \u300c\u69cb\u6210\u300d\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\nconst firebaseConfig = {\n    apiKey: \"YOUR_API_KEY\",                     // \u2190 \u66f8\u304d\u63db\u3048\u5fc5\u9808\n    authDomain: \"YOUR_PROJECT.firebaseapp.com\", // \u2190 \u66f8\u304d\u63db\u3048\u5fc5\u9808\n    projectId: \"YOUR_PROJECT_ID\",               // \u2190 \u66f8\u304d\u63db\u3048\u5fc5\u9808\n    storageBucket: \"YOUR_PROJECT.appspot.com\",\n    messagingSenderId: \"000000000000\",\n    appId: \"YOUR_APP_ID\"\n};\n\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// 2. \u521d\u671f\u5316\u3010\u524a\u9664\u7981\u6b62\u3011\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\nfirebase.initializeApp(firebaseConfig);\nconst auth = firebase.auth();\nlet currentUser = null;\n\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// 3. \u8a8d\u8a3c\u72b6\u614b\u76e3\u8996\u3010\u524a\u9664\u7981\u6b62\u3011\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// \u30ed\u30b0\u30a4\u30f3/\u30ed\u30b0\u30a2\u30a6\u30c8\u3059\u308b\u3068\u81ea\u52d5\u3067\u3053\u306e\u95a2\u6570\u304c\u547c\u3070\u308c\u308b\nauth.onAuthStateChanged(async (user) =&gt; {\n    if (user) {\n        // \u30ed\u30b0\u30a4\u30f3\u6e08\u307f \u2192 \u30a2\u30af\u30bb\u30b9\u6a29\u9650\u3092\u78ba\u8a8d\n        currentUser = user;\n        const isAllowed = await checkAccess(user);\n        isAllowed ? showChat(user) : showDenied(user);\n    } else {\n        // \u672a\u30ed\u30b0\u30a4\u30f3 \u2192 \u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3092\u8868\u793a\n        currentUser = null;\n        showLogin();\n    }\n});\n\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// 4. \u753b\u9762\u5207\u308a\u66ff\u3048\u3010\u524a\u9664\u7981\u6b62\u3011\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// $('id\u540d') \u3067\u8981\u7d20\u3092\u53d6\u5f97\u3059\u308b\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\nconst $ = id =&gt; document.getElementById(id);\n\n// \u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3092\u8868\u793a\nfunction showLogin() {\n    $('login-screen').classList.remove('hidden');\n    $('chat-screen').classList.add('hidden');\n    $('access-denied').classList.add('hidden');\n    $('user-info').classList.add('hidden');\n}\n\n// \u30a2\u30af\u30bb\u30b9\u62d2\u5426\u753b\u9762\u3092\u8868\u793a\nfunction showDenied(user) {\n    $('login-screen').classList.add('hidden');\n    $('chat-screen').classList.add('hidden');\n    $('access-denied').classList.remove('hidden');\n    $('user-info').classList.add('hidden');\n    $('denied-email').textContent = user.email;\n}\n\n// \u30c1\u30e3\u30c3\u30c8\u753b\u9762\u3092\u8868\u793a\nfunction showChat(user) {\n    $('login-screen').classList.add('hidden');\n    $('chat-screen').classList.remove('hidden');\n    $('access-denied').classList.add('hidden');\n    $('user-info').classList.remove('hidden');\n    $('user-name').textContent = user.displayName;\n    $('user-photo').src = user.photoURL || '';\n}\n\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// 5. \u8a8d\u8a3c\u95a2\u6570\u3010\u524a\u9664\u7981\u6b62\u3011\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n\n// Google\u3067\u30ed\u30b0\u30a4\u30f3\nasync function login() {\n    try {\n        await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());\n    } catch (e) {\n        alert('\u30ed\u30b0\u30a4\u30f3\u306b\u5931\u6557\u3057\u307e\u3057\u305f');\n    }\n}\n\n// \u30ed\u30b0\u30a2\u30a6\u30c8\nasync function logout() {\n    await auth.signOut();\n}\n\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// 6. \u30a2\u30af\u30bb\u30b9\u6a29\u9650\u30c1\u30a7\u30c3\u30af\u3010\u524a\u9664\u7981\u6b62\u3011\n// \u2192 \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306e /api/check-access \u3092\u547c\u3073\u51fa\u3057\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\nasync function checkAccess(user) {\n    try {\n        // JWT\u30c8\u30fc\u30af\u30f3\uff08\u30c7\u30b8\u30bf\u30eb\u4f1a\u54e1\u8a3c\uff09\u3092\u53d6\u5f97\n        const token = await user.getIdToken();\n\n        // \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306b\u78ba\u8a8d\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u4fe1\n        const res = await fetch('/api/check-access', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${token}`  // \u4f1a\u54e1\u8a3c\u3092\u63d0\u793a\n            }\n        });\n        const data = await res.json();\n        return data.allowed === true;\n    } catch (e) {\n        return false;\n    }\n}\n\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// 7. \u2605\u2605\u2605 \u30c1\u30e3\u30c3\u30c8\u6a5f\u80fd\uff08\u3053\u3053\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\uff09\u2605\u2605\u2605\n// \u2192 \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306e /api/chat \u3092\u547c\u3073\u51fa\u3057\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\nconst chatContainer = $('chat-container');\nconst messageInput = $('message-input');\nconst sendBtn = $('send-btn');\n\n// \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u753b\u9762\u306b\u8ffd\u52a0\nfunction addMessage(text, type) {\n    const div = document.createElement('div');\n    div.className = `message ${type}`;\n    div.textContent = text;\n    chatContainer.appendChild(div);\n    chatContainer.scrollTop = chatContainer.scrollHeight;\n}\n\n// \u300c\u8003\u3048\u4e2d...\u300d\u306e\u30ed\u30fc\u30c7\u30a3\u30f3\u30b0\u8868\u793a\u3092\u8ffd\u52a0\nfunction addLoading() {\n    const div = document.createElement('div');\n    div.className = 'message assistant';\n    div.innerHTML = '&lt;span class=\"loading\"&gt;&lt;/span&gt; \u8003\u3048\u4e2d...';\n    chatContainer.appendChild(div);\n    chatContainer.scrollTop = chatContainer.scrollHeight;\n    return div;\n}\n\n// \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u51e6\u7406\nasync function sendMessage() {\n    if (!currentUser) return alert('\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044');\n    const message = messageInput.value.trim();\n    if (!message) return;\n\n    // \u9001\u4fe1\u30dc\u30bf\u30f3\u3092\u7121\u52b9\u5316\uff08\u9023\u6253\u9632\u6b62\uff09\n    sendBtn.disabled = true;\n\n    // \u30e6\u30fc\u30b6\u30fc\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8868\u793a\n    addMessage(message, 'user');\n    messageInput.value = '';\n    const loading = addLoading();\n\n    try {\n        // JWT\u30c8\u30fc\u30af\u30f3\uff08\u30c7\u30b8\u30bf\u30eb\u4f1a\u54e1\u8a3c\uff09\u3092\u53d6\u5f97\n        const token = await currentUser.getIdToken();\n\n        // \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\n        const res = await fetch('/api/chat', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${token}`\n            },\n            body: JSON.stringify({ message })\n        });\n        const data = await res.json();\n        loading.remove();\n\n        // \u7d50\u679c\u3092\u8868\u793a\n        addMessage(res.ok ? data.response : `\u30a8\u30e9\u30fc: ${data.error}`, res.ok ? 'assistant' : 'error');\n    } catch (e) {\n        loading.remove();\n        addMessage('\u30a8\u30e9\u30fc: \u901a\u4fe1\u306b\u5931\u6557\u3057\u307e\u3057\u305f', 'error');\n    }\n\n    sendBtn.disabled = false;\n    messageInput.focus();\n}\n\n// Enter\u30ad\u30fc\u3067\u9001\u4fe1\nmessageInput.addEventListener('keypress', e =&gt; {\n    if (e.key === 'Enter') sendMessage();\n});\n\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// \u3010\u65b0\u3057\u3044\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\u5834\u6240\u3011\n// \u4f8b: \u30c1\u30e3\u30c3\u30c8\u5c65\u6b74\u4fdd\u5b58\u3001\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u7b49\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n</code></pre>"},{"location":"code/python/","title":"Python\u7248 \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9","text":"<p>GCP Cloud Run functions \u3067\u52d5\u4f5c\u3059\u308bAI\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\u306ePython\u7248\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3067\u3059\u3002</p>"},{"location":"code/python/#_1","title":"\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7","text":"\u30d5\u30a1\u30a4\u30eb \u5f79\u5272 GCP\u3067\u306e\u64cd\u4f5c backend.py \u30b5\u30fc\u30d0\u30fc\u5074\u306e\u51e6\u7406\uff08\u30e1\u30a4\u30f3\uff09 main.py \u306b\u8cbc\u308a\u4ed8\u3051 front.html \u753b\u9762\u306e\u30c7\u30b6\u30a4\u30f3\uff08HTML/CSS\uff09 \u65b0\u898f\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u8ffd\u52a0 script.js \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u306e\u51e6\u7406\uff08JavaScript\uff09 \u65b0\u898f\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u8ffd\u52a0 requirements.txt \u4f7f\u7528\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u4e00\u89a7 requirements.txt \u306b\u8cbc\u308a\u4ed8\u3051"},{"location":"code/python/#_2","title":"\u4f7f\u3044\u65b9","text":"<ol> <li>\u5404\u30d5\u30a1\u30a4\u30eb\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u30b3\u30fc\u30c9\u3092\u8868\u793a</li> <li>\u30b3\u30fc\u30c9\u30d6\u30ed\u30c3\u30af\u53f3\u4e0a\u306e\u30b3\u30d4\u30fc\u30dc\u30bf\u30f3\u3067\u30b3\u30d4\u30fc</li> <li>GCP\u306eCloud Run functions\u306b\u8cbc\u308a\u4ed8\u3051</li> </ol> <p>\u8a73\u3057\u3044\u624b\u9806\u306f \u69cb\u7bc9\u624b\u9806\u66f8 \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"code/python/backend/","title":"backend.py","text":"<p>\u30b5\u30fc\u30d0\u30fc\u5074\u306e\u51e6\u7406\uff08\u30e1\u30a4\u30f3\uff09</p> <pre><code>\"\"\"\nAI \u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea - \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\uff08\u30b5\u30fc\u30d0\u30fc\u5074\u51e6\u7406\uff09Python\u7248\n\n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n\u3010HTTP\u901a\u4fe1\u3068\u306f\uff1f - \u624b\u7d19\u306e\u3084\u308a\u53d6\u308a\u306b\u4f8b\u3048\u308b\u3068\u3011\n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n\n\u30d6\u30e9\u30a6\u30b6\uff08\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\uff09\u3068\u30b5\u30fc\u30d0\u30fc\uff08\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\uff09\u306f\u300c\u624b\u7d19\u300d\u3067\u3084\u308a\u53d6\u308a\u3057\u307e\u3059\u3002\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  fetch('/api/chat', {                                       \u2502\n\u2502      method: 'POST',                    \u2190 \u624b\u7d19\u306e\u7a2e\u985e        \u2502\n\u2502      headers: { Authorization: '...' }, \u2190 \u5c01\u7b52\u306e\u60c5\u5831        \u2502\n\u2502      body: JSON.stringify({ message })  \u2190 \u624b\u7d19\u306e\u4e2d\u8eab        \u2502\n\u2502  })                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u25a0 method = \u624b\u7d19\u306e\u7a2e\u985e\uff08GET=\u60c5\u5831\u304f\u3060\u3055\u3044 / POST=\u3053\u308c\u51e6\u7406\u3057\u3066\uff09\n\u25a0 headers = \u5c01\u7b52\u306e\u60c5\u5831\uff08\u8a8d\u8a3c\u30c8\u30fc\u30af\u30f3\u7b49\uff09\n\u25a0 body = \u624b\u7d19\u306e\u4e2d\u8eab\uff08\u9001\u308a\u305f\u3044\u30c7\u30fc\u30bf\uff09\n\n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n\u3010JWT\u30c8\u30fc\u30af\u30f3\u3068\u306f\uff1f - \u4f1a\u54e1\u8a3c\u306b\u4f8b\u3048\u308b\u3068\u3011\n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n\nJWT\u30c8\u30fc\u30af\u30f3 = \u300c\u30c7\u30b8\u30bf\u30eb\u4f1a\u54e1\u8a3c\u300d\u306e\u3088\u3046\u306a\u3082\u306e\u3002\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Google\u3067\u30ed\u30b0\u30a4\u30f3                                            \u2502\n\u2502       \u2193                                                     \u2502\n\u2502  Firebase\u304c\u300c\u3053\u306e\u4eba\u306f\u25cb\u25cb\u3055\u3093\u3067\u3059\u300d\u3068\u3044\u3046\u4f1a\u54e1\u8a3c\u3092\u767a\u884c             \u2502\n\u2502       \u2193                                                     \u2502\n\u2502  \u305d\u306e\u4f1a\u54e1\u8a3c\uff08JWT\u30c8\u30fc\u30af\u30f3\uff09\u3092\u30b5\u30fc\u30d0\u30fc\u306b\u898b\u305b\u3066\u30a2\u30af\u30bb\u30b9            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u25a0 \u306a\u305c\u5fc5\u8981\uff1f\n  \u2192 \u30b5\u30fc\u30d0\u30fc\u306f\u300c\u8ab0\u304b\u3089\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u304b\u300d\u3092\u78ba\u8a8d\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\n  \u2192 JWT\u30c8\u30fc\u30af\u30f3\u306e\u4e2d\u306b\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u7b49\u306e\u60c5\u5831\u304c\u5165\u3063\u3066\u3044\u308b\n\n\u25a0 \u3053\u306e\u30b3\u30fc\u30c9\u3067\u306e\u4f7f\u308f\u308c\u65b9\n  1. \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9: \u30ed\u30b0\u30a4\u30f3\u5f8c\u3001\u30c8\u30fc\u30af\u30f3\u3092headers\u306b\u5165\u308c\u3066\u9001\u4fe1\n  2. \u30d0\u30c3\u30af\u30a8\u30f3\u30c9: \u30c8\u30fc\u30af\u30f3\u304b\u3089\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u53d6\u308a\u51fa\u3057\u3066\u8a8d\u8a3c\n\"\"\"\n\n# \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n# \u30e9\u30a4\u30d6\u30e9\u30ea\u8aad\u307f\u8fbc\u307f\u3010\u524a\u9664\u7981\u6b62\u3011\n# \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n\nimport os\nimport json\nimport base64\nfrom datetime import datetime\n\n# Cloud Run functions \u3067HTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u53d6\u308b\u305f\u3081\u306b\u5fc5\u8981\uff08Google\u63d0\u4f9b\uff09\nimport functions_framework\n\n# ChatGPT API\u3092\u547c\u3073\u51fa\u3059\u305f\u3081\u306b\u5fc5\u8981\uff08OpenAI\u63d0\u4f9b\uff09\nfrom openai import OpenAI\n\n# \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n# \u2605\u2605\u2605 \u8a2d\u5b9a\uff08\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3054\u3068\u306b\u5909\u66f4\u304c\u5fc5\u8981\uff09\u2605\u2605\u2605\n# \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n\n# \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n# \u3010CORS\u8a2d\u5b9a - \u672c\u756a\u74b0\u5883\u3067\u306f\u5909\u66f4\u63a8\u5968\u3011\n# \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n#\n# \u25a0 \u3053\u308c\u306f\u4f55\uff1f\n#   \u300c\u3069\u306eWeb\u30b5\u30a4\u30c8\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3059\u308b\u304b\u300d\u306e\u8a2d\u5b9a\u3067\u3059\u3002\n#   '*' \u306f\u300c\u3069\u3053\u304b\u3089\u3067\u3082OK\u300d\u3068\u3044\u3046\u610f\u5473\uff08\u958b\u767a\u7528\uff09\u3002\n#\n# \u25a0 \u672c\u756a\u3067\u306f\u3069\u3046\u3059\u308b\uff1f\n#   Cloud Run\u306e\u95a2\u6570URL\uff08\u30c7\u30d7\u30ed\u30a4\u5f8c\u306b\u8868\u793a\u3055\u308c\u308b\uff09\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n#\n#   \u3010\u78ba\u8a8d\u65b9\u6cd5\u3011\n#   GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u2192 Cloud Run \u2192 \u95a2\u6570\u3092\u30af\u30ea\u30c3\u30af \u2192 \u4e0a\u90e8\u306b\u8868\u793a\u3055\u308c\u308bURL\n#   \u4f8b: https://ai-chat-app-xxxxx-an.a.run.app\n#\n#   \u3010\u8a2d\u5b9a\u4f8b\u3011\n#   ALLOWED_ORIGINS = [\n#       'https://ai-chat-app-xxxxx-an.a.run.app'\n#   ]\n#\n# \u25a0 \u4eca\u306f\u5909\u66f4\u3057\u306a\u304f\u3066OK\n#   \u3053\u306e\u30a2\u30d7\u30ea\u306f\u30d5\u30ed\u30f3\u30c8\u3068\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u304c\u540c\u3058URL\u306a\u306e\u3067\u3001\n#   '*' \u306e\u307e\u307e\u3067\u3082\u52d5\u4f5c\u3057\u307e\u3059\u3002\n#\nALLOWED_ORIGINS = ['*']\n\n# HTML\u30d5\u30a1\u30a4\u30eb\u8aad\u307f\u8fbc\u307f\u3010\u524a\u9664\u7981\u6b62\u3011\nwith open('front.html', 'r', encoding='utf-8') as f:\n    HTML_CONTENT = f.read()\n\n# JavaScript\u30d5\u30a1\u30a4\u30eb\u8aad\u307f\u8fbc\u307f\u3010\u524a\u9664\u7981\u6b62\u3011\nwith open('script.js', 'r', encoding='utf-8') as f:\n    SCRIPT_CONTENT = f.read()\n\n# \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n# \u30d8\u30eb\u30d1\u30fc\u95a2\u6570\u3010\u524a\u9664\u7981\u6b62\u3011\n# \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n\ndef set_cors_headers(headers, origin):\n    \"\"\"CORS\u30d8\u30c3\u30c0\u30fc\u8a2d\u5b9a\"\"\"\n    if '*' in ALLOWED_ORIGINS or origin in ALLOWED_ORIGINS:\n        headers['Access-Control-Allow-Origin'] = origin or '*'\n    headers['Access-Control-Allow-Methods'] = 'GET, POST, OPTIONS'\n    headers['Access-Control-Allow-Headers'] = 'Content-Type, Authorization'\n    headers['Access-Control-Max-Age'] = '3600'\n\ndef set_security_headers(headers):\n    \"\"\"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30d8\u30c3\u30c0\u30fc\u8a2d\u5b9a\"\"\"\n    headers['X-Content-Type-Options'] = 'nosniff'\n    headers['X-Frame-Options'] = 'DENY'\n    headers['X-XSS-Protection'] = '1; mode=block'\n    headers['Referrer-Policy'] = 'strict-origin-when-cross-origin'\n\n# \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n# \u2605\u2605\u2605 \u30a2\u30af\u30bb\u30b9\u5236\u5fa1\uff08\u91cd\u8981\uff01\u524a\u9664\u7981\u6b62\uff09\u2605\u2605\u2605\n# \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n#\n# \u3053\u306e\u95a2\u6570\u304c\u306a\u3044\u3068\u3001\u8ab0\u3067\u3082\u30a2\u30d7\u30ea\u3092\u4f7f\u3048\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n#\n# \u3010\u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\u65b9\u6cd5\u3011GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u2192 Cloud Run \u2192 \u74b0\u5883\u5909\u6570\n#   ALLOWED_EMAILS: \"admin@example.com,user1@example.com\"\n#   ALLOWED_DOMAINS: \"@yourcompany.co.jp\"\n#\n# \u3010\u6ce8\u610f\u3011\u4e21\u65b9\u672a\u8a2d\u5b9a\u3060\u3068\u5168\u54e1\u8a31\u53ef\u306b\u306a\u308a\u307e\u3059\uff08\u958b\u767a\u7528\uff09\n\ndef is_email_allowed(email):\n    if not email:\n        return False\n    lower_email = email.lower()\n\n    allowed_emails_str = os.environ.get('ALLOWED_EMAILS', '')\n    allowed_emails = [e.strip().lower() for e in allowed_emails_str.split(',') if e.strip()]\n\n    allowed_domains_str = os.environ.get('ALLOWED_DOMAINS', '')\n    allowed_domains = [d.strip().lower() for d in allowed_domains_str.split(',') if d.strip()]\n\n    if lower_email in allowed_emails:\n        return True\n    for domain in allowed_domains:\n        if lower_email.endswith(domain):\n            return True\n\n    # \u8a2d\u5b9a\u306a\u3057 = \u5168\u54e1\u8a31\u53ef\uff08\u958b\u767a\u7528\uff09\n    if not allowed_emails and not allowed_domains:\n        print('\u26a0\ufe0f ALLOWED_EMAILS/ALLOWED_DOMAINS \u672a\u8a2d\u5b9a')\n        return True\n    return False\n\ndef get_email_from_token(id_token):\n    \"\"\"JWT\u30c8\u30fc\u30af\u30f3\u304b\u3089\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u53d6\u5f97\u3010\u524a\u9664\u7981\u6b62\u3011\"\"\"\n    try:\n        payload = id_token.split('.')[1]\n        padding = 4 - len(payload) % 4\n        if padding != 4:\n            payload += '=' * padding\n        decoded = base64.urlsafe_b64decode(payload).decode('utf-8')\n        return json.loads(decoded).get('email')\n    except:\n        return None\n\ndef make_response(body, status=200, content_type='application/json', headers=None):\n    \"\"\"\u30ec\u30b9\u30dd\u30f3\u30b9\u4f5c\u6210\u3010\u524a\u9664\u7981\u6b62\u3011\"\"\"\n    if headers is None:\n        headers = {}\n    headers['Content-Type'] = content_type\n    if content_type == 'application/json' and isinstance(body, dict):\n        body = json.dumps(body, ensure_ascii=False)\n    return (body, status, headers)\n\n# \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n# \u30e1\u30a4\u30f3\u30cf\u30f3\u30c9\u30e9\u3010\u524a\u9664\u7981\u6b62\u3011\n# \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n#\n# \u25a0 \u30e1\u30a4\u30f3\u30cf\u30f3\u30c9\u30e9\u3068\u306f\uff1f\n#   \u300c\u53d7\u4ed8\u4fc2\u300d\u306e\u3088\u3046\u306a\u3082\u306e\u3002\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u6700\u521d\u306b\u53d7\u3051\u53d6\u308a\u3001\n#   URL\u306b\u5fdc\u3058\u3066\u9069\u5207\u306a\u51e6\u7406\u306b\u632f\u308a\u5206\u3051\u307e\u3059\u3002\n#\n# \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n# \u2502  \u30d6\u30e9\u30a6\u30b6: \u300c/api/chat \u306b POST \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u308a\u307e\u3059\u300d         \u2502\n# \u2502       \u2193                                                     \u2502\n# \u2502  \u30e1\u30a4\u30f3\u30cf\u30f3\u30c9\u30e9: \u300c/api/chat \u3067\u3059\u306d\u3001\u30c1\u30e3\u30c3\u30c8\u51e6\u7406\u306b\u56de\u3057\u307e\u3059\u300d  \u2502\n# \u2502       \u2193                                                     \u2502\n# \u2502  \u30c1\u30e3\u30c3\u30c8API: \u300cAI\u306b\u554f\u3044\u5408\u308f\u305b\u3066\u8fd4\u7b54\u3057\u307e\u3059\u300d                  \u2502\n# \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n#\n# \u25a0 @functions_framework.http \u3068\u306f\uff1f\n#   \u300c\u3053\u306eapp\u3068\u3044\u3046\u95a2\u6570\u304cHTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u53d6\u308b\u5165\u53e3\u3067\u3059\u3088\u300d\u3068\u3044\u3046\u76ee\u5370\u3002\n#   GCP\u306f\u3053\u306e\u76ee\u5370\u3092\u898b\u3066\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u3053\u306e\u95a2\u6570\u306b\u6e21\u3057\u307e\u3059\u3002\n#\n\n@functions_framework.http\ndef app(request):\n    # \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    # \u2502 request\uff08\u30ea\u30af\u30a8\u30b9\u30c8\uff09= \u30d6\u30e9\u30a6\u30b6\u304b\u3089\u5c4a\u3044\u305f\u300c\u624b\u7d19\u300d            \u2502\n    # \u2502   - request.method  \u2192 \u624b\u7d19\u306e\u7a2e\u985e\uff08GET/POST\uff09               \u2502\n    # \u2502   - request.path    \u2192 \u3069\u3053\u5b9b\u3066\uff1f\uff08/api/chat \u306a\u3069\uff09         \u2502\n    # \u2502   - request.headers \u2192 \u5c01\u7b52\u306e\u60c5\u5831\uff08\u8a8d\u8a3c\u30c8\u30fc\u30af\u30f3\u306a\u3069\uff09       \u2502\n    # \u2502   - request.get_json() \u2192 \u624b\u7d19\u306e\u4e2d\u8eab\uff08\u9001\u3089\u308c\u3066\u304d\u305f\u30c7\u30fc\u30bf\uff09  \u2502\n    # \u2502                                                             \u2502\n    # \u2502 \u8fd4\u308a\u5024 = \u30d6\u30e9\u30a6\u30b6\u306b\u8fd4\u3059\u300c\u8fd4\u4e8b\u300d                             \u2502\n    # \u2502   - (\u672c\u6587, \u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9, \u30d8\u30c3\u30c0\u30fc) \u306e\u5f62\u5f0f\u3067\u8fd4\u3059         \u2502\n    # \u2502   - \u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9: 200=\u6210\u529f\u3001404=\u898b\u3064\u304b\u3089\u306a\u3044\u3001\u306a\u3069      \u2502\n    # \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n    headers = {}\n    origin = request.headers.get('Origin', '')\n\n    # \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\u3092\u8fd4\u4e8b\u306b\u8ffd\u52a0\u3010\u524a\u9664\u7981\u6b62\u3011\n    set_cors_headers(headers, origin)\n    set_security_headers(headers)\n\n    # \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    # \u2502 \u30d7\u30ea\u30d5\u30e9\u30a4\u30c8\u30ea\u30af\u30a8\u30b9\u30c8\u3068\u306f\uff1f\u3010\u524a\u9664\u7981\u6b62\u3011                     \u2502\n    # \u2502                                                             \u2502\n    # \u2502 \u30d6\u30e9\u30a6\u30b6\u304c\u672c\u756a\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308b\u524d\u306b                        \u2502\n    # \u2502 \u300c\u3053\u306e\u30b5\u30fc\u30d0\u30fc\u3001\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3044\u3044\uff1f\u300d\u3068\u78ba\u8a8d\u3059\u308b\u4ed5\u7d44\u307f        \u2502\n    # \u2502                                                             \u2502\n    # \u2502 \u30d6\u30e9\u30a6\u30b6: \u300cOPTIONS\u3067\u78ba\u8a8d\u3057\u307e\u3059\u300d                           \u2502\n    # \u2502 \u30b5\u30fc\u30d0\u30fc: \u300c204\uff08OK\u3001\u4e2d\u8eab\u306a\u3057\uff09\u3067\u8fd4\u4e8b\u300d                     \u2502\n    # \u2502 \u30d6\u30e9\u30a6\u30b6: \u300c\u3058\u3083\u3042\u672c\u756a\u306ePOST\u3092\u9001\u308a\u307e\u3059\u300d                    \u2502\n    # \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    if request.method == 'OPTIONS':\n        return ('', 204, headers)\n\n    path = request.path\n\n    # \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n    # \u2551 \u3010\u51e6\u7406\u306e\u6d41\u308c\u3011\u30e6\u30fc\u30b6\u30fc\u306e\u64cd\u4f5c\u9806\u306b\u4e26\u3093\u3067\u3044\u307e\u3059                 \u2551\n    # \u2551                                                             \u2551\n    # \u2551  1. / (\u30c8\u30c3\u30d7\u30da\u30fc\u30b8)     \u2192 \u30e6\u30fc\u30b6\u30fc\u304c\u6700\u521d\u306b\u30a2\u30af\u30bb\u30b9         \u2551\n    # \u2551  1b. /script.js          \u2192 \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u306eJavaScript       \u2551\n    # \u2551  2. /api/check-access    \u2192 \u30ed\u30b0\u30a4\u30f3\u5f8c\u3001\u6a29\u9650\u3092\u78ba\u8a8d           \u2551\n    # \u2551  3. /api/chat            \u2192 \u30e1\u30a4\u30f3\u306e\u30c1\u30e3\u30c3\u30c8\u6a5f\u80fd             \u2551\n    # \u2551  4. \u3010\u65b0\u3057\u3044API\u3092\u8ffd\u52a0\u3011  \u2192 \u6a5f\u80fd\u62e1\u5f35\u306f\u3053\u3053\u306b                 \u2551\n    # \u2551  5. /api/health          \u2192 \u904b\u7528\u76e3\u8996\u7528\uff08\u30e6\u30fc\u30b6\u30fc\u306f\u4f7f\u308f\u306a\u3044\uff09 \u2551\n    # \u2551  6. 404\u30a8\u30e9\u30fc            \u2192 \u3069\u308c\u306b\u3082\u8a72\u5f53\u3057\u306a\u3044\u5834\u5408           \u2551\n    # \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n\n    # ---------------------------------------------------------------\n    # 1. \u30c8\u30c3\u30d7\u30da\u30fc\u30b8\u8868\u793a\u3010\u524a\u9664\u7981\u6b62\u3011\n    # \u2192 \u30e6\u30fc\u30b6\u30fc\u304c\u6700\u521d\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u753b\u9762\uff08\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\uff09\n    # ---------------------------------------------------------------\n    if path == '/' and request.method == 'GET':\n        headers['Content-Type'] = 'text/html; charset=utf-8'\n        return (HTML_CONTENT, 200, headers)\n\n    # ---------------------------------------------------------------\n    # 1b. JavaScript\u914d\u4fe1\u3010\u524a\u9664\u7981\u6b62\u3011\n    # \u2192 \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3067\u4f7f\u3046JavaScript\uff08front.html\u304b\u3089\u8aad\u307f\u8fbc\u307e\u308c\u308b\uff09\n    # ---------------------------------------------------------------\n    if path == '/script.js' and request.method == 'GET':\n        headers['Content-Type'] = 'application/javascript; charset=utf-8'\n        return (SCRIPT_CONTENT, 200, headers)\n\n    # ---------------------------------------------------------------\n    # 2. \u30a2\u30af\u30bb\u30b9\u6a29\u9650\u30c1\u30a7\u30c3\u30af\u3010\u524a\u9664\u7981\u6b62\u3011\n    # \u2192 \u30ed\u30b0\u30a4\u30f3\u5f8c\u3001\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u304c\u30a2\u30d7\u30ea\u3092\u4f7f\u3048\u308b\u304b\u78ba\u8a8d\n    # ---------------------------------------------------------------\n    if path == '/api/check-access' and request.method == 'POST':\n        try:\n            auth_header = request.headers.get('Authorization', '')\n            if not auth_header.startswith('Bearer '):\n                return make_response({'allowed': False, 'error': '\u8a8d\u8a3c\u30c8\u30fc\u30af\u30f3\u304c\u3042\u308a\u307e\u305b\u3093'}, 401, headers=headers)\n\n            email = get_email_from_token(auth_header.split('Bearer ')[1])\n            if not email:\n                return make_response({'allowed': False, 'error': '\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u53d6\u5f97\u5931\u6557'}, 401, headers=headers)\n\n            allowed = is_email_allowed(email)\n            print(f\"\u30a2\u30af\u30bb\u30b9: {email} \u2192 {'\u8a31\u53ef' if allowed else '\u62d2\u5426'}\")\n            return make_response({'allowed': allowed}, headers=headers)\n        except:\n            return make_response({'allowed': False, 'error': '\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f'}, 500, headers=headers)\n\n    # ---------------------------------------------------------------\n    # 3. \u2605\u2605\u2605 \u30c1\u30e3\u30c3\u30c8API\uff08\u3053\u3053\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\uff09\u2605\u2605\u2605\n    # \u2192 \u30e1\u30a4\u30f3\u306e\u6a5f\u80fd\u3002AI\u3068\u30c1\u30e3\u30c3\u30c8\u3059\u308b\n    # ---------------------------------------------------------------\n    if path == '/api/chat' and request.method == 'POST':\n        try:\n            # --- \u8a8d\u8a3c\u30c1\u30a7\u30c3\u30af\u3010\u524a\u9664\u7981\u6b62\u3011---\n            auth_header = request.headers.get('Authorization', '')\n            if not auth_header.startswith('Bearer '):\n                return make_response({'error': '\u30ed\u30b0\u30a4\u30f3\u304c\u5fc5\u8981\u3067\u3059'}, 401, headers=headers)\n\n            email = get_email_from_token(auth_header.split('Bearer ')[1])\n            if not is_email_allowed(email):\n                return make_response({'error': '\u6a29\u9650\u304c\u3042\u308a\u307e\u305b\u3093'}, 403, headers=headers)\n\n            # --- \u5165\u529b\u30c1\u30a7\u30c3\u30af\u3010\u524a\u9664\u7981\u6b62\u3011---\n            body = request.get_json(silent=True) or {}\n            message = body.get('message', '')\n\n            if not message or not isinstance(message, str):\n                return make_response({'error': '\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044'}, 400, headers=headers)\n            if len(message) &gt; 10000:\n                return make_response({'error': '\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9577\u3059\u304e\u307e\u3059'}, 400, headers=headers)\n\n            # --- AI\u547c\u3073\u51fa\u3057\u3010\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u53ef\u80fd\u3011---\n            client = OpenAI(api_key=os.environ.get('OPENAI_API_KEY'))\n            completion = client.chat.completions.create(\n                model='gpt-3.5-turbo',  # \u2190 gpt-4 \u306b\u5909\u66f4\u53ef\u80fd\n                messages=[{'role': 'user', 'content': message}],\n                max_tokens=1000,        # \u2190 \u56de\u7b54\u306e\u9577\u3055\n                temperature=0.7         # \u2190 0=\u56fa\u5b9a\u7684\u30011=\u5275\u9020\u7684\n            )\n\n            return make_response({'response': completion.choices[0].message.content}, headers=headers)\n\n        except Exception as e:\n            print(f'\u30c1\u30e3\u30c3\u30c8\u30a8\u30e9\u30fc: {e}')\n            return make_response({'error': 'AI\u306e\u51e6\u7406\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f'}, 500, headers=headers)\n\n    # ---------------------------------------------------------------\n    # 4. \u3010\u65b0\u3057\u3044API\u3092\u8ffd\u52a0\u3059\u308b\u5834\u6240\u3011\n    # \u2192 \u6a5f\u80fd\u3092\u8ffd\u52a0\u3057\u305f\u3044\u5834\u5408\u306f\u3053\u3053\u306b\u66f8\u304f\n    #\n    # \u4f8b: \u30c1\u30e3\u30c3\u30c8\u5c65\u6b74\u3092\u53d6\u5f97\u3059\u308bAPI\n    # if path == '/api/history' and request.method == 'GET':\n    #     # \u8a8d\u8a3c\u30c1\u30a7\u30c3\u30af\uff08\u4e0a\u306e\u30c1\u30e3\u30c3\u30c8API\u304b\u3089\u30b3\u30d4\u30fc\uff09\n    #     # \u5c65\u6b74\u3092\u53d6\u5f97\u3057\u3066\u8fd4\u3059\u51e6\u7406\n    #     return make_response({'history': [...]}, headers=headers)\n    # ---------------------------------------------------------------\n\n    # ---------------------------------------------------------------\n    # 5. \u30d8\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u3010\u524a\u9664\u7981\u6b62\u3011\n    # \u2192 \u30b5\u30fc\u30d0\u30fc\u304c\u52d5\u3044\u3066\u3044\u308b\u304b\u78ba\u8a8d\u7528\uff08\u904b\u7528\u76e3\u8996\u7528\u3001\u30e6\u30fc\u30b6\u30fc\u306f\u4f7f\u308f\u306a\u3044\uff09\n    # ---------------------------------------------------------------\n    if path == '/api/health' and request.method == 'GET':\n        return make_response(\n            {'status': 'ok', 'timestamp': datetime.now().isoformat()},\n            headers=headers\n        )\n\n    # ---------------------------------------------------------------\n    # 6. 404\u30a8\u30e9\u30fc\u3010\u524a\u9664\u7981\u6b62\u3011\n    # \u2192 \u4e0a\u306e\u3069\u308c\u306b\u3082\u8a72\u5f53\u3057\u306a\u3044URL\u306b\u30a2\u30af\u30bb\u30b9\u3055\u308c\u305f\u5834\u5408\n    # ---------------------------------------------------------------\n    return make_response({'error': '\u30da\u30fc\u30b8\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093'}, 404, headers=headers)\n</code></pre>"},{"location":"code/python/front/","title":"front.html","text":"<p>\u753b\u9762\u306e\u30c7\u30b6\u30a4\u30f3\uff08HTML/CSS\uff09</p> <p>Node.js\u3068\u5171\u901a</p> <p>\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306fNode.js\u7248\u3068\u540c\u3058\u5185\u5bb9\u3067\u3059\u3002</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"ja\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;title&gt;AI \u30c1\u30e3\u30c3\u30c8&lt;/title&gt;\n    &lt;!-- Firebase SDK\u3010\u524a\u9664\u7981\u6b62\u3011 --&gt;\n    &lt;script src=\"https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js\"&gt;&lt;/script&gt;\n    &lt;style&gt;\n        /* \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n           CSS\u3010\u524a\u9664\u7981\u6b62\u3011\u30c7\u30b6\u30a4\u30f3\u3092\u5909\u3048\u305f\u3044\u5834\u5408\u306f\u3053\u3053\u3092\u7de8\u96c6\n           \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 */\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            background: #f5f5f5;\n            min-height: 100vh;\n            display: flex;\n            flex-direction: column;\n        }\n        header {\n            background: #1a73e8;\n            color: white;\n            padding: 16px;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        main {\n            flex: 1;\n            max-width: 800px;\n            margin: 0 auto;\n            padding: 20px;\n            width: 100%;\n        }\n        .chat-container {\n            background: white;\n            border-radius: 8px;\n            padding: 20px;\n            min-height: 400px;\n            max-height: 60vh;\n            overflow-y: auto;\n            margin-bottom: 20px;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n        }\n        .message {\n            margin-bottom: 16px;\n            padding: 12px 16px;\n            border-radius: 8px;\n            max-width: 80%;\n        }\n        .user { background: #e3f2fd; margin-left: auto; text-align: right; }\n        .assistant { background: #f5f5f5; margin-right: auto; }\n        .error { background: #ffebee; color: #c62828; }\n        .input-area { display: flex; gap: 10px; }\n        #message-input {\n            flex: 1;\n            padding: 12px 16px;\n            border: 1px solid #ddd;\n            border-radius: 24px;\n            font-size: 16px;\n            outline: none;\n        }\n        #message-input:focus { border-color: #1a73e8; }\n        .btn {\n            padding: 12px 24px;\n            background: #1a73e8;\n            color: white;\n            border: none;\n            border-radius: 24px;\n            font-size: 16px;\n            cursor: pointer;\n        }\n        .btn:hover { background: #1557b0; }\n        .btn:disabled { background: #ccc; cursor: not-allowed; }\n        .btn-outline { background: transparent; border: 1px solid white; padding: 8px 16px; }\n        .loading {\n            display: inline-block;\n            width: 20px;\n            height: 20px;\n            border: 2px solid #f3f3f3;\n            border-top: 2px solid #1a73e8;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n        }\n        @keyframes spin { to { transform: rotate(360deg); } }\n        .center-screen {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            min-height: 60vh;\n            text-align: center;\n        }\n        .user-info { display: flex; align-items: center; gap: 12px; }\n        .user-info img { width: 32px; height: 32px; border-radius: 50%; }\n        .hidden { display: none !important; }\n        .google-btn {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            padding: 12px 24px;\n            background: white;\n            border: 1px solid #ddd;\n            border-radius: 4px;\n            font-size: 16px;\n            cursor: pointer;\n        }\n        .google-btn:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.15); }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;!-- \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n         HTML\u69cb\u9020\u3010\u524a\u9664\u7981\u6b62\u3011\u753b\u9762\u3092\u8ffd\u52a0\u3057\u305f\u3044\u5834\u5408\u306f&lt;main&gt;\u5185\u306b\u65b0\u3057\u3044div\u3092\u8ffd\u52a0\n         \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 --&gt;\n    &lt;header&gt;\n        &lt;h1&gt;AI \u30c1\u30e3\u30c3\u30c8&lt;/h1&gt;\n        &lt;div id=\"user-info\" class=\"user-info hidden\"&gt;\n            &lt;img id=\"user-photo\" src=\"\" alt=\"\"&gt;\n            &lt;span id=\"user-name\"&gt;&lt;/span&gt;\n            &lt;button class=\"btn btn-outline\" onclick=\"logout()\"&gt;\u30ed\u30b0\u30a2\u30a6\u30c8&lt;/button&gt;\n        &lt;/div&gt;\n    &lt;/header&gt;\n\n    &lt;main&gt;\n        &lt;!-- \u30ed\u30b0\u30a4\u30f3\u753b\u9762 --&gt;\n        &lt;div id=\"login-screen\" class=\"center-screen\"&gt;\n            &lt;h2&gt;\u3088\u3046\u3053\u305d&lt;/h2&gt;\n            &lt;p style=\"margin: 20px 0; color: #666;\"&gt;Google\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044&lt;/p&gt;\n            &lt;button class=\"google-btn\" onclick=\"login()\"&gt;\n                &lt;svg width=\"18\" height=\"18\" viewBox=\"0 0 18 18\"&gt;\n                    &lt;path fill=\"#4285F4\" d=\"M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z\"/&gt;\n                    &lt;path fill=\"#34A853\" d=\"M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 0 0 9 18z\"/&gt;\n                    &lt;path fill=\"#FBBC05\" d=\"M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z\"/&gt;\n                    &lt;path fill=\"#EA4335\" d=\"M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z\"/&gt;\n                &lt;/svg&gt;\n                Google\u3067\u30ed\u30b0\u30a4\u30f3\n            &lt;/button&gt;\n        &lt;/div&gt;\n\n        &lt;!-- \u30a2\u30af\u30bb\u30b9\u62d2\u5426\u753b\u9762 --&gt;\n        &lt;div id=\"access-denied\" class=\"center-screen hidden\"&gt;\n            &lt;h2 style=\"color: #c62828;\"&gt;\u30a2\u30af\u30bb\u30b9\u304c\u8a31\u53ef\u3055\u308c\u3066\u3044\u307e\u305b\u3093&lt;/h2&gt;\n            &lt;p style=\"margin: 20px 0; color: #666;\"&gt;\u7ba1\u7406\u8005\u306b\u304a\u554f\u3044\u5408\u308f\u305b\u304f\u3060\u3055\u3044\u3002&lt;/p&gt;\n            &lt;p style=\"color: #999; font-size: 14px;\"&gt;\u30ed\u30b0\u30a4\u30f3\u4e2d: &lt;span id=\"denied-email\"&gt;&lt;/span&gt;&lt;/p&gt;\n            &lt;button class=\"btn\" style=\"margin-top: 20px;\" onclick=\"logout()\"&gt;\u5225\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ed\u30b0\u30a4\u30f3&lt;/button&gt;\n        &lt;/div&gt;\n\n        &lt;!-- \u30c1\u30e3\u30c3\u30c8\u753b\u9762 --&gt;\n        &lt;div id=\"chat-screen\" class=\"hidden\"&gt;\n            &lt;div id=\"chat-container\" class=\"chat-container\"&gt;\n                &lt;div class=\"message assistant\"&gt;\u3053\u3093\u306b\u3061\u306f\uff01\u4f55\u3067\u3082\u805e\u3044\u3066\u304f\u3060\u3055\u3044\u3002&lt;/div&gt;\n            &lt;/div&gt;\n            &lt;div class=\"input-area\"&gt;\n                &lt;input type=\"text\" id=\"message-input\" placeholder=\"\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5165\u529b...\" autocomplete=\"off\"&gt;\n                &lt;button id=\"send-btn\" class=\"btn\" onclick=\"sendMessage()\"&gt;\u9001\u4fe1&lt;/button&gt;\n            &lt;/div&gt;\n        &lt;/div&gt;\n    &lt;/main&gt;\n\n    &lt;!-- \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n         JavaScript\u3010\u524a\u9664\u7981\u6b62\u3011\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3068\u306e\u901a\u4fe1\u51e6\u7406\n         \u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u5834\u5408\u306f script.js \u3092\u7de8\u96c6\n         \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 --&gt;\n    &lt;script src=\"script.js\"&gt;&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"code/python/requirements/","title":"requirements.txt","text":"<p>\u4f7f\u7528\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u4e00\u89a7</p> <pre><code># AI \u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea - \u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u4e00\u89a7\n#\n# \u3010\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u3064\u3044\u3066\u3011\n# Python\u7248\u3067\u4f7f\u7528\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002\n# GCP\u304c\u30c7\u30d7\u30ed\u30a4\u6642\u306b\u81ea\u52d5\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n#\n# \u3010GCP\u3067\u306e\u4f7f\u3044\u65b9\u3011\n# 1. Cloud Run functions \u306e\u4f5c\u6210\u753b\u9762\u3092\u958b\u304f\n# 2. \u30e9\u30f3\u30bf\u30a4\u30e0\u3092\u300cPython 3.11\u300d\u306b\u5909\u66f4\n# 3. main.py \u306b backend.py \u306e\u5185\u5bb9\u3092\u8cbc\u308a\u4ed8\u3051\n# 4. requirements.txt \u306b\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u5bb9\u3092\u8cbc\u308a\u4ed8\u3051\n# 5. front.html \u3068 script.js \u3092\u65b0\u898f\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u8ffd\u52a0\n\nfunctions-framework==3.*\nopenai&gt;=1.0.0\n</code></pre>"},{"location":"code/python/script/","title":"script.js","text":"<p>\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u306e\u51e6\u7406\uff08JavaScript\uff09</p> <p>Node.js\u3068\u5171\u901a</p> <p>\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306fNode.js\u7248\u3068\u540c\u3058\u5185\u5bb9\u3067\u3059\u3002</p> <pre><code>/**\n * AI \u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea - \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\uff08\u30d6\u30e9\u30a6\u30b6\u5074\u51e6\u7406\uff09\n *\n * \u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n * \u2551 \u3010\u51e6\u7406\u306e\u6d41\u308c\u3011                                               \u2551\n * \u2551  1. Firebase\u8a2d\u5b9a     \u2192 \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3054\u3068\u306b\u66f8\u304d\u63db\u3048           \u2551\n * \u2551  2. \u8a8d\u8a3c\u72b6\u614b\u76e3\u8996     \u2192 \u30ed\u30b0\u30a4\u30f3/\u30ed\u30b0\u30a2\u30a6\u30c8\u3092\u691c\u77e5            \u2551\n * \u2551  3. \u753b\u9762\u5207\u308a\u66ff\u3048     \u2192 \u30ed\u30b0\u30a4\u30f3/\u62d2\u5426/\u30c1\u30e3\u30c3\u30c8\u753b\u9762\u3092\u5207\u66ff     \u2551\n * \u2551  4. \u8a8d\u8a3c\u95a2\u6570         \u2192 \u30ed\u30b0\u30a4\u30f3/\u30ed\u30b0\u30a2\u30a6\u30c8\u51e6\u7406              \u2551\n * \u2551  5. \u30a2\u30af\u30bb\u30b9\u6a29\u9650\u78ba\u8a8d \u2192 \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306b\u554f\u3044\u5408\u308f\u305b             \u2551\n * \u2551  6. \u30c1\u30e3\u30c3\u30c8\u6a5f\u80fd     \u2192 AI\u3068\u306e\u4f1a\u8a71\u51e6\u7406                       \u2551\n * \u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n */\n\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// 1. \u2605\u2605\u2605 Firebase\u8a2d\u5b9a\uff08\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3054\u3068\u306b\u5909\u66f4\u304c\u5fc5\u8981\uff09\u2605\u2605\u2605\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// Firebase\u30b3\u30f3\u30bd\u30fc\u30eb \u2192 \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u8a2d\u5b9a \u2192 \u300c\u69cb\u6210\u300d\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\nconst firebaseConfig = {\n    apiKey: \"YOUR_API_KEY\",                     // \u2190 \u66f8\u304d\u63db\u3048\u5fc5\u9808\n    authDomain: \"YOUR_PROJECT.firebaseapp.com\", // \u2190 \u66f8\u304d\u63db\u3048\u5fc5\u9808\n    projectId: \"YOUR_PROJECT_ID\",               // \u2190 \u66f8\u304d\u63db\u3048\u5fc5\u9808\n    storageBucket: \"YOUR_PROJECT.appspot.com\",\n    messagingSenderId: \"000000000000\",\n    appId: \"YOUR_APP_ID\"\n};\n\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// 2. \u521d\u671f\u5316\u3010\u524a\u9664\u7981\u6b62\u3011\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\nfirebase.initializeApp(firebaseConfig);\nconst auth = firebase.auth();\nlet currentUser = null;\n\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// 3. \u8a8d\u8a3c\u72b6\u614b\u76e3\u8996\u3010\u524a\u9664\u7981\u6b62\u3011\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// \u30ed\u30b0\u30a4\u30f3/\u30ed\u30b0\u30a2\u30a6\u30c8\u3059\u308b\u3068\u81ea\u52d5\u3067\u3053\u306e\u95a2\u6570\u304c\u547c\u3070\u308c\u308b\nauth.onAuthStateChanged(async (user) =&gt; {\n    if (user) {\n        // \u30ed\u30b0\u30a4\u30f3\u6e08\u307f \u2192 \u30a2\u30af\u30bb\u30b9\u6a29\u9650\u3092\u78ba\u8a8d\n        currentUser = user;\n        const isAllowed = await checkAccess(user);\n        isAllowed ? showChat(user) : showDenied(user);\n    } else {\n        // \u672a\u30ed\u30b0\u30a4\u30f3 \u2192 \u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3092\u8868\u793a\n        currentUser = null;\n        showLogin();\n    }\n});\n\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// 4. \u753b\u9762\u5207\u308a\u66ff\u3048\u3010\u524a\u9664\u7981\u6b62\u3011\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// $('id\u540d') \u3067\u8981\u7d20\u3092\u53d6\u5f97\u3059\u308b\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\nconst $ = id =&gt; document.getElementById(id);\n\n// \u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3092\u8868\u793a\nfunction showLogin() {\n    $('login-screen').classList.remove('hidden');\n    $('chat-screen').classList.add('hidden');\n    $('access-denied').classList.add('hidden');\n    $('user-info').classList.add('hidden');\n}\n\n// \u30a2\u30af\u30bb\u30b9\u62d2\u5426\u753b\u9762\u3092\u8868\u793a\nfunction showDenied(user) {\n    $('login-screen').classList.add('hidden');\n    $('chat-screen').classList.add('hidden');\n    $('access-denied').classList.remove('hidden');\n    $('user-info').classList.add('hidden');\n    $('denied-email').textContent = user.email;\n}\n\n// \u30c1\u30e3\u30c3\u30c8\u753b\u9762\u3092\u8868\u793a\nfunction showChat(user) {\n    $('login-screen').classList.add('hidden');\n    $('chat-screen').classList.remove('hidden');\n    $('access-denied').classList.add('hidden');\n    $('user-info').classList.remove('hidden');\n    $('user-name').textContent = user.displayName;\n    $('user-photo').src = user.photoURL || '';\n}\n\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// 5. \u8a8d\u8a3c\u95a2\u6570\u3010\u524a\u9664\u7981\u6b62\u3011\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n\n// Google\u3067\u30ed\u30b0\u30a4\u30f3\nasync function login() {\n    try {\n        await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());\n    } catch (e) {\n        alert('\u30ed\u30b0\u30a4\u30f3\u306b\u5931\u6557\u3057\u307e\u3057\u305f');\n    }\n}\n\n// \u30ed\u30b0\u30a2\u30a6\u30c8\nasync function logout() {\n    await auth.signOut();\n}\n\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// 6. \u30a2\u30af\u30bb\u30b9\u6a29\u9650\u30c1\u30a7\u30c3\u30af\u3010\u524a\u9664\u7981\u6b62\u3011\n// \u2192 \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306e /api/check-access \u3092\u547c\u3073\u51fa\u3057\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\nasync function checkAccess(user) {\n    try {\n        // JWT\u30c8\u30fc\u30af\u30f3\uff08\u30c7\u30b8\u30bf\u30eb\u4f1a\u54e1\u8a3c\uff09\u3092\u53d6\u5f97\n        const token = await user.getIdToken();\n\n        // \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306b\u78ba\u8a8d\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u4fe1\n        const res = await fetch('/api/check-access', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${token}`  // \u4f1a\u54e1\u8a3c\u3092\u63d0\u793a\n            }\n        });\n        const data = await res.json();\n        return data.allowed === true;\n    } catch (e) {\n        return false;\n    }\n}\n\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// 7. \u2605\u2605\u2605 \u30c1\u30e3\u30c3\u30c8\u6a5f\u80fd\uff08\u3053\u3053\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\uff09\u2605\u2605\u2605\n// \u2192 \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306e /api/chat \u3092\u547c\u3073\u51fa\u3057\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\nconst chatContainer = $('chat-container');\nconst messageInput = $('message-input');\nconst sendBtn = $('send-btn');\n\n// \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u753b\u9762\u306b\u8ffd\u52a0\nfunction addMessage(text, type) {\n    const div = document.createElement('div');\n    div.className = `message ${type}`;\n    div.textContent = text;\n    chatContainer.appendChild(div);\n    chatContainer.scrollTop = chatContainer.scrollHeight;\n}\n\n// \u300c\u8003\u3048\u4e2d...\u300d\u306e\u30ed\u30fc\u30c7\u30a3\u30f3\u30b0\u8868\u793a\u3092\u8ffd\u52a0\nfunction addLoading() {\n    const div = document.createElement('div');\n    div.className = 'message assistant';\n    div.innerHTML = '&lt;span class=\"loading\"&gt;&lt;/span&gt; \u8003\u3048\u4e2d...';\n    chatContainer.appendChild(div);\n    chatContainer.scrollTop = chatContainer.scrollHeight;\n    return div;\n}\n\n// \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u51e6\u7406\nasync function sendMessage() {\n    if (!currentUser) return alert('\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044');\n    const message = messageInput.value.trim();\n    if (!message) return;\n\n    // \u9001\u4fe1\u30dc\u30bf\u30f3\u3092\u7121\u52b9\u5316\uff08\u9023\u6253\u9632\u6b62\uff09\n    sendBtn.disabled = true;\n\n    // \u30e6\u30fc\u30b6\u30fc\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8868\u793a\n    addMessage(message, 'user');\n    messageInput.value = '';\n    const loading = addLoading();\n\n    try {\n        // JWT\u30c8\u30fc\u30af\u30f3\uff08\u30c7\u30b8\u30bf\u30eb\u4f1a\u54e1\u8a3c\uff09\u3092\u53d6\u5f97\n        const token = await currentUser.getIdToken();\n\n        // \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\n        const res = await fetch('/api/chat', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${token}`\n            },\n            body: JSON.stringify({ message })\n        });\n        const data = await res.json();\n        loading.remove();\n\n        // \u7d50\u679c\u3092\u8868\u793a\n        addMessage(res.ok ? data.response : `\u30a8\u30e9\u30fc: ${data.error}`, res.ok ? 'assistant' : 'error');\n    } catch (e) {\n        loading.remove();\n        addMessage('\u30a8\u30e9\u30fc: \u901a\u4fe1\u306b\u5931\u6557\u3057\u307e\u3057\u305f', 'error');\n    }\n\n    sendBtn.disabled = false;\n    messageInput.focus();\n}\n\n// Enter\u30ad\u30fc\u3067\u9001\u4fe1\nmessageInput.addEventListener('keypress', e =&gt; {\n    if (e.key === 'Enter') sendMessage();\n});\n\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n// \u3010\u65b0\u3057\u3044\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\u5834\u6240\u3011\n// \u4f8b: \u30c1\u30e3\u30c3\u30c8\u5c65\u6b74\u4fdd\u5b58\u3001\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u7b49\n// \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n</code></pre>"},{"location":"gcp-firebase/01_design/","title":"AI\u30c1\u30fc\u30e0\u5411\u3051 GCP\u74b0\u5883 \u69cb\u7bc9\u8a2d\u8a08\u66f8","text":"\u9805\u76ee \u5185\u5bb9 \u4f5c\u6210\u65e5 2025\u5e7412\u670819\u65e5 \u30d0\u30fc\u30b8\u30e7\u30f3 1.0 \u5bfe\u8c61 AI\u30c1\u30fc\u30e0"},{"location":"gcp-firebase/01_design/#1","title":"1. \u30b7\u30b9\u30c6\u30e0\u6982\u8981","text":""},{"location":"gcp-firebase/01_design/#11","title":"1.1 \u76ee\u7684","text":"<p>\u975e\u30a8\u30f3\u30b8\u30cb\u30a2\u30c1\u30fc\u30e0\u304cDify\u3001Vertex AI\u7b49\u306eAI\u30c4\u30fc\u30eb\u3092\u5b89\u5168\u306b\u904b\u7528\u3057\u3001\u5916\u90e8\u9867\u5ba2\u306b\u3082\u30b5\u30fc\u30d3\u30b9\u3092\u63d0\u4f9b\u3067\u304d\u308b\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u3002</p>"},{"location":"gcp-firebase/01_design/#12","title":"1.2 \u8981\u4ef6","text":"\u8981\u4ef6 \u5185\u5bb9 \u904b\u7528\u30a2\u30d7\u30ea Dify\u3001Vertex AI + \u5c06\u6765\u7684\u306b\u4ed6AI\u30c4\u30fc\u30eb\u8ffd\u52a0 \u5229\u7528\u8005 \u793e\u5185\u30e1\u30f3\u30d0\u30fc + \u5916\u90e8\u9867\u5ba2\uff08500\u4eba\u898f\u6a21\u60f3\u5b9a\uff09 \u8a8d\u8a3c\u65b9\u5f0f Google\u30ed\u30b0\u30a4\u30f3\uff08OAuth 2.0\uff09 \u500b\u4eba\u60c5\u5831 \u6271\u308f\u306a\u3044 \u69cb\u7bc9\u65b9\u6cd5 GCP\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u624b\u52d5\u8a2d\u5b9a \u62c5\u5f53\u8005\u30b9\u30ad\u30eb \u975e\u30a8\u30f3\u30b8\u30cb\u30a2 \u30b3\u30fc\u30c9\u7ba1\u7406 GitHub\u3067\u7ba1\u7406"},{"location":"gcp-firebase/01_design/#13","title":"1.3 \u63a1\u7528\u69cb\u6210","text":"<p>Cloud Run functions \u30b5\u30d6\u30c9\u30e1\u30a4\u30f3\u65b9\u5f0f\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8\u69cb\u6210</p> <p>Cloud Run functions \u3068\u306f 2024\u5e748\u6708\u3001Cloud Functions\u306fCloud Run\u306b\u7d71\u5408\u3055\u308c\u300cCloud Run functions\u300d\u306b\u540d\u79f0\u5909\u66f4\u3055\u308c\u307e\u3057\u305f\u3002 \u30b3\u30fc\u30c9\u3092\u76f4\u63a5\u5165\u529b\u3059\u308b\u3060\u3051\u3067\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u3001Docker\u30a4\u30e1\u30fc\u30b8\u306f\u4e0d\u8981\u3067\u3059\u3002 GCP\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u306f\u300cCloud Run\u300d\u2192\u300c\u95a2\u6570\u3092\u4f5c\u6210\u300d\u304b\u3089\u5229\u7528\u3057\u307e\u3059\u3002</p> <p>\u203b \u975e\u30a8\u30f3\u30b8\u30cb\u30a2\u3067\u3082\u69cb\u7bc9\u53ef\u80fd\u306a\u30b7\u30f3\u30d7\u30eb\u69cb\u6210\u3092\u63a1\u7528</p>"},{"location":"gcp-firebase/01_design/#2","title":"2. \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3","text":""},{"location":"gcp-firebase/01_design/#21","title":"2.1 \u5168\u4f53\u69cb\u6210\u56f3","text":"<pre><code>                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                              \u2502     \u30e6\u30fc\u30b6\u30fc      \u2502\n                              \u2502   \uff08\u30d6\u30e9\u30a6\u30b6\uff09     \u2502\n                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                       \u2502\n                                       \u2502 HTTPS\n                                       \u2502\n              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n              \u2502                        \u2502                        \u2502\n              \u25bc                        \u25bc                        \u25bc\n    companya.example     companyb.example     companyc.example\n         .co.jp                  .co.jp                  .co.jp\n              \u2502                        \u2502                        \u2502\n              \u2502 DNS (CNAME)            \u2502 DNS (CNAME)            \u2502 DNS (CNAME)\n              \u25bc                        \u25bc                        \u25bc\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502 Cloud Run       \u2502    \u2502 Cloud Run       \u2502    \u2502 Cloud Run       \u2502\n   \u2502 functions       \u2502    \u2502 functions       \u2502    \u2502 functions       \u2502\n   \u2502 (tenant-a)      \u2502    \u2502 (tenant-b)      \u2502    \u2502 (tenant-c)      \u2502\n   \u2502                 \u2502    \u2502                 \u2502    \u2502                 \u2502\n   \u2502 - Dify          \u2502    \u2502 - Vertex AI     \u2502    \u2502 - \u30ab\u30b9\u30bf\u30e0AI     \u2502\n   \u2502 - Firebase Auth \u2502    \u2502 - Firebase Auth \u2502    \u2502 - Firebase Auth \u2502\n   \u2502 - \u81ea\u52d5SSL\u8a3c\u660e\u66f8  \u2502    \u2502 - \u81ea\u52d5SSL\u8a3c\u660e\u66f8  \u2502    \u2502 - \u81ea\u52d5SSL\u8a3c\u660e\u66f8  \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n            \u2502                      \u2502                      \u2502\n            \u25bc                      \u25bc                      \u25bc\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502 Secret Manager  \u2502    \u2502 Secret Manager  \u2502    \u2502 Secret Manager  \u2502\n   \u2502  tenant-a-*     \u2502    \u2502  tenant-b-*     \u2502    \u2502  tenant-c-*     \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n            \u2502                      \u2502                      \u2502\n            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                   \u2502\n                                   \u25bc\n                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                          \u2502    GitHub    \u2502\n                          \u2502 \uff08\u30b3\u30fc\u30c9\u7ba1\u7406\uff09  \u2502\n                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>\u69cb\u6210\u306e\u30dd\u30a4\u30f3\u30c8: - \u30b7\u30f3\u30d7\u30eb\u69cb\u6210: Load Balancer\u4e0d\u8981\u3001Cloud Run functions\u306b\u76f4\u63a5\u30de\u30c3\u30d4\u30f3\u30b0 - Docker\u4e0d\u8981: \u30b3\u30fc\u30c9\u3092\u76f4\u63a5\u5165\u529b\u3059\u308b\u3060\u3051\u3067\u30c7\u30d7\u30ed\u30a4\u53ef\u80fd - \u30c6\u30ca\u30f3\u30c8\u5206\u96e2: \u9867\u5ba2\u3054\u3068\u306b\u72ec\u7acb\u3057\u305f\u95a2\u6570 + \u30b5\u30d6\u30c9\u30e1\u30a4\u30f3 - \u30c7\u30fc\u30bf\u5206\u96e2: Secret Manager\u3092\u30c6\u30ca\u30f3\u30c8\u5225\u306b\u5206\u96e2 - \u81ea\u52d5SSL: Cloud Run\u306e\u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\u6a5f\u80fd\u3067\u81ea\u52d5\u767a\u884c\u30fb\u66f4\u65b0 - \u4f4e\u30b3\u30b9\u30c8: Load Balancer\u8cbb\u7528\uff08\u6708$18\u301c25\uff09\u304c\u4e0d\u8981</p>"},{"location":"gcp-firebase/01_design/#22","title":"2.2 \u30b5\u30d6\u30c9\u30e1\u30a4\u30f3\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0","text":"<pre><code>\u30d9\u30fc\u30b9\u30c9\u30e1\u30a4\u30f3: example.co.jp\n\n\u3010URL\u8a2d\u8a08\u3011\n{tenant}.example.co.jp/        \u2192 \u30c6\u30ca\u30f3\u30c8\u5c02\u7528\u30c8\u30c3\u30d7\u30da\u30fc\u30b8\n{tenant}.example.co.jp/dify/*  \u2192 \u30c6\u30ca\u30f3\u30c8\u5c02\u7528 Dify\u30a2\u30d7\u30ea\n{tenant}.example.co.jp/chat/*  \u2192 \u30c6\u30ca\u30f3\u30c8\u5c02\u7528 AI\u30c1\u30e3\u30c3\u30c8\u30dc\u30c3\u30c8\n{tenant}.example.co.jp/vertex/* \u2192 \u30c6\u30ca\u30f3\u30c8\u5c02\u7528 Vertex AI\u30a2\u30d7\u30ea\n\n\u3010\u30c6\u30ca\u30f3\u30c8\u4f8b\u3011\ncompanya.example.co.jp/        \u2192 A\u793e\u5c02\u7528\u30c8\u30c3\u30d7\u30da\u30fc\u30b8\ncompanya.example.co.jp/dify/*  \u2192 A\u793e Dify\u30a2\u30d7\u30ea\ncompanyb.example.co.jp/        \u2192 B\u793e\u5c02\u7528\u30c8\u30c3\u30d7\u30da\u30fc\u30b8\ncompanyb.example.co.jp/vertex/* \u2192 B\u793e Vertex AI\u30a2\u30d7\u30ea\n</code></pre> <p>DNS\u8a2d\u5b9a\uff08\u30c6\u30ca\u30f3\u30c8\u8ffd\u52a0\u6642\uff09: | \u30b5\u30d6\u30c9\u30e1\u30a4\u30f3 | \u30ec\u30b3\u30fc\u30c9\u30bf\u30a4\u30d7 | \u5024 | |-------------|---------------|-----| | companya.example.co.jp | CNAME | Cloud Run \u30b5\u30fc\u30d3\u30b9URL | | companyb.example.co.jp | CNAME | Cloud Run \u30b5\u30fc\u30d3\u30b9URL |</p> <p>\u203b Cloud Run\u306e\u300c\u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\u3092\u30de\u30c3\u30d4\u30f3\u30b0\u300d\u6a5f\u80fd\u3092\u4f7f\u7528</p>"},{"location":"gcp-firebase/01_design/#23","title":"2.3 \u30c7\u30fc\u30bf\u30d5\u30ed\u30fc","text":"<pre><code>\u3010\u8a8d\u8a3c\u30d5\u30ed\u30fc\u3011\n\n1. \u30e6\u30fc\u30b6\u30fc\u304c https://companya.example.co.jp/ \u306b\u30a2\u30af\u30bb\u30b9\n   \u2502\n   \u25bc\n2. DNS \u304c Cloud Run functions (tenant-a) \u306b\u89e3\u6c7a\n   \u2502\n   \u25bc\n3. Cloud Run functions \u304c Firebase Auth \u306e\u8a8d\u8a3c\u72b6\u614b\u3092\u30c1\u30a7\u30c3\u30af\n   \u2502\n   \u251c\u2500\u2500 \u672a\u30ed\u30b0\u30a4\u30f3 \u2192 Google\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n   \u2502                 \u2502\n   \u2502                 \u25bc\n   \u2502            Google\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ed\u30b0\u30a4\u30f3\n   \u2502                 \u2502\n   \u2502                 \u25bc\n   \u2502            Firebase ID Token \u767a\u884c\n   \u2502\n   \u2514\u2500\u2500 \u30ed\u30b0\u30a4\u30f3\u6e08\u307f \u2192 \u30c8\u30fc\u30af\u30f3\u691c\u8a3c\n       \u2502\n       \u251c\u2500\u2500 \u6709\u52b9 + \u8a31\u53ef\u30c9\u30e1\u30a4\u30f3 \u2192 \u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u3078\n       \u2502\n       \u2514\u2500\u2500 \u7121\u52b9 or \u8a31\u53ef\u5916 \u2192 403 \u30a2\u30af\u30bb\u30b9\u62d2\u5426\n   \u2502\n   \u25bc\n5. \u30a2\u30d7\u30ea\u753b\u9762\u3092\u8868\u793a\n</code></pre> <pre><code>\u3010AI\u6a5f\u80fd\u5229\u7528\u30d5\u30ed\u30fc\u3011\n\n1. \u30e6\u30fc\u30b6\u30fc\u304cAI\u6a5f\u80fd\u3092\u5229\u7528\uff08\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u7b49\uff09\n   \u2502\n   \u25bc\n2. Cloud Run functions \u304c\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u51e6\u7406\n   \u2502\n   \u25bc\n3. Secret Manager \u304b\u3089\u8a72\u5f53\u30c6\u30ca\u30f3\u30c8\u306eAPI\u30ad\u30fc\u3092\u53d6\u5f97\n   \uff08\u4f8b: tenant-a-openai-key\uff09\n   \u2502\n   \u25bc\n4. \u5916\u90e8AI API\uff08OpenAI\u3001Anthropic\u3001Vertex AI\u7b49\uff09\u3092\u547c\u3073\u51fa\u3057\n   \u2502\n   \u25bc\n5. \u7d50\u679c\u3092\u30e6\u30fc\u30b6\u30fc\u306b\u8fd4\u5374\n</code></pre>"},{"location":"gcp-firebase/01_design/#3","title":"3. \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u8a2d\u8a08","text":""},{"location":"gcp-firebase/01_design/#31-firebase-authentication","title":"3.1 Firebase Authentication","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u5f79\u5272 \u5168\u30c6\u30ca\u30f3\u30c8\u5171\u901a\u306e\u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c \u8a8d\u8a3c\u65b9\u5f0f Google\u30ed\u30b0\u30a4\u30f3\uff08OAuth 2.0\uff09 \u30e6\u30fc\u30b6\u30fc\u30bf\u30a4\u30d7 \u5916\u90e8\uff08External\uff09 \u30c6\u30ca\u30f3\u30c8\u8b58\u5225 \u30ab\u30b9\u30bf\u30e0\u30af\u30ec\u30fc\u30e0 or \u30e6\u30fc\u30b6\u30fc\u306e\u30e1\u30fc\u30eb\u30c9\u30e1\u30a4\u30f3 \u30c9\u30e1\u30a4\u30f3\u5236\u9650 \u30c6\u30ca\u30f3\u30c8\u3054\u3068\u306b\u8a31\u53ef\u30c9\u30e1\u30a4\u30f3\u3092\u8a2d\u5b9a\u53ef\u80fd"},{"location":"gcp-firebase/01_design/#32-cloud-run-functions","title":"3.2 Cloud Run functions","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u5f79\u5272 \u30d0\u30c3\u30af\u30a8\u30f3\u30c9API + \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u914d\u4fe1 \u30c7\u30d7\u30ed\u30a4\u5358\u4f4d \u30c6\u30ca\u30f3\u30c8\u3054\u3068\u306b\u95a2\u6570\u3092\u4f5c\u6210 \u95a2\u6570\u540d\u898f\u5247 <code>ai-platform-{tenant-id}</code> \u30ea\u30fc\u30b8\u30e7\u30f3 asia-northeast1\uff08\u6771\u4eac\uff09 \u30e9\u30f3\u30bf\u30a4\u30e0 Node.js 20 / Python 3.11 \u30e1\u30e2\u30ea 512MB\u301c2GB \u6700\u5c0f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 0\uff08\u30b3\u30b9\u30c8\u524a\u6e1b\uff09 \u6700\u5927\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 10\uff08\u5236\u9650\u53ef\u80fd\uff09 \u30bf\u30a4\u30e0\u30a2\u30a6\u30c8 300\u79d2 \u8a8d\u8a3c \u672a\u8a8d\u8a3c\u8a31\u53ef\uff08Firebase Auth \u3067\u5236\u5fa1\uff09 \u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3 <code>{tenant}.example.co.jp</code> \u3092\u30de\u30c3\u30d4\u30f3\u30b0 <p>\u30c7\u30d7\u30ed\u30a4\u65b9\u6cd5: - GCP\u30b3\u30f3\u30bd\u30fc\u30eb\u306e Cloud Run \u2192\u300c\u95a2\u6570\u3092\u4f5c\u6210\u300d\u304b\u3089\u30b3\u30fc\u30c9\u3092\u76f4\u63a5\u5165\u529b - Docker\u30a4\u30e1\u30fc\u30b8\u306f\u4e0d\u8981 - SSL\u8a3c\u660e\u66f8\u306f\u81ea\u52d5\u767a\u884c\u30fb\u81ea\u52d5\u66f4\u65b0</p>"},{"location":"gcp-firebase/01_design/#33-secret-manager","title":"3.3 Secret Manager","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u5f79\u5272 API\u30ad\u30fc\u30fb\u6a5f\u5bc6\u60c5\u5831\u306e\u4fdd\u7ba1 \u547d\u540d\u898f\u5247 <code>{tenant-id}-{secret-name}</code> \u4f8b <code>companya-openai-key</code>, <code>companyb-anthropic-key</code> \u6697\u53f7\u5316 \u81ea\u52d5\uff08AES-256\uff09 \u30a2\u30af\u30bb\u30b9\u5236\u5fa1 \u30c6\u30ca\u30f3\u30c8\u5c02\u7528\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u307f\u30a2\u30af\u30bb\u30b9\u53ef\u80fd \u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406 \u6709\u52b9 <p>\u30a2\u30af\u30bb\u30b9\u5236\u5fa1: Cloud Run functions\u306f\u3001\u95a2\u6570\u4f5c\u6210\u6642\u306b\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u74b0\u5883\u5909\u6570\u3068\u3057\u3066\u7d10\u4ed8\u3051\u307e\u3059\u3002 GCP\u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u300c\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u300d\u2192\u300c\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u53c2\u7167\u300d\u304b\u3089\u8a2d\u5b9a\u3057\u307e\u3059\u3002</p>"},{"location":"gcp-firebase/01_design/#34-google","title":"3.4 Google\u30b0\u30eb\u30fc\u30d7\uff08\u30c6\u30ca\u30f3\u30c8\u7ba1\u7406\u7528\uff09","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u5f79\u5272 \u30c6\u30ca\u30f3\u30c8\u3054\u3068\u306e\u30e6\u30fc\u30b6\u30fc\u4e00\u62ec\u7ba1\u7406 \u30b0\u30eb\u30fc\u30d7\u4f8b <code>ai-users-companya@example.co.jp</code> \u7ba1\u7406\u65b9\u6cd5 Google Workspace \u7ba1\u7406\u30b3\u30f3\u30bd\u30fc\u30eb or groups.google.com \u7528\u9014 Firebase Auth \u306e\u8a31\u53ef\u30e6\u30fc\u30b6\u30fc\u7ba1\u7406\u306b\u4f7f\u7528"},{"location":"gcp-firebase/01_design/#4","title":"4. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u8a08","text":""},{"location":"gcp-firebase/01_design/#41","title":"4.1 \u591a\u5c64\u9632\u5fa1\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    \u7b2c1\u5c64: HTTPS\u901a\u4fe1                          \u2502\n\u2502                   \uff08\u5168\u901a\u4fe1\u306e\u6697\u53f7\u5316\uff09                          \u2502\n\u2502                                                             \u2502\n\u2502  - TLS 1.2\u4ee5\u4e0a                                               \u2502\n\u2502  - Cloud Run \u81ea\u52d5SSL\u8a3c\u660e\u66f8                                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              \u7b2c2\u5c64: Firebase Authentication                  \u2502\n\u2502                   \uff08\u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c\uff09                            \u2502\n\u2502                                                             \u2502\n\u2502  - Google\u30ed\u30b0\u30a4\u30f3\u5fc5\u9808                                        \u2502\n\u2502  - \u672a\u8a8d\u8a3c\u30e6\u30fc\u30b6\u30fc\u306f\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8                   \u2502\n\u2502  - \u30c6\u30ca\u30f3\u30c8\u3054\u3068\u306e\u8a31\u53ef\u30c9\u30e1\u30a4\u30f3/\u30e6\u30fc\u30b6\u30fc\u5236\u5fa1                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502               \u7b2c3\u5c64: \u30c6\u30ca\u30f3\u30c8\u5206\u96e2                              \u2502\n\u2502              \uff08\u30c7\u30fc\u30bf\u30fb\u30ea\u30bd\u30fc\u30b9\u5206\u96e2\uff09                          \u2502\n\u2502                                                             \u2502\n\u2502  - Cloud Run functions: \u30c6\u30ca\u30f3\u30c8\u3054\u3068\u306b\u72ec\u7acb\u3057\u305f\u95a2\u6570             \u2502\n\u2502  - Secret Manager: \u30c6\u30ca\u30f3\u30c8\u5225\u306b\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u7ba1\u7406                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502               \u7b2c4\u5c64: Secret Manager                          \u2502\n\u2502                \uff08\u6a5f\u5bc6\u60c5\u5831\u306e\u4fdd\u8b77\uff09                              \u2502\n\u2502                                                             \u2502\n\u2502  - API\u30ad\u30fc\u306f\u30b3\u30fc\u30c9\u306b\u542b\u3081\u306a\u3044                                  \u2502\n\u2502  - AES-256\u6697\u53f7\u5316\u4fdd\u5b58                                         \u2502\n\u2502  - \u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u8a18\u9332                                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>\u6ce8\u610f: WAF\uff08Cloud Armor\uff09\u306f\u672c\u69cb\u6210\u3067\u306f\u4f7f\u7528\u3057\u307e\u305b\u3093\u3002\u5c06\u6765\u7684\u306b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5f37\u5316\u304c\u5fc5\u8981\u306a\u5834\u5408\u306f Load Balancer + Cloud Armor \u306e\u8ffd\u52a0\u3092\u691c\u8a0e\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"gcp-firebase/01_design/#42","title":"4.2 \u30c6\u30ca\u30f3\u30c8\u5206\u96e2\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3","text":"<pre><code>\u3010\u30c6\u30ca\u30f3\u30c8\u5206\u96e2\u306e\u4ed5\u7d44\u307f\u3011\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              \u30b5\u30d6\u30c9\u30e1\u30a4\u30f3\u5206\u96e2                                  \u2502\n\u2502                                                             \u2502\n\u2502  - \u30c6\u30ca\u30f3\u30c8\u3054\u3068\u306b\u72ec\u7acb\u3057\u305f\u30b5\u30d6\u30c9\u30e1\u30a4\u30f3 + Cloud Run functions     \u2502\n\u2502  - companya.example.co.jp \u2192 tenant-a \u95a2\u6570\u306e\u307f\u30a2\u30af\u30bb\u30b9      \u2502\n\u2502  - companyb.example.co.jp \u2192 tenant-b \u95a2\u6570\u306e\u307f\u30a2\u30af\u30bb\u30b9      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u5206\u96e2                                  \u2502\n\u2502                                                             \u2502\n\u2502  - \u30c6\u30ca\u30f3\u30c8\u3054\u3068\u306b\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u5206\u96e2                            \u2502\n\u2502  - tenant-a \u95a2\u6570 \u2192 tenant-a-* \u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u306e\u307f\u7d10\u4ed8\u3051        \u2502\n\u2502  - tenant-b \u95a2\u6570 \u2192 tenant-b-* \u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u306e\u307f\u7d10\u4ed8\u3051        \u2502\n\u2502  - \u4ed6\u30c6\u30ca\u30f3\u30c8\u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u306f\u53c2\u7167\u4e0d\u53ef                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u8a8d\u8a3c                              \u2502\n\u2502                                                             \u2502\n\u2502  - Firebase Auth \u3067\u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c                               \u2502\n\u2502  - \u30c6\u30ca\u30f3\u30c8\u3054\u3068\u306e\u8a31\u53ef\u30e6\u30fc\u30b6\u30fc\u30ea\u30b9\u30c8/\u30c9\u30e1\u30a4\u30f3\u3067\u5236\u5fa1              \u2502\n\u2502  - \u7570\u306a\u308b\u30c6\u30ca\u30f3\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u306f403\u62d2\u5426                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"gcp-firebase/01_design/#43","title":"4.3 \u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u30de\u30c8\u30ea\u30af\u30b9","text":"\u30ea\u30bd\u30fc\u30b9 \u672a\u8a8d\u8a3c\u30e6\u30fc\u30b6\u30fc \u8a8d\u8a3c\u6e08\u307f\uff08\u4ed6\u30c6\u30ca\u30f3\u30c8\uff09 \u8a8d\u8a3c\u6e08\u307f\uff08\u8a72\u5f53\u30c6\u30ca\u30f3\u30c8\uff09 Cloud Run functions\uff08\u30c6\u30ca\u30f3\u30c8A\uff09 \u62d2\u5426 \u62d2\u5426 \u8a31\u53ef Cloud Run functions\uff08\u30c6\u30ca\u30f3\u30c8B\uff09 \u62d2\u5426 \u62d2\u5426 \u8a31\u53ef Secret Manager\uff08tenant-a-*\uff09 \u62d2\u5426 \u62d2\u5426 \u8a31\u53ef\uff08\u95a2\u6570\u304b\u3089\u53c2\u7167\uff09 Secret Manager\uff08tenant-b-*\uff09 \u62d2\u5426 \u62d2\u5426 \u8a31\u53ef\uff08\u95a2\u6570\u304b\u3089\u53c2\u7167\uff09 GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u62d2\u5426 \u62d2\u5426 \u7ba1\u7406\u8005\u306e\u307f"},{"location":"gcp-firebase/01_design/#44","title":"4.4 \u901a\u4fe1\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3","text":"\u9805\u76ee \u8a2d\u5b9a \u30d7\u30ed\u30c8\u30b3\u30eb HTTPS\uff08TLS 1.2\u4ee5\u4e0a\uff09 \u8a3c\u660e\u66f8 Google\u7ba1\u7406\uff08\u81ea\u52d5\u767a\u884c\u30fb\u66f4\u65b0\uff09 HTTP \u2192 HTTPS \u81ea\u52d5\u30ea\u30c0\u30a4\u30ec\u30af\u30c8"},{"location":"gcp-firebase/01_design/#5","title":"5. \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210","text":""},{"location":"gcp-firebase/01_design/#51","title":"5.1 \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a","text":"<pre><code>                         \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\n                              \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502                     \u2502                     \u2502\n        \u25bc                     \u25bc                     \u25bc\n   companya.           companyb.            companyc.\n   example.co.jp    example.co.jp     example.co.jp\n        \u2502                     \u2502                     \u2502\n        \u2502 DNS (CNAME)         \u2502 DNS (CNAME)         \u2502 DNS (CNAME)\n        \u2502 + HTTPS (443)       \u2502 + HTTPS (443)       \u2502 + HTTPS (443)\n        \u25bc                     \u25bc                     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Cloud Run       \u2502  \u2502 Cloud Run       \u2502  \u2502 Cloud Run       \u2502\n\u2502 functions       \u2502  \u2502 functions       \u2502  \u2502 functions       \u2502\n\u2502 (tenant-a)      \u2502  \u2502 (tenant-b)      \u2502  \u2502 (tenant-c)      \u2502\n\u2502 asia-northeast1 \u2502  \u2502 asia-northeast1 \u2502  \u2502 asia-northeast1 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"gcp-firebase/01_design/#52","title":"5.2 \u30ea\u30fc\u30b8\u30e7\u30f3\u8a2d\u5b9a","text":"\u30b5\u30fc\u30d3\u30b9 \u30ea\u30fc\u30b8\u30e7\u30f3 \u7406\u7531 Cloud Run functions asia-northeast1\uff08\u6771\u4eac\uff09 \u65e5\u672c\u306e\u30e6\u30fc\u30b6\u30fc\u5411\u3051\u30ec\u30a4\u30c6\u30f3\u30b7\u6700\u5c0f\u5316 Secret Manager asia-northeast1 Cloud Run functions\u3068\u540c\u4e00\u30ea\u30fc\u30b8\u30e7\u30f3 Firebase Auth \u30b0\u30ed\u30fc\u30d0\u30eb Google\u7ba1\u7406"},{"location":"gcp-firebase/01_design/#6","title":"6. \u53ef\u7528\u6027\u30fb\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3","text":""},{"location":"gcp-firebase/01_design/#61","title":"6.1 \u53ef\u7528\u6027","text":"\u30b5\u30fc\u30d3\u30b9 SLA \u5197\u9577\u6027 Cloud Run functions 99.95% \u8907\u6570\u30be\u30fc\u30f3 Firebase Auth 99.95% Google\u7ba1\u7406 Secret Manager 99.95% \u30ea\u30fc\u30b8\u30e7\u30f3\u5185\u5197\u9577"},{"location":"gcp-firebase/01_design/#62","title":"6.2 \u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3","text":"\u30b5\u30fc\u30d3\u30b9 \u30b9\u30b1\u30fc\u30ea\u30f3\u30b0 \u5236\u9650 Cloud Run functions \u81ea\u52d5\uff080\u301c100\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9/\u95a2\u6570\uff09 \u30c6\u30ca\u30f3\u30c8\u3054\u3068\u306b\u8a2d\u5b9a\u53ef\u80fd \u30c6\u30ca\u30f3\u30c8\u8ffd\u52a0 \u624b\u52d5 \u95a2\u6570\u4f5c\u6210 + DNS\u8a2d\u5b9a"},{"location":"gcp-firebase/01_design/#7","title":"7. \u76e3\u8996\u30fb\u30ed\u30b0","text":""},{"location":"gcp-firebase/01_design/#71","title":"7.1 \u76e3\u8996\u9805\u76ee","text":"\u9805\u76ee \u30c4\u30fc\u30eb \u30a2\u30e9\u30fc\u30c8 \u30b5\u30fc\u30d3\u30b9\u7a3c\u50cd\u72b6\u6cc1 Cloud Monitoring \u30c0\u30a6\u30f3\u6642\u306b\u901a\u77e5 \u30a8\u30e9\u30fc\u7387 Cloud Logging 5%\u8d85\u904e\u3067\u901a\u77e5 \u30ec\u30a4\u30c6\u30f3\u30b7 Cloud Monitoring 3\u79d2\u8d85\u904e\u3067\u901a\u77e5 \u30b3\u30b9\u30c8 Billing \u30a2\u30e9\u30fc\u30c8 \u4e88\u7b97\u8d85\u904e\u3067\u901a\u77e5"},{"location":"gcp-firebase/01_design/#72","title":"7.2 \u30ed\u30b0","text":"\u30ed\u30b0\u7a2e\u5225 \u4fdd\u5b58\u5148 \u4fdd\u6301\u671f\u9593 \u30a2\u30af\u30bb\u30b9\u30ed\u30b0 Cloud Logging 30\u65e5 \u30a8\u30e9\u30fc\u30ed\u30b0 Cloud Logging 30\u65e5 \u8a8d\u8a3c\u30ed\u30b0 Cloud Logging 30\u65e5 \u76e3\u67fb\u30ed\u30b0 Cloud Audit Logs 400\u65e5"},{"location":"gcp-firebase/01_design/#8","title":"8. \u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30fb\u5fa9\u65e7","text":""},{"location":"gcp-firebase/01_design/#81","title":"8.1 \u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u5bfe\u8c61","text":"\u5bfe\u8c61 \u65b9\u6cd5 \u983b\u5ea6 \u95a2\u6570\u30b3\u30fc\u30c9 GitHub \u5909\u66f4\u306e\u305f\u3073\u306b\u81ea\u52d5 Cloud Run functions\u8a2d\u5b9a GCP\u8a2d\u5b9a\u30a8\u30af\u30b9\u30dd\u30fc\u30c8 \u67081\u56de\u63a8\u5968 Secret Manager \u30d0\u30fc\u30b8\u30e7\u30f3\u5c65\u6b74 \u81ea\u52d5"},{"location":"gcp-firebase/01_design/#82","title":"8.2 \u5fa9\u65e7\u624b\u9806","text":"\u30b7\u30ca\u30ea\u30aa \u5fa9\u65e7\u65b9\u6cd5 \u76ee\u6a19\u5fa9\u65e7\u6642\u9593 \u95a2\u6570\u969c\u5bb3 GitHub\u304b\u3089\u518d\u30c7\u30d7\u30ed\u30a4 5\u5206 Cloud Run functions\u969c\u5bb3 \u95a2\u6570\u518d\u4f5c\u6210 15\u5206 \u8a2d\u5b9a\u30df\u30b9 \u4ee5\u524d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u623b\u3059 10\u5206"},{"location":"gcp-firebase/01_design/#9","title":"9. \u30b3\u30b9\u30c8\u8a2d\u8a08","text":""},{"location":"gcp-firebase/01_design/#91","title":"9.1 \u6708\u984d\u8cbb\u7528\u898b\u7a4d\u3082\u308a\uff08\u30b5\u30d6\u30c9\u30e1\u30a4\u30f3\u65b9\u5f0f\uff09","text":"<p>\u57fa\u672c\u30a4\u30f3\u30d5\u30e9\u30b3\u30b9\u30c8\uff08\u30c6\u30ca\u30f3\u30c8\u6570\u306b\u95a2\u4fc2\u306a\u304f\u56fa\u5b9a\uff09: | \u30b5\u30fc\u30d3\u30b9 | \u6708\u984d\u76ee\u5b89 | \u5099\u8003 | |---------|---------|------| | Firebase Auth | $0 | \u67085\u4e07\u8a8d\u8a3c\u307e\u3067\u7121\u6599 | | Cloud Logging | $0\u301c5 | 50GB/\u6708\u307e\u3067\u7121\u6599 | | \u57fa\u672c\u30a4\u30f3\u30d5\u30e9\u5c0f\u8a08 | $0\u301c5/\u6708 | |</p> <p>\u30c6\u30ca\u30f3\u30c8\u3054\u3068\u306e\u8ffd\u52a0\u30b3\u30b9\u30c8: | \u30b5\u30fc\u30d3\u30b9 | \u6708\u984d\u76ee\u5b89/\u30c6\u30ca\u30f3\u30c8 | \u5099\u8003 | |---------|-----------------|------| | Cloud Run functions | $5\u301c30 | \u30ea\u30af\u30a8\u30b9\u30c8\u6570\u30fb\u5229\u7528\u91cf\u306b\u5fdc\u3058\u3066 | | Secret Manager | \u301c$1 | \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u6570\u306b\u5fdc\u3058\u3066 | | \u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3 | $0 | Cloud Run\u6a5f\u80fd\u3067\u7121\u6599 | | \u30c6\u30ca\u30f3\u30c8\u5c0f\u8a08 | $5\u301c31/\u30c6\u30ca\u30f3\u30c8 | |</p> <p>\u7dcf\u30b3\u30b9\u30c8\u898b\u7a4d\u3082\u308a: | \u30c6\u30ca\u30f3\u30c8\u6570 | \u6708\u984d\u76ee\u5b89 | \u65e7\u69cb\u6210\u3068\u306e\u6bd4\u8f03 | |-----------|---------|---------------| | 1\u30c6\u30ca\u30f3\u30c8 | $5\u301c36 | \u7d04$23\u7bc0\u7d04 | | 3\u30c6\u30ca\u30f3\u30c8 | $15\u301c98 | \u7d04$23\u7bc0\u7d04 | | 5\u30c6\u30ca\u30f3\u30c8 | $25\u301c160 | \u7d04$23\u7bc0\u7d04 | | 10\u30c6\u30ca\u30f3\u30c8 | $50\u301c315 | \u7d04$23\u7bc0\u7d04 |</p> <p>\u203b Load Balancer + Cloud Armor \u3092\u4f7f\u7528\u3057\u306a\u3044\u305f\u3081\u3001\u6708$23\u301c35\u306e\u30b3\u30b9\u30c8\u524a\u6e1b</p>"},{"location":"gcp-firebase/01_design/#92","title":"9.2 \u30b3\u30b9\u30c8\u6700\u9069\u5316","text":"<ul> <li>Cloud Run functions\u306e\u6700\u5c0f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u6570\u30920\u306b\u8a2d\u5b9a\uff08\u30b3\u30fc\u30eb\u30c9\u30b9\u30bf\u30fc\u30c8\u8a31\u5bb9\u6642\uff09</li> <li>\u30c6\u30ca\u30f3\u30c8\u3054\u3068\u306e\u5229\u7528\u91cf\u306b\u5fdc\u3058\u305f\u8a2d\u5b9a\u8abf\u6574</li> <li>\u4e0d\u8981\u306a\u30ed\u30b0\u306e\u524a\u9664</li> <li>\u4e88\u7b97\u30a2\u30e9\u30fc\u30c8\u306e\u8a2d\u5b9a\uff08\u30c6\u30ca\u30f3\u30c8\u3054\u3068 + \u5168\u4f53\uff09</li> </ul>"},{"location":"gcp-firebase/01_design/#10","title":"10. \u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8\u904b\u7528","text":""},{"location":"gcp-firebase/01_design/#101","title":"10.1 \u30c6\u30ca\u30f3\u30c8\u30aa\u30f3\u30dc\u30fc\u30c7\u30a3\u30f3\u30b0\u624b\u9806","text":"\u624b\u9806 \u4f5c\u696d\u5185\u5bb9 \u30c4\u30fc\u30eb \u96e3\u6613\u5ea6 1 Cloud Run functions \u95a2\u6570\u4f5c\u6210 GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u7c21\u5358 2 Secret Manager \u306bAPI\u30ad\u30fc\u767b\u9332 GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u7c21\u5358 3 \u95a2\u6570\u306b\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u7d10\u4ed8\u3051 GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u7c21\u5358 4 \u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\u3092\u30de\u30c3\u30d4\u30f3\u30b0 GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u7c21\u5358 5 DNS\u306bCNAME\u30ec\u30b3\u30fc\u30c9\u8ffd\u52a0 DNS\u7ba1\u7406\u753b\u9762 \u7c21\u5358 6 Firebase Auth \u3067\u8a31\u53ef\u8a2d\u5b9a Firebase \u30b3\u30f3\u30bd\u30fc\u30eb \u7c21\u5358 7 \u52d5\u4f5c\u78ba\u8a8d \u30d6\u30e9\u30a6\u30b6 \u7c21\u5358 <p>\u30dd\u30a4\u30f3\u30c8: Docker\u4e0d\u8981\u3001\u30b3\u30fc\u30c9\u3092\u76f4\u63a5\u5165\u529b\u3059\u308b\u3060\u3051\u306a\u306e\u3067\u975e\u30a8\u30f3\u30b8\u30cb\u30a2\u3067\u3082\u5bfe\u5fdc\u53ef\u80fd</p>"},{"location":"gcp-firebase/01_design/#102-gcp","title":"10.2 \u30c6\u30ca\u30f3\u30c8\u8ffd\u52a0\u306e\u8a73\u7d30\u624b\u9806\uff08GCP\u30b3\u30f3\u30bd\u30fc\u30eb\uff09","text":"<p>\u624b\u98061: Cloud Run functions \u95a2\u6570\u4f5c\u6210 1. GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u2192 Cloud Run \u2192\u300c\u95a2\u6570\u3092\u4f5c\u6210\u300d 2. \u95a2\u6570\u540d: <code>ai-platform-{tenant}</code>\uff08\u4f8b: ai-platform-companya\uff09 3. \u30ea\u30fc\u30b8\u30e7\u30f3: asia-northeast1\uff08\u6771\u4eac\uff09 4. \u8a8d\u8a3c: \u300c\u672a\u8a8d\u8a3c\u306e\u547c\u3073\u51fa\u3057\u3092\u8a31\u53ef\u300d\u306b\u30c1\u30a7\u30c3\u30af 5. \u30e9\u30f3\u30bf\u30a4\u30e0: Node.js 20 \u307e\u305f\u306f Python 3.11 \u3092\u9078\u629e 6. \u30b3\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u300c\u30c7\u30d7\u30ed\u30a4\u300d</p> <p>\u624b\u98062: Secret Manager \u8a2d\u5b9a 1. GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u2192 Secret Manager \u2192\u300c\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u4f5c\u6210\u300d 2. \u540d\u524d: <code>{tenant}-openai-key</code>\uff08\u4f8b: companya-openai-key\uff09 3. \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u5024: API\u30ad\u30fc\u3092\u5165\u529b 4.\u300c\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af</p> <p>\u624b\u98063: \u95a2\u6570\u306b\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u7d10\u4ed8\u3051 1. \u4f5c\u6210\u3057\u305f\u95a2\u6570 \u2192\u300c\u7de8\u96c6\u3057\u3066\u30c7\u30d7\u30ed\u30a4\u300d 2.\u300c\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u300d\u2192\u300c\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u53c2\u7167\u300d 3. \u74b0\u5883\u5909\u6570\u540d\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u8a2d\u5b9a 4.\u300c\u30c7\u30d7\u30ed\u30a4\u300d</p> <p>\u624b\u98064: \u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\u3092\u30de\u30c3\u30d4\u30f3\u30b0 1. \u4f5c\u6210\u3057\u305f\u95a2\u6570\u3092\u958b\u304f 2.\u300c\u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\u3092\u30de\u30c3\u30d4\u30f3\u30b0\u300d\u3092\u30af\u30ea\u30c3\u30af 3. \u30c9\u30e1\u30a4\u30f3: <code>{tenant}.example.co.jp</code> \u3092\u5165\u529b 4. \u8868\u793a\u3055\u308c\u308bCNAME\u30ec\u30b3\u30fc\u30c9\u60c5\u5831\u3092\u30e1\u30e2</p> <p>\u624b\u98065: DNS\u8a2d\u5b9a 1. \u30c9\u30e1\u30a4\u30f3\u7ba1\u7406\u753b\u9762\uff08\u304a\u540d\u524d.com\u7b49\uff09\u3092\u958b\u304f 2. CNAME\u30ec\u30b3\u30fc\u30c9\u3092\u8ffd\u52a0:    - \u30db\u30b9\u30c8\u540d: <code>{tenant}</code>\uff08\u4f8b: companya\uff09    - \u5024: Cloud Run\u304c\u8868\u793a\u3057\u305fCNAME\u5148 3. \u53cd\u6620\u307e\u3067\u6570\u5206\u301c\u6570\u6642\u9593\u5f85\u3064</p>"},{"location":"gcp-firebase/01_design/#103","title":"10.3 \u30c6\u30ca\u30f3\u30c8\u7ba1\u7406\u53f0\u5e33\uff08\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u4f8b\uff09","text":"\u30c6\u30ca\u30f3\u30c8ID \u4f1a\u793e\u540d \u30b5\u30d6\u30c9\u30e1\u30a4\u30f3 \u95a2\u6570\u540d \u8a31\u53ef\u30c9\u30e1\u30a4\u30f3 \u5229\u7528AI \u5951\u7d04\u958b\u59cb\u65e5 \u30b9\u30c6\u30fc\u30bf\u30b9 tenant-a A\u682a\u5f0f\u4f1a\u793e companya.example.co.jp ai-platform-tenant-a @a-company.co.jp Dify 2025/01/01 \u7a3c\u50cd\u4e2d tenant-b B\u682a\u5f0f\u4f1a\u793e companyb.example.co.jp ai-platform-tenant-b @b-company.co.jp Vertex AI 2025/02/01 \u7a3c\u50cd\u4e2d"},{"location":"gcp-firebase/01_design/#11_1","title":"11. \u4eca\u5f8c\u306e\u62e1\u5f35","text":""},{"location":"gcp-firebase/01_design/#111","title":"11.1 \u8ffd\u52a0\u53ef\u80fd\u306a\u6a5f\u80fd","text":"\u6a5f\u80fd \u30b5\u30fc\u30d3\u30b9 \u7528\u9014 \u512a\u5148\u5ea6 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9 Cloud SQL / Firestore \u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u30fb\u5c65\u6b74\u306e\u6c38\u7d9a\u5316 \u9ad8 \u30d5\u30a1\u30a4\u30eb\u4fdd\u5b58 Cloud Storage \u5927\u5bb9\u91cf\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9 \u4e2d CI/CD Cloud Build \u30c6\u30ca\u30f3\u30c8\u8ffd\u52a0\u306e\u81ea\u52d5\u5316 \u4e2d \u76e3\u8996\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9 Cloud Monitoring \u30c6\u30ca\u30f3\u30c8\u5225\u306e\u5229\u7528\u72b6\u6cc1\u53ef\u8996\u5316 \u4f4e"},{"location":"gcp-firebase/01_design/#112","title":"11.2 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5f37\u5316\u30aa\u30d7\u30b7\u30e7\u30f3","text":"\u72b6\u6cc1 \u5bfe\u5fdc\u7b56 \u8ffd\u52a0\u30b3\u30b9\u30c8 WAF/DDoS\u4fdd\u8b77\u304c\u5fc5\u8981 Load Balancer + Cloud Armor \u3092\u8ffd\u52a0 \u6708$23\u301c35 \u3088\u308a\u53b3\u683c\u306a\u30a2\u30af\u30bb\u30b9\u5236\u5fa1 IAP\uff08Identity-Aware Proxy\uff09\u3092\u8ffd\u52a0 \u6708$0\u301c5"},{"location":"gcp-firebase/01_design/#113","title":"11.3 \u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u6642\u306e\u8003\u616e\u4e8b\u9805","text":"\u72b6\u6cc1 \u5bfe\u5fdc\u7b56 \u30c6\u30ca\u30f3\u30c8\u6570\u304c50\u4ee5\u4e0a\u306b\u5897\u52a0 Terraform\u7b49\u3067\u306eIaC\u5316\u3092\u691c\u8a0e \u7279\u5b9a\u30c6\u30ca\u30f3\u30c8\u306e\u9ad8\u8ca0\u8377 \u95a2\u6570\u306e\u30ea\u30bd\u30fc\u30b9\u5897\u5f37 \u30b0\u30ed\u30fc\u30d0\u30eb\u5c55\u958b \u8907\u6570\u30ea\u30fc\u30b8\u30e7\u30f3\u3078\u306e\u5c55\u958b \u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u8981\u4ef6\u5f37\u5316 GCP\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u5206\u96e2\u3078\u306e\u79fb\u884c"},{"location":"gcp-firebase/02_setup/","title":"GCP\u74b0\u5883 \u69cb\u7bc9\u624b\u9806\u66f8","text":"\u9805\u76ee \u5185\u5bb9 \u5bfe\u8c61\u8005 \u975e\u30a8\u30f3\u30b8\u30cb\u30a2 \u4f5c\u696d\u6642\u9593 \u7d041\u301c2\u6642\u9593"},{"location":"gcp-firebase/02_setup/#_1","title":"\u4e8b\u524d\u6e96\u5099\u30c1\u30a7\u30c3\u30af","text":"\u30c1\u30a7\u30c3\u30af \u9805\u76ee \u2610 Google\u30a2\u30ab\u30a6\u30f3\u30c8\uff08\u7ba1\u7406\u8005\u6a29\u9650\uff09 \u2610 \u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\uff08GCP\u8ab2\u91d1\u7528\uff09 \u2610 AI\u306eAPI\u30ad\u30fc\uff08OpenAI\u7b49\uff09"},{"location":"gcp-firebase/02_setup/#_2","title":"\u5168\u4f53\u69cb\u6210","text":""},{"location":"gcp-firebase/02_setup/#_3","title":"\u4ed5\u7d44\u307f\u306e\u6982\u8981","text":"<pre><code>\u3042\u306a\u305f\uff08\u30d6\u30e9\u30a6\u30b6\uff09\n    |\n    | (1) \u30a2\u30af\u30bb\u30b9\n    v\nCloud Run functions\n    |\n    | (2) \u30ed\u30b0\u30a4\u30f3\u3057\u3066\u308b\uff1f\n    v\nFirebase Auth\uff08\u8a8d\u8a3c\uff09 \u2190\u2500\u2500 Google\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ed\u30b0\u30a4\u30f3\n    |\n    | (3) \u30ed\u30b0\u30a4\u30f3\u6e08\u307f\u306a\u3089OK\n    v\nCloud Run functions\n    |\n    | (4) API\u30ad\u30fc\u3092\u53d6\u5f97\n    v\nSecret Manager\uff08\u9375\u306e\u91d1\u5eab\uff09\n    |\n    | (5) AI \u306b\u8cea\u554f\n    v\nOpenAI API\uff08ChatGPT\uff09\n    |\n    | (6) \u56de\u7b54\n    v\n\u3042\u306a\u305f\uff08\u30d6\u30e9\u30a6\u30b6\uff09\u306b\u8868\u793a\n</code></pre>"},{"location":"gcp-firebase/02_setup/#_4","title":"\u4f55\u3092\u4f5c\u308b\u304b","text":"\u4f5c\u308b\u3082\u306e \u5f79\u5272 \u500b\u6570 Firebase \u30d7\u30ed\u30b8\u30a7\u30af\u30c8 Google\u30ed\u30b0\u30a4\u30f3\u8a8d\u8a3c 1\u3064 Cloud Run functions \u30c1\u30e3\u30c3\u30c8\u753b\u9762\u306e\u8868\u793a + AI\u547c\u3073\u51fa\u3057 1\u3064 Secret Manager \u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8 API\u30ad\u30fc\u306e\u4fdd\u7ba1 1\u3064"},{"location":"gcp-firebase/02_setup/#_5","title":"\u306a\u305c\u3053\u306e\u69cb\u6210\uff1f","text":"\u7279\u5fb4 \u8aac\u660e \u8a8d\u8a3c\u3042\u308a Google\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u4eba\u3060\u3051\u4f7f\u3048\u308b \u30b7\u30f3\u30d7\u30eb \u4f5c\u6210\u3059\u308b\u306e\u306f3\u3064\u3060\u3051 \u5b89\u5168 API\u30ad\u30fc\u306f\u6697\u53f7\u5316\u3057\u3066\u4fdd\u7ba1\uff08\u30b3\u30fc\u30c9\u306b\u66f8\u304b\u306a\u3044\uff09 \u7121\u6599\u67a0\u3042\u308a \u5c11\u91cf\u30a2\u30af\u30bb\u30b9\u306a\u3089\u7121\u6599\u67a0\u5185\u3067\u904b\u7528\u53ef\u80fd <p>\u30b3\u30b9\u30c8\u306b\u3064\u3044\u3066</p> \u30b5\u30fc\u30d3\u30b9 \u7121\u6599\u67a0 \u8d85\u904e\u6642\u306e\u8ab2\u91d1 Firebase Auth \u67085\u4e07\u8a8d\u8a3c\u307e\u3067\u7121\u6599 \u307b\u307c\u7121\u6599\u3067\u53ce\u307e\u308b Cloud Run functions \u6708200\u4e07\u30ea\u30af\u30a8\u30b9\u30c8\u307e\u3067\u7121\u6599 \u30ea\u30af\u30a8\u30b9\u30c8\u6570\u306b\u5fdc\u3058\u3066\u8ab2\u91d1 Secret Manager \u67086\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30fb6,000\u30a2\u30af\u30bb\u30b9\u307e\u3067\u7121\u6599 \u5fae\u91cf\u8ab2\u91d1 OpenAI API \u7121\u6599\u67a0\u306a\u3057 \u5229\u7528\u91cf\u306b\u5fdc\u3058\u3066\u8ab2\u91d1 <p>\u6ce8\u610f: Firebase/GCP\u306f\u7121\u6599\u67a0\u304c\u3042\u308a\u307e\u3059\u304c\u3001OpenAI\u7b49\u306e\u5916\u90e8AI API\u306f\u5f93\u91cf\u8ab2\u91d1\u3067\u3059\u3002 \u30c6\u30b9\u30c8\u6bb5\u968e\u3067\u306f\u6570\u5186\u301c\u6570\u5341\u5186\u7a0b\u5ea6\u3067\u3059\u304c\u3001\u672c\u756a\u904b\u7528\u6642\u306fAPI\u5229\u7528\u6599\u91d1\u304c\u767a\u751f\u3057\u307e\u3059\u3002</p>"},{"location":"gcp-firebase/02_setup/#step-1-firebase15","title":"Step 1: Firebase\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\uff0815\u5206\uff09","text":"<p>Firebase\u3068GCP\u306e\u95a2\u4fc2</p> <p>Firebase\u3067\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3059\u308b\u3068\u3001GCP\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3082\u81ea\u52d5\u7684\u306b\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002 \u5225\u3005\u306b\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002</p> <pre><code>Firebase\u3067\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\n    \u2193\n\u81ea\u52d5\u7684\u306bGCP\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3082\u4f5c\u6210\u3055\u308c\u308b\n    \u2193\n\u4e21\u65b9\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u540c\u3058\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u64cd\u4f5c\u3067\u304d\u308b\n</code></pre> \u30b3\u30f3\u30bd\u30fc\u30eb URL \u7528\u9014 Firebase console.firebase.google.com \u8a8d\u8a3c\uff08Auth\uff09\u3001\u30a6\u30a7\u30d6\u30a2\u30d7\u30ea\u8a2d\u5b9a GCP console.cloud.google.com Cloud Run functions\u3001Secret Manager"},{"location":"gcp-firebase/02_setup/#1-1-firebase","title":"1-1. Firebase\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210","text":"<ol> <li>https://console.firebase.google.com \u306b\u30a2\u30af\u30bb\u30b9</li> <li>Google\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ed\u30b0\u30a4\u30f3</li> <li>\u300c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af</li> </ol> <p>\u300c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u8ffd\u52a0\u300d\u3068\u8868\u793a\u3055\u308c\u308b\u5834\u5408 \u65e2\u306bFirebase\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u304c\u3042\u308b\u5834\u5408\u306f\u300c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u8ffd\u52a0\u300d\u3068\u8868\u793a\u3055\u308c\u307e\u3059\u3002 \u3069\u3061\u3089\u3082\u540c\u3058\u64cd\u4f5c\u3067\u3059\u3002</p> <ol> <li>\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d\u3092\u5165\u529b\uff08\u4f8b: <code>ai-chat-app</code>\uff09</li> <li>\u3053\u306e\u540d\u524d\u304cGCP\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d\u306b\u3082\u306a\u308a\u307e\u3059</li> <li> <p>\u30d7\u30ed\u30b8\u30a7\u30af\u30c8ID\u306f\u81ea\u52d5\u751f\u6210\u3055\u308c\u307e\u3059\uff08\u4f8b: <code>ai-chat-app-89fe2</code>\uff09</p> </li> <li> <p>\u300c\u7d9a\u884c\u300d\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li> <p>Google\u30a2\u30ca\u30ea\u30c6\u30a3\u30af\u30b9: \u4eca\u56de\u306f\u300c\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067Google\u30a2\u30ca\u30ea\u30c6\u30a3\u30af\u30b9\u3092\u6709\u52b9\u306b\u3059\u308b\u300d\u3092\u30aa\u30d5\u306b\u3059\u308b</p> </li> <li>\u30c6\u30b9\u30c8\u74b0\u5883\u3067\u306f\u4e0d\u8981\u3067\u3059</li> <li> <p>\u5f8c\u304b\u3089\u6709\u52b9\u5316\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059</p> </li> <li> <p>\u300c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li> <p>\u300c\u65b0\u3057\u3044\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u6e96\u5099\u304c\u3067\u304d\u307e\u3057\u305f\u300d\u3068\u8868\u793a\u3055\u308c\u305f\u3089\u300c\u7d9a\u884c\u300d\u3092\u30af\u30ea\u30c3\u30af</p> </li> </ol>"},{"location":"gcp-firebase/02_setup/#1-2-id","title":"1-2. \u30d7\u30ed\u30b8\u30a7\u30af\u30c8ID\u306e\u78ba\u8a8d","text":"<p>\u4f5c\u6210\u5f8c\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8ID\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\uff08\u5f8c\u3067\u4f7f\u7528\u3057\u307e\u3059\uff09\u3002</p> <ol> <li>\u5de6\u4e0a\u306e\u6b6f\u8eca\u30a2\u30a4\u30b3\u30f3\uff08\u2699\ufe0f\uff09\u3092\u30af\u30ea\u30c3\u30af</li> <li>\u300c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u8a2d\u5b9a\u300d\u3092\u30af\u30ea\u30c3\u30af</li> <li>\u4ee5\u4e0b\u306e\u60c5\u5831\u3092\u30e1\u30e2\u3057\u3066\u304a\u304f:</li> </ol> \u9805\u76ee \u4f8b \u7528\u9014 \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d <code>ai-chat-app</code> \u8868\u793a\u540d \u30d7\u30ed\u30b8\u30a7\u30af\u30c8ID <code>ai-chat-app-89fe2</code> GCP\u3067\u306e\u8b58\u5225\u306b\u4f7f\u7528 <p>GCP\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u306e\u78ba\u8a8d\u65b9\u6cd5</p> <p>https://console.cloud.google.com \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001 \u753b\u9762\u4e0a\u90e8\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u9078\u629e\u3067\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\uff08\u4f8b: <code>ai-chat-app-89fe2</code>\uff09\u304c \u8868\u793a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"gcp-firebase/02_setup/#step-2-firebase-authentication10","title":"Step 2: Firebase Authentication\u8a2d\u5b9a\uff0810\u5206\uff09","text":"<p>Firebase Auth\u3068\u306f\uff1f Google\u304c\u63d0\u4f9b\u3059\u308b\u8a8d\u8a3c\u30b5\u30fc\u30d3\u30b9\u3067\u3059\u3002 \u300cGoogle\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ed\u30b0\u30a4\u30f3\u300d\u30dc\u30bf\u30f3\u3092\u7c21\u5358\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p> \u30e1\u30ea\u30c3\u30c8 \u8aac\u660e \u7c21\u5358 \u6570\u884c\u306e\u30b3\u30fc\u30c9\u3067\u30ed\u30b0\u30a4\u30f3\u6a5f\u80fd\u304c\u5b8c\u6210 \u5b89\u5168 \u30d1\u30b9\u30ef\u30fc\u30c9\u7ba1\u7406\u306fGoogle\u306b\u304a\u4efb\u305b \u7121\u6599 \u67085\u4e07\u4eba\u307e\u3067\u7121\u6599"},{"location":"gcp-firebase/02_setup/#2-1-authentication","title":"2-1. Authentication\u6709\u52b9\u5316","text":"<ol> <li>Firebase\u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u5de6\u30e1\u30cb\u30e5\u30fc\u304b\u3089\u300c\u69cb\u7bc9\u300d\u3092\u5c55\u958b</li> <li>\u300cAuthentication\u300d\u3092\u30af\u30ea\u30c3\u30af</li> <li>\u300c\u59cb\u3081\u308b\u300d\u3092\u30af\u30ea\u30c3\u30af</li> </ol> <p>\u753b\u9762\u304c\u7570\u306a\u308b\u5834\u5408 \u65e2\u306bAuthentication\u304c\u6709\u52b9\u306a\u5834\u5408\u306f\u300c\u59cb\u3081\u308b\u300d\u30dc\u30bf\u30f3\u306f\u8868\u793a\u3055\u308c\u307e\u305b\u3093\u3002 \u305d\u306e\u5834\u5408\u306f\u6b21\u306e\u624b\u9806\u306b\u9032\u3093\u3067\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"gcp-firebase/02_setup/#2-2-google","title":"2-2. Google\u30ed\u30b0\u30a4\u30f3\u3092\u6709\u52b9\u5316","text":"<ol> <li>\u300c\u30ed\u30b0\u30a4\u30f3\u65b9\u6cd5\u300d\u30bf\u30d6\u3092\u30af\u30ea\u30c3\u30af</li> <li>\u300c\u65b0\u3057\u3044\u30d7\u30ed\u30d0\u30a4\u30c0\u3092\u8ffd\u52a0\u300d\u3092\u30af\u30ea\u30c3\u30af</li> <li> <p>\u300cGoogle\u300d\u3092\u9078\u629e</p> </li> <li> <p>\u4ee5\u4e0b\u3092\u8a2d\u5b9a:    | \u9805\u76ee | \u8a2d\u5b9a |    |------|------|    | \u6709\u52b9\u306b\u3059\u308b | \u30aa\u30f3\uff08\u30c8\u30b0\u30eb\u3092\u30af\u30ea\u30c3\u30af\uff09 |    | \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30b5\u30dd\u30fc\u30c8\u30e1\u30fc\u30eb | \u81ea\u5206\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u9078\u629e |</p> </li> <li> <p>\u300c\u4fdd\u5b58\u300d\u3092\u30af\u30ea\u30c3\u30af</p> </li> </ol> <p>\u8a2d\u5b9a\u5b8c\u4e86\u5f8c\u306e\u753b\u9762</p> \u30d7\u30ed\u30d0\u30a4\u30c0 \u30b9\u30c6\u30fc\u30bf\u30b9 Google \u6709\u52b9 <p>\u3068\u8868\u793a\u3055\u308c\u3066\u3044\u308c\u3070OK\u3067\u3059\u3002</p>"},{"location":"gcp-firebase/02_setup/#2-3","title":"2-3. \u30a6\u30a7\u30d6\u30a2\u30d7\u30ea\u3092\u767b\u9332","text":"<p>Firebase\u8a2d\u5b9a\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u3001\u30a6\u30a7\u30d6\u30a2\u30d7\u30ea\u3092\u767b\u9332\u3057\u307e\u3059\u3002</p> <ol> <li>\u5de6\u4e0a\u306e\u5bb6\u30a2\u30a4\u30b3\u30f3\uff08\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u6982\u8981\uff09\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u30c8\u30c3\u30d7\u30da\u30fc\u30b8\u306b\u623b\u308b</li> <li>\u300c\uff0b \u30a2\u30d7\u30ea\u3092\u8ffd\u52a0\u300d\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af</li> </ol> <p>\u300c\uff0b \u30a2\u30d7\u30ea\u3092\u8ffd\u52a0\u300d\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u5834\u5408 \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u6982\u8981\u30da\u30fc\u30b8\u3067\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d\u306e\u4e0b\u306b \u300c\u30a2\u30d7\u30ea\u3092\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u300d\u3068\u3044\u3046\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u3042\u308a\u307e\u3059\u3002 \u305d\u3053\u304b\u3089\u8ffd\u52a0\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002</p> <ol> <li> <p>\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u306e\u9078\u629e\u753b\u9762\u3067\u300c\u30a6\u30a7\u30d6\u300d\uff08\u30a6\u30a7\u30d6\u30a2\u30a4\u30b3\u30f3\uff09\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li> <p>\u30a2\u30d7\u30ea\u60c5\u5831\u3092\u5165\u529b:    | \u9805\u76ee | \u5165\u529b\u5024 |    |------|--------|    | \u30a2\u30d7\u30ea\u306e\u30cb\u30c3\u30af\u30cd\u30fc\u30e0 | <code>ai-chat-web</code>\uff08\u4efb\u610f\u306e\u540d\u524d\uff09 |    | Firebase Hosting | \u30c1\u30a7\u30c3\u30af\u3057\u306a\u3044\uff08\u4eca\u56de\u306f\u4e0d\u8981\uff09 |</p> </li> </ol> <p>Firebase Hosting \u3068\u306f\uff1f Firebase\u304c\u63d0\u4f9b\u3059\u308b\u9759\u7684\u30a6\u30a7\u30d6\u30b5\u30a4\u30c8\u306e\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u30b5\u30fc\u30d3\u30b9\u3067\u3059\u3002 HTML/CSS/JavaScript\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u304f\u3060\u3051\u3067\u30a6\u30a7\u30d6\u30b5\u30a4\u30c8\u3092\u516c\u958b\u3067\u304d\u307e\u3059\u3002 \u4eca\u56de\u306fCloud Run functions\u3067\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3082\u914d\u4fe1\u3059\u308b\u305f\u3081\u3001Firebase Hosting\u306f\u4f7f\u7528\u3057\u307e\u305b\u3093\u3002</p> <ol> <li> <p>\u300c\u30a2\u30d7\u30ea\u3092\u767b\u9332\u300d\u3092\u30af\u30ea\u30c3\u30af</p> </li> <li> <p>\u300cFirebase SDK \u306e\u8ffd\u52a0\u300d\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059</p> </li> <li>\u8868\u793a\u3055\u308c\u308b <code>firebaseConfig</code> \u306e\u5185\u5bb9\u3092\u30e1\u30e2\u307e\u305f\u306f\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304f</li> </ol> <p>SDK\uff08\u30a8\u30b9\u30c7\u30a3\u30fc\u30b1\u30fc\uff09\u3068\u306f\uff1f Software Development Kit\u306e\u7565\u3067\u3001\u300c\u958b\u767a\u7528\u306e\u9053\u5177\u30bb\u30c3\u30c8\u300d\u3068\u3044\u3046\u610f\u5473\u3067\u3059\u3002 Firebase\u306e\u6a5f\u80fd\uff08\u30ed\u30b0\u30a4\u30f3\u6a5f\u80fd\u306a\u3069\uff09\u3092\u30a2\u30d7\u30ea\u304b\u3089\u7c21\u5358\u306b\u4f7f\u3046\u305f\u3081\u306e\u90e8\u54c1\u96c6\u3067\u3059\u3002 \u3053\u3053\u3067\u8868\u793a\u3055\u308c\u308b <code>firebaseConfig</code> \u306f\u3001\u3042\u306a\u305f\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u5c02\u7528\u306e\u63a5\u7d9a\u60c5\u5831\u3067\u3059\u3002</p> <pre><code>// \u3053\u306e\u60c5\u5831\u306f\u5f8c\u3067\u30b3\u30fc\u30c9\u306b\u8cbc\u308a\u4ed8\u3051\u307e\u3059\uff08\u5024\u306f\u5404\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u7570\u306a\u308a\u307e\u3059\uff09\nconst firebaseConfig = {\n  apiKey: \"AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\",\n  authDomain: \"ai-chat-app-89fe2.firebaseapp.com\",\n  projectId: \"ai-chat-app-89fe2\",\n  storageBucket: \"ai-chat-app-89fe2.appspot.com\",\n  messagingSenderId: \"123456789012\",\n  appId: \"1:123456789012:web:xxxxxxxxxxxxxxxxxx\"\n};\n</code></pre> <ol> <li>\u300c\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u9032\u3080\u300d\u3092\u30af\u30ea\u30c3\u30af</li> </ol> <p>\u5f8c\u304b\u3089firebaseConfig\u3092\u78ba\u8a8d\u3059\u308b\u65b9\u6cd5</p> <ol> <li>\u6b6f\u8eca\u30a2\u30a4\u30b3\u30f3\uff08\u2699\ufe0f\uff09\u2192\u300c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u8a2d\u5b9a\u300d</li> <li>\u300c\u5168\u822c\u300d\u30bf\u30d6\u306e\u4e0b\u90e8\u300c\u30de\u30a4\u30a2\u30d7\u30ea\u300d\u30bb\u30af\u30b7\u30e7\u30f3</li> <li>\u767b\u9332\u3057\u305f\u30a6\u30a7\u30d6\u30a2\u30d7\u30ea\u3092\u30af\u30ea\u30c3\u30af</li> <li>\u300cSDK \u306e\u8a2d\u5b9a\u3068\u69cb\u6210\u300d\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059</li> </ol>"},{"location":"gcp-firebase/02_setup/#step-3-gcp-api5","title":"Step 3: GCP API\u6709\u52b9\u5316\uff085\u5206\uff09","text":"<p>Cloud Run functions\u3068Secret Manager\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\u306b\u3001GCP\u3067\u5fc5\u8981\u306aAPI\u3092\u6709\u52b9\u5316\u3057\u307e\u3059\u3002</p>"},{"location":"gcp-firebase/02_setup/#3-1-gcp","title":"3-1. GCP\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u30a2\u30af\u30bb\u30b9","text":"<ol> <li>https://console.cloud.google.com \u306b\u30a2\u30af\u30bb\u30b9</li> <li>\u753b\u9762\u4e0a\u90e8\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u9078\u629e\u3067\u3001Firebase\u3067\u4f5c\u6210\u3057\u305f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u9078\u629e</li> <li>\u4f8b: <code>ai-chat-app-89fe2</code></li> </ol> <p>\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u5834\u5408 \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u9078\u629e\u753b\u9762\u3067\u300c\u3059\u3079\u3066\u300d\u30bf\u30d6\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002 Firebase\u3067\u4f5c\u6210\u3057\u305f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306f\u81ea\u52d5\u7684\u306bGCP\u306b\u3082\u8868\u793a\u3055\u308c\u307e\u3059\u3002</p>"},{"location":"gcp-firebase/02_setup/#3-2-api","title":"3-2. API\u6709\u52b9\u5316","text":"<ol> <li>\u5de6\u30e1\u30cb\u30e5\u30fc\u300cAPI\u3068\u30b5\u30fc\u30d3\u30b9\u300d\u2192\u300c\u30e9\u30a4\u30d6\u30e9\u30ea\u300d\u3092\u30af\u30ea\u30c3\u30af</li> <li>\u4ee5\u4e0b\u306eAPI\u3092\u305d\u308c\u305e\u308c\u691c\u7d22\u3057\u3066\u6709\u52b9\u5316:</li> </ol> API\u540d \u691c\u7d22\u30ef\u30fc\u30c9 \u7528\u9014 Cloud Run Admin API <code>Cloud Run</code> Cloud Run functions\u306e\u4f5c\u6210\u30fb\u7ba1\u7406 Cloud Build API <code>Cloud Build</code> \u30b3\u30fc\u30c9\u306e\u30d3\u30eb\u30c9 Secret Manager API <code>Secret Manager</code> API\u30ad\u30fc\u306e\u5b89\u5168\u306a\u4fdd\u7ba1 <p>\u5404API\u306e\u6709\u52b9\u5316\u624b\u9806: 1. \u691c\u7d22\u30d0\u30fc\u306bAPI\u540d\u3092\u5165\u529b 2. \u691c\u7d22\u7d50\u679c\u304b\u3089API\u3092\u30af\u30ea\u30c3\u30af 3. \u300c\u6709\u52b9\u306b\u3059\u308b\u300d\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af 4. \u6709\u52b9\u5316\u304c\u5b8c\u4e86\u3059\u308b\u307e\u3067\u5f85\u3064\uff08\u6570\u79d2\u301c1\u5206\u7a0b\u5ea6\uff09</p> <p>\u65e2\u306b\u6709\u52b9\u306a\u5834\u5408 \u300c\u6709\u52b9\u306b\u3059\u308b\u300d\u3067\u306f\u306a\u304f\u300c\u7ba1\u7406\u300d\u3068\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u65e2\u306b\u6709\u52b9\u3067\u3059\u3002 \u4f55\u3082\u305b\u305a\u6b21\u306eAPI\u306b\u9032\u3093\u3067\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"gcp-firebase/02_setup/#step-4-secret-manager10","title":"Step 4: Secret Manager\u8a2d\u5b9a\uff0810\u5206\uff09","text":""},{"location":"gcp-firebase/02_setup/#4-1-api","title":"4-1. API\u30ad\u30fc\u4fdd\u5b58","text":"<p>Secret Manager\u3068\u306f\uff1f AI\u30b5\u30fc\u30d3\u30b9\uff08OpenAI\u7b49\uff09\u306eAPI\u30ad\u30fc\u3092\u5b89\u5168\u306b\u6697\u53f7\u5316\u3057\u3066\u4fdd\u7ba1\u3059\u308b\u305f\u3081\u306e\u30b5\u30fc\u30d3\u30b9\u3067\u3059\u3002</p> \u4fdd\u5b58\u65b9\u6cd5 \u554f\u984c\u70b9 \u30b3\u30fc\u30c9\u306b\u76f4\u63a5\u66f8\u304f GitHub\u306b\u6f0f\u6d29 \u2192 \u4e0d\u6b63\u5229\u7528\u3067\u9ad8\u984d\u8acb\u6c42 \u74b0\u5883\u5909\u6570\u306b\u76f4\u63a5\u8a2d\u5b9a GCP\u30b3\u30f3\u30bd\u30fc\u30eb\u753b\u9762\u306b\u5e73\u6587\u3067\u4e38\u898b\u3048 Secret Manager \u6697\u53f7\u5316\u4fdd\u5b58 + \u30a2\u30af\u30bb\u30b9\u6a29\u9650\u7ba1\u7406 <ol> <li>GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u2192\u300cSecret Manager\u300d\u2192\u300c\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u4f5c\u6210\u300d</li> <li>\u540d\u524d: <code>openai-api-key</code></li> <li>\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u306e\u5024: OpenAI\u306eAPI\u30ad\u30fc\u3092\u5165\u529b</li> <li>\u300c\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u4f5c\u6210\u300d</li> </ol> <p>\u3010\u547d\u540d\u898f\u5247\u306e\u63a8\u5968\u3011\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8\u904b\u7528\u6642</p> <p>\u8907\u6570\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\uff08\u30c6\u30ca\u30f3\u30c8\uff09\u3092\u7ba1\u7406\u3059\u308b\u5834\u5408\u3001\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u540d\u306b\u30c6\u30ca\u30f3\u30c8ID\u3092\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3068\u3057\u3066\u4ed8\u3051\u308b\u3053\u3068\u3092\u5f37\u304f\u63a8\u5968\u3057\u307e\u3059\u3002</p> \u69cb\u6210 \u547d\u540d\u898f\u5247 \u4f8b \u30b7\u30f3\u30b0\u30eb\u30c6\u30ca\u30f3\u30c8\uff081\u793e\u306e\u307f\uff09 <code>{\u7528\u9014}</code> <code>openai-api-key</code> \u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8\uff08\u8907\u6570\u793e\uff09 <code>{\u30c6\u30ca\u30f3\u30c8ID}-{\u7528\u9014}</code> <code>companya-openai-key</code> <pre><code>\u3010\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8\u306e\u5834\u5408\u306eSecret Manager\u4e00\u89a7\u3011\n\ncompanya-openai-key      \u2190 A\u793e\u7528\u306eOpenAI API\u30ad\u30fc\ncompanya-anthropic-key   \u2190 A\u793e\u7528\u306eAnthropic API\u30ad\u30fc\ncompanyb-openai-key      \u2190 B\u793e\u7528\u306eOpenAI API\u30ad\u30fc\ncompanyc-dify-key        \u2190 C\u793e\u7528\u306eDify API\u30ad\u30fc\n\n\u2192 \u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3067\u3069\u306e\u30c6\u30ca\u30f3\u30c8\u304b\u4e00\u76ee\u77ad\u7136\uff01\n</code></pre> <p>\u306a\u305c\u547d\u540d\u898f\u5247\u304c\u91cd\u8981\u304b\uff1f - \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u304c\u5897\u3048\u308b\u3068\u300c\u3069\u308c\u304c\u3069\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u7528\u304b\u300d\u304c\u5206\u304b\u3089\u306a\u304f\u306a\u308b - \u8aa4\u3063\u3066\u5225\u30c6\u30ca\u30f3\u30c8\u306eAPI\u30ad\u30fc\u3092\u7d10\u4ed8\u3051\u308b\u30ea\u30b9\u30af\u3092\u9632\u6b62 - \u7ba1\u7406\u753b\u9762\u3067\u306e\u691c\u7d22\u30fb\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u304c\u5bb9\u6613\u306b\u306a\u308b</p> <p>\u3010\u30c6\u30b9\u30c8\u74b0\u5883\u306e\u5834\u5408\u3011 \u5b9f\u969b\u306eAPI\u30ad\u30fc\u304c\u306a\u3044\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u30c0\u30df\u30fc\u5024\u3067\u624b\u9806\u3092\u7df4\u7fd2\u3067\u304d\u307e\u3059\uff1a <pre><code>sk-test-dummy-key-12345\n</code></pre> \u203b \u30c0\u30df\u30fc\u5024\u3067\u306fAI\u6a5f\u80fd\u306f\u52d5\u4f5c\u3057\u307e\u305b\u3093\u304c\u3001\u74b0\u5883\u69cb\u7bc9\u306e\u624b\u9806\u78ba\u8a8d\u306b\u306f\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"gcp-firebase/02_setup/#4-2","title":"4-2. \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3078\u306e\u6a29\u9650\u4ed8\u4e0e","text":"<p>\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001Cloud Run\u304c\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u6a29\u9650\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002</p> <p>\u26a0\ufe0f \u3053\u306e\u624b\u9806\u3092\u5fd8\u308c\u308b\u3068\uff1f</p> <p>Cloud Run\u30c7\u30d7\u30ed\u30a4\u6642\u306b\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3059\uff1a</p> <pre><code>Permission denied on secret: projects/xxx/secrets/openai-api-key/versions/latest\nfor Revision service account xxx@xxx.iam.gserviceaccount.com.\nThe service account used must be granted the 'Secret Manager Secret Accessor' role\n</code></pre> <p>\u6a29\u9650\u4ed8\u4e0e\u306e\u624b\u9806</p> <ol> <li>GCP\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u300cIAM\u3068\u7ba1\u7406\u300d\u2192\u300cIAM\u300d\u3092\u958b\u304f</li> <li>\u4f7f\u7528\u3059\u308b\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u63a2\u3059</li> <li>\u63a8\u5968: <code>firebase-adminsdk-xxxxx@[\u30d7\u30ed\u30b8\u30a7\u30af\u30c8ID].iam.gserviceaccount.com</code></li> <li>\u203b <code>xxxxx</code> \u3068 <code>[\u30d7\u30ed\u30b8\u30a7\u30af\u30c8ID]</code> \u306f\u5404\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u7570\u306a\u308a\u307e\u3059</li> <li>\u53f3\u306e\u925b\u7b46\u30a2\u30a4\u30b3\u30f3\uff08\u7de8\u96c6\uff09\u3092\u30af\u30ea\u30c3\u30af</li> <li>\u300c\u5225\u306e\u30ed\u30fc\u30eb\u3092\u8ffd\u52a0\u300d\u3092\u30af\u30ea\u30c3\u30af</li> <li>\u300c<code>Secret Manager Secret Accessor</code>\u300d\u307e\u305f\u306f\u300c<code>Secret Manager \u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8 \u30a2\u30af\u30bb\u30b5\u30fc</code>\u300d\u3092\u691c\u7d22\u3057\u3066\u9078\u629e</li> <li>\u300c\u4fdd\u5b58\u300d\u3092\u30af\u30ea\u30c3\u30af</li> </ol> <p>\u3069\u306e\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u6a29\u9650\u3092\u4ed8\u4e0e\u3059\u308b\u304b\uff1f</p> \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8 \u8aac\u660e <code>firebase-adminsdk-xxxxx@...</code>\uff08\u63a8\u5968\uff09 Firebase\u95a2\u9023\u306e\u6a29\u9650\u3082\u6301\u3063\u3066\u3044\u308b\u3002Step 5\u3067Cloud Run\u306b\u8a2d\u5b9a\u3059\u308b <code>xxxxx-compute@developer.gserviceaccount.com</code> \u30c7\u30d5\u30a9\u30eb\u30c8\u306eCompute Engine \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8 <p>\u63a8\u5968: <code>firebase-adminsdk</code> \u3092\u4f7f\u7528\u3057\u3001Step 5\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30bf\u30d6\u3067\u3053\u306e\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u9078\u629e\u3057\u307e\u3059\u3002</p>"},{"location":"gcp-firebase/02_setup/#step-5-cloud-run-functions30","title":"Step 5: Cloud Run functions\u4f5c\u6210\uff0830\u5206\uff09","text":"<p>Cloud Run functions \u3068\u306f\uff1f \u30b3\u30fc\u30c9\u3092\u66f8\u304f\u3060\u3051\u3067\u30b5\u30fc\u30d0\u30fc\u306a\u3057\u3067\u52d5\u304fWeb\u30a2\u30d7\u30ea\u3092\u4f5c\u308c\u308b\u30b5\u30fc\u30d3\u30b9\u3067\u3059\u3002</p> \u5f93\u6765\u306e\u65b9\u6cd5 Cloud Run functions \u30b5\u30fc\u30d0\u30fc\u3092\u501f\u308a\u308b \u2192 OS\u8a2d\u5b9a \u2192 Node.js\u5165\u308c\u308b \u2192 \u30a2\u30d7\u30ea\u8a2d\u7f6e \u30b3\u30fc\u30c9\u3092\u8cbc\u308a\u4ed8\u3051 \u2192 \u52d5\u304f\uff01 <p>\u540d\u79f0\u306b\u3064\u3044\u3066 \u4ee5\u524d\u306f\u300cCloud Functions\u300d\u3068\u3044\u3046\u540d\u524d\u3067\u3057\u305f\u304c\u3001\u73fe\u5728\u306f\u300cCloud Run functions\u300d\u306b\u540d\u79f0\u5909\u66f4\u3055\u308c\u307e\u3057\u305f\u3002 GCP\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u306f\u300cCloud Run\u300d\u2192\u300c\u95a2\u6570\u3092\u4f5c\u6210\u300d\u304b\u3089\u5229\u7528\u3057\u307e\u3059\u3002</p> <p>\u88dc\u8db3: \u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u306b\u3064\u3044\u3066 Cloud Run functions\u7248\u3067\u306f\u3001\u30b3\u30fc\u30c9\u3092\u8cbc\u308a\u4ed8\u3051\u308b\u3060\u3051\u3067GCP\u304c\u81ea\u52d5\u7684\u306b\u5b9f\u884c\u74b0\u5883\u3092\u7528\u610f\u3057\u3066\u304f\u308c\u307e\u3059\u3002 \u305d\u306e\u305f\u3081\u3001Docker\u3084\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u306e\u77e5\u8b58\u306f\u4e0d\u8981\u3067\u3059\u3002 \u300c\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3068\u306f\u4f55\u304b\uff1f\u300d\u3092\u77e5\u308a\u305f\u3044\u65b9\u306f 99_container.md \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"gcp-firebase/02_setup/#5-1","title":"5-1. \u95a2\u6570\u306e\u4f5c\u6210\u3092\u958b\u59cb","text":"<ol> <li>GCP\u30b3\u30f3\u30bd\u30fc\u30eb\uff08https://console.cloud.google.com\uff09\u3092\u958b\u304f</li> <li>\u5de6\u5074\u30e1\u30cb\u30e5\u30fc\u304b\u3089\u300cCloud Run\u300d\u3092\u30af\u30ea\u30c3\u30af</li> <li>\u4e0a\u90e8\u306e\u300c\uff0b \u95a2\u6570\u3092\u4f5c\u6210\u300d\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af</li> </ol> <p>\u300c\u95a2\u6570\u3092\u4f5c\u6210\u300d\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u5834\u5408 \u300c\uff0b \u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\u300d\u3067\u306f\u306a\u304f\u300c\uff0b \u95a2\u6570\u3092\u4f5c\u6210\u300d\u3092\u9078\u3093\u3067\u304f\u3060\u3055\u3044\u3002 \u898b\u3064\u304b\u3089\u306a\u3044\u5834\u5408\u306f\u3001\u691c\u7d22\u30d0\u30fc\u3067\u300cCloud Run functions\u300d\u3068\u691c\u7d22\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"gcp-firebase/02_setup/#5-2","title":"5-2. \u57fa\u672c\u60c5\u5831\u306e\u8a2d\u5b9a\uff08\u753b\u9762\u4e0a\u90e8\uff09","text":"<p>\u753b\u9762\u306e\u4e0a\u304b\u3089\u9806\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u304d\u307e\u3059\u3002</p>"},{"location":"gcp-firebase/02_setup/#_6","title":"\u30b5\u30fc\u30d3\u30b9\u540d\u3068\u30ea\u30fc\u30b8\u30e7\u30f3","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u610f\u5473 \u30b5\u30fc\u30d3\u30b9\u540d <code>ai-chat-app</code> \u3053\u306e\u95a2\u6570\u3092\u8b58\u5225\u3059\u308b\u540d\u524d\uff08\u534a\u89d2\u82f1\u6570\u5b57\u3068\u30cf\u30a4\u30d5\u30f3\u306e\u307f\uff09 \u30ea\u30fc\u30b8\u30e7\u30f3 <code>asia-northeast1\uff08\u6771\u4eac\uff09</code> \u30b5\u30fc\u30d0\u30fc\u306e\u5834\u6240\u3002\u65e5\u672c\u306e\u30e6\u30fc\u30b6\u30fc\u5411\u3051\u306a\u3089\u6771\u4eac\u3092\u9078\u629e <p>\u30ea\u30fc\u30b8\u30e7\u30f3\u3068\u306f\uff1f \u30b5\u30fc\u30d0\u30fc\u304c\u7269\u7406\u7684\u306b\u8a2d\u7f6e\u3055\u308c\u3066\u3044\u308b\u5834\u6240\u3067\u3059\u3002 \u30e6\u30fc\u30b6\u30fc\u306b\u8fd1\u3044\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u9078\u3076\u3068\u3001\u5fdc\u7b54\u901f\u5ea6\u304c\u901f\u304f\u306a\u308a\u307e\u3059\u3002</p> \u30ea\u30fc\u30b8\u30e7\u30f3 \u5834\u6240 \u7528\u9014 asia-northeast1 \u6771\u4eac \u65e5\u672c\u56fd\u5185\u5411\u3051\uff08\u63a8\u5968\uff09 asia-northeast2 \u5927\u962a \u6771\u4eac\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7 us-central1 \u30a2\u30a4\u30aa\u30ef \u6d77\u5916\u5411\u3051\u30fb\u30b3\u30b9\u30c8\u91cd\u8996"},{"location":"gcp-firebase/02_setup/#_7","title":"\u30e9\u30f3\u30bf\u30a4\u30e0","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u610f\u5473 \u30e9\u30f3\u30bf\u30a4\u30e0 <code>Node.js 24</code> \u307e\u305f\u306f <code>Node.js 20</code> \u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u5b9f\u884c\u74b0\u5883\uff08\u8a00\u8a9e\u3068\u30d0\u30fc\u30b8\u30e7\u30f3\uff09"},{"location":"gcp-firebase/02_setup/#_8","title":"\u30c8\u30ea\u30ac\u30fc\uff08\u7701\u7565\u53ef\uff09","text":"<p>\u300c\uff0b \u30c8\u30ea\u30ac\u30fc\u3092\u8ffd\u52a0\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001HTTPS\u30c8\u30ea\u30ac\u30fc\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002 \uff08\u7701\u7565\u3057\u305f\u5834\u5408\u3082HTTPS\u30c8\u30ea\u30ac\u30fc\u304c\u81ea\u52d5\u3067\u8a2d\u5b9a\u3055\u308c\u307e\u3059\uff09</p>"},{"location":"gcp-firebase/02_setup/#_9","title":"\u8a8d\u8a3c\uff08\u91cd\u8981\uff09","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u610f\u5473 \u8a8d\u8a3c \u516c\u958b\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3059\u308b \u8ab0\u3067\u3082URL\u306b\u30a2\u30af\u30bb\u30b9\u53ef\u80fd <p>\u300c\u516c\u958b\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3059\u308b\u300d\u3092\u9078\u629e\u3059\u308b\u7406\u7531</p> <pre><code>2\u6bb5\u968e\u306e\u8a8d\u8a3c\u306b\u306a\u3063\u3066\u3044\u307e\u3059\uff1a\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1\u6bb5\u968e\u76ee: Cloud Run \u306e\u8a8d\u8a3c\uff08GCP\u30ec\u30d9\u30eb\uff09            \u2502\n\u2502                                                 \u2502\n\u2502   \u300c\u516c\u958b\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3059\u308b\u300d                       \u2502\n\u2502   = \u8ab0\u3067\u3082URL\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b                     \u2502\n\u2502   = \u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3092\u8868\u793a\u3059\u308b\u305f\u3081\u3001\u3053\u3053\u306f\u8a31\u53ef\u304c\u5fc5\u8981    \u2502\n\u2502                                                 \u2502\n\u2502   \u203b\u300c\u8a8d\u8a3c\u304c\u5fc5\u8981\u300d\u3092\u9078\u3076\u3068\u3001GCP\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u306a\u3044\u3068   \u2502\n\u2502     \u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3059\u3089\u898b\u308c\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3046           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 2\u6bb5\u968e\u76ee: \u30a2\u30d7\u30ea\u5074\u306e\u8a8d\u8a3c\uff08Firebase Auth\uff09          \u2502\n\u2502                                                 \u2502\n\u2502   \u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3067\u300cGoogle\u3067\u30ed\u30b0\u30a4\u30f3\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u3059   \u2502\n\u2502   \u2192 \u30ed\u30b0\u30a4\u30f3\u3057\u305f\u4eba\u3060\u3051\u304c\u30c1\u30e3\u30c3\u30c8\u6a5f\u80fd\u3092\u4f7f\u3048\u308b      \u2502\n\u2502                                                 \u2502\n\u2502   \u203b\u3053\u3053\u3067\u672c\u5f53\u306e\u30a2\u30af\u30bb\u30b9\u5236\u9650\u3092\u304b\u3051\u3066\u3044\u308b           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u3064\u307e\u308a\uff1a\n\u30fb\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u306f\u8ab0\u3067\u3082\u898b\u308c\u308b\uff081\u6bb5\u968e\u76ee\u306f\u8a31\u53ef\uff09\n\u30fb\u30c1\u30e3\u30c3\u30c8\u6a5f\u80fd\u306f\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u4eba\u3060\u3051\u4f7f\u3048\u308b\uff082\u6bb5\u968e\u76ee\u3067\u5236\u9650\uff09\n</code></pre>"},{"location":"gcp-firebase/02_setup/#_10","title":"\u8ab2\u91d1","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u610f\u5473 \u8ab2\u91d1 \u30ea\u30af\u30a8\u30b9\u30c8 \u30d9\u30fc\u30b9 \u30ea\u30af\u30a8\u30b9\u30c8\u304c\u3042\u3063\u305f\u6642\u3060\u3051\u8ab2\u91d1\u3055\u308c\u308b\uff08\u63a8\u5968\uff09 <p>\u8ab2\u91d1\u65b9\u5f0f\u306e\u9055\u3044 | \u65b9\u5f0f | \u8aac\u660e | \u9069\u3057\u305f\u30b1\u30fc\u30b9 | |------|------|-------------| | \u30ea\u30af\u30a8\u30b9\u30c8 \u30d9\u30fc\u30b9 | \u30ea\u30af\u30a8\u30b9\u30c8\u304c\u306a\u3044\u6642\u306fCPU\u304c\u5236\u9650\u3055\u308c\u308b\u3002\u4f7f\u3063\u305f\u5206\u3060\u3051\u8ab2\u91d1 | \u30c6\u30b9\u30c8\u74b0\u5883\u3001\u30a2\u30af\u30bb\u30b9\u5c11\u306a\u3081\uff08\u63a8\u5968\uff09 | | \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 \u30d9\u30fc\u30b9 | \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u9593\u305a\u3063\u3068\u8ab2\u91d1 | \u5e38\u6642\u9ad8\u8ca0\u8377\u3001\u5fdc\u7b54\u901f\u5ea6\u91cd\u8996 |</p>"},{"location":"gcp-firebase/02_setup/#_11","title":"\u30b5\u30fc\u30d3\u30b9\u306e\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\uff08\u753b\u9762\u4e0a\u90e8\uff09","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u610f\u5473 \u30b9\u30b1\u30fc\u30ea\u30f3\u30b0 \u81ea\u52d5\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0 \u30a2\u30af\u30bb\u30b9\u91cf\u306b\u5fdc\u3058\u3066\u81ea\u52d5\u3067\u5897\u6e1b\uff08\u63a8\u5968\uff09 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6700\u5c0f\u6570 <code>0</code> \u30a2\u30af\u30bb\u30b9\u304c\u306a\u3044\u6642\u306b\u8d77\u52d5\u3057\u3066\u304a\u304f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6570 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6700\u5927\u6570 <code>10</code>\uff08\u307e\u305f\u306f\u7a7a\u6b04\uff09 \u540c\u6642\u306b\u8d77\u52d5\u3067\u304d\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4e0a\u9650 <p>\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068\u306f\uff1f</p> <p>\u300c\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u300d\u3068\u306f\u3001\u30a2\u30d7\u30ea\u304c\u52d5\u3044\u3066\u3044\u308b\u4eee\u60f3\u7684\u306a\u30b5\u30fc\u30d0\u30fc1\u53f0\u306e\u3088\u3046\u306a\u3082\u306e\u3067\u3059\u3002</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  \u5206\u304b\u308a\u3084\u3059\u3044\u4f8b\u3048                  \u2502\n\u2502                                                 \u2502\n\u2502     \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 = \u30d5\u30a1\u30b9\u30c8\u30d5\u30fc\u30c9\u5e97\u306e\u30ec\u30b8\u4fc2         \u2502\n\u2502                                                 \u2502\n\u2502     \u30fb\u304a\u5ba2\u3055\u3093\u6570\u4eba \u2192 \u30ec\u30b8\u4fc21\u4eba\u3067\u5bfe\u5fdc\u3067\u304d\u308b         \u2502\n\u2502     \u30fb\u304a\u5ba2\u3055\u3093100\u4eba\u304c\u6bba\u5230                        \u2502\n\u2502       \u2192 \u30ec\u30b8\u4fc2\u309210\u4eba\u306b\u5897\u3084\u3057\u3066\u5bfe\u5fdc\uff08\u81ea\u52d5\uff01\uff09      \u2502\n\u2502     \u30fb\u304a\u5ba2\u3055\u30930\u4eba\uff08\u6df1\u591c\u306a\u3069\uff09                     \u2502\n\u2502       \u2192 \u30ec\u30b8\u4fc2\u3092\u5e30\u5b85\u3055\u305b\u3066\u30b3\u30b9\u30c8\u524a\u6e1b             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>\u26a0\ufe0f \u6ce8\u610f: \u30a4\u30f3\u30b9\u30bf\u30f3\u30b91\u53f0 \u2260 \u30e6\u30fc\u30b6\u30fc1\u4eba \u3067\u306f\u3042\u308a\u307e\u305b\u3093\uff01</p> <p>1\u3064\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f\u8907\u6570\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u540c\u6642\u306b\u51e6\u7406\u3067\u304d\u307e\u3059\u3002 \u4f55\u4eba\u307e\u3067\u540c\u6642\u306b\u51e6\u7406\u3067\u304d\u308b\u304b\u306f\u3001\u6b21\u306e\u300c\u30ea\u30af\u30a8\u30b9\u30c8\u300d\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002 \uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u306f80\u30ea\u30af\u30a8\u30b9\u30c8/\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\uff09</p> <pre><code>\u3010\u8a08\u7b97\u4f8b\u3011\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u6700\u5927\u6570: 10\n1\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3042\u305f\u308a: 80\u30ea\u30af\u30a8\u30b9\u30c8\n    \u2193\n\u6700\u5927 10 \u00d7 80 = 800\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u540c\u6642\u306b\u51e6\u7406\u53ef\u80fd\n</code></pre> <p>\u300c1\u306b\u8a2d\u5b9a\u3059\u308b\u3068\u30b3\u30fc\u30eb\u30c9 \u30b9\u30bf\u30fc\u30c8\u304c\u6e1b\u5c11\u3057\u307e\u3059\u300d\u3068\u306f\uff1f</p> \u8a2d\u5b9a \u52d5\u4f5c \u30e1\u30ea\u30c3\u30c8 \u30c7\u30e1\u30ea\u30c3\u30c8 \u6700\u5c0f=0 \u30a2\u30af\u30bb\u30b9\u304c\u306a\u3044\u3068\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u505c\u6b62 \u30b3\u30b9\u30c80\u5186\uff08\u4f7f\u3063\u305f\u6642\u3060\u3051\u8ab2\u91d1\uff09 \u521d\u56de\u30a2\u30af\u30bb\u30b9\u304c\u9045\u3044\uff082\u301c5\u79d2\u5f85\u3064\uff09 \u6700\u5c0f=1 \u5e38\u306b1\u53f0\u306f\u8d77\u52d5\u3057\u3066\u304a\u304f \u5e38\u306b\u9ad8\u901f\u5fdc\u7b54 \u5e38\u6642\u8ab2\u91d1\u304c\u767a\u751f\uff08\u6708$5\u301c10\u7a0b\u5ea6\uff09 <pre><code>\u3010\u6700\u5c0f=0 \u306e\u5834\u5408\uff08\u30b3\u30fc\u30eb\u30c9\u30b9\u30bf\u30fc\u30c8\uff09\u3011\n\n\u30e6\u30fc\u30b6\u30fc\u304c\u30a2\u30af\u30bb\u30b9\n    \u2193\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u505c\u6b62\u4e2d...\uff08\u8ab0\u3082\u3044\u306a\u3044\u5e97\uff09\n    \u2193\n\u8d77\u52d5\u958b\u59cb\uff08\u5e97\u3092\u958b\u3051\u3066\u6e96\u5099\u4e2d\uff09\n    \u2193\n2\u301c5\u79d2\u5f8c\u306b\u5fdc\u7b54 \u2190 \u3053\u306e\u5f85\u3061\u6642\u9593\u304c\u300c\u30b3\u30fc\u30eb\u30c9\u30b9\u30bf\u30fc\u30c8\u300d\n\n\n\u3010\u6700\u5c0f=1 \u306e\u5834\u5408\uff08\u30a6\u30a9\u30fc\u30e0\u30b9\u30bf\u30fc\u30c8\uff09\u3011\n\n\u30e6\u30fc\u30b6\u30fc\u304c\u30a2\u30af\u30bb\u30b9\n    \u2193\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f\u8d77\u52d5\u6e08\u307f\uff01\uff08\u5e97\u306f\u3059\u3067\u306b\u55b6\u696d\u4e2d\uff09\n    \u2193\n\u3059\u3050\u306b\u5fdc\u7b54\n</code></pre> <p>\u30c6\u30b9\u30c8\u74b0\u5883\u3067\u306f\u6700\u5c0f=0\u3001\u672c\u756a\u3067\u5fdc\u7b54\u901f\u5ea6\u304c\u91cd\u8981\u306a\u3089\u6700\u5c0f=1\u4ee5\u4e0a\u3092\u691c\u8a0e\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"gcp-firebase/02_setup/#5-3","title":"5-3. \u30b3\u30f3\u30c6\u30ca\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30ad\u30f3\u30b0\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u8a2d\u5b9a","text":"<p>\u753b\u9762\u4e0b\u90e8\u306b\u3042\u308b\u300c\u30b3\u30f3\u30c6\u30ca\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30ad\u30f3\u30b0\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u5c55\u958b\u3057\u307e\u3059\u3002</p>"},{"location":"gcp-firebase/02_setup/#_12","title":"\u300c\u30b3\u30f3\u30c6\u30ca\u300d\u30bf\u30d6 \u2192 \u300c\u30b3\u30f3\u30c6\u30ca\u306e\u7de8\u96c6\u300d","text":""},{"location":"gcp-firebase/02_setup/#_13","title":"\u8a2d\u5b9a\u30bf\u30d6","text":""},{"location":"gcp-firebase/02_setup/#_14","title":"\u30ea\u30bd\u30fc\u30b9","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u610f\u5473 \u30e1\u30e2\u30ea <code>512 MiB</code> \u30a2\u30d7\u30ea\u304c\u4f7f\u3048\u308b\u30e1\u30e2\u30ea\u91cf\u3002AI\u51e6\u7406\u306b\u306f512MB\u4ee5\u4e0a\u63a8\u5968 CPU <code>1</code> \u51e6\u7406\u80fd\u529b\u3002\u901a\u5e38\u306f1\u3067\u5341\u5206 <p>\u30e1\u30e2\u30ea\u3068CPU\u306e\u95a2\u4fc2 <pre><code>\u30e1\u30e2\u30ea = \u673a\u306e\u5e83\u3055\uff08\u4f5c\u696d\u30b9\u30da\u30fc\u30b9\uff09\nCPU = \u4f5c\u696d\u3059\u308b\u4eba\u306e\u6570\u3068\u901f\u3055\n\nAI\u51e6\u7406\u3067\u306f\u591a\u304f\u306e\u30c7\u30fc\u30bf\u3092\u4e00\u6642\u7684\u306b\u4fdd\u6301\u3059\u308b\u305f\u3081\u3001\n\u673a\uff08\u30e1\u30e2\u30ea\uff09\u304c\u5e83\u3044\u65b9\u304c\u52b9\u7387\u3088\u304f\u51e6\u7406\u3067\u304d\u307e\u3059\u3002\n</code></pre></p>"},{"location":"gcp-firebase/02_setup/#_15","title":"\u30ea\u30af\u30a8\u30b9\u30c8","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u610f\u5473 \u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8 <code>300</code> \u79d2 1\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u6700\u5927\u51e6\u7406\u6642\u9593 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3042\u305f\u308a\u306e\u6700\u5927\u540c\u6642\u30ea\u30af\u30a8\u30b9\u30c8\u6570 <code>80</code>\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\uff09 1\u3064\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u540c\u6642\u306b\u51e6\u7406\u3067\u304d\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u6570 <p>\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3068\u306f\uff1f <pre><code>\u30e6\u30fc\u30b6\u30fc\u304cAI\u306b\u8cea\u554f\n    \u2193\nAI\u304c\u8003\u3048\u4e2d...\uff08\u6700\u5927300\u79d2\u307e\u3067\u5f85\u3064\uff09\n    \u2193\n300\u79d2\u3092\u8d85\u3048\u308b\u3068\u5f37\u5236\u7d42\u4e86\uff08\u30a8\u30e9\u30fc\uff09\n\nAI\u306e\u5fdc\u7b54\u306f\u6570\u79d2\u301c30\u79d2\u7a0b\u5ea6\u304b\u304b\u308b\u3053\u3068\u304c\u3042\u308b\u305f\u3081\u3001\n\u4f59\u88d5\u3092\u6301\u3063\u3066300\u79d2\uff085\u5206\uff09\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n</code></pre></p>"},{"location":"gcp-firebase/02_setup/#_16","title":"\u5b9f\u884c\u74b0\u5883","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u610f\u5473 \u5b9f\u884c\u74b0\u5883 \u30c7\u30d5\u30a9\u30eb\u30c8 Cloud Run\u304c\u6700\u9069\u306a\u74b0\u5883\u3092\u81ea\u52d5\u9078\u629e <p>\u5b9f\u884c\u74b0\u5883\u306e\u9078\u629e\u80a2 | \u9078\u629e\u80a2 | \u8aac\u660e | |--------|------| | \u30c7\u30d5\u30a9\u30eb\u30c8 | Cloud Run\u304c\u81ea\u52d5\u3067\u6700\u9069\u306a\u74b0\u5883\u3092\u9078\u3076\uff08\u63a8\u5968\uff09 | | \u7b2c1\u4e16\u4ee3 | \u30b3\u30fc\u30eb\u30c9\u30b9\u30bf\u30fc\u30c8\u304c\u901f\u3044\uff08\u30b7\u30f3\u30d7\u30eb\u306a\u51e6\u7406\u5411\u3051\uff09 | | \u7b2c2\u4e16\u4ee3 | \u9ad8\u6027\u80fd\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u5bfe\u5fdc\uff08\u8907\u96d1\u306a\u51e6\u7406\u5411\u3051\uff09 |</p>"},{"location":"gcp-firebase/02_setup/#_17","title":"\u30ea\u30d3\u30b8\u30e7\u30f3 \u30b9\u30b1\u30fc\u30ea\u30f3\u30b0","text":"<p>\u300c\u30ea\u30d3\u30b8\u30e7\u30f3 \u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u300d\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u4ee5\u4e0b\u3092\u8a2d\u5b9a\uff1a</p> \u9805\u76ee \u8a2d\u5b9a\u5024 \u610f\u5473 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6700\u5c0f\u6570 <code>0</code> \u3053\u306e\u30ea\u30d3\u30b8\u30e7\u30f3\u3067\u8d77\u52d5\u3057\u3066\u304a\u304f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6700\u5c0f\u6570 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6700\u5927\u6570 <code>10</code> \u3053\u306e\u30ea\u30d3\u30b8\u30e7\u30f3\u3067\u8d77\u52d5\u3067\u304d\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4e0a\u9650 <p>\u300c\u30b5\u30fc\u30d3\u30b9\u306e\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u300d\u3068\u300c\u30ea\u30d3\u30b8\u30e7\u30f3 \u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u300d\u306e\u9055\u3044</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 \u30b5\u30fc\u30d3\u30b9\u306e\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\uff08\u753b\u9762\u4e0a\u90e8\uff09                 \u2502\n\u2502                                                 \u2502\n\u2502   \u30b5\u30fc\u30d3\u30b9\u5168\u4f53\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u6570\u3092\u8a2d\u5b9a              \u2502\n\u2502   \u2192 \u901a\u5e38\u306f\u3053\u3061\u3089\u3067\u8a2d\u5b9a\u3059\u308c\u3070OK                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 \u30ea\u30d3\u30b8\u30e7\u30f3 \u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\uff08\u30b3\u30f3\u30c6\u30ca\u8a2d\u5b9a\u5185\uff09          \u2502\n\u2502                                                 \u2502\n\u2502   \u7279\u5b9a\u306e\u30ea\u30d3\u30b8\u30e7\u30f3\uff08\u30d0\u30fc\u30b8\u30e7\u30f3\uff09\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u6570   \u2502\n\u2502   \u2192 \u8907\u6570\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u540c\u6642\u904b\u7528\u3059\u308b\u5834\u5408\u306b\u4f7f\u7528        \u2502\n\u2502   \u2192 \u901a\u5e38\u306f\u4e0a\u90e8\u306e\u8a2d\u5b9a\u3068\u540c\u3058\u5024\u3067OK                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>\u30ea\u30d3\u30b8\u30e7\u30f3\u3068\u306f\uff1f <pre><code>\u30ea\u30d3\u30b8\u30e7\u30f3 = \u30a2\u30d7\u30ea\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\n\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u3057\u3066\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u305f\u3073\u306b\u3001\u65b0\u3057\u3044\u30ea\u30d3\u30b8\u30e7\u30f3\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\n\u30ea\u30d3\u30b8\u30e7\u30f31\uff08\u53e4\u3044\uff09 \u2190 \u554f\u984c\u304c\u3042\u308c\u3070\u623b\u305b\u308b\n    \u2193\n\u30ea\u30d3\u30b8\u30e7\u30f32\uff08\u65b0\u3057\u3044\uff09 \u2190 \u73fe\u5728\u7a3c\u50cd\u4e2d\n</code></pre></p> <p>\u203b \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u3064\u3044\u3066\u306f\u300c\u30b5\u30fc\u30d3\u30b9\u306e\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u300d\uff084-2\uff09\u3067\u8aac\u660e\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"gcp-firebase/02_setup/#_18","title":"\u5909\u6570\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8 \u30bf\u30d6","text":"<p>\u300c\u5909\u6570\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u300d\u30bf\u30d6\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002</p>"},{"location":"gcp-firebase/02_setup/#_19","title":"\u74b0\u5883\u5909\u6570","text":"<p>\u300c\uff0b \u5909\u6570\u3092\u8ffd\u52a0\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001\u4ee5\u4e0b\u306e\u74b0\u5883\u5909\u6570\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002</p> \u540d\u524d \u5024\u306e\u4f8b \u610f\u5473 <code>ALLOWED_EMAILS</code> <code>user1@example.com,user2@example.com</code> \u30ed\u30b0\u30a4\u30f3\u3092\u8a31\u53ef\u3059\u308b\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\uff08\u30ab\u30f3\u30de\u533a\u5207\u308a\uff09 <code>ALLOWED_DOMAINS</code> <code>@yourcompany.co.jp</code> \u30ed\u30b0\u30a4\u30f3\u3092\u8a31\u53ef\u3059\u308b\u30c9\u30e1\u30a4\u30f3\uff08\u30ab\u30f3\u30de\u533a\u5207\u308a\uff09 <p>\u74b0\u5883\u5909\u6570\u3068\u306f\uff1f</p> <p>\u30a2\u30d7\u30ea\u306b\u6e21\u3059\u300c\u8a2d\u5b9a\u5024\u300d\u306e\u3053\u3068\u3067\u3059\u3002\u30b3\u30fc\u30c9\u306e\u4e2d\u8eab\u3092\u5909\u3048\u305a\u306b\u3001\u52d5\u4f5c\u3092\u5909\u66f4\u3067\u304d\u307e\u3059\u3002</p> <pre><code>\u3010\u74b0\u5883\u5909\u6570\u306e\u30a4\u30e1\u30fc\u30b8\u3011\n\n\u30b3\u30fc\u30c9\uff08\u5909\u3048\u306a\u3044\uff09        \u74b0\u5883\u5909\u6570\uff08\u5909\u3048\u308b\uff09\n      \u2193                       \u2193\n\u300c\u8a31\u53ef\u30ea\u30b9\u30c8\u3092\u30c1\u30a7\u30c3\u30af\u300d  \u2192  \u8a31\u53ef\u30ea\u30b9\u30c8 = \"user1@example.com\"\n\n\u203b \u8a31\u53ef\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u3092\u8ffd\u52a0\u3057\u305f\u3044\u6642\u3001\u30b3\u30fc\u30c9\u306f\u5909\u3048\u305a\u306b\n   \u74b0\u5883\u5909\u6570\u3060\u3051\u5909\u66f4\u3059\u308c\u3070OK\n</code></pre> <p>ALLOWED_EMAILS \u3068 ALLOWED_DOMAINS \u306e\u8a73\u7d30\u8aac\u660e</p> <p>\u3053\u306e2\u3064\u306e\u74b0\u5883\u5909\u6570\u3067\u300c\u8ab0\u304c\u3053\u306e\u30a2\u30d7\u30ea\u3092\u4f7f\u3048\u308b\u304b\u300d\u3092\u5236\u9650\u3067\u304d\u307e\u3059\u3002</p> <p>\u2460 ALLOWED_EMAILS\uff08\u500b\u5225\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u6307\u5b9a\uff09</p> \u8a2d\u5b9a\u5024\u306e\u4f8b \u8a31\u53ef\u3055\u308c\u308b\u30e6\u30fc\u30b6\u30fc <code>admin@example.com</code> admin@example.com \u306e\u307f <code>admin@example.com,user1@gmail.com</code> 2\u4eba\u306e\u307f\uff08\u30ab\u30f3\u30de\u533a\u5207\u308a\u3067\u8907\u6570\u6307\u5b9a\u53ef\u80fd\uff09 <p>\u2461 ALLOWED_DOMAINS\uff08\u30c9\u30e1\u30a4\u30f3\u6307\u5b9a\uff09</p> \u8a2d\u5b9a\u5024\u306e\u4f8b \u8a31\u53ef\u3055\u308c\u308b\u30e6\u30fc\u30b6\u30fc <code>@yourcompany.co.jp</code> <code>xxx@yourcompany.co.jp</code> \u306e\u30e1\u30fc\u30eb\u3092\u6301\u3064\u5168\u54e1 <code>@yourcompany.co.jp,@partner.co.jp</code> 2\u3064\u306e\u4f1a\u793e\u306e\u5168\u54e1\uff08\u30ab\u30f3\u30de\u533a\u5207\u308a\u3067\u8907\u6570\u6307\u5b9a\u53ef\u80fd\uff09 <p>\u2462 \u4e21\u65b9\u8a2d\u5b9a\u3057\u305f\u5834\u5408</p> <p>\u300c\u3069\u3061\u3089\u304b\u306b\u8a72\u5f53\u3059\u308c\u3070\u8a31\u53ef\u300d\u3055\u308c\u307e\u3059\uff08OR\u6761\u4ef6\uff09\u3002</p> <pre><code>\u4f8b\uff1a\nALLOWED_EMAILS = \"external-user@gmail.com\"\nALLOWED_DOMAINS = \"@yourcompany.co.jp\"\n\n\u8a31\u53ef\u3055\u308c\u308b\u30e6\u30fc\u30b6\u30fc\uff1a\n\u2713 tanaka@yourcompany.co.jp   \u2190 \u30c9\u30e1\u30a4\u30f3\u304c\u4e00\u81f4\n\u2713 suzuki@yourcompany.co.jp   \u2190 \u30c9\u30e1\u30a4\u30f3\u304c\u4e00\u81f4\n\u2713 external-user@gmail.com    \u2190 \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u304c\u4e00\u81f4\n\u2717 other@gmail.com            \u2190 \u3069\u3061\u3089\u306b\u3082\u8a72\u5f53\u3057\u306a\u3044\n</code></pre> <p>\u2463 \u7247\u65b9\u3060\u3051\u8a2d\u5b9a\u3059\u308b\u5834\u5408</p> \u3084\u308a\u305f\u3044\u3053\u3068 \u8a2d\u5b9a\u65b9\u6cd5 \u4f1a\u793e\u306e\u30c9\u30e1\u30a4\u30f3\u3060\u3051\u3067\u7e1b\u308a\u305f\u3044 <code>ALLOWED_DOMAINS</code> \u3060\u3051\u8a2d\u5b9a\u3059\u308b\uff08<code>ALLOWED_EMAILS</code> \u306f\u7a7a\u6b04\u307e\u305f\u306f\u672a\u8a2d\u5b9a\uff09 \u7279\u5b9a\u306e\u4eba\u3060\u3051\u8a31\u53ef\u3057\u305f\u3044 <code>ALLOWED_EMAILS</code> \u3060\u3051\u8a2d\u5b9a\u3059\u308b\uff08<code>ALLOWED_DOMAINS</code> \u306f\u7a7a\u6b04\u307e\u305f\u306f\u672a\u8a2d\u5b9a\uff09 \u4e21\u65b9\u7d44\u307f\u5408\u308f\u305b\u305f\u3044 \u4e21\u65b9\u8a2d\u5b9a\u3059\u308b <p>\u2464 \u4e21\u65b9\u3068\u3082\u672a\u8a2d\u5b9a\u306e\u5834\u5408</p> <p>\u5168\u54e1\u304c\u30ed\u30b0\u30a4\u30f3\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\uff08\u958b\u767a\u30fb\u30c6\u30b9\u30c8\u7528\uff09\u3002 \u672c\u756a\u74b0\u5883\u3067\u306f\u5fc5\u305a\u3069\u3061\u3089\u304b\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p> <p>\u306a\u305c\u74b0\u5883\u5909\u6570\u3067\u30a2\u30af\u30bb\u30b9\u5236\u9650\u304c\u3067\u304d\u308b\u306e\u304b\uff1f\uff08\u4ed5\u7d44\u307f\u306e\u89e3\u8aac\uff09</p> <pre><code>\u3010\u51e6\u7406\u306e\u6d41\u308c\u3011\n\n1. \u30e6\u30fc\u30b6\u30fc\u304cGoogle\u3067\u30ed\u30b0\u30a4\u30f3\u3059\u308b\n       \u2193\n2. Google\u304b\u3089\u300c\u3053\u306e\u4eba\u306f tanaka@yourcompany.co.jp \u3067\u3059\u300d\u3068\u3044\u3046\u60c5\u5831\u304c\u8fd4\u3063\u3066\u304f\u308b\n       \u2193\n3. \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\uff08front.html\uff09\u304c\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\uff08backend.js\uff09\u306b\u78ba\u8a8d\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308b\n   \u300c\u3053\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306e\u4eba\u306f\u4f7f\u3063\u3066\u3044\u3044\u3067\u3059\u304b\uff1f\u300d\n       \u2193\n4. \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\uff08backend.js\uff09\u304c\u74b0\u5883\u5909\u6570\u3092\u30c1\u30a7\u30c3\u30af\n   \u30fbALLOWED_EMAILS \u306b\u542b\u307e\u308c\u3066\u3044\u308b\u304b\uff1f \u2192 NO\n   \u30fbALLOWED_DOMAINS \u3067\u7d42\u308f\u3063\u3066\u3044\u308b\u304b\uff1f \u2192 YES\uff08@yourcompany.co.jp \u3067\u7d42\u308f\u308b\uff09\n       \u2193\n5. \u7d50\u679c\u3092\u8fd4\u3059\n   \u30fb\u8a31\u53ef \u2192 \u30c1\u30e3\u30c3\u30c8\u753b\u9762\u3092\u8868\u793a\n   \u30fb\u62d2\u5426 \u2192 \u300c\u30a2\u30af\u30bb\u30b9\u304c\u8a31\u53ef\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u300d\u753b\u9762\u3092\u8868\u793a\n</code></pre> <p>\u30b3\u30fc\u30c9\u5185\u306e\u8a72\u5f53\u90e8\u5206\uff08backend.js\uff09</p> <pre><code>// \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u304c\u8a31\u53ef\u3055\u308c\u3066\u3044\u308b\u304b\u30c1\u30a7\u30c3\u30af\u3059\u308b\u95a2\u6570\nfunction isEmailAllowed(email) {\n    // 1. ALLOWED_EMAILS \u306b\u542b\u307e\u308c\u3066\u3044\u308b\u304b\u30c1\u30a7\u30c3\u30af\n    if (allowedEmails.includes(email)) {\n        return true;  // \u8a31\u53ef\n    }\n\n    // 2. ALLOWED_DOMAINS \u306e\u3069\u308c\u304b\u3067\u7d42\u308f\u3063\u3066\u3044\u308b\u304b\u30c1\u30a7\u30c3\u30af\n    for (const domain of allowedDomains) {\n        if (email.endsWith(domain)) {  // endsWith = \u300c\u301c\u3067\u7d42\u308f\u308b\u300d\n            return true;  // \u8a31\u53ef\n        }\n    }\n\n    return false;  // \u3069\u3061\u3089\u306b\u3082\u8a72\u5f53\u3057\u306a\u3044 \u2192 \u62d2\u5426\n}\n</code></pre> <p>\u3053\u306e\u3088\u3046\u306b\u3001\u30ed\u30b0\u30a4\u30f3\u5f8c\u306b\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\u51e6\u7406\u304c\u30b3\u30fc\u30c9\u306b\u7d44\u307f\u8fbc\u307e\u308c\u3066\u3044\u308b\u305f\u3081\u3001 \u74b0\u5883\u5909\u6570\u3092\u5909\u66f4\u3059\u308b\u3060\u3051\u3067\u30a2\u30af\u30bb\u30b9\u5236\u9650\u3092\u5909\u66f4\u3067\u304d\u307e\u3059\u3002</p> <p>\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3068\u306e\u9055\u3044</p> \u7a2e\u985e \u7528\u9014 \u753b\u9762\u3067\u306e\u898b\u3048\u65b9 \u74b0\u5883\u5909\u6570 \u4e00\u822c\u7684\u306a\u8a2d\u5b9a\u5024 \u305d\u306e\u307e\u307e\u898b\u3048\u308b\uff08\u4f8b: <code>user@example.com</code>\uff09 \u30b7\u30fc\u30af\u30ec\u30c3\u30c8 API\u30ad\u30fc\u306a\u3069\u6a5f\u5bc6\u60c5\u5831 \u96a0\u3055\u308c\u308b\uff08\u4f8b: <code>\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022</code>\uff09 <p>\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3084\u30c9\u30e1\u30a4\u30f3\u540d\u306f\u6a5f\u5bc6\u60c5\u5831\u3067\u306f\u306a\u3044\u306e\u3067\u300c\u74b0\u5883\u5909\u6570\u300d\u3092\u4f7f\u3044\u307e\u3059\u3002 API\u30ad\u30fc\u306a\u3069\u6f0f\u308c\u3066\u306f\u3044\u3051\u306a\u3044\u60c5\u5831\u306f\u300c\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u300d\u3092\u4f7f\u3044\u307e\u3059\u3002</p>"},{"location":"gcp-firebase/02_setup/#_20","title":"\u74b0\u5883\u5909\u6570\u3068\u3057\u3066\u516c\u958b\u3055\u308c\u308b\u30b7\u30fc\u30af\u30ec\u30c3\u30c8","text":"<ol> <li>\u300c\uff0b \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u53c2\u7167\u300d\u3092\u30af\u30ea\u30c3\u30af</li> <li>\u4ee5\u4e0b\u3092\u8a2d\u5b9a:</li> </ol> \u9805\u76ee \u8a2d\u5b9a\u5024 \u610f\u5473 \u540d\u524d1 <code>OPENAI_API_KEY</code> \u30b3\u30fc\u30c9\u5185\u3067\u4f7f\u3046\u74b0\u5883\u5909\u6570\u540d \u30b7\u30fc\u30af\u30ec\u30c3\u30c8 <code>openai-api-key</code> \u3092\u9078\u629e Step 3\u3067\u4f5c\u6210\u3057\u305f\u30b7\u30fc\u30af\u30ec\u30c3\u30c8 \u30d0\u30fc\u30b8\u30e7\u30f3 <code>1</code> \u307e\u305f\u306f <code>latest</code> \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u306e\u30d0\u30fc\u30b8\u30e7\u30f3 <ol> <li>\u300c\u5b8c\u4e86\u300d\u3092\u30af\u30ea\u30c3\u30af</li> </ol> <p>\u306a\u305c\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u4f7f\u3046\u306e\u304b\uff1f</p> \u65b9\u6cd5 \u554f\u984c\u70b9 \u30b3\u30fc\u30c9\u306b\u76f4\u63a5API\u30ad\u30fc\u3092\u66f8\u304f GitHub\u306a\u3069\u306b\u6f0f\u6d29\u3059\u308b\u30ea\u30b9\u30af\u5927 \u666e\u901a\u306e\u74b0\u5883\u5909\u6570\u306b\u8a2d\u5b9a GCP\u753b\u9762\u306b\u5e73\u6587\u3067\u4e38\u898b\u3048 \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u4f7f\u3046 \u6697\u53f7\u5316\u3055\u308c\u3066\u5b89\u5168\u306b\u4fdd\u7ba1 \u2713 <p>\u3053\u306e\u753b\u9762\u3067\u3084\u3063\u3066\u3044\u308b\u3053\u3068\uff083\u3064\u306e\u8a2d\u5b9a\uff09</p> \u9805\u76ee \u8a2d\u5b9a\u5024 \u610f\u5473 \u540d\u524d <code>OPENAI_API_KEY</code> \u30b3\u30fc\u30c9\u5185\u3067\u4f7f\u3046\u300c\u547c\u3073\u540d\u300d\uff08\u5909\u6570\u540d\uff09 \u30b7\u30fc\u30af\u30ec\u30c3\u30c8 <code>openai-api-key</code> Step 3\u3067\u4f5c\u3063\u305f\u300c\u91d1\u5eab\u306e\u4e2d\u8eab\u300d \u30d0\u30fc\u30b8\u30e7\u30f3 <code>latest</code> \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u306e\u3069\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u4f7f\u3046\u304b <p>\u30a4\u30e1\u30fc\u30b8 <pre><code>\u91d1\u5eab\uff08Secret Manager\uff09\u306e\u4e2d\u8eab \u2192 \u547c\u3073\u540d\uff08\u74b0\u5883\u5909\u6570\uff09\u3092\u3064\u3051\u3066\u6e21\u3059\n\n openai-api-key        \u2192  OPENAI_API_KEY \u3068\u3044\u3046\u540d\u524d\u3067\n\u300csk-xxxxx...\u300d            \u30a2\u30d7\u30ea\u306b\u6e21\u3059\n</code></pre></p> <p>\u3053\u3046\u3059\u308b\u3053\u3068\u3067\u3001\u30b3\u30fc\u30c9\u5185\u3067\u306f <code>process.env.OPENAI_API_KEY</code> \u3068\u66f8\u304f\u3060\u3051\u3067\u3001 \u5b89\u5168\u306b\u4fdd\u7ba1\u3055\u308c\u305fAPI\u30ad\u30fc\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002</p> <p>\u88dc\u8db3: \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u3064\u3044\u3066 Cloud Run functions\u3067\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u81ea\u52d5\u7684\u306b\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002 \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3068\u306f\u300c\u30a2\u30d7\u30ea\u5c02\u7528\u306eGoogle\u30a2\u30ab\u30a6\u30f3\u30c8\u300d\u306e\u3088\u3046\u306a\u3082\u306e\u3067\u3001 \u30a2\u30d7\u30ea\u304cSecret Manager\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306e\u6a29\u9650\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002 \u8a73\u3057\u304f\u306f 99_service_account.md \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p> <ol> <li>\u300c\u30b3\u30f3\u30c6\u30ca\u3092\u4fdd\u5b58\u300d\u3092\u30af\u30ea\u30c3\u30af</li> </ol>"},{"location":"gcp-firebase/02_setup/#_21","title":"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3 \u30bf\u30d6","text":"<p>\u300c\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u300d\u30bf\u30d6\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002</p> \u9805\u76ee \u8a2d\u5b9a\u5024 \u610f\u5473 \u30b5\u30fc\u30d3\u30b9 \u30a2\u30ab\u30a6\u30f3\u30c8 <code>firebase-adminsdk-xxxxx@[\u30d7\u30ed\u30b8\u30a7\u30af\u30c8ID].iam.gserviceaccount.com</code> Step 4-2\u3067\u6a29\u9650\u3092\u4ed8\u4e0e\u3057\u305f\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8 <p>\u6ce8\u610f: Step 4-2 \u3067\u6a29\u9650\u4ed8\u4e0e\u3057\u305f\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002 <code>Default compute service account</code> \u306e\u307e\u307e\u3060\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u9650\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3059\u3002</p>"},{"location":"gcp-firebase/02_setup/#5-4","title":"5-4. \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u8a2d\u5b9a","text":"<p>\u300c\u30bd\u30fc\u30b9\u300d\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u4ee5\u4e0b\u3092\u8a2d\u5b9a\uff1a</p>"},{"location":"gcp-firebase/02_setup/#_22","title":"\u30bd\u30fc\u30b9\u306e\u5834\u6240","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u610f\u5473 \u30bd\u30fc\u30b9\u306e\u5834\u6240 \u30a4\u30f3\u30e9\u30a4\u30f3\u30a8\u30c7\u30a3\u30bf GCP\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u3067\u76f4\u63a5\u30b3\u30fc\u30c9\u3092\u5165\u529b"},{"location":"gcp-firebase/02_setup/#_23","title":"\u30a8\u30f3\u30c8\u30ea\u30dd\u30a4\u30f3\u30c8\uff08\u91cd\u8981\uff09","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u610f\u5473 \u30a8\u30f3\u30c8\u30ea\u30dd\u30a4\u30f3\u30c8 <code>app</code> \u6700\u521d\u306b\u547c\u3073\u51fa\u3055\u308c\u308b\u95a2\u6570\u540d <p>\u30a8\u30f3\u30c8\u30ea\u30dd\u30a4\u30f3\u30c8\u3068\u306f\uff1f</p> <p>\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u300c\u5165\u53e3\u300d\u3067\u3059\u3002\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u6765\u305f\u6642\u306b\u6700\u521d\u306b\u5b9f\u884c\u3055\u308c\u308b\u95a2\u6570\u306e\u540d\u524d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002</p> <pre><code>\u3010\u30a8\u30f3\u30c8\u30ea\u30dd\u30a4\u30f3\u30c8\u306e\u4ed5\u7d44\u307f\u3011\n\n\u30e6\u30fc\u30b6\u30fc\u304c\u30a2\u30af\u30bb\u30b9\n    \u2193\nCloud Run: \u300c\u30a8\u30f3\u30c8\u30ea\u30dd\u30a4\u30f3\u30c8\u306f 'app' \u3060\u306a\u300d\n    \u2193\n\u30b3\u30fc\u30c9\u5185\u306e functions.http('app', ...) \u3092\u5b9f\u884c\n    \u2193\n\u51e6\u7406\u958b\u59cb\n</code></pre> <p>\u30b3\u30fc\u30c9\u3068\u306e\u5bfe\u5fdc\uff08backend.js\uff09</p> <pre><code>// backend.js \u306e\u4e2d\u8eab\uff08\u629c\u7c8b\uff09\nfunctions.http('app', async (req, res) =&gt; {\n//              \u2191\n//     \u3053\u306e 'app' \u304c\u30a8\u30f3\u30c8\u30ea\u30dd\u30a4\u30f3\u30c8\u540d\n//     GCP\u306e\u8a2d\u5b9a\u3068\u4e00\u81f4\u3055\u305b\u308b\u5fc5\u8981\u304c\u3042\u308b\n    ...\n});\n</code></pre> <p>\u9593\u9055\u3048\u3084\u3059\u3044\u30dd\u30a4\u30f3\u30c8</p> \u8a2d\u5b9a\u7b87\u6240 \u8a2d\u5b9a\u5024 \u8aac\u660e GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u2192 \u30a8\u30f3\u30c8\u30ea\u30dd\u30a4\u30f3\u30c8 <code>app</code> GCP\u306b\u6559\u3048\u308b\u300c\u5165\u53e3\u306e\u540d\u524d\u300d backend.js \u2192 <code>functions.http('app', ...)</code> <code>app</code> \u30b3\u30fc\u30c9\u5185\u3067\u5b9a\u7fa9\u3057\u305f\u300c\u5165\u53e3\u306e\u540d\u524d\u300d <p>\u3053\u306e2\u3064\u304c\u4e00\u81f4\u3057\u3066\u3044\u306a\u3044\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002</p> <pre><code>\u30a8\u30e9\u30fc\u4f8b: Function 'helloWorld' is not defined\n\u539f\u56e0: GCP\u3067\u306f 'helloWorld' \u3092\u63a2\u3057\u3066\u3044\u308b\u304c\u3001\u30b3\u30fc\u30c9\u306b\u306f 'app' \u3057\u304b\u306a\u3044\n\u5bfe\u51e6: \u30a8\u30f3\u30c8\u30ea\u30dd\u30a4\u30f3\u30c8\u3092 'app' \u306b\u5909\u66f4\n</code></pre>"},{"location":"gcp-firebase/02_setup/#_24","title":"\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9","text":"<p>\u8a00\u8a9e\u306e\u9078\u629e</p> <p>Node.js\u7248\u3068Python\u7248\u3092\u7528\u610f\u3057\u3066\u3044\u307e\u3059\u3002\u3069\u3061\u3089\u3067\u3082\u540c\u3058\u6a5f\u80fd\u304c\u52d5\u4f5c\u3057\u307e\u3059\u3002</p> \u8a00\u8a9e \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9 \u7279\u5fb4 Node.js\uff08\u63a8\u5968\uff09 \u30b3\u30fc\u30c9\u3092\u898b\u308b JavaScript\u3002\u30a6\u30a7\u30d6\u958b\u767a\u3067\u6700\u3082\u4e00\u822c\u7684 Python \u30b3\u30fc\u30c9\u3092\u898b\u308b AI\u3084\u6a5f\u68b0\u5b66\u7fd2\u3067\u3088\u304f\u4f7f\u308f\u308c\u308b\u8a00\u8a9e <p>\u4ee5\u4e0b\u306e\u624b\u9806\u306fNode.js\u7248\u3067\u8aac\u660e\u3057\u307e\u3059\u3002Python\u7248\u3092\u4f7f\u3046\u5834\u5408\u306f\u3001\u30e9\u30f3\u30bf\u30a4\u30e0\u3092\u300cPython 3.11\u300d\u306b\u5909\u66f4\u3057\u3001<code>main.py</code>\u306bbackend.py\u306e\u5185\u5bb9\u3092\u8cbc\u308a\u4ed8\u3051\u3066\u304f\u3060\u3055\u3044\u3002</p> <p>\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\uff08Node.js\u7248\uff09</p> \u30d5\u30a1\u30a4\u30eb \u5f79\u5272 GCP\u3067\u306e\u64cd\u4f5c front.html \u753b\u9762\u306e\u30c7\u30b6\u30a4\u30f3\uff08HTML/CSS\uff09 \u65b0\u898f\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u8ffd\u52a0 script.js \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u306e\u51e6\u7406\uff08JavaScript\uff09 \u65b0\u898f\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u8ffd\u52a0 backend.js \u30b5\u30fc\u30d0\u30fc\u5074\u306e\u51e6\u7406 index.js \u306b\u8cbc\u308a\u4ed8\u3051 package.json \u4f7f\u7528\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u4e00\u89a7 package.json \u306b\u8cbc\u308a\u4ed8\u3051"},{"location":"gcp-firebase/02_setup/#gcp_1","title":"GCP\u3078\u306e\u8cbc\u308a\u4ed8\u3051\u624b\u9806","text":"<p>1. index.js \u3092\u8a2d\u5b9a</p> <ol> <li>\u5de6\u5074\u306e\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u3067\u300cindex.js\u300d\u3092\u30af\u30ea\u30c3\u30af</li> <li>\u65e2\u5b58\u306e\u30b3\u30fc\u30c9\u3092\u3059\u3079\u3066\u524a\u9664</li> <li>backend.js \u306e\u5185\u5bb9\u3092\u30b3\u30d4\u30fc\u3057\u3066\u8cbc\u308a\u4ed8\u3051</li> </ol> <p>2. front.html \u3092\u8ffd\u52a0</p> <ol> <li>\u5de6\u5074\u306e\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u306e\u4e0a\u306b\u3042\u308b\u300c\uff0b\u300d\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af</li> <li>\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u300c<code>front.html</code>\u300d\u3068\u5165\u529b</li> <li>front.html \u306e\u5185\u5bb9\u3092\u30b3\u30d4\u30fc\u3057\u3066\u8cbc\u308a\u4ed8\u3051</li> </ol> <p>3. script.js \u3092\u8ffd\u52a0</p> <ol> <li>\u5de6\u5074\u306e\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u306e\u4e0a\u306b\u3042\u308b\u300c\uff0b\u300d\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af</li> <li>\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u300c<code>script.js</code>\u300d\u3068\u5165\u529b</li> <li>script.js \u306e\u5185\u5bb9\u3092\u30b3\u30d4\u30fc\u3057\u3066\u8cbc\u308a\u4ed8\u3051</li> </ol> <p>\u91cd\u8981: Firebase\u8a2d\u5b9a\u306e\u66f8\u304d\u63db\u3048</p> <p>script.js \u5185\u306e <code>firebaseConfig</code> \u3092\u3001Step 2-3\u3067\u30e1\u30e2\u3057\u305f\u81ea\u5206\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u8a2d\u5b9a\u306b\u66f8\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u3002</p> <pre><code>const firebaseConfig = {\n    apiKey: \"AIzaSy...\",           // \u2190 \u81ea\u5206\u306e\u5024\u306b\u66f8\u304d\u63db\u3048\n    authDomain: \"xxx.firebaseapp.com\",  // \u2190 \u81ea\u5206\u306e\u5024\u306b\u66f8\u304d\u63db\u3048\n    projectId: \"your-project-id\",  // \u2190 \u81ea\u5206\u306e\u5024\u306b\u66f8\u304d\u63db\u3048\n    ...\n};\n</code></pre> <p>4. package.json \u3092\u8a2d\u5b9a</p> <ol> <li>\u5de6\u5074\u306e\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u3067\u300cpackage.json\u300d\u3092\u30af\u30ea\u30c3\u30af</li> <li>\u65e2\u5b58\u306e\u5185\u5bb9\u3092\u3059\u3079\u3066\u524a\u9664</li> <li>package.json \u306e\u5185\u5bb9\u3092\u30b3\u30d4\u30fc\u3057\u3066\u8cbc\u308a\u4ed8\u3051</li> </ol>"},{"location":"gcp-firebase/02_setup/#5-5","title":"5-5. \u30c7\u30d7\u30ed\u30a4","text":"<ol> <li>\u753b\u9762\u4e0b\u90e8\u306e\u300c\u4f5c\u6210\u300d\u307e\u305f\u306f\u300c\u30c7\u30d7\u30ed\u30a4\u300d\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af</li> <li>\u30c7\u30d7\u30ed\u30a4\u304c\u5b8c\u4e86\u3059\u308b\u307e\u3067\u5f85\u6a5f\uff082\u301c5\u5206\u7a0b\u5ea6\uff09</li> </ol> <p>\u30c7\u30d7\u30ed\u30a4\u4e2d\u306e\u753b\u9762 - \u9752\u3044\u5186\u304c\u56de\u8ee2\u3057\u3066\u3044\u308b: \u30c7\u30d7\u30ed\u30a4\u4e2d - \u7dd1\u306e\u30c1\u30a7\u30c3\u30af\u30de\u30fc\u30af: \u30c7\u30d7\u30ed\u30a4\u6210\u529f - \u8d64\u3044\u00d7\u30de\u30fc\u30af: \u30c7\u30d7\u30ed\u30a4\u5931\u6557\uff08\u30ed\u30b0\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\uff09</p>"},{"location":"gcp-firebase/02_setup/#5-6-url","title":"5-6. \u95a2\u6570URL\u306e\u78ba\u8a8d","text":"<ol> <li>\u30c7\u30d7\u30ed\u30a4\u5b8c\u4e86\u5f8c\u3001\u4f5c\u6210\u3057\u305f\u95a2\u6570\u540d\uff08<code>ai-chat-app</code>\uff09\u3092\u30af\u30ea\u30c3\u30af</li> <li>\u753b\u9762\u4e0a\u90e8\u306b\u8868\u793a\u3055\u308c\u308bURL\u3092\u30e1\u30e2</li> <li>\u4f8b: <code>https://ai-chat-app-xxxxx-an.a.run.app</code></li> <li>\u3053\u306eURL\u3092\u30d6\u30e9\u30a6\u30b6\u3067\u958b\u304f\u3068\u3001\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059</li> </ol> <p>\u72ec\u81ea\u30c9\u30e1\u30a4\u30f3\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408 \u672c\u756a\u74b0\u5883\u3067 <code>app.yourcompany.co.jp</code> \u306e\u3088\u3046\u306a\u72ec\u81ea\u30c9\u30e1\u30a4\u30f3\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306f\u3001 99_custom_domain.md \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"gcp-firebase/02_setup/#5-7-firebase","title":"5-7. Firebase\u8a8d\u8a3c\u6e08\u307f\u30c9\u30e1\u30a4\u30f3\u306e\u8ffd\u52a0\uff08\u91cd\u8981\uff09","text":"<p>Cloud Run\u306eURL\u3067Google\u30ed\u30b0\u30a4\u30f3\u3092\u4f7f\u7528\u3059\u308b\u306b\u306f\u3001\u627f\u8a8d\u6e08\u307f\u30c9\u30e1\u30a4\u30f3\u3078\u306e\u8ffd\u52a0\u304c\u5fc5\u9808\u3067\u3059\u3002</p>"},{"location":"gcp-firebase/02_setup/#_25","title":"\u306a\u305c\u5fc5\u8981\u304b\uff1f","text":"<p>Firebase Authentication\u306f\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u4e0a\u306e\u7406\u7531\u304b\u3089OAuth\u8a8d\u8a3c\u3092\u8a31\u53ef\u3059\u308b\u30c9\u30e1\u30a4\u30f3\u3092\u5236\u9650\u3057\u3066\u3044\u307e\u3059\u3002</p> <pre><code>\u3010\u627f\u8a8d\u6e08\u307f\u30c9\u30e1\u30a4\u30f3\u304c\u306a\u3044\u5834\u5408\u3011\n\n\u60aa\u610f\u306e\u3042\u308b\u30b5\u30a4\u30c8\uff08evil.com\uff09\n    \u2193\n\u3042\u306a\u305f\u306eFirebase\u8a8d\u8a3c\u3092\u57cb\u3081\u8fbc\u3082\u3046\u3068\u3059\u308b\n    \u2193\nFirebase: \u300cevil.com\u306f\u8a31\u53ef\u30ea\u30b9\u30c8\u306b\u306a\u3044\u306e\u3067\u62d2\u5426\uff01\u300d\n    \u2193\n\u30e6\u30fc\u30b6\u30fc\u306e\u8a8d\u8a3c\u60c5\u5831\u304c\u76d7\u307e\u308c\u308b\u3053\u3068\u3092\u9632\u6b62\n</code></pre> <p>\u3064\u307e\u308a\u3001\u3042\u306a\u305f\u306eCloud Run URL\u3082\u8a31\u53ef\u30ea\u30b9\u30c8\u306b\u8ffd\u52a0\u3057\u306a\u3044\u3068\u3001\u6b63\u898f\u306e\u30b5\u30a4\u30c8\u3067\u3082\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u307e\u305b\u3093\u3002</p>"},{"location":"gcp-firebase/02_setup/#_26","title":"\u8a2d\u5b9a\u624b\u9806","text":"<ol> <li>Firebase\u30b3\u30f3\u30bd\u30fc\u30eb \u2192 Authentication \u2192 Settings</li> <li>\u300c\u627f\u8a8d\u6e08\u307f\u30c9\u30e1\u30a4\u30f3\u300d \u30bf\u30d6\u3092\u30af\u30ea\u30c3\u30af</li> <li>\u300c\u30c9\u30e1\u30a4\u30f3\u3092\u8ffd\u52a0\u300d \u3092\u30af\u30ea\u30c3\u30af</li> <li>Cloud Run\u306eURL\uff08\u30db\u30b9\u30c8\u540d\u90e8\u5206\u306e\u307f\uff09\u3092\u5165\u529b:    <pre><code>ai-chat-app-xxxxx-an.a.run.app\n</code></pre>    \u203b <code>https://</code> \u306f\u542b\u3081\u306a\u3044</li> <li>\u300c\u8ffd\u52a0\u300d\u3092\u30af\u30ea\u30c3\u30af</li> </ol> <p>\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u8a31\u53ef\u3055\u308c\u3066\u3044\u308b\u30c9\u30e1\u30a4\u30f3</p> \u30c9\u30e1\u30a4\u30f3 \u8aac\u660e <code>localhost</code> \u30ed\u30fc\u30ab\u30eb\u958b\u767a\u7528 <code>xxx.firebaseapp.com</code> Firebase\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30c9\u30e1\u30a4\u30f3 <code>xxx.web.app</code> Firebase Hosting\u306e\u30c9\u30e1\u30a4\u30f3 <p>Cloud Run\u306eURL\u306f\u81ea\u52d5\u3067\u306f\u8ffd\u52a0\u3055\u308c\u306a\u3044\u305f\u3081\u3001\u624b\u52d5\u3067\u8ffd\u52a0\u304c\u5fc5\u8981\u3067\u3059\u3002</p>"},{"location":"gcp-firebase/02_setup/#step-6-5","title":"Step 6: \u52d5\u4f5c\u78ba\u8a8d\uff085\u5206\uff09","text":""},{"location":"gcp-firebase/02_setup/#6-1","title":"6-1. \u30a2\u30af\u30bb\u30b9\u78ba\u8a8d","text":"URL \u671f\u5f85\u3059\u308b\u7d50\u679c <code>https://[\u95a2\u6570URL]/</code> \u30ed\u30b0\u30a4\u30f3\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b <code>https://[\u95a2\u6570URL]/api/health</code> <code>{\"status\":\"ok\",\"timestamp\":\"...\"}</code> \u304c\u8868\u793a\u3055\u308c\u308b"},{"location":"gcp-firebase/02_setup/#6-2","title":"6-2. \u30ed\u30b0\u30a4\u30f3\u30c6\u30b9\u30c8","text":"<ol> <li>\u300cGoogle\u3067\u30ed\u30b0\u30a4\u30f3\u300d\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af</li> <li>Google\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u9078\u629e</li> <li>\u30ed\u30b0\u30a4\u30f3\u6210\u529f\u5f8c\u3001\u30c1\u30e3\u30c3\u30c8\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b</li> </ol>"},{"location":"gcp-firebase/02_setup/#6-3","title":"6-3. \u30c1\u30e3\u30c3\u30c8\u30c6\u30b9\u30c8","text":"<ol> <li>\u30c1\u30e3\u30c3\u30c8\u753b\u9762\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5165\u529b</li> <li>\u300c\u9001\u4fe1\u300d\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af</li> <li>AI\u304b\u3089\u306e\u56de\u7b54\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u6210\u529f</li> </ol> <p>\u30c0\u30df\u30fcAPI\u30ad\u30fc\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u5834\u5408 <code>/api/health</code> \u306f\u6210\u529f\u3057\u307e\u3059\u304c\u3001\u30c1\u30e3\u30c3\u30c8\u306f\u300cAI\u306e\u51e6\u7406\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u300d\u3068\u8868\u793a\u3055\u308c\u307e\u3059\u3002 \u672c\u756a\u306eOpenAI API\u30ad\u30fc\u3092\u8a2d\u5b9a\u3059\u308c\u3070\u3001\u30c1\u30e3\u30c3\u30c8\u3082\u52d5\u4f5c\u3057\u307e\u3059\u3002</p>"},{"location":"gcp-firebase/02_setup/#_27","title":"\u5b8c\u4e86\u30c1\u30a7\u30c3\u30af","text":"\u30c1\u30a7\u30c3\u30af \u78ba\u8a8d\u9805\u76ee \u2610 \u95a2\u6570URL\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b \u2610 Google\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b \u2610 \u30ed\u30b0\u30a4\u30f3\u5f8c\u3001\u30c1\u30e3\u30c3\u30c8\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b \u2610 <code>/api/health</code> \u3067 <code>{\"status\":\"ok\"}</code> \u304c\u8868\u793a\u3055\u308c\u308b \u2610 \u30d6\u30e9\u30a6\u30b6\u306b\u9375\u30de\u30fc\u30af\uff08HTTPS\uff09\u304c\u8868\u793a\u3055\u308c\u308b"},{"location":"gcp-firebase/02_setup/#_28","title":"\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0","text":""},{"location":"gcp-firebase/02_setup/#cloud-run-functions","title":"Cloud Run functions\u306e\u30c7\u30d7\u30ed\u30a4\u304c\u5931\u6557\u3059\u308b","text":"<ul> <li>Cloud Build API\u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d</li> <li>\u30b3\u30fc\u30c9\u306b\u30a8\u30e9\u30fc\u304c\u306a\u3044\u304b\u78ba\u8a8d\uff08\u30a4\u30f3\u30c7\u30f3\u30c8\u306e\u305a\u308c\u7b49\uff09</li> <li>\u30ed\u30b0\u3092\u78ba\u8a8d: Cloud Run \u2192\u300c\u30ed\u30b0\u300d\u30bf\u30d6</li> </ul>"},{"location":"gcp-firebase/02_setup/#status-ok","title":"\u300c{\"status\": \"ok\"}\u300d\u304c\u8868\u793a\u3055\u308c\u306a\u3044","text":"<ul> <li>\u95a2\u6570\u304c\u6b63\u5e38\u306b\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\uff08\u7dd1\u306e\u30c1\u30a7\u30c3\u30af\u30de\u30fc\u30af\uff09</li> <li>\u300c\u672a\u8a8d\u8a3c\u306e\u547c\u3073\u51fa\u3057\u3092\u8a31\u53ef\u300d\u304c\u9078\u629e\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d</li> <li>\u95a2\u6570URL\u304c\u6b63\u3057\u3044\u304b\u78ba\u8a8d</li> </ul>"},{"location":"gcp-firebase/02_setup/#_29","title":"\u30c1\u30e3\u30c3\u30c8\u3067\u30a8\u30e9\u30fc\u304c\u51fa\u308b","text":"<ul> <li>OpenAI API\u30ad\u30fc\u304c\u6b63\u3057\u304f\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d</li> <li>Secret Manager\u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u540d\u304c <code>openai-api-key</code> \u306b\u306a\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d</li> <li>\u74b0\u5883\u5909\u6570\u540d\u304c <code>OPENAI_API_KEY</code> \u306b\u306a\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d</li> </ul>"},{"location":"gcp-firebase/02_setup/#cors","title":"CORS\u30a8\u30e9\u30fc\u304c\u51fa\u308b","text":"<ul> <li>\u30b3\u30fc\u30c9\u5185\u306eCORS\u8a2d\u5b9a\u304c\u6b63\u3057\u3044\u304b\u78ba\u8a8d</li> <li><code>Access-Control-Allow-Origin: *</code> \u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d</li> </ul>"},{"location":"gcp-firebase/02_setup/#url","title":"\u91cd\u8981\u306aURL","text":"\u30b5\u30fc\u30d3\u30b9 URL GCP\u30b3\u30f3\u30bd\u30fc\u30eb https://console.cloud.google.com Firebase\u30b3\u30f3\u30bd\u30fc\u30eb https://console.firebase.google.com OpenAI API\u30ad\u30fc\u53d6\u5f97 https://platform.openai.com/api-keys"},{"location":"gcp-firebase/02_setup/#_30","title":"\u672c\u756a\u904b\u7528\u6642\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a","text":"<p>\u672c\u756a\u74b0\u5883\u3067\u904b\u7528\u3059\u308b\u969b\u306f\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u5fc5\u305a\u884c\u3063\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"gcp-firebase/02_setup/#_31","title":"\u5fc5\u9808\u8a2d\u5b9a","text":"\u9805\u76ee \u73fe\u72b6\uff08\u958b\u767a\u7528\uff09 \u672c\u756a\u8a2d\u5b9a CORS\u8a2d\u5b9a <code>'*'</code>\uff08\u5168\u8a31\u53ef\uff09 \u81ea\u5206\u306e\u30c9\u30e1\u30a4\u30f3\u306e\u307f\u8a31\u53ef\u306b\u5909\u66f4 ALLOWED\u8a2d\u5b9a \u672a\u8a2d\u5b9a\uff08\u5168\u54e1\u8a31\u53ef\uff09 <code>ALLOWED_EMAILS</code> \u307e\u305f\u306f <code>ALLOWED_DOMAINS</code> \u3092\u5fc5\u305a\u8a2d\u5b9a Firebase\u8a2d\u5b9a \u30b5\u30f3\u30d7\u30eb\u5024 \u81ea\u5206\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u5024\u306b\u66f8\u304d\u63db\u3048"},{"location":"gcp-firebase/02_setup/#cors_1","title":"CORS\u8a2d\u5b9a\u306e\u5909\u66f4\u65b9\u6cd5","text":"<p><code>backend.js</code> \u306e\u4ee5\u4e0b\u306e\u90e8\u5206\u3092\u5909\u66f4\u3057\u307e\u3059\uff1a</p> <pre><code>// \u5909\u66f4\u524d\uff08\u958b\u767a\u7528\uff09\nconst ALLOWED_ORIGINS = ['*'];\n\n// \u5909\u66f4\u5f8c\uff08\u672c\u756a\u7528\uff09- \u81ea\u5206\u306e\u30c9\u30e1\u30a4\u30f3\u306e\u307f\u8a31\u53ef\nconst ALLOWED_ORIGINS = [\n    'https://your-app.web.app',\n    'https://your-domain.com'\n];\n</code></pre>"},{"location":"gcp-firebase/02_setup/#_32","title":"\u30a2\u30af\u30bb\u30b9\u5236\u9650\u306e\u8a2d\u5b9a","text":"<p>GCP\u306e\u74b0\u5883\u5909\u6570\u3067\u4ee5\u4e0b\u3092\u8a2d\u5b9a\u3057\u307e\u3059\uff1a</p> \u74b0\u5883\u5909\u6570 \u8a2d\u5b9a\u4f8b \u8aac\u660e <code>ALLOWED_EMAILS</code> <code>admin@example.com,user1@example.com</code> \u8a31\u53ef\u3059\u308b\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\uff08\u30ab\u30f3\u30de\u533a\u5207\u308a\uff09 <code>ALLOWED_DOMAINS</code> <code>@yourcompany.co.jp</code> \u8a31\u53ef\u3059\u308b\u30c9\u30e1\u30a4\u30f3\uff08@\u3092\u542b\u3080\u3001\u30ab\u30f3\u30de\u533a\u5207\u308a\uff09 <p>\u6ce8\u610f: \u4e21\u65b9\u3068\u3082\u672a\u8a2d\u5b9a\u306e\u5834\u5408\u3001\u958b\u767a\u7528\u3068\u3057\u3066\u5168\u54e1\u304c\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002 \u672c\u756a\u3067\u306f\u5fc5\u305a\u3069\u3061\u3089\u304b\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"gcp-firebase/02_setup/#_33","title":"\u63a8\u5968\u8a2d\u5b9a\uff08\u3088\u308a\u5b89\u5168\u306b\u904b\u7528\u3057\u305f\u3044\u5834\u5408\uff09","text":"\u9805\u76ee \u8aac\u660e \u5bfe\u5fdc\u65b9\u6cd5 JWT\u7f72\u540d\u691c\u8a3c \u30c8\u30fc\u30af\u30f3\u306e\u6539\u3056\u3093\u9632\u6b62\u3092\u5f37\u5316 <code>firebase-admin</code> \u30d1\u30c3\u30b1\u30fc\u30b8\u3067\u691c\u8a3c\u3092\u8ffd\u52a0 \u30ec\u30fc\u30c8\u5236\u9650 \u5927\u91cf\u30ea\u30af\u30a8\u30b9\u30c8\u653b\u6483\u306e\u9632\u6b62 Cloud Armor \u3092\u8a2d\u5b9a \u30ed\u30b0\u76e3\u8996 \u4e0d\u6b63\u30a2\u30af\u30bb\u30b9\u306e\u691c\u77e5 Cloud Logging \u3067\u30a2\u30e9\u30fc\u30c8\u8a2d\u5b9a <p>\u88dc\u8db3: \u73fe\u5728\u306e\u5b9f\u88c5\u3067\u3082\u57fa\u672c\u7684\u306a\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306f\u78ba\u4fdd\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u4e0a\u8a18\u306f\u5927\u898f\u6a21\u904b\u7528\u3084\u6a5f\u5bc6\u6027\u306e\u9ad8\u3044\u30c7\u30fc\u30bf\u3092\u6271\u3046\u5834\u5408\u306e\u8ffd\u52a0\u5bfe\u7b56\u3067\u3059\u3002</p>"},{"location":"gcp-firebase/02_setup/#_34","title":"\u53c2\u8003: \u5225\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u30d1\u30bf\u30fc\u30f3","text":"<p>\u3088\u308a\u8907\u96d1\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3084\u9577\u6642\u9593\u51e6\u7406\u304c\u5fc5\u8981\u306a\u5834\u5408\u306f\u3001Cloud Run\u3092\u4f7f\u7528\u3059\u308b\u65b9\u6cd5\u3082\u3042\u308a\u307e\u3059\u3002</p> <p>\u8a73\u7d30\u306f 99_cloudrun.md \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"gcp-firebase/03_deploy_cost/","title":"\u30c6\u30ca\u30f3\u30c8\u8ffd\u52a0\u624b\u9806 &amp; \u8cbb\u7528\u898b\u7a4d\u3082\u308a","text":"\u9805\u76ee \u5185\u5bb9 \u5bfe\u8c61 2\u3064\u76ee\u4ee5\u964d\u306e\u30c6\u30ca\u30f3\u30c8\u8ffd\u52a0\u6642 \u4f5c\u696d\u6642\u9593 \u7d0430\u5206\uff08\uff0bDNS\u53cd\u6620\u5f85\u3061\uff09"},{"location":"gcp-firebase/03_deploy_cost/#_2","title":"\u30c6\u30ca\u30f3\u30c8\u8ffd\u52a0\u624b\u9806","text":"<p>\u57fa\u76e4\uff08GCP/Firebase\uff09\u306f\u521d\u56de\u3067\u69cb\u7bc9\u6e08\u307f\u306a\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u4f5c\u696d\u306e\u307f\u3067OK\u3002</p>"},{"location":"gcp-firebase/03_deploy_cost/#step-1-5","title":"Step 1: \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u4f5c\u6210\uff085\u5206\uff09","text":"<ol> <li>GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u2192\u300cIAM\u3068\u7ba1\u7406\u300d\u2192\u300c\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u300d</li> <li>\u300c\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u6210\u300d</li> <li>\u540d\u524d: <code>sa-tenant-b</code>\uff08\u30c6\u30ca\u30f3\u30c8B\u306e\u5834\u5408\uff09</li> <li>\u30ed\u30fc\u30eb:\u300cSecret Manager \u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8 \u30a2\u30af\u30bb\u30b5\u30fc\u300d</li> <li>\u300c\u5b8c\u4e86\u300d</li> </ol>"},{"location":"gcp-firebase/03_deploy_cost/#step-2-api5","title":"Step 2: API\u30ad\u30fc\u767b\u9332\uff085\u5206\uff09","text":"<ol> <li>GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u2192\u300cSecret Manager\u300d\u2192\u300c\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u4f5c\u6210\u300d</li> <li>\u540d\u524d: <code>tenant-b-openai-key</code></li> <li>\u5024: API\u30ad\u30fc\u3092\u5165\u529b \u2192\u300c\u4f5c\u6210\u300d</li> <li>\u4f5c\u6210\u3057\u305f\u30b7\u30fc\u30af\u30ec\u30c3\u30c8 \u2192\u300c\u6a29\u9650\u300d\u2192\u300c\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u300d</li> <li>\u30d7\u30ea\u30f3\u30b7\u30d1\u30eb: <code>sa-tenant-b@[PROJECT_ID].iam.gserviceaccount.com</code></li> <li>\u30ed\u30fc\u30eb:\u300cSecret Manager \u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8 \u30a2\u30af\u30bb\u30b5\u30fc\u300d</li> </ol>"},{"location":"gcp-firebase/03_deploy_cost/#step-3-cloud-run10","title":"Step 3: Cloud Run\u4f5c\u6210\uff0810\u5206\uff09","text":"<ol> <li>GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u2192\u300cCloud Run\u300d\u2192\u300c\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\u300d</li> <li>\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8: \u30a2\u30d7\u30ea\u306e\u30a4\u30e1\u30fc\u30b8URL</li> <li>\u30b5\u30fc\u30d3\u30b9\u540d: <code>ai-platform-tenant-b</code></li> <li>\u30ea\u30fc\u30b8\u30e7\u30f3: <code>asia-northeast1</code></li> <li>\u8a8d\u8a3c:\u300c\u672a\u8a8d\u8a3c\u306e\u547c\u3073\u51fa\u3057\u3092\u8a31\u53ef\u300d</li> <li>\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3 \u2192 \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8: <code>sa-tenant-b</code></li> <li>\u300c\u4f5c\u6210\u300d</li> <li>\u4f5c\u6210\u5f8c \u2192\u300c\u5909\u6570\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u300d\u3067\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u7d10\u4ed8\u3051</li> </ol>"},{"location":"gcp-firebase/03_deploy_cost/#step-4-5","title":"Step 4: \u30c9\u30e1\u30a4\u30f3\u8a2d\u5b9a\uff085\u5206\uff0b\u5f85\u3061\u6642\u9593\uff09","text":"<ol> <li>Cloud Run \u2192 \u30b5\u30fc\u30d3\u30b9 \u2192\u300c\u30c9\u30e1\u30a4\u30f3 \u30de\u30c3\u30d4\u30f3\u30b0\u3092\u7ba1\u7406\u300d</li> <li>\u30c9\u30e1\u30a4\u30f3: <code>companyb.example.co.jp</code></li> <li>DNS\u7ba1\u7406\u753b\u9762\u3067CNAME\u30ec\u30b3\u30fc\u30c9\u8ffd\u52a0:</li> <li>\u30db\u30b9\u30c8: <code>companyb</code></li> <li>\u5024: <code>ghs.googlehosted.com</code></li> <li>Firebase \u2192 Authentication \u2192\u300c\u627f\u8a8d\u6e08\u307f\u30c9\u30e1\u30a4\u30f3\u300d\u306b\u8ffd\u52a0</li> </ol>"},{"location":"gcp-firebase/03_deploy_cost/#_3","title":"\u5b8c\u4e86\u30c1\u30a7\u30c3\u30af","text":"\u30c1\u30a7\u30c3\u30af \u78ba\u8a8d\u9805\u76ee \u2610 https://companyb.example.co.jp \u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b \u2610 SSL\u8a3c\u660e\u66f8\u304c\u6709\u52b9\uff08\u9375\u30de\u30fc\u30af\u8868\u793a\uff09 \u2610 Google\u30ed\u30b0\u30a4\u30f3\u304c\u52d5\u4f5c\u3059\u308b"},{"location":"gcp-firebase/03_deploy_cost/#_4","title":"\u8cbb\u7528\u898b\u7a4d\u3082\u308a","text":""},{"location":"gcp-firebase/03_deploy_cost/#_5","title":"\u6708\u984d\u8cbb\u7528\u307e\u3068\u3081","text":"\u898f\u6a21 \u6708\u984d \u5185\u8a33 1\u30c6\u30ca\u30f3\u30c8 \u7d04$5\u301c15 Cloud Run $5\u301c15 3\u30c6\u30ca\u30f3\u30c8 \u7d04$15\u301c45 Cloud Run \u00d7 3 5\u30c6\u30ca\u30f3\u30c8 \u7d04$25\u301c75 Cloud Run \u00d7 5 <p>\u6ce8\u610f: AI API\uff08OpenAI\u3001Anthropic\u7b49\uff09\u306e\u5229\u7528\u6599\u91d1\u306f\u5225\u9014\u767a\u751f\u3057\u307e\u3059\u3002</p>"},{"location":"gcp-firebase/03_deploy_cost/#1","title":"1\u30c6\u30ca\u30f3\u30c8\u8ffd\u52a0\u6642\u306e\u8ffd\u52a0\u30b3\u30b9\u30c8","text":"\u9805\u76ee \u6708\u984d Cloud Run $5\u301c20 Secret Manager \u301c$0.1 \u5408\u8a08 \u7d04$5\u301c20"},{"location":"gcp-firebase/03_deploy_cost/#_6","title":"\u7121\u6599\u67a0","text":"\u30b5\u30fc\u30d3\u30b9 \u7121\u6599\u67a0 Cloud Run \u6708200\u4e07\u30ea\u30af\u30a8\u30b9\u30c8 Firebase Auth \u67085\u4e07\u8a8d\u8a3c Secret Manager 6\u30b7\u30fc\u30af\u30ec\u30c3\u30c8"},{"location":"gcp-firebase/03_deploy_cost/#_7","title":"\u3088\u304f\u3042\u308b\u8cea\u554f","text":""},{"location":"gcp-firebase/03_deploy_cost/#q","title":"Q: \u60f3\u5b9a\u3088\u308a\u8cbb\u7528\u304c\u9ad8\u304f\u306a\u3063\u305f\u5834\u5408\u306f\uff1f","text":"<p>\u4ee5\u4e0b\u3092\u78ba\u8a8d: 1. Cloud Run\u306e\u6700\u5c0f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u6570\u304c0\u304b\u78ba\u8a8d\uff081\u4ee5\u4e0a\u3060\u3068\u5e38\u6642\u8ab2\u91d1\uff09 2. \u4f7f\u3063\u3066\u3044\u306a\u3044\u30b5\u30fc\u30d3\u30b9\u3092\u524a\u9664 3. GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u2192\u300c\u304a\u652f\u6255\u3044\u300d\u2192\u300c\u4e88\u7b97\u3068\u30a2\u30e9\u30fc\u30c8\u300d\u3067\u4e88\u7b97\u8a2d\u5b9a</p>"},{"location":"gcp-firebase/03_deploy_cost/#q-ai-api","title":"Q: AI API\u306e\u6599\u91d1\u306f\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u304b\uff1f","text":"<p>\u542b\u307e\u308c\u3066\u3044\u307e\u305b\u3093\u3002OpenAI\u3001Anthropic\u7b49\u306e\u6599\u91d1\u306f\u5404\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u306b\u76f4\u63a5\u652f\u6255\u3044\u3067\u3059\u3002</p>"},{"location":"gcp-firebase/03_deploy_cost/#_8","title":"\u4e88\u7b97\u30a2\u30e9\u30fc\u30c8\u306e\u8a2d\u5b9a\uff08\u63a8\u5968\uff09","text":"<ol> <li>GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u2192\u300c\u304a\u652f\u6255\u3044\u300d\u2192\u300c\u4e88\u7b97\u3068\u30a2\u30e9\u30fc\u30c8\u300d</li> <li>\u300c\u4e88\u7b97\u3092\u4f5c\u6210\u300d</li> <li>\u4e88\u7b97\u984d: $50\uff08\u4f8b\uff09</li> <li>\u30a2\u30e9\u30fc\u30c8: 50%\u300180%\u3001100%\u5230\u9054\u6642\u306b\u901a\u77e5</li> <li>\u901a\u77e5\u5148\u30e1\u30fc\u30eb\u3092\u8a2d\u5b9a \u2192\u300c\u4fdd\u5b58\u300d</li> </ol>"},{"location":"gcp-firebase/99_cloudrun/","title":"Cloud Run\uff08\u30b5\u30fc\u30d3\u30b9\uff09\u7248\u69cb\u7bc9\u624b\u9806\uff08Docker\u30a4\u30e1\u30fc\u30b8\u30d1\u30bf\u30fc\u30f3\uff09","text":"<p>\u3053\u306e\u8cc7\u6599\u306f\u3001Cloud Run\uff08\u30b5\u30fc\u30d3\u30b9\uff09\u3092\u4f7f\u7528\u3057\u3066\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u5834\u5408\u306e\u624b\u9806\u3067\u3059\u3002 Docker\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\u3001\u30ed\u30fc\u30ab\u30eb\u3067\u306eDocker\u74b0\u5883\u307e\u305f\u306fCloud Build\u304c\u5fc5\u8981\u3067\u3059\u3002</p> <p>\u30b7\u30f3\u30d7\u30eb\u306a\u69cb\u6210\u306b\u306fCloud Run functions\u7248\uff0802_\u69cb\u7bc9\u624b\u9806\u66f8.md\uff09\u3092\u63a8\u5968\u3057\u307e\u3059\u3002</p>"},{"location":"gcp-firebase/99_cloudrun/#cloud-run","title":"Cloud Run\uff08\u30b5\u30fc\u30d3\u30b9\uff09\u3068\u306f","text":"<p>\u81ea\u5206\u306e\u30a2\u30d7\u30ea\u3092Google\u306e\u30b5\u30fc\u30d0\u30fc\u3067\u52d5\u304b\u3059\u30b5\u30fc\u30d3\u30b9\u3067\u3059\u3002</p> <pre><code>\u5f93\u6765\u306e\u65b9\u6cd5:\n\u81ea\u5206\u3067\u30b5\u30fc\u30d0\u30fc\u3092\u501f\u308a\u308b \u2192 OS\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb \u2192 Python\u3092\u5165\u308c\u308b \u2192 \u30a2\u30d7\u30ea\u3092\u8a2d\u7f6e \u2192 \u904b\u7528\u7ba1\u7406...\n\nCloud Run:\n\u30a2\u30d7\u30ea\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9 \u2192 Google\u304c\u5168\u90e8\u3084\u3063\u3066\u304f\u308c\u308b \u2192 \u52d5\u3044\u305f\uff01\n</code></pre> \u9805\u76ee \u8aac\u660e \u4f55\u304c\u3067\u304d\u308b\uff1f Web\u30a2\u30d7\u30ea\u3084\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\uff08API\uff09\u3092\u52d5\u304b\u305b\u308b \u7ba1\u7406\u306f\uff1f \u30b5\u30fc\u30d0\u30fc\u7ba1\u7406\u4e0d\u8981\uff08Google\u304c\u81ea\u52d5\u3067\u3084\u308b\uff09 \u6599\u91d1\u306f\uff1f \u4f7f\u3063\u305f\u5206\u3060\u3051\uff08\u30a2\u30af\u30bb\u30b9\u304c\u306a\u3051\u308c\u3070\u307b\u307c\u7121\u6599\uff09 \u5fc5\u8981\u306a\u3082\u306e \u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\uff08\u30a2\u30d7\u30ea\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\uff09"},{"location":"gcp-firebase/99_cloudrun/#cloud-runvs-cloud-run-functions","title":"Cloud Run\uff08\u30b5\u30fc\u30d3\u30b9\uff09vs Cloud Run functions","text":"<p>\u540d\u79f0\u306b\u3064\u3044\u3066 \u4ee5\u524d\u306f\u300cCloud Functions\u300d\u3068\u3044\u3046\u540d\u524d\u3067\u3057\u305f\u304c\u3001\u73fe\u5728\u306f\u300cCloud Run functions\u300d\u306b\u540d\u79f0\u5909\u66f4\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u672c\u8cc7\u6599\u3067\u306f\u300cCloud Run\uff08\u30b5\u30fc\u30d3\u30b9\uff09\u300d\u3068\u300cCloud Run functions\u300d\u3092\u533a\u5225\u3057\u3066\u8aac\u660e\u3057\u307e\u3059\u3002</p> \u9805\u76ee Cloud Run\uff08\u30b5\u30fc\u30d3\u30b9\uff09 Cloud Run functions \u30c7\u30d7\u30ed\u30a4\u65b9\u6cd5 Docker\u30a4\u30e1\u30fc\u30b8\u304c\u5fc5\u8981 \u30b3\u30fc\u30c9\u3060\u3051\u3067OK \u74b0\u5883\u69cb\u7bc9 Docker or Cloud Build\u5fc5\u8981 GCP\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u76f4\u63a5\u53ef\u80fd \u9069\u3057\u305f\u30b1\u30fc\u30b9 \u8907\u96d1\u306a\u30a2\u30d7\u30ea\u3001\u9577\u6642\u9593\u51e6\u7406 \u30b7\u30f3\u30d7\u30eb\u306aAPI\u3001\u30a4\u30d9\u30f3\u30c8\u99c6\u52d5 \u30b3\u30fc\u30eb\u30c9\u30b9\u30bf\u30fc\u30c8 \u3084\u3084\u9577\u3044 \u77ed\u3044 \u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u6027 \u9ad8\u3044\uff08OS\u3001\u30e9\u30a4\u30d6\u30e9\u30ea\u81ea\u7531\uff09 \u5236\u9650\u3042\u308a"},{"location":"gcp-firebase/99_cloudrun/#_1","title":"\u524d\u63d0\u6761\u4ef6","text":"<p>\u4ee5\u4e0b\u306e\u3044\u305a\u308c\u304b\u304c\u5fc5\u8981\uff1a - \u30ed\u30fc\u30ab\u30ebPC\u306bDocker\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b - \u307e\u305f\u306f\u3001Cloud Build\u3092\u4f7f\u7528\u3059\u308b\uff08GCP\u3067\u8ab2\u91d1\u304c\u767a\u751f\uff09</p>"},{"location":"gcp-firebase/99_cloudrun/#step-1","title":"Step 1: \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u4f5c\u6210","text":"<ol> <li>GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u2192\u300cIAM\u3068\u7ba1\u7406\u300d\u2192\u300c\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u300d</li> <li>\u300c\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u6210\u300d</li> <li>\u540d\u524d: <code>sa-tenant-a</code> \u2192 \u300c\u4f5c\u6210\u3057\u3066\u7d9a\u884c\u300d</li> <li>\u30ed\u30fc\u30eb\u306e\u4ed8\u4e0e\u306f\u30b9\u30ad\u30c3\u30d7\u2192\u300c\u5b8c\u4e86\u300d</li> </ol>"},{"location":"gcp-firebase/99_cloudrun/#step-2-apisecret-manager","title":"Step 2: API\u30ad\u30fc\u4fdd\u5b58\uff08Secret Manager\uff09","text":"<ol> <li>GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u2192\u300cSecret Manager\u300d\u2192\u300c\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u4f5c\u6210\u300d</li> <li>\u540d\u524d: <code>tenant-a-openai-key</code></li> <li>\u5024: API\u30ad\u30fc\u3092\u5165\u529b \u2192\u300c\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u4f5c\u6210\u300d</li> <li>\u4f5c\u6210\u3057\u305f\u30b7\u30fc\u30af\u30ec\u30c3\u30c8 \u2192\u300c\u6a29\u9650\u300d\u2192\u300c\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u300d</li> <li>\u30d7\u30ea\u30f3\u30b7\u30d1\u30eb: <code>sa-tenant-a@[PROJECT_ID].iam.gserviceaccount.com</code></li> <li>\u30ed\u30fc\u30eb:\u300cSecret Manager \u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8 \u30a2\u30af\u30bb\u30b5\u30fc\u300d\u2192\u300c\u4fdd\u5b58\u300d</li> </ol>"},{"location":"gcp-firebase/99_cloudrun/#step-3-cloud-run","title":"Step 3: Cloud Run\u30b5\u30fc\u30d3\u30b9\u4f5c\u6210","text":""},{"location":"gcp-firebase/99_cloudrun/#3-1","title":"3-1. \u30c6\u30b9\u30c8\u7528\u30a4\u30e1\u30fc\u30b8\u3067\u306e\u4f5c\u6210\uff08\u74b0\u5883\u78ba\u8a8d\u7528\uff09","text":"<ol> <li>GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u2192\u300cCloud Run\u300d\u2192\u300c\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\u300d</li> <li>\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8: <code>gcr.io/cloudrun/hello</code>\uff08\u30c6\u30b9\u30c8\u7528\uff09</li> <li>\u30b5\u30fc\u30d3\u30b9\u540d: <code>ai-platform-tenant-a</code></li> <li>\u30ea\u30fc\u30b8\u30e7\u30f3: <code>asia-northeast1</code>\uff08\u6771\u4eac\uff09</li> <li>\u8a8d\u8a3c:\u300c\u516c\u958b\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3059\u308b\u300d\u3092\u9078\u629e</li> <li>\u300c\u30b3\u30f3\u30c6\u30ca\u3001\u30dc\u30ea\u30e5\u30fc\u30e0\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30ad\u30f3\u30b0\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u300d\u3092\u5c55\u958b</li> </ol>"},{"location":"gcp-firebase/99_cloudrun/#_2","title":"\u30b3\u30f3\u30c6\u30ca\u8a2d\u5b9a","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u8aac\u660e \u30e1\u30e2\u30ea 1 GiB \u30a2\u30d7\u30ea\u304c\u4f7f\u7528\u3067\u304d\u308b\u30e1\u30e2\u30ea\u91cf CPU 1 \u51e6\u7406\u80fd\u529b \u30ea\u30af\u30a8\u30b9\u30c8\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8 300\u79d2 1\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u6700\u5927\u51e6\u7406\u6642\u9593"},{"location":"gcp-firebase/99_cloudrun/#_3","title":"\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8a2d\u5b9a","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u8aac\u660e \u6700\u5c0f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u6570 0 \u30a2\u30af\u30bb\u30b9\u304c\u306a\u3044\u6642\u306b\u8d77\u52d5\u3057\u3066\u304a\u304f\u6570 \u6700\u5927\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u6570 10 \u540c\u6642\u306b\u8d77\u52d5\u3067\u304d\u308b\u4e0a\u9650"},{"location":"gcp-firebase/99_cloudrun/#_4","title":"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a","text":"\u9805\u76ee \u8a2d\u5b9a\u5024 \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8 <code>sa-tenant-a</code> <ol> <li>\u300c\u4f5c\u6210\u300d\u2192 \u7dd1\u30c1\u30a7\u30c3\u30af\u304c\u51fa\u305f\u3089\u6210\u529f</li> </ol>"},{"location":"gcp-firebase/99_cloudrun/#3-2","title":"3-2. \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u7d10\u4ed8\u3051","text":"<ol> <li>\u4f5c\u6210\u3057\u305fCloud Run\u30b5\u30fc\u30d3\u30b9 \u2192\u300c\u65b0\u3057\u3044\u30ea\u30d3\u30b8\u30e7\u30f3\u3092\u7de8\u96c6\u3057\u3066\u30c7\u30d7\u30ed\u30a4\u300d</li> <li>\u300c\u5909\u6570\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u300d\u2192\u300c\uff0b\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u53c2\u7167\u300d</li> <li>\u4ee5\u4e0b\u3092\u8a2d\u5b9a:</li> </ol> \u9805\u76ee \u8a2d\u5b9a\u5024 \u540d\u524d1 <code>OPENAI_API_KEY</code> \u30b7\u30fc\u30af\u30ec\u30c3\u30c8 <code>tenant-a-openai-key</code> \u30d0\u30fc\u30b8\u30e7\u30f3 <code>latest</code> <ol> <li>\u300c\u5b8c\u4e86\u300d\u2192\u300c\u30c7\u30d7\u30ed\u30a4\u300d</li> </ol>"},{"location":"gcp-firebase/99_cloudrun/#step-4","title":"Step 4: \u672c\u756a\u7528\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306e\u30c7\u30d7\u30ed\u30a4","text":"<p>\u30c6\u30b9\u30c8\u7528\u30a4\u30e1\u30fc\u30b8\uff08<code>gcr.io/cloudrun/hello</code>\uff09\u3092\u81ea\u4f5c\u306e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306b\u7f6e\u304d\u63db\u3048\u307e\u3059\u3002</p>"},{"location":"gcp-firebase/99_cloudrun/#_5","title":"\u5fc5\u8981\u306a\u30d5\u30a1\u30a4\u30eb","text":"<p>backend/main.py <pre><code>from flask import Flask, request, jsonify\nfrom flask_cors import CORS\nimport os\nfrom openai import OpenAI\n\napp = Flask(__name__)\nCORS(app)\n\n@app.route('/health', methods=['GET'])\ndef health():\n    return jsonify({'status': 'ok'})\n\n@app.route('/chat', methods=['POST'])\ndef chat():\n    data = request.get_json()\n    message = data.get('message', '')\n\n    client = OpenAI(api_key=os.environ.get('OPENAI_API_KEY'))\n\n    response = client.chat.completions.create(\n        model=\"gpt-3.5-turbo\",\n        messages=[{\"role\": \"user\", \"content\": message}]\n    )\n\n    return jsonify({\n        'response': response.choices[0].message.content\n    })\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=int(os.environ.get('PORT', 8080)))\n</code></pre></p> <p>backend/requirements.txt <pre><code>flask==3.0.0\nflask-cors==4.0.0\nopenai==1.6.1\ngunicorn==21.2.0\n</code></pre></p> <p>backend/Dockerfile <pre><code>FROM python:3.11-slim\nWORKDIR /app\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\nCOPY . .\nENV PORT=8080\nCMD exec gunicorn --bind :$PORT --workers 1 --threads 8 --timeout 0 main:app\n</code></pre></p>"},{"location":"gcp-firebase/99_cloudrun/#a-docker","title":"\u30c7\u30d7\u30ed\u30a4\u65b9\u6cd5A: \u30ed\u30fc\u30ab\u30ebDocker\u4f7f\u7528","text":"<pre><code># 1. Docker\u30a4\u30e1\u30fc\u30b8\u3092\u30d3\u30eb\u30c9\ncd backend\ndocker build -t gcr.io/[PROJECT_ID]/ai-backend:latest .\n\n# 2. Container Registry\u306b\u30d7\u30c3\u30b7\u30e5\ndocker push gcr.io/[PROJECT_ID]/ai-backend:latest\n\n# 3. Cloud Run\u3092\u66f4\u65b0\ngcloud run deploy ai-platform-tenant-a \\\n  --image gcr.io/[PROJECT_ID]/ai-backend:latest \\\n  --region asia-northeast1\n</code></pre>"},{"location":"gcp-firebase/99_cloudrun/#b-cloud-builddocker","title":"\u30c7\u30d7\u30ed\u30a4\u65b9\u6cd5B: Cloud Build\u4f7f\u7528\uff08Docker\u4e0d\u8981\uff09","text":"<pre><code># backend\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u5b9f\u884c\ngcloud builds submit --tag gcr.io/[PROJECT_ID]/ai-backend:latest\n\n# Cloud Run\u3092\u66f4\u65b0\ngcloud run deploy ai-platform-tenant-a \\\n  --image gcr.io/[PROJECT_ID]/ai-backend:latest \\\n  --region asia-northeast1\n</code></pre>"},{"location":"gcp-firebase/99_cloudrun/#_6","title":"\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3068\u306f","text":"<p>\u30a2\u30d7\u30ea\u3092\u52d5\u304b\u3059\u305f\u3081\u306e\u300c\u5b8c\u6210\u54c1\u30d1\u30c3\u30b1\u30fc\u30b8\u300d\u3067\u3059\u3002</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       \u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  OS\uff08Linux\u7b49\uff09                   \u2502\n\u2502  \u5b9f\u884c\u74b0\u5883\uff08Python / Node.js \u7b49\uff09 \u2502\n\u2502  \u30e9\u30a4\u30d6\u30e9\u30ea\uff08Flask, React\u7b49\uff09    \u2502\n\u2502  \u3042\u306a\u305f\u306e\u30b3\u30fc\u30c9\uff08main.py\u7b49\uff09      \u2502\n\u2502  \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"gcp-firebase/99_cloudrun/#docker","title":"Docker\u3068\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u306e\u95a2\u4fc2","text":"\u7528\u8a9e \u8aac\u660e Docker \u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u308b\u30fb\u52d5\u304b\u3059\u305f\u3081\u306e\u30c4\u30fc\u30eb Dockerfile \u30a4\u30e1\u30fc\u30b8\u306e\u8a2d\u8a08\u56f3 \u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8 \u5b8c\u6210\u3057\u305f\u30d1\u30c3\u30b1\u30fc\u30b8 \u30b3\u30f3\u30c6\u30ca \u30a4\u30e1\u30fc\u30b8\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u72b6\u614b"},{"location":"gcp-firebase/99_cloudrun/#_7","title":"\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8a2d\u5b9a\u306e\u8003\u3048\u65b9","text":""},{"location":"gcp-firebase/99_cloudrun/#10-10","title":"\u3088\u304f\u3042\u308b\u8aa4\u89e3: \u6700\u592710 = 10\u4eba\u3057\u304b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u306a\u3044\uff1f","text":"<p>\u3044\u3044\u3048\u30011\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u8907\u6570\u4eba\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u51e6\u7406\u3067\u304d\u307e\u3059\u3002</p> <pre><code>1\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3042\u305f\u308a\u7d0480\u30ea\u30af\u30a8\u30b9\u30c8/\u79d2\u3092\u51e6\u7406\u53ef\u80fd\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\uff09\n\n\u6700\u5927\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u6570=10 \u306e\u5834\u5408:\n\u2192 10\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 \u00d7 80 = \u7d04800\u30ea\u30af\u30a8\u30b9\u30c8/\u79d2\u307e\u3067\u5bfe\u5fdc\u53ef\u80fd\n\u2192 \u540c\u6642\u306b\u6570\u767e\u301c\u6570\u5343\u4eba\u304c\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3082\u554f\u984c\u306a\u3057\n</code></pre>"},{"location":"gcp-firebase/99_cloudrun/#_8","title":"\u6700\u5c0f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u6570\u306e\u8003\u3048\u65b9","text":"\u8a2d\u5b9a \u30e1\u30ea\u30c3\u30c8 \u30c7\u30e1\u30ea\u30c3\u30c8 \u6700\u5c0f=0 \u30b3\u30b9\u30c8\u524a\u6e1b \u521d\u56de\u30a2\u30af\u30bb\u30b9\u304c\u9045\u3044\uff082-5\u79d2\uff09 \u6700\u5c0f=1\u4ee5\u4e0a \u5e38\u306b\u9ad8\u901f\u5fdc\u7b54 \u5e38\u6642\u8ab2\u91d1\u304c\u767a\u751f"},{"location":"gcp-firebase/99_cloudrun/#_9","title":"\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u306e\u95a2\u4fc2","text":"<pre><code>\u4f8b: sa-tenant-a \u304c\u4ee5\u4e0b\u3059\u3079\u3066\u306b\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u306a\u5834\u5408\n\nSecret Manager:\n\u251c\u2500\u2500 tenant-a-openai-key    \u2190 Cloud Run\u3067\u9078\u629e \u2192 \u4f7f\u7528\u3059\u308b\n\u251c\u2500\u2500 tenant-a-claude-key    \u2190 \u9078\u629e\u3057\u306a\u3044 \u2192 \u4f7f\u7528\u3057\u306a\u3044\n\u2514\u2500\u2500 tenant-a-backup-key    \u2190 \u9078\u629e\u3057\u306a\u3044 \u2192 \u4f7f\u7528\u3057\u306a\u3044\n</code></pre> \u8a2d\u5b9a \u5f79\u5272 \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8 Secret Manager\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u6a29\u9650 \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u7d10\u4ed8\u3051 \u3069\u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u4f7f\u3046\u304b\uff0b\u74b0\u5883\u5909\u6570\u540d"},{"location":"gcp-firebase/99_container/","title":"\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3068\u306f\uff08\u88dc\u8db3\u8cc7\u6599\uff09","text":"<p>\u3053\u306e\u8cc7\u6599\u306f\u300cCloud Run\uff08\u30b5\u30fc\u30d3\u30b9\uff09\u7248\u300d\u3067\u4f7f\u7528\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u306e\u89e3\u8aac\u3067\u3059\u3002 Cloud Run functions\u7248\uff0802_\u69cb\u7bc9\u624b\u9806\u66f8.md\uff09\u3067\u306f\u3001\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u306f\u4e0d\u8981\u3067\u3059\uff08\u30b3\u30fc\u30c9\u3092\u76f4\u63a5\u5165\u529b\u3059\u308b\u3060\u3051\uff09\u3002</p>"},{"location":"gcp-firebase/99_container/#_2","title":"\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092\u4e00\u8a00\u3067","text":"<p>\u30a2\u30d7\u30ea\u3092\u52d5\u304b\u3059\u305f\u3081\u306e\u300c\u5b8c\u6210\u54c1\u30d1\u30c3\u30b1\u30fc\u30b8\u300d \u3067\u3059\u3002</p>"},{"location":"gcp-firebase/99_container/#_3","title":"\u30a4\u30e1\u30fc\u30b8\u56f3","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       \u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  OS\uff08Linux\u7b49\uff09                   \u2502\n\u2502  \u5b9f\u884c\u74b0\u5883\uff08Python / Node.js \u7b49\uff09 \u2502\n\u2502  \u30e9\u30a4\u30d6\u30e9\u30ea\uff08Flask, React\u7b49\uff09    \u2502\n\u2502  \u3042\u306a\u305f\u306e\u30b3\u30fc\u30c9\uff08main.py\u7b49\uff09      \u2502\n\u2502  \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>\u30a2\u30d7\u30ea\u3092\u52d5\u304b\u3059\u306e\u306b\u5fc5\u8981\u306a\u3082\u306e\u304c\u5168\u90e8\u5165\u3063\u305fZIP\u30d5\u30a1\u30a4\u30eb\u306e\u3088\u3046\u306a\u3082\u306e\u3067\u3059\u3002</p>"},{"location":"gcp-firebase/99_container/#_4","title":"\u8eab\u8fd1\u306a\u4f8b\u3048\u3067\u7406\u89e3\u3059\u308b","text":"\u4f8b\u3048 \u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8 \u304a\u5f01\u5f53 \u3054\u98ef\u3001\u304a\u304b\u305a\u3001\u7bb8\u3001\u5bb9\u5668\u304c\u5168\u90e8\u30bb\u30c3\u30c8\u3002\u958b\u3051\u305f\u3089\u3059\u3050\u98df\u3079\u3089\u308c\u308b \u30a4\u30f3\u30b9\u30bf\u30f3\u30c8\u98df\u54c1 \u304a\u6e6f\u3092\u5165\u308c\u308b\u3060\u3051\u3067\u5b8c\u6210\u3002\u74b0\u5883\u3092\u9078\u3070\u306a\u3044 \u30b2\u30fc\u30e0\u30bd\u30d5\u30c8 \u672c\u4f53\u306b\u5165\u308c\u305f\u3089\u3059\u3050\u904a\u3079\u308b\u3002\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u306e\u72b6\u614b"},{"location":"gcp-firebase/99_container/#_5","title":"\u306a\u305c\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3046\u306e\u304b","text":""},{"location":"gcp-firebase/99_container/#_6","title":"\u5f93\u6765\u306e\u554f\u984c","text":"<pre><code>\u958b\u767a\u8005A: \u300c\u79c1\u306ePC\u3067\u306f\u52d5\u304f\u3093\u3067\u3059\u3051\u3069...\u300d\n\u958b\u767a\u8005B: \u300c\u3053\u3063\u3061\u3067\u306f\u52d5\u304b\u306a\u3044\u300d\n\u30b5\u30fc\u30d0\u30fc: \u300c\u672c\u756a\u74b0\u5883\u3067\u30a8\u30e9\u30fc\u304c\u51fa\u307e\u3057\u305f\u300d\n\n\u539f\u56e0:\n- Python\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u9055\u3046\n- \u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u9055\u3046\n- OS\u306e\u8a2d\u5b9a\u304c\u9055\u3046\n</code></pre>"},{"location":"gcp-firebase/99_container/#_7","title":"\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3067\u89e3\u6c7a","text":"<pre><code>\u958b\u767a\u8005A: \u300c\u3053\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3063\u3066\u300d\n\u958b\u767a\u8005B: \u300cOK\u3001\u52d5\u3044\u305f\u300d\n\u30b5\u30fc\u30d0\u30fc: \u300c\u540c\u3058\u30a4\u30e1\u30fc\u30b8\u306a\u306e\u3067\u540c\u3058\u52d5\u4f5c\u3067\u3059\u300d\n\n\u7406\u7531:\n- \u5168\u54e1\u304c\u540c\u3058\u300c\u30d1\u30c3\u30b1\u30fc\u30b8\u300d\u3092\u4f7f\u3046\n- \u74b0\u5883\u306e\u5dee\u7570\u304c\u306a\u304f\u306a\u308b\n</code></pre>"},{"location":"gcp-firebase/99_container/#gcriocloudrunhello","title":"\u624b\u9806\u66f8\u3067\u4f7f\u3063\u3066\u3044\u308b <code>gcr.io/cloudrun/hello</code>","text":"<p>\u3053\u308c\u306fGoogle\u304c\u7528\u610f\u3057\u305f\u30c6\u30b9\u30c8\u7528\u306e\u30b5\u30f3\u30d7\u30eb\u30a4\u30e1\u30fc\u30b8\u3067\u3059\u3002</p> \u9805\u76ee \u5185\u5bb9 \u63d0\u4f9b\u5143 Google\u516c\u5f0f \u4e2d\u8eab \u300cHello World\u300d\u3092\u8868\u793a\u3059\u308b\u3060\u3051\u306e\u30b7\u30f3\u30d7\u30eb\u306a\u30a2\u30d7\u30ea \u76ee\u7684 Cloud Run\u306e\u52d5\u4f5c\u78ba\u8a8d\u7528 Docker\u306e\u6e96\u5099 \u4e0d\u8981\uff08Google\u304c\u4f5c\u6210\u6e08\u307f\uff09 <p>URL\u3092\u6307\u5b9a\u3059\u308b\u3060\u3051\u3067\u3001\u3059\u3050\u306bCloud Run\u306b\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"gcp-firebase/99_container/#_8","title":"\u672c\u756a\u3067\u81ea\u5206\u306e\u30a2\u30d7\u30ea\u3092\u52d5\u304b\u3059\u5834\u5408\uff08\u53c2\u8003\uff09","text":"<p>\u672c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u306f\u884c\u3044\u307e\u305b\u3093\u304c\u3001\u53c2\u8003\u3068\u3057\u3066\u8a18\u8f09\u3057\u307e\u3059\u3002</p>"},{"location":"gcp-firebase/99_container/#1-pcdocker","title":"\u65b9\u6cd51: \u30ed\u30fc\u30ab\u30ebPC\u3067Docker\u3092\u4f7f\u3046","text":"<pre><code>1. Docker\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n2. Dockerfile \u3092\u66f8\u304f\n3. docker build \u3067\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\n4. Google Container Registry \u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n5. Cloud Run \u3067\u305d\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u6307\u5b9a\n</code></pre>"},{"location":"gcp-firebase/99_container/#2-cloud-buildgcp","title":"\u65b9\u6cd52: Cloud Build\uff08GCP\u30b5\u30fc\u30d3\u30b9\uff09\u3092\u4f7f\u3046","text":"<pre><code>1. \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3068Dockerfile\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n2. GCP\u304c\u30af\u30e9\u30a6\u30c9\u4e0a\u3067\u30d3\u30eb\u30c9\u3057\u3066\u304f\u308c\u308b\n3. \u81ea\u52d5\u7684\u306bContainer Registry\u306b\u4fdd\u5b58\u3055\u308c\u308b\n4. Cloud Run \u3067\u305d\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u6307\u5b9a\n\n\u203b \u30ed\u30fc\u30ab\u30ebPC\u306bDocker\u306f\u4e0d\u8981\n</code></pre>"},{"location":"gcp-firebase/99_container/#docker","title":"Docker\u3068\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u306e\u95a2\u4fc2","text":"\u7528\u8a9e \u8aac\u660e \u4f8b\u3048 Docker \u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u308b\u30fb\u52d5\u304b\u3059\u305f\u3081\u306e\u30c4\u30fc\u30eb \u5de5\u5834\u306e\u6a5f\u68b0 Dockerfile \u30a4\u30e1\u30fc\u30b8\u306e\u8a2d\u8a08\u56f3 \u88fd\u54c1\u306e\u8a2d\u8a08\u66f8 \u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8 \u5b8c\u6210\u3057\u305f\u30d1\u30c3\u30b1\u30fc\u30b8 \u5b8c\u6210\u3057\u305f\u88fd\u54c1 \u30b3\u30f3\u30c6\u30ca \u30a4\u30e1\u30fc\u30b8\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u72b6\u614b \u88fd\u54c1\u3092\u4f7f\u3063\u3066\u3044\u308b\u72b6\u614b"},{"location":"gcp-firebase/99_container/#_9","title":"\u307e\u3068\u3081","text":"\u65b9\u5f0f Docker\u306e\u6e96\u5099 \u7528\u9014 Cloud Run functions \u4e0d\u8981 \u30b7\u30f3\u30d7\u30eb\u306aAPI\uff08\u63a8\u5968\uff09 Cloud Run\uff08\u30b5\u30fc\u30d3\u30b9\uff09\u30c6\u30b9\u30c8\u7528 \u4e0d\u8981\uff08Google\u63d0\u4f9b\u30a4\u30e1\u30fc\u30b8\u4f7f\u7528\uff09 \u52d5\u4f5c\u78ba\u8a8d\u7528 Cloud Run\uff08\u30b5\u30fc\u30d3\u30b9\uff09\u672c\u756a\u7528 \u5fc5\u8981\uff08\u307e\u305f\u306f Cloud Build\uff09 \u8907\u96d1\u306a\u30a2\u30d7\u30ea <p>\u672c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u306fCloud Run functions\u7248\u3092\u63a1\u7528\u3057\u3066\u3044\u308b\u305f\u3081\u3001Docker/\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u306f\u4e0d\u8981\u3067\u3059\u3002</p>"},{"location":"gcp-firebase/99_custom_domain/","title":"\u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\u8a2d\u5b9a\uff08\u672c\u756a\u74b0\u5883\u5411\u3051\uff09","text":"<p>\u3053\u306e\u8cc7\u6599\u306f\u672c\u756a\u74b0\u5883\u3067\u72ec\u81ea\u30c9\u30e1\u30a4\u30f3\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306e\u624b\u9806\u3067\u3059\u3002 \u30c6\u30b9\u30c8\u74b0\u5883\u3067\u306fCloud Run\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30c9\u30e1\u30a4\u30f3\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\u3001\u3053\u306e\u624b\u9806\u306f\u4e0d\u8981\u3067\u3059\u3002</p>"},{"location":"gcp-firebase/99_custom_domain/#cloud-run","title":"Cloud Run\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30c9\u30e1\u30a4\u30f3\u306b\u3064\u3044\u3066","text":"<p>Cloud Run functions\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306aURL\u304c\u81ea\u52d5\u3067\u5272\u308a\u5f53\u3066\u3089\u308c\u307e\u3059\u3002</p> <pre><code>https://[\u30b5\u30fc\u30d3\u30b9\u540d]-[\u30e9\u30f3\u30c0\u30e0\u6587\u5b57\u5217]-[\u30ea\u30fc\u30b8\u30e7\u30f3].a.run.app\n\u4f8b: https://ai-chat-app-198203881336.asia-northeast1.run.app\n</code></pre> <p>\u3053\u306eURL\u306f\u305d\u306e\u307e\u307e\u4f7f\u7528\u3067\u304d\u307e\u3059\u304c\u3001\u672c\u756a\u74b0\u5883\u3067\u306f\u899a\u3048\u3084\u3059\u3044\u72ec\u81ea\u30c9\u30e1\u30a4\u30f3\uff08\u4f8b: <code>chat.yourcompany.com</code>\uff09\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3092\u63a8\u5968\u3057\u307e\u3059\u3002</p>"},{"location":"gcp-firebase/99_custom_domain/#firebase","title":"Firebase\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30c9\u30e1\u30a4\u30f3\u306b\u3064\u3044\u3066","text":"<p>\u30c6\u30b9\u30c8\u74b0\u5883\u3067\u4f7f\u7528\u3059\u308b\u30c7\u30d5\u30a9\u30eb\u30c8\u30c9\u30e1\u30a4\u30f3\u306b\u306f2\u7a2e\u985e\u3042\u308a\u307e\u3059\u3002</p> \u30c9\u30e1\u30a4\u30f3 \u8aac\u660e <code>project-id.web.app</code> \u65b0\u3057\u3044\u5f62\u5f0f\u3002\u3053\u3061\u3089\u3092\u4f7f\u7528\u63a8\u5968 <code>project-id.firebaseapp.com</code> \u65e7\u5f62\u5f0f\u3002\u4e92\u63db\u6027\u306e\u305f\u3081\u306b\u6b8b\u3055\u308c\u3066\u3044\u308b <p>\u3069\u3061\u3089\u3082\u540c\u3058\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u8868\u793a\u3057\u307e\u3059\u3002\u6a5f\u80fd\u7684\u306a\u9055\u3044\u306f\u3042\u308a\u307e\u305b\u3093\u3002 <code>web.app</code> \u306e\u65b9\u304c\u77ed\u304f\u3066\u899a\u3048\u3084\u3059\u3044\u305f\u3081\u3001\u30c6\u30b9\u30c8\u74b0\u5883\u3067\u306f <code>web.app</code> \u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p> <p>\u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\u3092\u8a2d\u5b9a\u3059\u308b\u5834\u5408\u3001\u3053\u308c\u3089\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30c9\u30e1\u30a4\u30f3\u3082\u5f15\u304d\u7d9a\u304d\u6709\u52b9\u3067\u3059\u3002 \u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\u8a2d\u5b9a\u5f8c\u3082 <code>project-id.web.app</code> \u3067\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u3067\u3059\u3002</p>"},{"location":"gcp-firebase/99_custom_domain/#_2","title":"\u524d\u63d0\u6761\u4ef6","text":"<ul> <li>\u72ec\u81ea\u30c9\u30e1\u30a4\u30f3\u3092\u53d6\u5f97\u6e08\u307f\uff08\u4f8b: <code>example.com</code>\uff09</li> <li>\u30c9\u30e1\u30a4\u30f3\u306eDNS\u8a2d\u5b9a\u3092\u5909\u66f4\u3067\u304d\u308b\u6a29\u9650\u304c\u3042\u308b</li> </ul>"},{"location":"gcp-firebase/99_custom_domain/#_3","title":"\u5168\u4f53\u50cf","text":"<pre><code>\u30e6\u30fc\u30b6\u30fc\n   |\n   | https://app.example.com\uff08\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\uff09\n   v\nFirebase Hosting \u2190 \u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\u8a2d\u5b9a\n   |\n   | API\u30ea\u30af\u30a8\u30b9\u30c8\n   | https://api.example.com\uff08\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\uff09\n   v\nCloud Run \u2190 \u30c9\u30e1\u30a4\u30f3\u30de\u30c3\u30d4\u30f3\u30b0\u8a2d\u5b9a\n</code></pre> \u7528\u9014 \u30c7\u30d5\u30a9\u30eb\u30c8URL \u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\u4f8b \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9 <code>project-id.web.app</code> <code>app.example.com</code> \u30d0\u30c3\u30af\u30a8\u30f3\u30c9 <code>service-xxx.run.app</code> <code>api.example.com</code>"},{"location":"gcp-firebase/99_custom_domain/#step-1-cloud-run","title":"Step 1: Cloud Run\u306e\u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\u8a2d\u5b9a","text":""},{"location":"gcp-firebase/99_custom_domain/#1-1","title":"1-1. \u30c9\u30e1\u30a4\u30f3\u30de\u30c3\u30d4\u30f3\u30b0\u306e\u8ffd\u52a0","text":"<ol> <li>GCP\u30b3\u30f3\u30bd\u30fc\u30eb \u2192\u300cCloud Run\u300d\u2192 \u5bfe\u8c61\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u30af\u30ea\u30c3\u30af</li> <li>\u300c\u30c9\u30e1\u30a4\u30f3\u30de\u30c3\u30d4\u30f3\u30b0\u300d\u30bf\u30d6 \u2192\u300c\u30de\u30c3\u30d4\u30f3\u30b0\u3092\u8ffd\u52a0\u300d</li> <li>\u300cCloud Run\u30c9\u30e1\u30a4\u30f3\u30de\u30c3\u30d4\u30f3\u30b0\u3092\u4f7f\u7528\u300d\u3092\u9078\u629e</li> <li>\u30c9\u30e1\u30a4\u30f3: <code>api.example.com</code>\uff08\u30b5\u30d6\u30c9\u30e1\u30a4\u30f3\u63a8\u5968\uff09</li> <li>\u300c\u7d9a\u884c\u300d</li> </ol>"},{"location":"gcp-firebase/99_custom_domain/#1-2-dns","title":"1-2. DNS\u8a2d\u5b9a","text":"<p>\u8868\u793a\u3055\u308c\u308bDNS\u30ec\u30b3\u30fc\u30c9\u60c5\u5831\u3092\u30e1\u30e2\u3057\u3001\u30c9\u30e1\u30a4\u30f3\u306eDNS\u8a2d\u5b9a\u753b\u9762\u3067\u8ffd\u52a0\u3057\u307e\u3059\u3002</p> \u30ec\u30b3\u30fc\u30c9\u30bf\u30a4\u30d7 \u30db\u30b9\u30c8\u540d \u5024 CNAME <code>api</code> <code>ghs.googlehosted.com.</code> <p>\u6ce8\u610f: CNAME\u30ec\u30b3\u30fc\u30c9\u306e\u5024\u306e\u672b\u5c3e\u306b\u30d4\u30ea\u30aa\u30c9\uff08<code>.</code>\uff09\u304c\u5fc5\u8981\u306a\u5834\u5408\u304c\u3042\u308a\u307e\u3059\uff08DNS\u4e8b\u696d\u8005\u306b\u3088\u308b\uff09</p>"},{"location":"gcp-firebase/99_custom_domain/#1-3-ssl","title":"1-3. SSL\u8a3c\u660e\u66f8\u306e\u767a\u884c\u5f85\u3061","text":"<ul> <li>\u30c9\u30e1\u30a4\u30f3\u30de\u30c3\u30d4\u30f3\u30b0\u5f8c\u3001Google\u304cSSL\u8a3c\u660e\u66f8\u3092\u81ea\u52d5\u767a\u884c\u3057\u307e\u3059</li> <li>\u901a\u5e3815\u301c30\u5206\u7a0b\u5ea6\u304b\u304b\u308a\u307e\u3059</li> <li>\u8a3c\u660e\u66f8\u767a\u884c\u5b8c\u4e86\u5f8c\u3001<code>https://api.example.com</code> \u3067\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059</li> </ul>"},{"location":"gcp-firebase/99_custom_domain/#1-4","title":"1-4. \u78ba\u8a8d\u65b9\u6cd5","text":"<pre><code>\u30b9\u30c6\u30fc\u30bf\u30b9\u78ba\u8a8d:\nGCP\u30b3\u30f3\u30bd\u30fc\u30eb \u2192 Cloud Run \u2192 \u30c9\u30e1\u30a4\u30f3\u30de\u30c3\u30d4\u30f3\u30b0\n\u2192 \u7dd1\u306e\u30c1\u30a7\u30c3\u30af\u30de\u30fc\u30af\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u5b8c\u4e86\n</code></pre>"},{"location":"gcp-firebase/99_custom_domain/#step-2-firebase-hosting","title":"Step 2: Firebase Hosting\u306e\u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\u8a2d\u5b9a","text":""},{"location":"gcp-firebase/99_custom_domain/#2-1","title":"2-1. \u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\u306e\u8ffd\u52a0","text":"<ol> <li>Firebase\u30b3\u30f3\u30bd\u30fc\u30eb \u2192\u300cHosting\u300d\u2192\u300c\u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\u3092\u8ffd\u52a0\u300d</li> <li>\u30c9\u30e1\u30a4\u30f3: <code>app.example.com</code></li> <li>\u300c\u7d9a\u884c\u300d</li> </ol>"},{"location":"gcp-firebase/99_custom_domain/#2-2","title":"2-2. \u30c9\u30e1\u30a4\u30f3\u6240\u6709\u6a29\u306e\u78ba\u8a8d","text":"<p>Firebase\u304c\u8868\u793a\u3059\u308bTXT\u30ec\u30b3\u30fc\u30c9\u3092DNS\u306b\u8ffd\u52a0\u3057\u3066\u6240\u6709\u6a29\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002</p> \u30ec\u30b3\u30fc\u30c9\u30bf\u30a4\u30d7 \u30db\u30b9\u30c8\u540d \u5024 TXT <code>app</code> <code>firebase=xxxxxxxxxxxx</code>\uff08\u8868\u793a\u3055\u308c\u305f\u5024\uff09"},{"location":"gcp-firebase/99_custom_domain/#2-3-dns","title":"2-3. DNS\u8a2d\u5b9a","text":"<p>\u6240\u6709\u6a29\u78ba\u8a8d\u5f8c\u3001\u4ee5\u4e0b\u306e\u30ec\u30b3\u30fc\u30c9\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002</p> \u30ec\u30b3\u30fc\u30c9\u30bf\u30a4\u30d7 \u30db\u30b9\u30c8\u540d \u5024 A <code>app</code> <code>151.101.1.195</code> A <code>app</code> <code>151.101.65.195</code> <p>\u6ce8\u610f: IP\u30a2\u30c9\u30ec\u30b9\u306fFirebase\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u8868\u793a\u3055\u308c\u308b\u5024\u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\uff08\u5909\u66f4\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\uff09</p>"},{"location":"gcp-firebase/99_custom_domain/#2-4-ssl","title":"2-4. SSL\u8a3c\u660e\u66f8\u306e\u767a\u884c\u5f85\u3061","text":"<ul> <li>Firebase Hosting\u3082\u81ea\u52d5\u3067SSL\u8a3c\u660e\u66f8\u3092\u767a\u884c\u3057\u307e\u3059</li> <li>\u901a\u5e38\u6570\u6642\u9593\u301c24\u6642\u9593\u7a0b\u5ea6\u304b\u304b\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059</li> </ul>"},{"location":"gcp-firebase/99_custom_domain/#step-3-firebase","title":"Step 3: Firebase\u8a8d\u8a3c\u6e08\u307f\u30c9\u30e1\u30a4\u30f3\u306e\u66f4\u65b0\uff08\u91cd\u8981\uff09","text":"<p>\u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\u3067Google\u30ed\u30b0\u30a4\u30f3\u3092\u4f7f\u7528\u3059\u308b\u306b\u306f\u3001\u5fc5\u305a\u627f\u8a8d\u6e08\u307f\u30c9\u30e1\u30a4\u30f3\u3078\u306e\u8ffd\u52a0\u304c\u5fc5\u8981\u3067\u3059\u3002</p>"},{"location":"gcp-firebase/99_custom_domain/#_4","title":"\u306a\u305c\u5fc5\u8981\u304b\uff1f","text":"<p>Firebase Authentication\u306f\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u4e0a\u306e\u7406\u7531\u304b\u3089\u3001OAuth\u8a8d\u8a3c\uff08Google\u30ed\u30b0\u30a4\u30f3\u7b49\uff09\u3092\u8a31\u53ef\u3059\u308b\u30c9\u30e1\u30a4\u30f3\u3092\u5236\u9650\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u300c\u30aa\u30fc\u30d7\u30f3\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u653b\u6483\u300d\u3092\u9632\u3050\u305f\u3081\u3067\u3059\u3002</p> <pre><code>\u3010\u627f\u8a8d\u6e08\u307f\u30c9\u30e1\u30a4\u30f3\u304c\u306a\u3044\u3068\u8d77\u3053\u308b\u3053\u3068\u3011\n\n\u30e6\u30fc\u30b6\u30fc: \u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\uff08chat.example.com\uff09\u3067\u30ed\u30b0\u30a4\u30f3\n    \u2193\nFirebase: \u300c\u3053\u306e\u30c9\u30e1\u30a4\u30f3\u306f\u8a31\u53ef\u30ea\u30b9\u30c8\u306b\u306a\u3044\uff01\u300d\n    \u2193\n\u30a8\u30e9\u30fc: \u300cauth/unauthorized-domain\u300d\n    \u2193\n\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u3044\n</code></pre>"},{"location":"gcp-firebase/99_custom_domain/#_5","title":"\u8a2d\u5b9a\u624b\u9806","text":"<ol> <li>Firebase\u30b3\u30f3\u30bd\u30fc\u30eb \u2192 Authentication \u2192 Settings</li> <li>\u300c\u627f\u8a8d\u6e08\u307f\u30c9\u30e1\u30a4\u30f3\u300d \u30bf\u30d6\u3092\u30af\u30ea\u30c3\u30af</li> <li>\u300c\u30c9\u30e1\u30a4\u30f3\u3092\u8ffd\u52a0\u300d \u3092\u30af\u30ea\u30c3\u30af</li> <li>\u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\u3092\u5165\u529b\uff08<code>https://</code> \u306f\u542b\u3081\u306a\u3044\uff09:    <pre><code>chat.example.com\n</code></pre></li> <li>\u300c\u8ffd\u52a0\u300d\u3092\u30af\u30ea\u30c3\u30af</li> </ol>"},{"location":"gcp-firebase/99_custom_domain/#_6","title":"\u8907\u6570\u30c9\u30e1\u30a4\u30f3\u3092\u4f7f\u3046\u5834\u5408","text":"<p>\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3068API\u3067\u7570\u306a\u308b\u30c9\u30e1\u30a4\u30f3\u3092\u4f7f\u3046\u5834\u5408\u306f\u3001\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u306e\u30c9\u30e1\u30a4\u30f3\u306e\u307f\u8ffd\u52a0\u3059\u308c\u3070OK\u3067\u3059\u3002</p> \u30c9\u30e1\u30a4\u30f3 \u7528\u9014 \u627f\u8a8d\u6e08\u307f\u30c9\u30e1\u30a4\u30f3\u3078\u306e\u8ffd\u52a0 <code>chat.example.com</code> \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\uff08\u30ed\u30b0\u30a4\u30f3\u753b\u9762\uff09 \u2713 \u5fc5\u8981 <code>api.example.com</code> \u30d0\u30c3\u30af\u30a8\u30f3\u30c9API \u4e0d\u8981 <p>\u6ce8\u610f: \u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\u8a2d\u5b9a\u5f8c\u3082\u3001\u5143\u306eCloud Run URL\u3067\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u3067\u3059\u3002 \u4e21\u65b9\u306e\u30c9\u30e1\u30a4\u30f3\u3067\u30ed\u30b0\u30a4\u30f3\u3092\u8a31\u53ef\u3057\u305f\u3044\u5834\u5408\u306f\u3001\u4e21\u65b9\u3068\u3082\u627f\u8a8d\u6e08\u307f\u30c9\u30e1\u30a4\u30f3\u306b\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"gcp-firebase/99_custom_domain/#dns","title":"DNS\u8a2d\u5b9a\u307e\u3068\u3081","text":"<p>\u6700\u7d42\u7684\u306aDNS\u8a2d\u5b9a\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002</p> \u30ec\u30b3\u30fc\u30c9\u30bf\u30a4\u30d7 \u30db\u30b9\u30c8\u540d \u5024 \u7528\u9014 TXT <code>app</code> <code>firebase=xxxx</code> Firebase\u6240\u6709\u6a29\u78ba\u8a8d A <code>app</code> <code>151.101.1.195</code> Firebase Hosting A <code>app</code> <code>151.101.65.195</code> Firebase Hosting CNAME <code>api</code> <code>ghs.googlehosted.com.</code> Cloud Run"},{"location":"gcp-firebase/99_custom_domain/#_7","title":"\u53cd\u6620\u78ba\u8a8d","text":""},{"location":"gcp-firebase/99_custom_domain/#dns_1","title":"DNS\u306e\u53cd\u6620\u78ba\u8a8d","text":"<p>DNS\u30c1\u30a7\u30c3\u30ab\u30fc\u3067\u8a2d\u5b9a\u304c\u53cd\u6620\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002</p> <ul> <li> <p>https://www.whatsmydns.net</p> </li> <li> <p>\u30c9\u30e1\u30a4\u30f3\u540d\u3092\u5165\u529b\uff08\u4f8b: <code>api.example.com</code>\uff09</p> </li> <li>\u30ec\u30b3\u30fc\u30c9\u30bf\u30a4\u30d7\u3092\u9078\u629e\uff08CNAME \u307e\u305f\u306f A\uff09</li> <li>\u300cSearch\u300d\u3092\u30af\u30ea\u30c3\u30af</li> <li>\u4e16\u754c\u5404\u5730\u306eDNS\u30b5\u30fc\u30d0\u30fc\u3067\u53cd\u6620\u72b6\u6cc1\u3092\u78ba\u8a8d</li> </ul> <p>\u6ce8\u610f: DNS\u53cd\u6620\u306b\u306f\u6700\u592748\u6642\u9593\u304b\u304b\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\uff08\u901a\u5e38\u306f\u6570\u6642\u9593\u4ee5\u5185\uff09</p>"},{"location":"gcp-firebase/99_custom_domain/#_8","title":"\u63a5\u7d9a\u78ba\u8a8d","text":"\u78ba\u8a8d\u9805\u76ee URL \u671f\u5f85\u3059\u308b\u7d50\u679c \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9 <code>https://app.example.com</code> \u30a2\u30d7\u30ea\u753b\u9762\u304c\u8868\u793a \u30d0\u30c3\u30af\u30a8\u30f3\u30c9 <code>https://api.example.com</code> API\u5fdc\u7b54 or Hello World HTTPS \u4e21\u65b9 \u30d6\u30e9\u30a6\u30b6\u306b\u9375\u30de\u30fc\u30af\u304c\u8868\u793a"},{"location":"gcp-firebase/99_custom_domain/#_9","title":"\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0","text":""},{"location":"gcp-firebase/99_custom_domain/#ssl","title":"SSL\u8a3c\u660e\u66f8\u304c\u767a\u884c\u3055\u308c\u306a\u3044","text":"<p>\u75c7\u72b6: \u6570\u6642\u9593\u7d4c\u3063\u3066\u3082\u300c\u8a3c\u660e\u66f8\u306e\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u4e2d\u300d\u306e\u307e\u307e</p> <p>\u539f\u56e0\u3068\u5bfe\u51e6: - DNS\u30ec\u30b3\u30fc\u30c9\u304c\u6b63\u3057\u304f\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044 \u2192 DNS\u8a2d\u5b9a\u3092\u518d\u78ba\u8a8d - DNS\u304c\u53cd\u6620\u3055\u308c\u3066\u3044\u306a\u3044 \u2192 whatsmydns.net \u3067\u78ba\u8a8d\u3001\u6570\u6642\u9593\u5f85\u3064 - CAA\u30ec\u30b3\u30fc\u30c9\u304c\u5236\u9650\u3057\u3066\u3044\u308b \u2192 CAA\u30ec\u30b3\u30fc\u30c9\u304c\u3042\u308c\u3070\u524a\u9664\u307e\u305f\u306f\u8a31\u53ef\u8a2d\u5b9a</p>"},{"location":"gcp-firebase/99_custom_domain/#_10","title":"\u300c\u3053\u306e\u30b5\u30a4\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u305b\u3093\u300d","text":"<p>\u539f\u56e0\u3068\u5bfe\u51e6: - DNS\u8a2d\u5b9a\u304c\u53cd\u6620\u3055\u308c\u3066\u3044\u306a\u3044 \u2192 \u6570\u6642\u9593\u5f85\u3064 - DNS\u30ec\u30b3\u30fc\u30c9\u306e\u5024\u304c\u9593\u9055\u3063\u3066\u3044\u308b \u2192 \u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u8868\u793a\u5024\u3068\u6bd4\u8f03 - \u30c9\u30e1\u30a4\u30f3\u306e\u6709\u52b9\u671f\u9650\u5207\u308c \u2192 \u30c9\u30e1\u30a4\u30f3\u7ba1\u7406\u753b\u9762\u3067\u78ba\u8a8d</p>"},{"location":"gcp-firebase/99_custom_domain/#google","title":"Google\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u3044","text":"<p>\u539f\u56e0\u3068\u5bfe\u51e6: - \u627f\u8a8d\u6e08\u307f\u30c9\u30e1\u30a4\u30f3\u306b\u8ffd\u52a0\u3057\u3066\u3044\u306a\u3044 \u2192 Firebase Authentication \u2192 Settings \u3067\u8ffd\u52a0 - <code>http://</code> \u3067\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3044\u308b \u2192 <code>https://</code> \u3092\u4f7f\u7528</p>"},{"location":"gcp-firebase/99_custom_domain/#_11","title":"\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u30b3\u30fc\u30c9\u306e\u5909\u66f4","text":"<p>\u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u3001\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u306eAPI\u547c\u3073\u51fa\u3057\u5148\u3092\u5909\u66f4\u3057\u307e\u3059\u3002</p> <pre><code>// \u5909\u66f4\u524d\uff08\u30c7\u30d5\u30a9\u30eb\u30c8URL\uff09\nconst API_URL = 'https://ai-platform-tenant-a-xxxxx.run.app';\n\n// \u5909\u66f4\u5f8c\uff08\u30ab\u30b9\u30bf\u30e0\u30c9\u30e1\u30a4\u30f3\uff09\nconst API_URL = 'https://api.example.com';\n</code></pre>"},{"location":"gcp-firebase/99_custom_domain/#vs","title":"\u53c2\u8003: \u30b5\u30d6\u30c9\u30e1\u30a4\u30f3 vs \u30eb\u30fc\u30c8\u30c9\u30e1\u30a4\u30f3","text":"\u8a2d\u5b9a \u4f8b \u63a8\u5968 \u30b5\u30d6\u30c9\u30e1\u30a4\u30f3 <code>app.example.com</code>, <code>api.example.com</code> \u63a8\u5968 \u30eb\u30fc\u30c8\u30c9\u30e1\u30a4\u30f3 <code>example.com</code> \u8a2d\u5b9a\u304c\u8907\u96d1\u306b\u306a\u308b\u5834\u5408\u3042\u308a <p>\u30b5\u30d6\u30c9\u30e1\u30a4\u30f3\u3092\u4f7f\u7528\u3059\u308b\u7406\u7531: - CNAME\u30ec\u30b3\u30fc\u30c9\u304c\u4f7f\u3048\u308b\uff08\u30eb\u30fc\u30c8\u30c9\u30e1\u30a4\u30f3\u3067\u306f\u4f7f\u3048\u306a\u3044\u5834\u5408\u304c\u3042\u308b\uff09 - \u7528\u9014\u3054\u3068\u306b\u5206\u96e2\u3067\u304d\u308b\uff08<code>app.</code>, <code>api.</code>, <code>admin.</code> \u306a\u3069\uff09 - \u5c06\u6765\u7684\u306a\u62e1\u5f35\u304c\u3057\u3084\u3059\u3044</p>"},{"location":"gcp-firebase/99_service_account/","title":"\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3068\u306f\uff08\u88dc\u8db3\u8cc7\u6599\uff09","text":"<p>\u3053\u306e\u8cc7\u6599\u306f\u300cCloud Run\uff08\u30b5\u30fc\u30d3\u30b9\uff09\u7248\u300d\u3067\u4f7f\u7528\u3059\u308b\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u89e3\u8aac\u3067\u3059\u3002 Cloud Run functions\u7248\uff0802_\u69cb\u7bc9\u624b\u9806\u66f8.md\uff09\u3067\u306f\u3001\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u660e\u793a\u7684\u306b\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f7f\u7528\uff09\u3002</p>"},{"location":"gcp-firebase/99_service_account/#_2","title":"\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4e00\u8a00\u3067","text":"<p>\u30a2\u30d7\u30ea\u5c02\u7528\u306eGoogle\u30a2\u30ab\u30a6\u30f3\u30c8 \u3067\u3059\u3002</p>"},{"location":"gcp-firebase/99_service_account/#_3","title":"\u4eba\u9593\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3068\u306e\u9055\u3044","text":"\u9805\u76ee \u4eba\u9593\u306e\u30a2\u30ab\u30a6\u30f3\u30c8 \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8 \u4f7f\u3046\u4eba \u3042\u306a\u305f\uff08\u4eba\u9593\uff09 \u30a2\u30d7\u30ea\uff08\u30d7\u30ed\u30b0\u30e9\u30e0\uff09 \u30ed\u30b0\u30a4\u30f3 \u30e1\u30fc\u30eb + \u30d1\u30b9\u30ef\u30fc\u30c9 \u81ea\u52d5\uff08\u30ad\u30fc\u30d5\u30a1\u30a4\u30eb\u7b49\uff09 \u4f8b <code>tanaka@gmail.com</code> <code>sa-tenant-a@project-id.iam.gserviceaccount.com</code> \u7528\u9014 GCP\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u30ed\u30b0\u30a4\u30f3 \u30a2\u30d7\u30ea\u304cGCP\u30b5\u30fc\u30d3\u30b9\u3092\u5229\u7528"},{"location":"gcp-firebase/99_service_account/#_4","title":"\u306a\u305c\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u5fc5\u8981\u306a\u306e\u304b","text":""},{"location":"gcp-firebase/99_service_account/#gcp","title":"\u554f\u984c: \u30a2\u30d7\u30ea\u304cGCP\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u3044\u305f\u3044","text":"<pre><code>Cloud Run\uff08\u30a2\u30d7\u30ea\uff09\u304c Secret Manager\uff08API\u30ad\u30fc\u4fdd\u7ba1\u5eab\uff09\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3044\n\n\u3067\u3082...\n\u30fb\u30a2\u30d7\u30ea\u306f\u4eba\u9593\u3058\u3083\u306a\u3044\u304b\u3089Google\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u3044\n\u30fb\u304b\u3068\u3044\u3063\u3066\u8ab0\u3067\u3082\u30a2\u30af\u30bb\u30b9\u3067\u304d\u305f\u3089\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u7684\u306b\u5371\u967a\n</code></pre>"},{"location":"gcp-firebase/99_service_account/#_5","title":"\u89e3\u6c7a: \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8","text":"<pre><code>\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u6210\n    \u2193\n\u300c\u3053\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u306fSecret Manager\u3092\u8aad\u3093\u3067\u3044\u3044\u3088\u300d\u3068\u6a29\u9650\u3092\u4ed8\u4e0e\n    \u2193\nCloud Run\u306b\u300c\u3053\u306e\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f7f\u3063\u3066\u306d\u300d\u3068\u8a2d\u5b9a\n    \u2193\nCloud Run\u304cSecret Manager\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\uff01\n</code></pre>"},{"location":"gcp-firebase/99_service_account/#_6","title":"\u8eab\u8fd1\u306a\u4f8b\u3048\u3067\u7406\u89e3\u3059\u308b","text":""},{"location":"gcp-firebase/99_service_account/#1","title":"\u4f8b1: \u4f1a\u793e\u306e\u5165\u9928\u8a3c","text":"<pre><code>\u4eba\u9593\u306e\u30a2\u30ab\u30a6\u30f3\u30c8 = \u793e\u54e1\u8a3c\uff08\u3042\u306a\u305f\u5c02\u7528\uff09\n\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8 = \u696d\u8005\u7528\u306e\u5165\u9928\u8a3c\uff08\u914d\u9001\u30ed\u30dc\u30c3\u30c8\u7528\uff09\n\n\u914d\u9001\u30ed\u30dc\u30c3\u30c8\u306b\u300c\u5009\u5eab\u30a8\u30ea\u30a2\u3060\u3051\u5165\u308c\u308b\u5165\u9928\u8a3c\u300d\u3092\u6e21\u3059\n\u2192 \u30ed\u30dc\u30c3\u30c8\u306f\u5009\u5eab\u306b\u306f\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u304c\u3001\u30aa\u30d5\u30a3\u30b9\u306b\u306f\u5165\u308c\u306a\u3044\n</code></pre>"},{"location":"gcp-firebase/99_service_account/#2","title":"\u4f8b2: \u9280\u884c\u306e\u4ee3\u7406\u4eba","text":"<pre><code>\u3042\u306a\u305f = \u9280\u884c\u53e3\u5ea7\u306e\u6301\u3061\u4e3b\n\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8 = \u59d4\u4efb\u72b6\u3092\u6301\u3063\u305f\u4ee3\u7406\u4eba\n\n\u300c\u3053\u306e\u4ee3\u7406\u4eba\u306f\u6b8b\u9ad8\u7167\u4f1a\u3060\u3051\u3067\u304d\u307e\u3059\u300d\u3068\u9650\u5b9a\u3057\u305f\u6a29\u9650\u3092\u4e0e\u3048\u308b\n\u2192 \u4ee3\u7406\u4eba\u306f\u6b8b\u9ad8\u306f\u898b\u308c\u308b\u304c\u3001\u5f15\u304d\u51fa\u3057\u306f\u3067\u304d\u306a\u3044\n</code></pre>"},{"location":"gcp-firebase/99_service_account/#cloud-run","title":"Cloud Run\uff08\u30b5\u30fc\u30d3\u30b9\uff09\u7248\u3067\u306e\u4f7f\u3044\u65b9","text":"<pre><code>+------------------------------------------------------------------+\n|                        GCP\u30d7\u30ed\u30b8\u30a7\u30af\u30c8                            |\n|                                                                  |\n|  +-------------------+           +-------------------------+     |\n|  | Cloud Run         |           | Secret Manager          |     |\n|  | (\u30b5\u30fc\u30d3\u30b9)        |  \u30a2\u30af\u30bb\u30b9  | (API\u30ad\u30fc\u4fdd\u7ba1\u5eab)          |     |\n|  |                   | --------&gt; |                         |     |\n|  | \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8: |           | tenant-a-openai-key     |     |\n|  | sa-tenant-a       |           |                         |     |\n|  +-------------------+           | \u30a2\u30af\u30bb\u30b9\u8a31\u53ef:            |     |\n|                                  | sa-tenant-a [OK]        |     |\n|                                  +-------------------------+     |\n+------------------------------------------------------------------+\n</code></pre> <ol> <li>\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u4f5c\u6210: <code>sa-tenant-a</code> \u3068\u3044\u3046\u540d\u524d\u3067\u4f5c\u6210</li> <li>\u6a29\u9650\u4ed8\u4e0e: Secret Manager\u306e\u7279\u5b9a\u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u306b\u5bfe\u3057\u3066\u300c\u8aad\u307f\u53d6\u308a\u6a29\u9650\u300d\u3092\u4ed8\u4e0e</li> <li>Cloud Run\u30b5\u30fc\u30d3\u30b9\u306b\u8a2d\u5b9a: Cloud Run\u304c\u3053\u306e\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f7f\u3046\u3088\u3046\u306b\u8a2d\u5b9a</li> <li>\u30a2\u30af\u30bb\u30b9\u6210\u529f: Cloud Run\u304cAPI\u30ad\u30fc\u3092\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b</li> </ol> <p>Cloud Run functions\u7248\u3068\u306e\u9055\u3044 Cloud Run functions\u7248\u3067\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002 \u95a2\u6570\u4f5c\u6210\u6642\u306b\u300c\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u53c2\u7167\u300d\u304b\u3089\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u7d10\u4ed8\u3051\u308b\u3060\u3051\u3067OK\u3067\u3059\u3002</p>"},{"location":"gcp-firebase/99_service_account/#_7","title":"\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u30e1\u30ea\u30c3\u30c8","text":""},{"location":"gcp-firebase/99_service_account/#1_1","title":"1. \u6700\u5c0f\u6a29\u9650\u306e\u539f\u5247","text":"<pre><code>\u60aa\u3044\u4f8b:\n\u30a2\u30d7\u30ea\u306b\u7ba1\u7406\u8005\u6a29\u9650\u3092\u4e0e\u3048\u308b \u2192 \u4f55\u3067\u3082\u3067\u304d\u3066\u3057\u307e\u3046\uff08\u5371\u967a\uff09\n\n\u826f\u3044\u4f8b:\n\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u5fc5\u8981\u6700\u5c0f\u9650\u306e\u6a29\u9650\u3060\u3051\u4e0e\u3048\u308b\n\u2192 \u300cSecret Manager\u306e\u8aad\u307f\u53d6\u308a\u3060\u3051\u300d\u306a\u3069\u9650\u5b9a\u3067\u304d\u308b\n</code></pre>"},{"location":"gcp-firebase/99_service_account/#2_1","title":"2. \u76e3\u67fb\u30ed\u30b0","text":"<pre><code>\u8ab0\u304c\uff08\u3069\u306e\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\uff09\n\u3044\u3064\n\u4f55\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u304b\n\n\u3059\u3079\u3066\u8a18\u9332\u3055\u308c\u308b \u2192 \u554f\u984c\u304c\u8d77\u304d\u305f\u6642\u306b\u8ffd\u8de1\u53ef\u80fd\n</code></pre>"},{"location":"gcp-firebase/99_service_account/#3","title":"3. \u6a29\u9650\u306e\u5206\u96e2","text":"<pre><code>\u30c6\u30ca\u30f3\u30c8A\u7528: sa-tenant-a \u2192 tenant-a-openai-key \u306b\u3060\u3051\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\n\u30c6\u30ca\u30f3\u30c8B\u7528: sa-tenant-b \u2192 tenant-b-openai-key \u306b\u3060\u3051\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\n\n\u4e92\u3044\u306e\u30c7\u30fc\u30bf\u306b\u306f\u30a2\u30af\u30bb\u30b9\u3067\u304d\u306a\u3044 \u2192 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5411\u4e0a\n</code></pre>"},{"location":"gcp-firebase/99_service_account/#_8","title":"\u3088\u304f\u3042\u308b\u8cea\u554f","text":""},{"location":"gcp-firebase/99_service_account/#q","title":"Q: \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306f\u5fc5\u305a\u4f5c\u308b\u5fc5\u8981\u304c\u3042\u308b\uff1f","text":"<p>A: \u5fc5\u9808\u3067\u306f\u306a\u3044\u304c\u3001\u63a8\u5968\u3067\u3059\u3002</p> <p>\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u3089\u306a\u3044\u5834\u5408\u3001Cloud Run\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f7f\u3044\u307e\u3059\u3002 \u305f\u3060\u3057\u30c7\u30d5\u30a9\u30eb\u30c8\u306f\u6a29\u9650\u304c\u5e83\u3059\u304e\u308b\u3053\u3068\u304c\u591a\u304f\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u4e0a\u306f\u5c02\u7528\u306e\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u308b\u65b9\u304c\u5b89\u5168\u3067\u3059\u3002</p>"},{"location":"gcp-firebase/99_service_account/#q_1","title":"Q: \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u6599\u91d1\u306f\u304b\u304b\u308b\uff1f","text":"<p>A: \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u81ea\u4f53\u306f\u7121\u6599\u3067\u3059\u3002</p> <p>\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u6210\u30fb\u4f7f\u7528\u3059\u308b\u3053\u3068\u81ea\u4f53\u306b\u306f\u6599\u91d1\u306f\u304b\u304b\u308a\u307e\u305b\u3093\u3002 \u6599\u91d1\u304c\u304b\u304b\u308b\u306e\u306f\u3001\u305d\u306e\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f7f\u3063\u3066\u30a2\u30af\u30bb\u30b9\u3059\u308bGCP\u30b5\u30fc\u30d3\u30b9\uff08Cloud Run\u3001Secret Manager\u7b49\uff09\u306e\u5229\u7528\u6599\u91d1\u3067\u3059\u3002</p>"},{"location":"gcp-firebase/99_service_account/#q-1","title":"Q: 1\u3064\u306e\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u8907\u6570\u306e\u30b5\u30fc\u30d3\u30b9\u3067\u4f7f\u3044\u56de\u3057\u3066\u3082\u3044\u3044\uff1f","text":"<p>A: \u53ef\u80fd\u3067\u3059\u304c\u3001\u5206\u3051\u305f\u65b9\u304c\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u7684\u306b\u5b89\u5168\u3067\u3059\u3002</p> <pre><code>\u4f7f\u3044\u56de\u3059\u5834\u5408:\nCloud Run A \u2500\u2500\u2510\n              \u251c\u2500\u2500 sa-shared \u2500\u2500 \u3059\u3079\u3066\u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\nCloud Run B \u2500\u2500\u2518\n\n\u5206\u3051\u308b\u5834\u5408:\nCloud Run A \u2500\u2500 sa-tenant-a \u2500\u2500 tenant-a \u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u306e\u307f\nCloud Run B \u2500\u2500 sa-tenant-b \u2500\u2500 tenant-b \u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u306e\u307f\n</code></pre>"},{"location":"gcp-firebase/99_service_account/#_9","title":"\u307e\u3068\u3081","text":"\u9805\u76ee \u8aac\u660e \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3068\u306f \u30a2\u30d7\u30ea\u5c02\u7528\u306eGoogle\u30a2\u30ab\u30a6\u30f3\u30c8 \u306a\u305c\u5fc5\u8981\u304b \u30a2\u30d7\u30ea\u304cGCP\u30b5\u30fc\u30d3\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081 \u30e1\u30ea\u30c3\u30c8 \u6700\u5c0f\u6a29\u9650\u3001\u76e3\u67fb\u30ed\u30b0\u3001\u6a29\u9650\u5206\u96e2 Cloud Run\uff08\u30b5\u30fc\u30d3\u30b9\uff09\u7248 \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u3066\u6a29\u9650\u4ed8\u4e0e Cloud Run functions\u7248 \u30c7\u30d5\u30a9\u30eb\u30c8SA\u3092\u4f7f\u7528\u3001\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u76f4\u63a5\u7d10\u4ed8\u3051"}]}